<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>ä½¿ç”¨batæ‰¹å¤„ç†è„šæœ¬å¤åˆ¶æ–‡ä»¶å¤¹</title>
    <link href="/20230316181900/"/>
    <url>/20230316181900/</url>
    
    <content type="html"><![CDATA[<h1 id="ä½¿ç”¨batæ‰¹å¤„ç†è„šæœ¬å¤åˆ¶æ–‡ä»¶å¤¹"><a href="#ä½¿ç”¨batæ‰¹å¤„ç†è„šæœ¬å¤åˆ¶æ–‡ä»¶å¤¹" class="headerlink" title="ä½¿ç”¨batæ‰¹å¤„ç†è„šæœ¬å¤åˆ¶æ–‡ä»¶å¤¹"></a>ä½¿ç”¨batæ‰¹å¤„ç†è„šæœ¬å¤åˆ¶æ–‡ä»¶å¤¹</h1><p>éœ€æ±‚ï¼šä½¿ç”¨hexoåœ¨å‘å¸ƒåšå®¢æ–‡ç« æ—¶ï¼Œéœ€è¦å°†æ–‡ä»¶å¤åˆ¶åˆ° <code>source\_posts</code> ç›®å½•ä¸‹ï¼Œæ¯æ¬¡æ‰‹åŠ¨å¤åˆ¶å¾ˆéº»çƒ¦ï¼Œæ‰€ä»¥è¿™è¾¹å†™äº†ä¸ªæ‰¹å¤„ç†è„šæœ¬æ¥æ‰§è¡Œã€‚</p><p>æ–°å»ºä¸€ä¸ª <code>xxx.bat</code> æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ä¸ºï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs sh">@<span class="hljs-built_in">echo</span> off  <br><br>:: å˜é‡å£°æ˜<br>:: è¦å¤åˆ¶çš„ç›®å½•ã€‚<br><span class="hljs-built_in">set</span> sourceDir=E:\01 åšå®¢\æœ¬åœ°åšå®¢<br>:: ç›®æ ‡ç›®å½•<br><span class="hljs-built_in">set</span> destDir=E:\01 åšå®¢\MyBlog\<span class="hljs-built_in">source</span>\_posts<br><br>:: åˆ é™¤æ—§çš„æ ‘ç›®å½•<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;æ­£åœ¨åˆ é™¤æ—§æ•°æ®.........&quot;</span>  <br>rd <span class="hljs-string">&quot;%destDir%&quot;</span> /s<br><br>:: å¤åˆ¶æ–‡ä»¶å¤¹åˆ°æŒ‡å®šç›®å½•<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;æ­£åœ¨å¤åˆ¶æ•°æ®.........&quot;</span>  <br>xcopy <span class="hljs-string">&quot;%sourceDir%&quot;</span> <span class="hljs-string">&quot;%destDir%&quot;</span> /e/h<br><br>pause<br></code></pre></td></tr></table></figure><p><em><strong>æ³¨ï¼šå¦‚æœè·¯å¾„æœ‰ä¸­æ–‡ï¼Œéœ€è¦å°†batæ–‡ä»¶å¦å­˜ä¸ºANSIæ ¼å¼å°±èƒ½æ­£å¸¸æ‰§è¡Œã€‚</strong></em></p><p>é™„ï¼šç›¸å…³å‘½ä»¤å‚æ•°å¯ä»¥æŸ¥çœ‹ä½¿ç”¨å¸®åŠ©ï¼Œä½¿ç”¨ <code>å‘½ä»¤å /?</code> ï¼Œå¦‚ï¼š<code>xcopy /?</code>ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>DOS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>DOS</tag>
      
      <tag>batæ‰¹å¤„ç†</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Zookeeperé›†ç¾¤æ­å»º</title>
    <link href="/20230316124100/"/>
    <url>/20230316124100/</url>
    
    <content type="html"><![CDATA[<h1 id="Zookeeperé›†ç¾¤æ­å»º"><a href="#Zookeeperé›†ç¾¤æ­å»º" class="headerlink" title="Zookeeperé›†ç¾¤æ­å»º"></a>Zookeeperé›†ç¾¤æ­å»º</h1><blockquote><p>æœ¬æ–‡ä¸»è¦ä»‹ç»Zookeeperé›†ç¾¤æ­å»ºä»¥åŠé€šè¿‡æ¨¡æ‹Ÿæ•…éšœæ¼”ç¤ºé€‰ä¸¾æœºåˆ¶ã€‚</p></blockquote><h2 id="1-1-æ­å»ºè¦æ±‚"><a href="#1-1-æ­å»ºè¦æ±‚" class="headerlink" title="1.1 æ­å»ºè¦æ±‚"></a>1.1 æ­å»ºè¦æ±‚</h2><p>çœŸå®çš„é›†ç¾¤æ˜¯éœ€è¦éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šçš„ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬æµ‹è¯•æ—¶åŒæ—¶å¯åŠ¨å¾ˆå¤šä¸ªè™šæ‹Ÿæœºå†…å­˜ä¼šåƒä¸æ¶ˆï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸ä¼šæ­å»º<strong>ä¼ªé›†ç¾¤</strong>ï¼Œä¹Ÿå°±æ˜¯æŠŠæ‰€æœ‰çš„æœåŠ¡éƒ½æ­å»ºåœ¨ä¸€å°è™šæ‹Ÿæœºä¸Šï¼Œç”¨ç«¯å£è¿›è¡ŒåŒºåˆ†ã€‚</p><p>æˆ‘ä»¬è¿™é‡Œè¦æ±‚æ­å»ºä¸€ä¸ªä¸‰ä¸ªèŠ‚ç‚¹çš„Zookeeperé›†ç¾¤ï¼ˆä¼ªé›†ç¾¤ï¼‰ã€‚</p><h2 id="1-2-å‡†å¤‡å·¥ä½œ"><a href="#1-2-å‡†å¤‡å·¥ä½œ" class="headerlink" title="1.2 å‡†å¤‡å·¥ä½œ"></a>1.2 å‡†å¤‡å·¥ä½œ</h2><p>é‡æ–°éƒ¨ç½²ä¸€å°è™šæ‹Ÿæœºä½œä¸ºæˆ‘ä»¬æ­å»ºé›†ç¾¤çš„æµ‹è¯•æœåŠ¡å™¨ã€‚</p><ol><li><p>å®‰è£…JDK  ã€æ­¤æ­¥éª¤çœç•¥ã€‘ã€‚</p></li><li><p>Zookeeperå‹ç¼©åŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚</p></li><li><p>å°†Zookeeperè§£å‹ ï¼Œå»ºç«‹&#x2F;usr&#x2F;zookeeper-clusterç›®å½•ï¼Œå°†è§£å‹åçš„Zookeeperåˆ†åˆ«å¤åˆ¶åˆ°ä»¥ä¸‹ä¸‰ä¸ªç›®å½•ï¼š</p><ul><li><p><code>/usr/zookeeper-cluster/zookeeper-1</code></p></li><li><p><code>/usr/zookeeper-cluster/zookeeper-2</code></p></li><li><p><code>/usr/zookeeper-cluster/zookeeper-3</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ›å»ºé›†ç¾¤ç›®å½•</span><br>mkdir /usr/zookeeper-cluster<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¤åˆ¶</span><br>cp -r apache-zookeeper-3.5.6-bin /usr/zookeeper-cluster/zookeeper-1<br>cp -r apache-zookeeper-3.5.6-bin /usr/zookeeper-cluster/zookeeper-2<br>cp -r apache-zookeeper-3.5.6-bin /usr/zookeeper-cluster/zookeeper-3<br></code></pre></td></tr></table></figure></li></ul></li><li><p>åˆ›å»ºdataç›®å½• ï¼Œå¹¶ä¸”å°† confä¸‹zoo_sample.cfg æ–‡ä»¶æ”¹åä¸º zoo.cfg</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ›å»ºdataç›®å½•</span><br>mkdir /usr/zookeeper-cluster/zookeeper-1/data<br>mkdir /usr/zookeeper-cluster/zookeeper-2/data<br>mkdir /usr/zookeeper-cluster/zookeeper-3/data<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ–‡ä»¶æ”¹åä¸º zoo.cfg</span><br>mv /usr/zookeeper-cluster/zookeeper-1/conf/zoo_sample.cfg /usr/zookeeper-cluster/zookeeper-1/conf/zoo.cfg<br>mv /usr/zookeeper-cluster/zookeeper-2/conf/zoo_sample.cfg /usr/zookeeper-cluster/zookeeper-2/conf/zoo.cfg<br>mv /usr/zookeeper-cluster/zookeeper-3/conf/zoo_sample.cfg /usr/zookeeper-cluster/zookeeper-3/conf/zoo.cfg<br></code></pre></td></tr></table></figure></li><li><p>é…ç½®æ¯ä¸€ä¸ªZookeeper çš„dataDir å’Œ clientPort åˆ†åˆ«ä¸º2181ã€2182 ã€2183</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ†åˆ«ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br>vim /usr/zookeeper-cluster/zookeeper-1/conf/zoo.cfg<br><span class="hljs-meta prompt_"># </span><span class="language-bash">clientPort=2181</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">dataDir=/usr/zookeeper-cluster/zookeeper-1/data</span><br><br>vim /usr/zookeeper-cluster/zookeeper-2/conf/zoo.cfg<br><span class="hljs-meta prompt_"># </span><span class="language-bash">clientPort=2182</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">dataDir=/usr/zookeeper-cluster/zookeeper-2/data</span><br><br>vim /usr/zookeeper-cluster/zookeeper-3/conf/zoo.cfg<br><span class="hljs-meta prompt_"># </span><span class="language-bash">clientPort=2183</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">dataDir=/usr/zookeeper-cluster/zookeeper-3/data</span><br></code></pre></td></tr></table></figure></li></ol><h2 id="1-3-é…ç½®é›†ç¾¤"><a href="#1-3-é…ç½®é›†ç¾¤" class="headerlink" title="1.3 é…ç½®é›†ç¾¤"></a>1.3 é…ç½®é›†ç¾¤</h2><ol><li><p>åœ¨æ¯ä¸ªzookeeperçš„ <code>data</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª <code>myid</code> æ–‡ä»¶ï¼Œå†…å®¹åˆ†åˆ«æ˜¯1ã€2ã€3 ã€‚è¿™ä¸ªæ–‡ä»¶å°±æ˜¯è®°å½•æ¯ä¸ªæœåŠ¡å™¨çš„IDã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æ–°å»ºæ–‡ä»¶å¹¶è¿½åŠ å†…å®¹åˆ°æ–‡ä»¶ä¸­</span><br>echo 1 &gt;/usr/zookeeper-cluster/zookeeper-1/data/myid<br>echo 2 &gt;/usr/zookeeper-cluster/zookeeper-2/data/myid<br>echo 3 &gt;/usr/zookeeper-cluster/zookeeper-3/data/myid<br></code></pre></td></tr></table></figure></li><li><p>åœ¨<strong>æ¯ä¸€ä¸ªzookeeper çš„ zoo.cfg</strong>é…ç½®é›†ç¾¤æœåŠ¡å™¨IPåˆ—è¡¨ã€‚</p><p>é›†ç¾¤æœåŠ¡å™¨IPåˆ—è¡¨å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim /usr/zookeeper-cluster/zookeeper-1/conf/zoo.cfg<br>vim /usr/zookeeper-cluster/zookeeper-2/conf/zoo.cfg<br>vim /usr/zookeeper-cluster/zookeeper-3/conf/zoo.cfg<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">é›†ç¾¤é…ç½®</span><br>server.1=192.168.18.123:2881:3881<br>server.2=192.168.18.123:2882:3882<br>server.3=192.168.18.123:2883:3883<br></code></pre></td></tr></table></figure><p>è§£é‡Šï¼šserver<code>.</code>æœåŠ¡å™¨ID<code>=</code>æœåŠ¡å™¨IPåœ°å€<code>:</code>æœåŠ¡å™¨ä¹‹é—´é€šä¿¡ç«¯å£<code>:</code>æœåŠ¡å™¨ä¹‹é—´æŠ•ç¥¨é€‰ä¸¾ç«¯å£</p></li></ol><h2 id="1-4-å¯åŠ¨é›†ç¾¤"><a href="#1-4-å¯åŠ¨é›†ç¾¤" class="headerlink" title="1.4 å¯åŠ¨é›†ç¾¤"></a>1.4 å¯åŠ¨é›†ç¾¤</h2><p>å¯åŠ¨é›†ç¾¤å°±æ˜¯åˆ†åˆ«å¯åŠ¨æ¯ä¸ªå®ä¾‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å¯åŠ¨æœåŠ¡</span><br>/usr/zookeeper-cluster/zookeeper-1/bin/zkServer.sh start<br>/usr/zookeeper-cluster/zookeeper-2/bin/zkServer.sh start<br>/usr/zookeeper-cluster/zookeeper-3/bin/zkServer.sh start<br></code></pre></td></tr></table></figure><p><img src="/20230316124100/image-20230316133126326.png" alt="å¯åŠ¨3ä¸ªæœåŠ¡"></p><p>å¯åŠ¨åæˆ‘ä»¬æŸ¥è¯¢ä¸€ä¸‹æ¯ä¸ªå®ä¾‹çš„è¿è¡ŒçŠ¶æ€</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æœåŠ¡çŠ¶æ€</span><br>/usr/zookeeper-cluster/zookeeper-1/bin/zkServer.sh status<br>/usr/zookeeper-cluster/zookeeper-2/bin/zkServer.sh status<br>/usr/zookeeper-cluster/zookeeper-3/bin/zkServer.sh status<br></code></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœé…ç½®äº†é›†ç¾¤ï¼Œå½“æˆ‘ä»¬åªæœ‰ä¸€ä¸ªzk-serverå¯åŠ¨çš„æ—¶å€™ï¼Œå®ƒçš„çŠ¶æ€æ˜¯ä¸å¯ç”¨çš„ã€‚</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬è¿™è¾¹åªå¯åŠ¨äº†zk-server-1ï¼ŒæŸ¥çœ‹çŠ¶æ€ï¼š</p><p><img src="/20230316124100/image-20230316151742323.png" alt="é›†ç¾¤åªå¯åŠ¨ä¸€å°server"></p><p>å½“æˆ‘ä»¬å¯åŠ¨ç¬¬äºŒå°zk-serverçš„æ—¶å€™ï¼Œé›†ç¾¤çŠ¶æ€å¯ç”¨ï¼Œå¹¶ä¸”2å·serverè¢«é€‰ä¸¾ä¸ºleaderï¼š</p><p><img src="/20230316124100/image-20230316152011389.png" alt="ç¬¬äºŒå°serverå¯åŠ¨åè¢«é€‰ä¸¾ä¸ºleader"></p><p>å¯åŠ¨3å·serveråï¼ŒåŸæ¥çš„2å·å·²ç»æ˜¯leaderï¼Œä¸ä¼šå†è¿›è¡Œé€‰ä¸¾ï¼Œ3å·serverå¯åŠ¨ä¸ºfollowerï¼š</p><p><img src="/20230316124100/image-20230316152241542.png" alt="3å·serverå¯åŠ¨ä¸ºfollower"></p><h2 id="1-5-æ¨¡æ‹Ÿé›†ç¾¤å¼‚å¸¸"><a href="#1-5-æ¨¡æ‹Ÿé›†ç¾¤å¼‚å¸¸" class="headerlink" title="1.5 æ¨¡æ‹Ÿé›†ç¾¤å¼‚å¸¸"></a>1.5 æ¨¡æ‹Ÿé›†ç¾¤å¼‚å¸¸</h2><p>ï¼ˆ1ï¼‰é¦–å…ˆæˆ‘ä»¬å…ˆæµ‹è¯•å¦‚æœæ˜¯ä»æœåŠ¡å™¨æŒ‚æ‰ï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿ</p><p>æŠŠ3å·æœåŠ¡å™¨åœæ‰ï¼Œè§‚å¯Ÿ1å·å’Œ2å·ï¼Œå‘ç°çŠ¶æ€å¹¶æ²¡æœ‰å˜åŒ–ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">/usr/zookeeper-cluster/zookeeper-3/bin/zkServer.sh stop<br><br>/usr/zookeeper-cluster/zookeeper-1/bin/zkServer.sh status<br>/usr/zookeeper-cluster/zookeeper-2/bin/zkServer.sh status<br></code></pre></td></tr></table></figure><p><img src="/20230316124100/image-20230316152449969.png" alt="image-20230316152449969"></p><p>ç”±æ­¤å¾—å‡ºç»“è®ºï¼Œ3ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œä»æœåŠ¡å™¨æŒ‚æ‰ï¼Œé›†ç¾¤æ­£å¸¸</p><p>ï¼ˆ2ï¼‰æˆ‘ä»¬å†æŠŠ1å·æœåŠ¡å™¨ï¼ˆä»æœåŠ¡å™¨ï¼‰ä¹Ÿåœæ‰ï¼ŒæŸ¥çœ‹2å·ï¼ˆä¸»æœåŠ¡å™¨ï¼‰çš„çŠ¶æ€ï¼Œå‘ç°å·²ç»åœæ­¢è¿è¡Œäº†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">/usr/zookeeper-cluster/zookeeper-1/bin/zkServer.sh stop<br><br>/usr/zookeeper-cluster/zookeeper-2/bin/zkServer.sh status<br></code></pre></td></tr></table></figure><p>ç”±æ­¤å¾—å‡ºç»“è®ºï¼Œ3ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œ2ä¸ªä»æœåŠ¡å™¨éƒ½æŒ‚æ‰ï¼Œä¸»æœåŠ¡å™¨ä¹Ÿæ— æ³•è¿è¡Œã€‚å› ä¸ºå¯è¿è¡Œçš„æœºå™¨æ²¡æœ‰è¶…è¿‡é›†ç¾¤æ€»æ•°é‡çš„åŠæ•°ã€‚</p><p>ï¼ˆ3ï¼‰æˆ‘ä»¬å†æ¬¡æŠŠ1å·æœåŠ¡å™¨å¯åŠ¨èµ·æ¥ï¼Œå‘ç°2å·æœåŠ¡å™¨åˆå¼€å§‹æ­£å¸¸å·¥ä½œäº†ã€‚è€Œä¸”ä¾ç„¶æ˜¯é¢†å¯¼è€…ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">/usr/zookeeper-cluster/zookeeper-1/bin/zkServer.sh start<br><br>/usr/zookeeper-cluster/zookeeper-2/bin/zkServer.sh status<br></code></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰æˆ‘ä»¬æŠŠ3å·æœåŠ¡å™¨ä¹Ÿå¯åŠ¨èµ·æ¥ï¼ŒæŠŠ2å·æœåŠ¡å™¨åœæ‰,åœæ‰åè§‚å¯Ÿ1å·å’Œ3å·çš„çŠ¶æ€ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">/usr/zookeeper-cluster/zookeeper-3/bin/zkServer.sh start<br>/usr/zookeeper-cluster/zookeeper-2/bin/zkServer.sh stop<br><br>/usr/zookeeper-cluster/zookeeper-1/bin/zkServer.sh status<br>/usr/zookeeper-cluster/zookeeper-3/bin/zkServer.sh status<br></code></pre></td></tr></table></figure><p>å‘ç°æ–°çš„leaderäº§ç”Ÿäº†~  </p><p>ç”±æ­¤æˆ‘ä»¬å¾—å‡ºç»“è®ºï¼Œå½“é›†ç¾¤ä¸­çš„ä¸»æœåŠ¡å™¨æŒ‚äº†ï¼Œé›†ç¾¤ä¸­çš„å…¶ä»–æœåŠ¡å™¨ä¼šè‡ªåŠ¨è¿›è¡Œé€‰ä¸¾çŠ¶æ€ï¼Œç„¶åäº§ç”Ÿæ–°å¾—leader </p><p>ï¼ˆ5ï¼‰æˆ‘ä»¬å†æ¬¡æµ‹è¯•ï¼Œå½“æˆ‘ä»¬æŠŠ2å·æœåŠ¡å™¨é‡æ–°å¯åŠ¨èµ·æ¥å¯åŠ¨åï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ2å·æœåŠ¡å™¨ä¼šå†æ¬¡æˆä¸ºæ–°çš„é¢†å¯¼å—ï¼Ÿæˆ‘ä»¬çœ‹ç»“æœ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">/usr/zookeeper-cluster/zookeeper-2/bin/zkServer.sh start<br><br>/usr/zookeeper-cluster/zookeeper-2/bin/zkServer.sh status<br>/usr/zookeeper-cluster/zookeeper-3/bin/zkServer.sh status<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¼šå‘ç°ï¼Œ2å·æœåŠ¡å™¨å¯åŠ¨åä¾ç„¶æ˜¯è·Ÿéšè€…ï¼ˆä»æœåŠ¡å™¨ï¼‰ï¼Œ3å·æœåŠ¡å™¨ä¾ç„¶æ˜¯é¢†å¯¼è€…ï¼ˆä¸»æœåŠ¡å™¨ï¼‰ï¼Œæ²¡æœ‰æ’¼åŠ¨3å·æœåŠ¡å™¨çš„é¢†å¯¼åœ°ä½ã€‚</p><p>ç”±æ­¤æˆ‘ä»¬å¾—å‡ºç»“è®ºï¼Œå½“é¢†å¯¼è€…äº§ç”Ÿåï¼Œå†æ¬¡æœ‰æ–°æœåŠ¡å™¨åŠ å…¥é›†ç¾¤ï¼Œä¸ä¼šå½±å“åˆ°ç°ä»»é¢†å¯¼è€…ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Zookeeper</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Zookeeper</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Zookeeperä½¿ç”¨æ‰‹å†Œ</title>
    <link href="/20230315231727/"/>
    <url>/20230315231727/</url>
    
    <content type="html"><![CDATA[<h1 id="Zookeeperä½¿ç”¨æ‰‹å†Œ"><a href="#Zookeeperä½¿ç”¨æ‰‹å†Œ" class="headerlink" title="Zookeeperä½¿ç”¨æ‰‹å†Œ"></a>Zookeeperä½¿ç”¨æ‰‹å†Œ</h1><blockquote><p>æœ¬æ–‡ä¸»è¦ä»‹ç»ï¼š</p><p>1ã€zookeeperçš„æ¦‚å¿µå’ŒåŸºæœ¬ç”¨æ³•ã€‚</p><p>2ã€å¦‚ä½•é€šè¿‡Curatorè¿™ä¸ªJava APIå®¢æˆ·ç«¯åº“è®¿é—®zookeeperå®¢æˆ·ç«¯ã€‚</p></blockquote><h1 id="1-Zookeeperæ¦‚å¿µ"><a href="#1-Zookeeperæ¦‚å¿µ" class="headerlink" title="1. Zookeeperæ¦‚å¿µ"></a>1. Zookeeperæ¦‚å¿µ</h1><p>Zookeeper æ˜¯ Apache Hadoop é¡¹ç›®ä¸‹çš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œæ˜¯ä¸€ä¸ªæ ‘å½¢ç›®å½•æœåŠ¡ã€‚</p><p>Zookeeper æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ã€å¼€æºçš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºçš„åè°ƒæœåŠ¡ã€‚</p><p>Zookeeper æä¾›çš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</p><ul><li><p>é…ç½®ç®¡ç†</p></li><li><p>åˆ†å¸ƒå¼é”</p></li><li><p>é›†ç¾¤ç®¡ç†</p></li></ul><p><img src="/20230315231727/image-20230315205619912.png" alt="é…ç½®ä¸­å¿ƒ"></p><p><img src="/20230315231727/image-20230315205504904.png" alt="åˆ†å¸ƒå¼é”"></p><p><img src="/20230315231727/image-20230315205537772.png" alt="é›†ç¾¤ç®¡ç†ï¼ˆæ³¨å†Œä¸­å¿ƒï¼‰"></p><h1 id="2-æ•°æ®ç±»å‹"><a href="#2-æ•°æ®ç±»å‹" class="headerlink" title="2. æ•°æ®ç±»å‹"></a>2. æ•°æ®ç±»å‹</h1><p>ZooKeeper æ˜¯ä¸€ä¸ªæ ‘å½¢ç›®å½•æœåŠ¡,å…¶æ•°æ®æ¨¡å‹å’ŒUnixçš„æ–‡ä»¶ç³»ç»Ÿç›®å½•æ ‘å¾ˆç±»ä¼¼ï¼Œæ‹¥æœ‰ä¸€ä¸ªå±‚æ¬¡åŒ–ç»“æ„ã€‚</p><p>è¿™é‡Œé¢çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½è¢«ç§°ä¸ºï¼š ZNodeï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½ä¼šä¿å­˜è‡ªå·±çš„æ•°æ®å’ŒèŠ‚ç‚¹ä¿¡æ¯ã€‚</p><p>èŠ‚ç‚¹å¯ä»¥æ‹¥æœ‰å­èŠ‚ç‚¹ï¼ŒåŒæ—¶ä¹Ÿå…è®¸å°‘é‡ï¼ˆ1MBï¼‰æ•°æ®å­˜å‚¨åœ¨è¯¥èŠ‚ç‚¹ä¹‹ä¸‹ã€‚</p><p>èŠ‚ç‚¹å¯ä»¥åˆ†ä¸ºå››å¤§ç±»ï¼š</p><ul><li><p>PERSISTENT æŒä¹…åŒ–èŠ‚ç‚¹</p></li><li><p>EPHEMERAL ä¸´æ—¶èŠ‚ç‚¹ ï¼š-e</p></li><li><p>PERSISTENT_SEQUENTIAL æŒä¹…åŒ–é¡ºåºèŠ‚ç‚¹ ï¼š-s</p></li><li><p>EPHEMERAL_SEQUENTIAL ä¸´æ—¶é¡ºåºèŠ‚ç‚¹ ï¼š-es</p></li></ul><h2 id="Zookeeperæ•°æ®æ¨¡å‹"><a href="#Zookeeperæ•°æ®æ¨¡å‹" class="headerlink" title="Zookeeperæ•°æ®æ¨¡å‹"></a>Zookeeperæ•°æ®æ¨¡å‹</h2><p><img src="/20230315231727/image-20230315211100515.png" alt="zookeeperæ•°æ®æ¨¡å‹"></p><h1 id="3-å®‰è£…zookeeper"><a href="#3-å®‰è£…zookeeper" class="headerlink" title="3. å®‰è£…zookeeper"></a>3. å®‰è£…zookeeper</h1><p>zookeeperçš„å®‰è£…è¯·å‚è€ƒæ–‡ç« <em><strong>ã€ŠZookeeperå®‰è£…ã€‹</strong></em>ã€‚</p><h1 id="4-æœåŠ¡ç«¯å‘½ä»¤"><a href="#4-æœåŠ¡ç«¯å‘½ä»¤" class="headerlink" title="4. æœåŠ¡ç«¯å‘½ä»¤"></a>4. æœåŠ¡ç«¯å‘½ä»¤</h1><ul><li><p>å¯åŠ¨ ZooKeeper æœåŠ¡ï¼š<code>./zkServer.sh start</code></p></li><li><p>æŸ¥çœ‹ ZooKeeper æœåŠ¡çŠ¶æ€ï¼š<code>./zkServer.sh status</code></p></li><li><p>åœæ­¢ ZooKeeper æœåŠ¡ï¼š<code>./zkServer.sh stop</code></p></li><li><p>é‡å¯ ZooKeeper æœåŠ¡ï¼š<code>./zkServer.sh restart</code></p></li></ul><h1 id="5-å®¢æˆ·ç«¯å‘½ä»¤"><a href="#5-å®¢æˆ·ç«¯å‘½ä»¤" class="headerlink" title="5. å®¢æˆ·ç«¯å‘½ä»¤"></a>5. å®¢æˆ·ç«¯å‘½ä»¤</h1><h2 id="5-1-å¯åŠ¨å®¢æˆ·ç«¯"><a href="#5-1-å¯åŠ¨å®¢æˆ·ç«¯" class="headerlink" title="5.1. å¯åŠ¨å®¢æˆ·ç«¯"></a>5.1. å¯åŠ¨å®¢æˆ·ç«¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è¿›å…¥zookeeperç›®å½•</span><br><span class="hljs-built_in">cd</span> /usr/zookeeper/apache-zookeeper-3.5.6-bin/bin<br><span class="hljs-comment"># å¯åŠ¨å®¢æˆ·ç«¯ï¼Œå¹¶è¿æ¥åˆ°zookeeperæœåŠ¡ç«¯ï¼Œ./zkCli.sh â€“server ip:port å¦‚ï¼š</span><br>./zkCli.sh -server localhost:2181<br></code></pre></td></tr></table></figure><p><img src="/20230315231727/image-20230315210839029.png" alt="å®¢æˆ·ç«¯è¿æ¥æˆåŠŸ"></p><p>å¯ä»¥åœ¨å®¢æˆ·ç«¯å‘½ä»¤è¡Œé€šè¿‡ä½¿ç”¨ <code>quit</code> å‘½ä»¤é€€å‡ºï¼Œæ–­å¼€è¿æ¥ã€‚</p><h2 id="5-2-æŸ¥çœ‹å‘½ä»¤å¸®åŠ©"><a href="#5-2-æŸ¥çœ‹å‘½ä»¤å¸®åŠ©" class="headerlink" title="5.2. æŸ¥çœ‹å‘½ä»¤å¸®åŠ©"></a>5.2. æŸ¥çœ‹å‘½ä»¤å¸®åŠ©</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹å‘½ä»¤å¸®åŠ©</span><br><span class="hljs-built_in">help</span><br></code></pre></td></tr></table></figure><h2 id="5-3-å±•ç¤ºèŠ‚ç‚¹ä¿¡æ¯"><a href="#5-3-å±•ç¤ºèŠ‚ç‚¹ä¿¡æ¯" class="headerlink" title="5.3. å±•ç¤ºèŠ‚ç‚¹ä¿¡æ¯"></a>5.3. å±•ç¤ºèŠ‚ç‚¹ä¿¡æ¯</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ˜¾ç¤ºæŒ‡å®šç›®å½•ä¸‹èŠ‚ç‚¹</span><br><span class="hljs-built_in">ls</span> /path<br></code></pre></td></tr></table></figure><p><img src="/20230315231727/image-20230315211454971.png" alt="æŸ¥çœ‹æ ¹ç›®å½•ä¸‹çš„èŠ‚ç‚¹"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ˜¾ç¤ºæŒ‡å®šèŠ‚ç‚¹ä¿¡æ¯ä»¥åŠå­èŠ‚ç‚¹</span><br><span class="hljs-built_in">ls</span> -s /path<br></code></pre></td></tr></table></figure><p><img src="/20230315231727/image-20230315211616857.png" alt="æŸ¥çœ‹æŒ‡å®šç›®å½•ä¸‹çš„èŠ‚ç‚¹ä¿¡æ¯"></p><p><img src="/20230315231727/image-20230315214252001.png" alt="æŸ¥çœ‹èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯"></p><h3 id="èŠ‚ç‚¹ä¿¡æ¯è¯´æ˜"><a href="#èŠ‚ç‚¹ä¿¡æ¯è¯´æ˜" class="headerlink" title="èŠ‚ç‚¹ä¿¡æ¯è¯´æ˜"></a>èŠ‚ç‚¹ä¿¡æ¯è¯´æ˜</h3><p><strong>czxid</strong>ï¼šèŠ‚ç‚¹è¢«åˆ›å»ºçš„äº‹åŠ¡ID</p><p><strong>ctime</strong>ï¼šåˆ›å»ºæ—¶é—´ </p><p><strong>mzxid</strong>ï¼šæœ€åä¸€æ¬¡è¢«æ›´æ–°çš„äº‹åŠ¡ID </p><p><strong>mtime</strong>ï¼šä¿®æ”¹æ—¶é—´ </p><p><strong>pzxid</strong>ï¼šå­èŠ‚ç‚¹åˆ—è¡¨æœ€åä¸€æ¬¡è¢«æ›´æ–°çš„äº‹åŠ¡ID</p><p><strong>cversion</strong>ï¼šå­èŠ‚ç‚¹çš„ç‰ˆæœ¬å·</p><p><strong>dataversion</strong>ï¼šæ•°æ®ç‰ˆæœ¬å·</p><p><strong>aclversion</strong>ï¼šæƒé™ç‰ˆæœ¬å·</p><p><strong>ephemeralOwner</strong>ï¼šç”¨äºä¸´æ—¶èŠ‚ç‚¹ï¼Œä»£è¡¨ä¸´æ—¶èŠ‚ç‚¹çš„äº‹åŠ¡IDï¼Œå¦‚æœä¸ºæŒä¹…èŠ‚ç‚¹åˆ™ä¸º0</p><p><strong>dataLength</strong>ï¼šèŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®çš„é•¿åº¦</p><p><strong>numChildren</strong>ï¼šå½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä¸ªæ•° </p><h2 id="5-4-èŠ‚ç‚¹æ“ä½œï¼ˆCURDï¼‰"><a href="#5-4-èŠ‚ç‚¹æ“ä½œï¼ˆCURDï¼‰" class="headerlink" title="5.4. èŠ‚ç‚¹æ“ä½œï¼ˆCURDï¼‰"></a>5.4. èŠ‚ç‚¹æ“ä½œï¼ˆCURDï¼‰</h2><h3 id="åˆ›å»ºèŠ‚ç‚¹"><a href="#åˆ›å»ºèŠ‚ç‚¹" class="headerlink" title="åˆ›å»ºèŠ‚ç‚¹"></a>åˆ›å»ºèŠ‚ç‚¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åˆ›å»ºèŠ‚ç‚¹å¹¶èµ‹å€¼value</span><br>create /èŠ‚ç‚¹path value<br></code></pre></td></tr></table></figure><p><img src="/20230315231727/image-20230315211952986.png" alt="åˆ›å»ºèŠ‚ç‚¹ä¸èµ‹å€¼"></p><h4 id="åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹"><a href="#åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹" class="headerlink" title="åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹"></a>åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹å¹¶èµ‹å€¼value</span><br>create -e /èŠ‚ç‚¹path value<br></code></pre></td></tr></table></figure><p>ä¸´æ—¶èŠ‚ç‚¹åœ¨ä¼šè¯å…³é—­ï¼ˆquitæ–­å¼€è¿æ¥ï¼‰ä¹‹åå°±ä¼šè¢«åˆ é™¤ã€‚</p><h4 id="åˆ›å»ºé¡ºåºèŠ‚ç‚¹"><a href="#åˆ›å»ºé¡ºåºèŠ‚ç‚¹" class="headerlink" title="åˆ›å»ºé¡ºåºèŠ‚ç‚¹"></a>åˆ›å»ºé¡ºåºèŠ‚ç‚¹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åˆ›å»ºé¡ºåºèŠ‚ç‚¹å¹¶èµ‹å€¼value</span><br>create -s /èŠ‚ç‚¹path value<br></code></pre></td></tr></table></figure><p><img src="/20230315231727/image-20230315213718919.png" alt="åˆ›å»ºé¡ºåºèŠ‚ç‚¹"></p><p>é¡ºåºèŠ‚ç‚¹çš„ç¼–å·æ˜¯æ‰€æœ‰èŠ‚ç‚¹éƒ½å…±ç”¨ä¸€ä¸ªç¼–å·å™¨ï¼ˆä¸æ–­ç´¯åŠ ï¼‰ã€‚</p><h4 id="åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹"><a href="#åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹" class="headerlink" title="åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹"></a>åˆ›å»ºä¸´æ—¶é¡ºåºèŠ‚ç‚¹</h4><p><img src="/20230315231727/image-20230315213937061.png" alt="image-20230315213937061"></p><h3 id="è·å–èŠ‚ç‚¹å€¼"><a href="#è·å–èŠ‚ç‚¹å€¼" class="headerlink" title="è·å–èŠ‚ç‚¹å€¼"></a>è·å–èŠ‚ç‚¹å€¼</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è·å–èŠ‚ç‚¹å€¼</span><br>get /èŠ‚ç‚¹path<br></code></pre></td></tr></table></figure><p><img src="/20230315231727/image-20230315212042192.png" alt="è·å–èŠ‚ç‚¹æ•°æ®"></p><h3 id="è®¾ç½®èŠ‚ç‚¹å€¼"><a href="#è®¾ç½®èŠ‚ç‚¹å€¼" class="headerlink" title="è®¾ç½®èŠ‚ç‚¹å€¼"></a>è®¾ç½®èŠ‚ç‚¹å€¼</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è®¾ç½®èŠ‚ç‚¹å€¼</span><br><span class="hljs-built_in">set</span> /èŠ‚ç‚¹path value<br></code></pre></td></tr></table></figure><p><img src="/20230315231727/image-20230315212333435.png" alt="è®¾ç½®èŠ‚ç‚¹å€¼"></p><h3 id="åˆ é™¤å•ä¸ªèŠ‚ç‚¹"><a href="#åˆ é™¤å•ä¸ªèŠ‚ç‚¹" class="headerlink" title="åˆ é™¤å•ä¸ªèŠ‚ç‚¹"></a>åˆ é™¤å•ä¸ªèŠ‚ç‚¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åˆ é™¤å•ä¸ªèŠ‚ç‚¹</span><br>delete /èŠ‚ç‚¹path<br></code></pre></td></tr></table></figure><p><img src="/20230315231727/image-20230315212500486.png" alt="åˆ é™¤å•ä¸ªèŠ‚ç‚¹"></p><h3 id="åˆ é™¤å¸¦æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹"><a href="#åˆ é™¤å¸¦æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹" class="headerlink" title="åˆ é™¤å¸¦æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹"></a>åˆ é™¤å¸¦æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># åˆ é™¤å¸¦æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹</span><br>deleteall /èŠ‚ç‚¹path<br></code></pre></td></tr></table></figure><p><img src="/20230315231727/image-20230315212754997.png" alt="ä¸èƒ½ç”¨deleteå‘½ä»¤åˆ é™¤éç©ºèŠ‚ç‚¹"></p><h1 id="6-Curator-å®¢æˆ·ç«¯åº“"><a href="#6-Curator-å®¢æˆ·ç«¯åº“" class="headerlink" title="6. Curator å®¢æˆ·ç«¯åº“"></a>6. Curator å®¢æˆ·ç«¯åº“</h1><h2 id="6-1-Curator-ä»‹ç»"><a href="#6-1-Curator-ä»‹ç»" class="headerlink" title="6.1. Curator ä»‹ç»"></a>6.1. Curator ä»‹ç»</h2><p>Curator æ˜¯ Apache ZooKeeper çš„Javaå®¢æˆ·ç«¯åº“ã€‚</p><p>Curator é¡¹ç›®çš„ç›®æ ‡æ˜¯ç®€åŒ–Javaä¸­ ZooKeeper å®¢æˆ·ç«¯çš„ä½¿ç”¨ã€‚</p><p>ğŸ‘‰<a href="http://curator.apache.org/">å®˜ç½‘åœ°å€</a>ã€‚ä½¿ç”¨Curatoréœ€è¦æ³¨æ„å’ŒZooKeeperçš„ç‰ˆæœ¬å…¼å®¹é—®é¢˜ã€‚</p><h2 id="6-2-Curator-API-å¸¸ç”¨æ“ä½œ"><a href="#6-2-Curator-API-å¸¸ç”¨æ“ä½œ" class="headerlink" title="6.2. Curator API å¸¸ç”¨æ“ä½œ"></a>6.2. Curator API å¸¸ç”¨æ“ä½œ</h2><ul><li><p>å»ºç«‹è¿æ¥ã€æ·»åŠ èŠ‚ç‚¹ã€åˆ é™¤èŠ‚ç‚¹ã€ä¿®æ”¹èŠ‚ç‚¹ã€æŸ¥è¯¢èŠ‚ç‚¹</p></li><li><p>Watchäº‹ä»¶ç›‘å¬</p></li><li><p>åˆ†å¸ƒå¼é”å®ç°</p></li></ul><h3 id="6-2-1-Javaä¸­è¿æ¥zk-server"><a href="#6-2-1-Javaä¸­è¿æ¥zk-server" class="headerlink" title="6.2.1 Javaä¸­è¿æ¥zk server"></a>6.2.1 Javaä¸­è¿æ¥zk server</h3><p>æ–°å»ºä¸€ä¸ªmavené¡¹ç›®ï¼Œpom.xmlæ–‡ä»¶æ·»åŠ ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.learning<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>curator-zk<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.source</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.source</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">maven.compiler.target</span>&gt;</span>8<span class="hljs-tag">&lt;/<span class="hljs-name">maven.compiler.target</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--junit--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.13.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-comment">&lt;!--Curator--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.curator<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>curator-framework<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.curator<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>curator-recipes<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!--æ—¥å¿—--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.21<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-log4j12<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.21<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ <code>src/main/resources/log4j.properties</code> æ–‡ä»¶ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># æ—¥å¿—çº§åˆ«</span><br><span class="hljs-attr">log4j.rootLogger</span>=<span class="hljs-string">ERROR,stdout</span><br><br><span class="hljs-attr">log4j.appender.stdout</span> = <span class="hljs-string">org.apache.log4j.ConsoleAppender</span><br><span class="hljs-attr">log4j.appender.stdout.Target</span> = <span class="hljs-string">System.out</span><br><span class="hljs-attr">log4j.appender.stdout.layout</span> = <span class="hljs-string">org.apache.log4j.PatternLayout</span><br><span class="hljs-attr">log4j.appender.stdout.layout.ConversionPattern</span> = <span class="hljs-string">[%d&#123;yyyy-MM-dd HH/:mm/:ss&#125;]%-5p %c(line/:%L) %x-%m%n</span><br></code></pre></td></tr></table></figure><p>æ–°å»ºä¸€ä¸ªå•å…ƒæµ‹è¯•ç±»ï¼Œæµ‹è¯•è¿æ¥zk serverï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * è¿æ¥zk server</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testConnect</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">/*</span><br><span class="hljs-comment">     * å‚æ•°è¯´æ˜</span><br><span class="hljs-comment">     * @param connectString       zkçš„serverçš„åœ°å€å’Œç«¯å£ï¼ˆå¤šä¸ªç”¨,éš”å¼€ï¼‰</span><br><span class="hljs-comment">     * @param sessionTimeoutMs    ä¼šè¯è¶…æ—¶æ—¶é—´ï¼ˆmsï¼‰</span><br><span class="hljs-comment">     * @param connectionTimeoutMs è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆmsï¼‰</span><br><span class="hljs-comment">     * @param retryPolicy         é‡è¯•ç­–ç•¥</span><br><span class="hljs-comment">     * @return client</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-type">CuratorFramework</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> CuratorFrameworkFactory.newClient(<span class="hljs-string">&quot;192.168.18.123:2181&quot;</span>, <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>, <span class="hljs-number">15</span> * <span class="hljs-number">1000</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExponentialBackoffRetry</span>(<span class="hljs-number">3000</span>, <span class="hljs-number">10</span>));<br>    client.start();<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="6-2-2-zookeeperçš„CURD"><a href="#6-2-2-zookeeperçš„CURD" class="headerlink" title="6.2.2 zookeeperçš„CURD"></a>6.2.2 zookeeperçš„CURD</h3><p>å®Œæ•´æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.learning;<br><br><span class="hljs-keyword">import</span> org.apache.curator.framework.CuratorFramework;<br><span class="hljs-keyword">import</span> org.apache.curator.framework.CuratorFrameworkFactory;<br><span class="hljs-keyword">import</span> org.apache.curator.retry.ExponentialBackoffRetry;<br><span class="hljs-keyword">import</span> org.apache.zookeeper.CreateMode;<br><span class="hljs-keyword">import</span> org.apache.zookeeper.data.Stat;<br><span class="hljs-keyword">import</span> org.junit.After;<br><span class="hljs-keyword">import</span> org.junit.Before;<br><span class="hljs-keyword">import</span> org.junit.Test;<br><br><span class="hljs-keyword">import</span> java.nio.charset.StandardCharsets;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CuratorTest</span> &#123;<br><br>    <span class="hljs-keyword">private</span> CuratorFramework client;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è¿æ¥zk serverï¼ˆé“¾å¼ï¼‰</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Before</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">connect</span><span class="hljs-params">()</span> &#123;<br>        client = CuratorFrameworkFactory.builder()<br>                .connectString(<span class="hljs-string">&quot;192.168.18.123:2181&quot;</span>)<br>                .sessionTimeoutMs(<span class="hljs-number">60</span> * <span class="hljs-number">1000</span>)<br>                .connectionTimeoutMs(<span class="hljs-number">15</span> * <span class="hljs-number">1000</span>)<br>                .retryPolicy(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ExponentialBackoffRetry</span>(<span class="hljs-number">3000</span>, <span class="hljs-number">10</span>))<br><span class="hljs-comment">//                .namespace(&quot;app1&quot;) //æŒ‡å®šé»˜è®¤çš„èµ·å§‹èŠ‚ç‚¹ï¼Œå°±ä¸ç”¨æ¯æ¬¡éƒ½å»å†™æ ¹èŠ‚ç‚¹</span><br>                .build();<br>        client.start();<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * é‡Šæ”¾èµ„æº</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@After</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">if</span> (client != <span class="hljs-literal">null</span>)&#123;<br>            client.close();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ›å»ºèŠ‚ç‚¹ æµ‹è¯•</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testCreate</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// æ³¨æ„ï¼Œè¿™è¾¹å¦‚æœä¸€ç›´è½¬åœˆåœˆæ— æ³•åˆ›å»ºï¼Œè¯·æ£€æŸ¥æ˜¯å¦å·²ç»å…³é—­linuxé˜²ç«å¢™æˆ–è€…æ˜¯å¦å¼€æ”¾ç«¯å£</span><br><br>        <span class="hljs-comment">// åˆ›å»ºé»˜è®¤èŠ‚ç‚¹ï¼Œå¦‚æœæ•°æ®ä¸ºç©ºï¼Œé‚£ä¹ˆé»˜è®¤æ•°æ®æ˜¯å½“å‰å®¢æˆ·ç«¯çš„ipåœ°å€</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">path</span> <span class="hljs-operator">=</span> client.create().forPath(<span class="hljs-string">&quot;/app5&quot;</span>);<br>        System.out.println(path);<br><br>        <span class="hljs-comment">// åˆ›å»ºå¸¦æ•°æ®çš„èŠ‚ç‚¹</span><br>        path = client.create().forPath(<span class="hljs-string">&quot;/app6&quot;</span>, <span class="hljs-string">&quot;æ•°æ®&quot;</span>.getBytes(StandardCharsets.UTF_8));<br>        System.out.println(path);<br><br>        <span class="hljs-comment">// åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹</span><br>        path = client.create().withMode(CreateMode.EPHEMERAL).forPath(<span class="hljs-string">&quot;/tmpNode&quot;</span>);<br>        System.out.println(path);<br><br>        <span class="hljs-comment">// åˆ›å»ºå¤šçº§èŠ‚ç‚¹ï¼Œå¦‚æœçˆ¶èŠ‚ç‚¹ä¸å­˜åœ¨åˆ™åˆ›å»ºçˆ¶èŠ‚ç‚¹</span><br>        path = client.create().creatingParentsIfNeeded().forPath(<span class="hljs-string">&quot;/parent/childNode&quot;</span>);<br>        System.out.println(path);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æŸ¥è¯¢èŠ‚ç‚¹ æµ‹è¯•</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGet</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// èŠ‚ç‚¹æ•°æ®ï¼šget</span><br>        <span class="hljs-type">byte</span>[] bytes = client.getData().forPath(<span class="hljs-string">&quot;/app6&quot;</span>);<br>        System.out.println(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(bytes));<br><br>        <span class="hljs-comment">// è·å–å­èŠ‚ç‚¹ï¼šls</span><br>        List&lt;String&gt; list = client.getChildren().forPath(<span class="hljs-string">&quot;/&quot;</span>);<br>        list.forEach(child -&gt; System.out.println(child));<br><br>        <span class="hljs-comment">// è·å–çŠ¶æ€ä¿¡æ¯ï¼šls -s</span><br>        <span class="hljs-type">Stat</span> <span class="hljs-variable">stat</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stat</span>();<br>        client.getData().storingStatIn(stat).forPath(<span class="hljs-string">&quot;/app6&quot;</span>);<br>        <span class="hljs-comment">// çŠ¶æ€ä¿¡æ¯ä¼šå°è£…è¿› Stat å¯¹è±¡</span><br>        System.out.println(stat);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * ä¿®æ”¹èŠ‚ç‚¹æ•°æ® æµ‹è¯•</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSet</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// ä¿®æ”¹èŠ‚ç‚¹æ•°æ®ã€‚</span><br>        client.setData().forPath(<span class="hljs-string">&quot;/app6&quot;</span>, <span class="hljs-string">&quot;dataValue&quot;</span>.getBytes(StandardCharsets.UTF_8));<br><br>        <span class="hljs-comment">// é€šè¿‡ç‰ˆæœ¬å·ä¿®æ”¹æ•°æ®ï¼ŒCASåŸç†</span><br>        <span class="hljs-comment">// å…ˆæŸ¥è¯¢ç‰ˆæœ¬å·ä¿¡æ¯</span><br>        <span class="hljs-type">Stat</span> <span class="hljs-variable">stat</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Stat</span>();<br>        client.getData().storingStatIn(stat).forPath(<span class="hljs-string">&quot;/app6&quot;</span>);<br>        <span class="hljs-comment">// å¦‚æœä¿®æ”¹å¤±è´¥ç›´æ¥è¿”å›å¼‚å¸¸</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">version</span> <span class="hljs-operator">=</span> stat.getVersion();<br>        client.setData().withVersion(version).forPath(<span class="hljs-string">&quot;/app6&quot;</span>, <span class="hljs-string">&quot;dataValue&quot;</span>.getBytes(StandardCharsets.UTF_8));<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ é™¤èŠ‚ç‚¹æ•°æ® æµ‹è¯•</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Exception</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDelete</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// åˆ é™¤å•ä¸ªèŠ‚ç‚¹</span><br>        client.delete().forPath(<span class="hljs-string">&quot;/app6&quot;</span>);<br><br>        <span class="hljs-comment">// åˆ é™¤å«å­èŠ‚ç‚¹çš„èŠ‚ç‚¹</span><br>        client.delete().deletingChildrenIfNeeded().forPath(<span class="hljs-string">&quot;/app6&quot;</span>);<br><br>        <span class="hljs-comment">// å¿…é¡»æˆåŠŸçš„åˆ é™¤</span><br>        client.delete().guaranteed().forPath(<span class="hljs-string">&quot;/app6&quot;</span>);<br><br>        <span class="hljs-comment">// å¸¦å›è°ƒå‡½æ•°çš„åˆ é™¤</span><br>        client.delete().inBackground((client, event) -&gt; &#123;<br>            System.out.println(<span class="hljs-string">&quot;åˆ é™¤åå›è°ƒå‡½æ•°è¢«æ‰§è¡Œ...&quot;</span>);<br>        &#125;).forPath(<span class="hljs-string">&quot;/app6&quot;</span>);<br>    &#125;<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="6-2-3-Watchç›‘æ§"><a href="#6-2-3-Watchç›‘æ§" class="headerlink" title="6.2.3 Watchç›‘æ§"></a>6.2.3 Watchç›‘æ§</h3><p>ZooKeeper å…è®¸ç”¨æˆ·åœ¨æŒ‡å®šèŠ‚ç‚¹ä¸Šæ³¨å†Œä¸€äº›Watcherï¼Œå¹¶ä¸”åœ¨ä¸€äº›ç‰¹å®šäº‹ä»¶è§¦å‘çš„æ—¶å€™ï¼ŒZooKeeper æœåŠ¡ç«¯ä¼šå°†äº‹ä»¶é€šçŸ¥åˆ°æ„Ÿå…´è¶£çš„å®¢æˆ·ç«¯ä¸Šå»ï¼Œè¯¥æœºåˆ¶æ˜¯ ZooKeeper å®ç°åˆ†å¸ƒå¼åè°ƒæœåŠ¡çš„é‡è¦ç‰¹æ€§ã€‚</p><p>ZooKeeper ä¸­å¼•å…¥äº†Watcheræœºåˆ¶æ¥å®ç°äº†å‘å¸ƒ&#x2F;è®¢é˜…åŠŸèƒ½èƒ½ï¼Œèƒ½å¤Ÿè®©å¤šä¸ªè®¢é˜…è€…åŒæ—¶ç›‘å¬æŸä¸€ä¸ªå¯¹è±¡ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è‡ªèº«çŠ¶æ€å˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥æ‰€æœ‰è®¢é˜…è€…ã€‚</p><p>ZooKeeperæä¾›äº†ä¸‰ç§Watcherï¼š</p><ul><li><p><strong>NodeCache</strong>ï¼šåªæ˜¯ç›‘æ§æŸä¸€ä¸ªç‰¹å®šçš„èŠ‚ç‚¹ã€‚</p></li><li><p><strong>PathChildrenCache</strong>ï¼šç›‘æ§ä¸€ä¸ªZNodeçš„å­èŠ‚ç‚¹ï¼ˆä¸åŒ…å«è‡ªå·±ï¼‰ã€‚</p></li><li><p><strong>TreeCache</strong>ï¼šå¯ä»¥ç›‘æ§æ•´ä¸ªæ ‘ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œç±»ä¼¼äº<strong>PathChildrenCache</strong>å’Œ<strong>NodeCache</strong>çš„ç»„åˆã€‚</p></li></ul><p>æ–°å»ºä¸€ä¸ªå•å…ƒæµ‹è¯•ç±»ï¼Œä½¿ç”¨<a href="#zookeeper%E7%9A%84CURD">ä¸Šä¸€æ­¥</a>ä¸­çš„è¿æ¥æ–¹å¼è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚</p><h4 id="ç›‘æ§æŸä¸€ä¸ªç‰¹å®šçš„èŠ‚ç‚¹"><a href="#ç›‘æ§æŸä¸€ä¸ªç‰¹å®šçš„èŠ‚ç‚¹" class="headerlink" title="ç›‘æ§æŸä¸€ä¸ªç‰¹å®šçš„èŠ‚ç‚¹"></a>ç›‘æ§æŸä¸€ä¸ªç‰¹å®šçš„èŠ‚ç‚¹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç›‘æ§æŸä¸€ä¸ªç‰¹å®šçš„èŠ‚ç‚¹</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testNodeCache</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">NodeCache</span> <span class="hljs-variable">nodeCache</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NodeCache</span>(client, <span class="hljs-string">&quot;/app1&quot;</span>);<br>    <span class="hljs-comment">// æ³¨å†Œç›‘å¬å™¨</span><br>    nodeCache.getListenable().addListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NodeCacheListener</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">nodeChanged</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            System.out.println(<span class="hljs-string">&quot;èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–...&quot;</span>);<br>            <span class="hljs-type">byte</span>[] data = nodeCache.getCurrentData().getData();<br>            System.out.println(<span class="hljs-string">&quot;èŠ‚ç‚¹æ–°çš„å€¼ï¼š&quot;</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(data));<br>        &#125;<br>    &#125;);<br>    <span class="hljs-comment">// å¼€å§‹ç›‘å¬</span><br>    nodeCache.start(<span class="hljs-literal">true</span>);<br><br>    <span class="hljs-comment">// å•å…ƒæµ‹è¯•ï¼Œè®©ç¨‹åºä¸€ç›´è¿è¡Œï¼Œæµ‹è¯•ç›‘å¬</span><br>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)&#123;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="ç›‘æ§ä¸€ä¸ªZNodeçš„å­èŠ‚ç‚¹ï¼ˆä¸åŒ…å«è‡ªå·±ï¼‰"><a href="#ç›‘æ§ä¸€ä¸ªZNodeçš„å­èŠ‚ç‚¹ï¼ˆä¸åŒ…å«è‡ªå·±ï¼‰" class="headerlink" title="ç›‘æ§ä¸€ä¸ªZNodeçš„å­èŠ‚ç‚¹ï¼ˆä¸åŒ…å«è‡ªå·±ï¼‰"></a>ç›‘æ§ä¸€ä¸ªZNodeçš„å­èŠ‚ç‚¹ï¼ˆä¸åŒ…å«è‡ªå·±ï¼‰</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * ç›‘æ§ä¸€ä¸ªZNodeçš„å­èŠ‚ç‚¹ï¼ˆä¸åŒ…å«è‡ªå·±ï¼‰</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testPathChildrenCache</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">PathChildrenCache</span> <span class="hljs-variable">pathChildrenCache</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PathChildrenCache</span>(client, <span class="hljs-string">&quot;/app2&quot;</span>, <span class="hljs-literal">true</span>);<br>    <span class="hljs-comment">// æ³¨å†Œç›‘å¬å™¨</span><br>    pathChildrenCache.getListenable().addListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PathChildrenCacheListener</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">childEvent</span><span class="hljs-params">(CuratorFramework curatorFramework, PathChildrenCacheEvent pathChildrenCacheEvent)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            System.out.println(<span class="hljs-string">&quot;å­èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–...&quot;</span>);<br>            System.out.println(pathChildrenCacheEvent);<br>        &#125;<br>    &#125;);<br>    <span class="hljs-comment">// å¼€å§‹ç›‘å¬</span><br>    pathChildrenCache.start();<br>    <span class="hljs-comment">// å•å…ƒæµ‹è¯•ï¼Œè®©ç¨‹åºä¸€ç›´è¿è¡Œï¼Œæµ‹è¯•ç›‘å¬</span><br>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)&#123;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/20230315231727/image-20230316101144520.png" alt="å­èŠ‚ç‚¹å˜åŒ–ç±»å‹"></p><h4 id="ç›‘æ§æ•´ä¸ªæ ‘ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹"><a href="#ç›‘æ§æ•´ä¸ªæ ‘ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹" class="headerlink" title="ç›‘æ§æ•´ä¸ªæ ‘ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹"></a>ç›‘æ§æ•´ä¸ªæ ‘ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * å¯ä»¥ç›‘æ§æ•´ä¸ªæ ‘ä¸Šçš„æ‰€æœ‰èŠ‚ç‚¹</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testTreeCache</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    <span class="hljs-type">TreeCache</span> <span class="hljs-variable">treeCache</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeCache</span>(client, <span class="hljs-string">&quot;/app2&quot;</span>);<br>    <span class="hljs-comment">// æ³¨å†Œç›‘å¬å™¨</span><br>    treeCache.getListenable().addListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeCacheListener</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">childEvent</span><span class="hljs-params">(CuratorFramework curatorFramework, TreeCacheEvent treeCacheEvent)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            System.out.println(<span class="hljs-string">&quot;èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–...&quot;</span>);<br>            System.out.println(treeCacheEvent);<br>        &#125;<br>    &#125;);<br>    <span class="hljs-comment">// å¼€å§‹ç›‘å¬</span><br>    treeCache.start();<br>    <span class="hljs-comment">// å•å…ƒæµ‹è¯•ï¼Œè®©ç¨‹åºä¸€ç›´è¿è¡Œï¼Œæµ‹è¯•ç›‘å¬</span><br>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)&#123;<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="6-2-4-åˆ†å¸ƒå¼é”"><a href="#6-2-4-åˆ†å¸ƒå¼é”" class="headerlink" title="6.2.4 åˆ†å¸ƒå¼é”"></a>6.2.4 åˆ†å¸ƒå¼é”</h3><h4 id="åˆ†å¸ƒå¼é”æ¦‚å¿µ"><a href="#åˆ†å¸ƒå¼é”æ¦‚å¿µ" class="headerlink" title="åˆ†å¸ƒå¼é”æ¦‚å¿µ"></a>åˆ†å¸ƒå¼é”æ¦‚å¿µ</h4><p>åœ¨æˆ‘ä»¬è¿›è¡Œå•æœºåº”ç”¨å¼€å‘ï¼Œæ¶‰åŠå¹¶å‘åŒæ­¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¾€å¾€é‡‡ç”¨synchronizedæˆ–è€…Lockçš„æ–¹å¼æ¥è§£å†³å¤šçº¿ç¨‹é—´çš„ä»£ç åŒæ­¥é—®é¢˜ï¼Œè¿™æ—¶å¤šçº¿ç¨‹çš„è¿è¡Œéƒ½æ˜¯åœ¨åŒä¸€ä¸ªJVMä¹‹ä¸‹ï¼Œæ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚</p><p>ä½†å½“æˆ‘ä»¬çš„åº”ç”¨æ˜¯åˆ†å¸ƒå¼é›†ç¾¤å·¥ä½œçš„æƒ…å†µä¸‹ï¼Œå±äºå¤šJVMä¸‹çš„å·¥ä½œç¯å¢ƒï¼Œè·¨JVMä¹‹é—´å·²ç»æ— æ³•é€šè¿‡å¤šçº¿ç¨‹çš„é”è§£å†³åŒæ­¥é—®é¢˜ã€‚</p><p>é‚£ä¹ˆå°±éœ€è¦ä¸€ç§æ›´åŠ é«˜çº§çš„é”æœºåˆ¶ï¼Œæ¥å¤„ç†ç§è·¨æœºå™¨çš„è¿›ç¨‹ä¹‹é—´çš„æ•°æ®åŒæ­¥é—®é¢˜â€”â€”è¿™å°±æ˜¯åˆ†å¸ƒå¼é”ã€‚</p><p><img src="/20230315231727/image-20230316103209367.png" alt="åˆ†å¸ƒå¼é”"></p><h4 id="åˆ†å¸ƒå¼é”çš„å‡ ç§å®ç°æ–¹æ¡ˆ"><a href="#åˆ†å¸ƒå¼é”çš„å‡ ç§å®ç°æ–¹æ¡ˆ" class="headerlink" title="åˆ†å¸ƒå¼é”çš„å‡ ç§å®ç°æ–¹æ¡ˆ"></a>åˆ†å¸ƒå¼é”çš„å‡ ç§å®ç°æ–¹æ¡ˆ</h4><ul><li>åŸºäºç¼“å­˜å®ç°ï¼šRedisã€Memcacheã€‚</li><li>åŸºäºzookeeperå®ç°ã€‚</li><li>åŸºäºæ•°æ®åº“å±‚é¢å®ç°ï¼ˆé€šè¿‡è¡¨æ•°æ®åˆ¤æ–­æ˜¯å¦è·å¾—é”ï¼‰ã€‚</li></ul><p><img src="/20230315231727/image-20230316103226236.png" alt="åˆ†å¸ƒå¼é”çš„å‡ ç§å®ç°æ–¹æ¡ˆ"></p><h4 id="zookeeperåˆ†å¸ƒå¼é”åŸç†"><a href="#zookeeperåˆ†å¸ƒå¼é”åŸç†" class="headerlink" title="zookeeperåˆ†å¸ƒå¼é”åŸç†"></a>zookeeperåˆ†å¸ƒå¼é”åŸç†</h4><p>æ ¸å¿ƒæ€æƒ³ï¼šå½“å®¢æˆ·ç«¯è¦è·å–é”ï¼Œåˆ™åˆ›å»ºèŠ‚ç‚¹ï¼Œä½¿ç”¨å®Œé”ï¼Œåˆ™åˆ é™¤è¯¥èŠ‚ç‚¹ã€‚</p><ol><li><p>å®¢æˆ·ç«¯è·å–é”æ—¶ï¼Œåœ¨lockèŠ‚ç‚¹ä¸‹åˆ›å»º<em><strong>ä¸´æ—¶é¡ºåº</strong></em>èŠ‚ç‚¹ã€‚</p><p><strong>ä¸´æ—¶</strong> æ˜¯ä¸ºäº†èƒ½å¤Ÿæœ‰æ•ˆçš„åˆ é™¤èŠ‚ç‚¹ï¼Œé¿å…é”æ— æ³•é‡Šæ”¾çš„é—®é¢˜ã€‚</p><p><strong>é¡ºåº</strong> æ˜¯ä¸ºäº†å®¢æˆ·ç«¯èƒ½å¤Ÿåˆ¤æ–­è‡ªå·±æ˜¯å¦è·å–åˆ°äº†é”ã€‚</p></li><li><p>ç„¶åè·å–lockä¸‹é¢çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œå®¢æˆ·ç«¯è·å–åˆ°æ‰€æœ‰çš„å­èŠ‚ç‚¹ä¹‹åï¼Œå¦‚æœå‘ç°è‡ªå·±åˆ›å»ºçš„å­èŠ‚ç‚¹åºå·æœ€å°ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºè¯¥å®¢æˆ·ç«¯è·å–åˆ°äº†é”ã€‚ä½¿ç”¨å®Œé”åï¼Œå°†è¯¥èŠ‚ç‚¹åˆ é™¤ã€‚</p></li><li><p>å¦‚æœå‘ç°è‡ªå·±åˆ›å»ºçš„èŠ‚ç‚¹å¹¶élockæ‰€æœ‰å­èŠ‚ç‚¹ä¸­æœ€å°çš„ï¼Œè¯´æ˜è‡ªå·±è¿˜æ²¡æœ‰è·å–åˆ°é”ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯éœ€è¦æ‰¾åˆ°æ¯”è‡ªå·±å°çš„é‚£ä¸ªèŠ‚ç‚¹ï¼ŒåŒæ—¶å¯¹å…¶æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ï¼Œç›‘å¬åˆ é™¤äº‹ä»¶ã€‚</p></li><li><p>å¦‚æœå‘ç°æ¯”è‡ªå·±å°çš„é‚£ä¸ªèŠ‚ç‚¹è¢«åˆ é™¤ï¼Œåˆ™å®¢æˆ·ç«¯çš„Watcherä¼šæ”¶åˆ°ç›¸åº”é€šçŸ¥ï¼Œæ­¤æ—¶å†æ¬¡åˆ¤æ–­è‡ªå·±åˆ›å»ºçš„èŠ‚ç‚¹æ˜¯å¦æ˜¯lockå­èŠ‚ç‚¹ä¸­åºå·æœ€å°çš„ï¼Œå¦‚æœæ˜¯åˆ™è·å–åˆ°äº†é”ï¼Œå¦‚æœä¸æ˜¯åˆ™é‡å¤ä»¥ä¸Šæ­¥éª¤ç»§ç»­è·å–åˆ°æ¯”è‡ªå·±å°çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶æ³¨å†Œç›‘å¬ã€‚</p></li></ol><p><img src="/20230315231727/image-20230316104427705.png" alt="zookeeperåˆ†å¸ƒå¼é”åŸç†"></p><h4 id="Curatorä¸­çš„äº”ç§é”æ–¹æ¡ˆ"><a href="#Curatorä¸­çš„äº”ç§é”æ–¹æ¡ˆ" class="headerlink" title="Curatorä¸­çš„äº”ç§é”æ–¹æ¡ˆ"></a>Curatorä¸­çš„äº”ç§é”æ–¹æ¡ˆ</h4><ul><li><p>InterProcessSemaphoreMutexï¼šåˆ†å¸ƒå¼æ’å®ƒé”ï¼ˆéå¯é‡å…¥é”ï¼‰</p></li><li><p>InterProcessMutexï¼šåˆ†å¸ƒå¼å¯é‡å…¥æ’å®ƒé”</p></li><li><p>InterProcessReadWriteLockï¼šåˆ†å¸ƒå¼è¯»å†™é”</p></li><li><p>InterProcessMultiLockï¼šå°†å¤šä¸ªé”ä½œä¸ºå•ä¸ªå®ä½“ç®¡ç†çš„å®¹å™¨</p></li><li><p>InterProcessSemaphoreV2ï¼šå…±äº«ä¿¡å·é‡</p></li></ul><h1 id="7-zookeeperé›†ç¾¤"><a href="#7-zookeeperé›†ç¾¤" class="headerlink" title="7. zookeeperé›†ç¾¤"></a>7. zookeeperé›†ç¾¤</h1><h2 id="7-1-Zookeeper-é›†ç¾¤ä»‹ç»"><a href="#7-1-Zookeeper-é›†ç¾¤ä»‹ç»" class="headerlink" title="7.1 Zookeeper é›†ç¾¤ä»‹ç»"></a>7.1 Zookeeper é›†ç¾¤ä»‹ç»</h2><h3 id="Zookeeperé›†ç¾¤æ¶æ„å›¾"><a href="#Zookeeperé›†ç¾¤æ¶æ„å›¾" class="headerlink" title="Zookeeperé›†ç¾¤æ¶æ„å›¾"></a>Zookeeperé›†ç¾¤æ¶æ„å›¾</h3><p><img src="/20230315231727/image-20230316130347940.png" alt="Zookeeperé›†ç¾¤"></p><h3 id="Zookeeperé›†ç¾¤è§’è‰²"><a href="#Zookeeperé›†ç¾¤è§’è‰²" class="headerlink" title="Zookeeperé›†ç¾¤è§’è‰²"></a>Zookeeperé›†ç¾¤è§’è‰²</h3><p>åœ¨ZooKeeperé›†ç¾¤æœä¸­åŠ¡ä¸­æœ‰ä¸‰ä¸ªè§’è‰²ï¼š</p><ul><li><p><strong>Leader</strong> é¢†å¯¼è€…</p><ol><li>å¤„ç†äº‹åŠ¡è¯·æ±‚</li><li>é›†ç¾¤å†…éƒ¨å„æœåŠ¡å™¨çš„è°ƒåº¦è€…</li></ol></li><li><p><strong>Follower</strong> è·Ÿéšè€…</p><ol><li>å¤„ç†å®¢æˆ·ç«¯éäº‹åŠ¡è¯·æ±‚ï¼Œè½¬å‘äº‹åŠ¡è¯·æ±‚ç»™LeaderæœåŠ¡å™¨</li><li>å‚ä¸Leaderé€‰ä¸¾æŠ•ç¥¨</li></ol></li><li><p><strong>Observer</strong> è§‚å¯Ÿè€…</p><ol><li>å¤„ç†å®¢æˆ·ç«¯éäº‹åŠ¡è¯·æ±‚ï¼Œè½¬å‘äº‹åŠ¡è¯·æ±‚ç»™LeaderæœåŠ¡å™¨</li></ol></li></ul><h3 id="Leaderé€‰ä¸¾æœºåˆ¶"><a href="#Leaderé€‰ä¸¾æœºåˆ¶" class="headerlink" title="Leaderé€‰ä¸¾æœºåˆ¶"></a>Leaderé€‰ä¸¾æœºåˆ¶</h3><p>å‰æï¼šå¯è¿è¡Œçš„æœºå™¨è¦è¶…è¿‡é›†ç¾¤æ€»æ•°é‡çš„åŠæ•°ã€‚</p><ul><li><p>Serveridï¼šæœåŠ¡å™¨ID</p><p>æ¯”å¦‚æœ‰ä¸‰å°æœåŠ¡å™¨ï¼Œç¼–å·åˆ†åˆ«æ˜¯1ã€2ã€3ã€‚ç¼–å·è¶Šå¤§åœ¨é€‰æ‹©ç®—æ³•ä¸­çš„æƒé‡è¶Šå¤§ã€‚</p></li><li><p>Zxidï¼šæ•°æ®ID</p><p>æœåŠ¡å™¨ä¸­å­˜æ”¾çš„æœ€å¤§æ•°æ®IDã€‚å€¼è¶Šå¤§è¯´æ˜æ•°æ®è¶Šæ–°ï¼Œåœ¨é€‰ä¸¾ç®—æ³•ä¸­æ•°æ®è¶Šæ–°æƒé‡è¶Šå¤§ã€‚</p></li><li><p>åœ¨Leaderé€‰ä¸¾çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæŸå°ZooKeeperè·å¾—äº†è¶…è¿‡åŠæ•°çš„é€‰ç¥¨ï¼Œåˆ™æ­¤ZooKeeperå°±å¯ä»¥æˆä¸ºLeaderäº†ã€‚</p></li></ul><p>å¦‚æœæœ‰è¿™ä¹ˆä¸€ç§æƒ…å†µï¼Œé¡ºåºå¯åŠ¨zk-serverï¼š</p><p>1ï¼‰1å·zk-serverå¯åŠ¨ï¼Œæ­¤æ—¶è¿˜æ˜¯éé›†ç¾¤çŠ¶æ€ï¼›</p><p>2ï¼‰æ¥ç€2å·zk-serverå¯åŠ¨ï¼Œæ­¤æ—¶é€‰ä¸¾2å·ä¸ºleaderï¼›</p><p>3ï¼‰å¦‚æœæ¥ç€3å·zk-serverå¯åŠ¨ï¼Œæ­¤æ—¶è¿˜æ˜¯2å·ä¸ºleaderï¼Œä¸ä¼šé‡æ–°è¿›è¡Œé€‰ä¸¾ï¼Œåªæœ‰åœ¨2å·å‘ç”Ÿæ•…éšœçš„æƒ…å†µä¸‹æ‰ä¼šé‡æ–°é€‰ä¸¾ï¼Œæ­¤æ—¶3å·æœºå°±ä¼šå½“é€‰leaderã€‚</p><h2 id="7-2-Zookeeper-é›†ç¾¤æ­å»º"><a href="#7-2-Zookeeper-é›†ç¾¤æ­å»º" class="headerlink" title="7.2 Zookeeper é›†ç¾¤æ­å»º"></a>7.2 Zookeeper é›†ç¾¤æ­å»º</h2><p>å‚è€ƒæ–‡ç« <em><strong>ã€ŠZookeeperé›†ç¾¤æ­å»ºã€‹</strong></em>ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Zookeeper</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Zookeeper</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CentOSå®‰è£…Java</title>
    <link href="/20230315144300/"/>
    <url>/20230315144300/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä¸»è¦ä»‹ç»åœ¨Linuxç¯å¢ƒä¸‹JAVAå®‰è£…ã€‚</p><p>ä»¥CentOS7ä¸‹å®‰è£…JDK8ä¸ºä¾‹ã€‚</p></blockquote><h2 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h2><p>ä¸‹è½½Linuxçš„å®‰è£…åŒ…ã€‚</p><p>ä»¥Java8ä¸ºä¾‹ï¼ŒğŸ‘‰<a href="https://www.oracle.com/java/technologies/downloads/#java8">å®˜ç½‘ä¸‹è½½åœ°å€</a>ã€‚</p><p><img src="/20230315144300/image-20230315144549665.png" alt="Linuxçš„Java8ä¸‹è½½"></p><h2 id="ä¸Šä¼ "><a href="#ä¸Šä¼ " class="headerlink" title="ä¸Šä¼ "></a>ä¸Šä¼ </h2><p>å°†ä¸‹è½½çš„å®‰è£…åŒ…ä¼ åˆ°Linuxä¸Šï¼Œè¿™é‡Œä»¥ MobaXterm ä¸ºä¾‹ï¼Œç›´æ¥æ‹–åŠ¨æ–‡ä»¶å³å¯ä¸Šä¼ ã€‚</p><p>è¿™è¾¹å¤åˆ¶åˆ° <code>/usr/java</code> ç›®å½•ã€‚</p><p><img src="/20230315144300/image-20230315144925981.png" alt="MobaXtermä¸Šä¼ æ–‡ä»¶"></p><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><h3 id="è§£å‹"><a href="#è§£å‹" class="headerlink" title="è§£å‹"></a>è§£å‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># è¿›å…¥ç›®å½•</span><br><span class="hljs-built_in">cd</span> /usr/java<br><span class="hljs-comment"># è§£å‹æ–‡ä»¶åˆ°å½“å‰ç›®å½•</span><br>tar -zxvf jdk-8u361-linux-x64.tar.gz<br></code></pre></td></tr></table></figure><h3 id="é…ç½®ç¯å¢ƒå˜é‡"><a href="#é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="é…ç½®ç¯å¢ƒå˜é‡"></a>é…ç½®ç¯å¢ƒå˜é‡</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># é…ç½®ç¯å¢ƒå˜é‡</span><br>vim /etc/profile<br></code></pre></td></tr></table></figure><p>å°†å¦‚ä¸‹ç¯å¢ƒå˜é‡ä¿¡æ¯ã€å†™å…¥æ–‡ä»¶ï¼ˆæ³¨æ„ã€è¯·å°†JAVA_HOMEæ›¿æ¢ä¸ºè‡ªå·±çš„jdkè·¯å¾„ï¼‰ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> JAVA_HOME=/usr/java/jdk1.8.0_361<br><span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$JAVA_HOME</span>/bin:<span class="hljs-variable">$PATH</span><br><span class="hljs-built_in">export</span> CLASSPATH=.:<span class="hljs-variable">$JAVA_HOME</span>/lib/dt.jar:<span class="hljs-variable">$JAVA_HOME</span>/lib/tools.jar<br><span class="hljs-built_in">export</span> JRE_HOME=<span class="hljs-variable">$JAVA_HOME</span>/jre<br></code></pre></td></tr></table></figure><p><img src="/20230315144300/image-20230315150407697.png" alt="é…ç½®ç¯å¢ƒå˜é‡"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ</span><br><span class="hljs-built_in">source</span> /etc/profile<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹javaç‰ˆæœ¬ï¼ˆéªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸï¼‰</span><br>java -version<br></code></pre></td></tr></table></figure><p><img src="/20230315144300/image-20230315151443269.png" alt="ç‰ˆæœ¬ä¿¡æ¯"></p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CentOS</tag>
      
      <tag>Java</tag>
      
      <tag>Linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linuxé˜²ç«å¢™ç«¯å£è®¾ç½®</title>
    <link href="/20230315105828/"/>
    <url>/20230315105828/</url>
    
    <content type="html"><![CDATA[<h1 id="Linuxé˜²ç«å¢™ç«¯å£è®¾ç½®"><a href="#Linuxé˜²ç«å¢™ç«¯å£è®¾ç½®" class="headerlink" title="Linuxé˜²ç«å¢™ç«¯å£è®¾ç½®"></a>Linuxé˜²ç«å¢™ç«¯å£è®¾ç½®</h1><h2 id="é˜²ç«å¢™çŠ¶æ€"><a href="#é˜²ç«å¢™çŠ¶æ€" class="headerlink" title="é˜²ç«å¢™çŠ¶æ€"></a>é˜²ç«å¢™çŠ¶æ€</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€</span><br>systemctl status firewalld<br><br><span class="hljs-comment"># å¼€å¯é˜²ç«å¢™</span><br>systemctl start firewalld<br><br><span class="hljs-comment"># å…³é—­é˜²ç«å¢™</span><br>systemctl stop firewalld<br><br></code></pre></td></tr></table></figure><p>è‹¥é‡åˆ°æ— æ³•å¼€å¯ï¼š<br>å…ˆç”¨ï¼š<code>systemctl unmask firewalld.service</code><br>ç„¶åï¼š<code>systemctl start firewalld.service</code></p><h2 id="æŸ¥çœ‹å¯¹å¤–å¼€æ”¾çš„ç«¯å£çŠ¶æ€"><a href="#æŸ¥çœ‹å¯¹å¤–å¼€æ”¾çš„ç«¯å£çŠ¶æ€" class="headerlink" title="æŸ¥çœ‹å¯¹å¤–å¼€æ”¾çš„ç«¯å£çŠ¶æ€"></a>æŸ¥çœ‹å¯¹å¤–å¼€æ”¾çš„ç«¯å£çŠ¶æ€</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥è¯¢å·²å¼€æ”¾çš„ç«¯å£ï¼ˆå·²å¼€æ”¾çš„ç«¯å£å·é›†åˆï¼‰</span><br>firewall-cmd --zone=public --list-ports<br><br><span class="hljs-comment"># æŸ¥è¯¢æŒ‡å®šç«¯å£æ˜¯å¦å·²å¼€ï¼ˆç»“æœyesè¡¨ç¤ºå¼€å¯ï¼Œnoè¡¨ç¤ºæœªå¼€å¯ï¼‰</span><br>firewall-cmd --query-port=2181/tcp<br></code></pre></td></tr></table></figure><h2 id="å¯¹å¤–å¼€æ”¾ç«¯å£"><a href="#å¯¹å¤–å¼€æ”¾ç«¯å£" class="headerlink" title="å¯¹å¤–å¼€æ”¾ç«¯å£"></a>å¯¹å¤–å¼€æ”¾ç«¯å£</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹æƒ³å¼€çš„ç«¯å£æ˜¯å¦å·²å¼€</span><br>firewall-cmd --query-port=6379/tcp<br><br><span class="hljs-comment"># æ·»åŠ æŒ‡å®šéœ€è¦å¼€æ”¾çš„ç«¯å£</span><br>firewall-cmd --add-port=123/tcp --permanent<br><br><span class="hljs-comment"># åˆ·æ–°é˜²ç«å¢™è®¾ç½®</span><br>firewall-cmd --reload<br><br><span class="hljs-comment"># æŸ¥è¯¢æŒ‡å®šç«¯å£æ˜¯å¦å¼€å¯æˆåŠŸ</span><br>firewall-cmd --query-port=123/tcp<br><br><span class="hljs-comment"># ç§»é™¤æŒ‡å®šç«¯å£</span><br>firewall-cmd --permanent --remove-port=123/tcp<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>é˜²ç«å¢™</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vimæ“ä½œæ‰‹å†Œ</title>
    <link href="/20230314210532/"/>
    <url>/20230314210532/</url>
    
    <content type="html"><![CDATA[<h2 id="vimæ“ä½œæ‰‹å†Œ"><a href="#vimæ“ä½œæ‰‹å†Œ" class="headerlink" title="vimæ“ä½œæ‰‹å†Œ"></a>vimæ“ä½œæ‰‹å†Œ</h2><h3 id="1-å‘½ä»¤æ¨¡å¼"><a href="#1-å‘½ä»¤æ¨¡å¼" class="headerlink" title="1. å‘½ä»¤æ¨¡å¼"></a>1. å‘½ä»¤æ¨¡å¼</h3><p>é»˜è®¤æ¨¡å¼ï¼Œæˆ–è€…åœ¨ æ’å…¥æ¨¡å¼æŒ‰Escé”® è¿›å…¥ã€‚</p><h4 id="1-1-ä¸´æ—¶è®¾ç½®"><a href="#1-1-ä¸´æ—¶è®¾ç½®" class="headerlink" title="1.1. ä¸´æ—¶è®¾ç½®"></a>1.1. ä¸´æ—¶è®¾ç½®</h4><table><thead><tr><th align="center">æ“ä½œ</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">:set nu</td><td align="center">æ˜¾ç¤ºè¡Œå·</td></tr><tr><td align="center">:set nonu</td><td align="center">å–æ¶ˆè¡Œå·æ˜¾ç¤º</td></tr><tr><td align="center">:set mouse&#x3D;a</td><td align="center">é¼ æ ‡å¯ç”¨</td></tr><tr><td align="center">:set cursorline</td><td align="center">æ˜¾ç¤ºå…‰æ ‡æ‰€åœ¨è¡Œçš„è¡Œçº¿</td></tr></tbody></table><h4 id="1-2-æ°¸ä¹…è®¾ç½®"><a href="#1-2-æ°¸ä¹…è®¾ç½®" class="headerlink" title="1.2. æ°¸ä¹…è®¾ç½®"></a>1.2. æ°¸ä¹…è®¾ç½®</h4><p>å¯¹æ‰€æœ‰ç”¨æˆ·ç”Ÿæ•ˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># vimçš„é…ç½®æ–‡ä»¶ï¼ˆå¯¹æ‰€æœ‰ç”¨æˆ·ç”Ÿæ•ˆï¼‰</span><br>vim /etc/vimrc<br><br><span class="hljs-comment"># vimçš„é…ç½®æ–‡ä»¶ï¼ˆå¯¹å½“å‰ç”¨æˆ·ç”Ÿæ•ˆï¼‰</span><br>vim ~/.vimrc<br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨å‘½ä»¤æ¨¡å¼è¾“å…¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">:<span class="hljs-built_in">set</span> nu<br></code></pre></td></tr></table></figure><h4 id="1-3-æœç´¢"><a href="#1-3-æœç´¢" class="headerlink" title="1.3. æœç´¢"></a>1.3. æœç´¢</h4><table><thead><tr><th align="center">æ“ä½œ</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center"><code>/å…³é”®å­—</code></td><td align="center">é«˜äº®æ˜¾ç¤ºå…³é”®å­—</td></tr><tr><td align="center"><code>:noh</code></td><td align="center">å–æ¶ˆé«˜äº®æ˜¾ç¤º</td></tr><tr><td align="center"><code>n</code></td><td align="center">å‘ä¸‹åŒ¹é…å…³é”®å­—</td></tr><tr><td align="center"><code>N</code></td><td align="center">å‘ä¸ŠåŒ¹é…å…³é”®å­—</td></tr></tbody></table><h4 id="1-4-å…‰æ ‡æ“ä½œï¼ˆå¿«é€Ÿå®šä½ï¼‰"><a href="#1-4-å…‰æ ‡æ“ä½œï¼ˆå¿«é€Ÿå®šä½ï¼‰" class="headerlink" title="1.4. å…‰æ ‡æ“ä½œï¼ˆå¿«é€Ÿå®šä½ï¼‰"></a>1.4. å…‰æ ‡æ“ä½œï¼ˆå¿«é€Ÿå®šä½ï¼‰</h4><table><thead><tr><th align="center">æ“ä½œ</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center"><code>gg</code></td><td align="center">å…‰æ ‡ç§»åŠ¨åˆ°æ–‡ä»¶ç¬¬ä¸€è¡Œè¡Œé¦–</td></tr><tr><td align="center"><code>G</code></td><td align="center">å…‰æ ‡ç§»åŠ¨åˆ°æœ€åä¸€è¡Œ</td></tr><tr><td align="center"><code>:æ•°å­—</code></td><td align="center">å…‰æ ‡ç§»åŠ¨åˆ°æŒ‡å®šè¡Œ</td></tr></tbody></table><h4 id="1-5-å­—ç¬¦æ“ä½œ"><a href="#1-5-å­—ç¬¦æ“ä½œ" class="headerlink" title="1.5. å­—ç¬¦æ“ä½œ"></a>1.5. å­—ç¬¦æ“ä½œ</h4><h5 id="1-5-1-å¤åˆ¶"><a href="#1-5-1-å¤åˆ¶" class="headerlink" title="1.5.1 å¤åˆ¶"></a>1.5.1 å¤åˆ¶</h5><table><thead><tr><th align="center">æ“ä½œ</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center"><code>y</code></td><td align="center">å¤åˆ¶</td></tr><tr><td align="center"><code>y1</code></td><td align="center">å¤åˆ¶ä¸€ä¸ªå­—æ¯</td></tr><tr><td align="center"><code>y3l</code></td><td align="center">å¤åˆ¶ä¸‰ä¸ªå­—æ¯</td></tr><tr><td align="center"><code>yw</code></td><td align="center">å¤åˆ¶ä¸€ä¸ªå•è¯</td></tr><tr><td align="center"><code>y3w</code></td><td align="center">å¤åˆ¶ä¸‰ä¸ªå•è¯</td></tr><tr><td align="center"><code>yy</code></td><td align="center">å¤åˆ¶ä¸€è¡Œ</td></tr><tr><td align="center"><code>y3y</code></td><td align="center">å¤åˆ¶ä¸‰è¡Œ</td></tr></tbody></table><h5 id="1-5-2-åˆ é™¤"><a href="#1-5-2-åˆ é™¤" class="headerlink" title="1.5.2 åˆ é™¤"></a>1.5.2 åˆ é™¤</h5><table><thead><tr><th align="center">æ“ä½œ</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center"><code>d</code></td><td align="center">åˆ é™¤</td></tr><tr><td align="center"><code>dl</code></td><td align="center">åˆ é™¤ä¸€ä¸ªå­—æ¯</td></tr><tr><td align="center"><code>d3l</code></td><td align="center">åˆ é™¤ä¸€ä¸ªå•è¯</td></tr><tr><td align="center"><code>dw</code></td><td align="center">åˆ é™¤ä¸€ä¸ªå•è¯</td></tr><tr><td align="center"><code>d3w</code></td><td align="center">åˆ é™¤ä¸‰ä¸ªå•è¯</td></tr><tr><td align="center"><code>dd</code></td><td align="center">åˆ é™¤ä¸€è¡Œ</td></tr><tr><td align="center"><code>d3d</code></td><td align="center">åˆ é™¤ä¸‰è¡Œ</td></tr></tbody></table><h5 id="1-5-3-å‰ªåˆ‡"><a href="#1-5-3-å‰ªåˆ‡" class="headerlink" title="1.5.3 å‰ªåˆ‡"></a>1.5.3 å‰ªåˆ‡</h5><table><thead><tr><th align="center">æ“ä½œ</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center"><code>c</code></td><td align="center">å‰ªåˆ‡</td></tr><tr><td align="center"><code>cl</code></td><td align="center">å‰ªåˆ‡ä¸€ä¸ªå­—æ¯</td></tr><tr><td align="center"><code>c3l</code></td><td align="center">å‰ªåˆ‡ä¸€ä¸ªå•è¯</td></tr><tr><td align="center"><code>cw</code></td><td align="center">å‰ªåˆ‡ä¸€ä¸ªå•è¯</td></tr><tr><td align="center"><code>c3w</code></td><td align="center">å‰ªåˆ‡ä¸‰ä¸ªå•è¯</td></tr><tr><td align="center"><code>cc</code></td><td align="center">å‰ªåˆ‡ä¸€è¡Œ</td></tr><tr><td align="center"><code>c3c</code></td><td align="center">å‰ªåˆ‡ä¸‰è¡Œ</td></tr></tbody></table><p><em><strong>æ³¨æ„ï¼šå‰ªåˆ‡æ“ä½œå®Œæ¯•åä¼šè¿›å…¥åˆ°æ’å…¥æ¨¡å¼ï¼Œå¦‚æœè¦ç²˜è´´éœ€è¦æŒ‰ESCé€€å‡ºæ’å…¥æ¨¡å¼ã€‚</strong></em></p><h5 id="1-5-4-ç²˜è´´-amp-æ¢å¤-amp-æ’¤é”€"><a href="#1-5-4-ç²˜è´´-amp-æ¢å¤-amp-æ’¤é”€" class="headerlink" title="1.5.4 ç²˜è´´&amp;æ¢å¤&amp;æ’¤é”€"></a>1.5.4 ç²˜è´´&amp;æ¢å¤&amp;æ’¤é”€</h5><table><thead><tr><th align="center">æ“ä½œ</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center"><code>p</code></td><td align="center">ç²˜è´´</td></tr><tr><td align="center"><code>u</code></td><td align="center">æ’¤é”€</td></tr><tr><td align="center"><code>&lt;ctrl&gt;+&lt;R&gt;</code></td><td align="center">é‡åš</td></tr></tbody></table><h4 id="1-6-å¯è§†åŒ–"><a href="#1-6-å¯è§†åŒ–" class="headerlink" title="1.6. å¯è§†åŒ–"></a>1.6. å¯è§†åŒ–</h4><table><thead><tr><th align="center">æ“ä½œ</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center"><code>&lt;ctrl&gt;+&lt;v&gt;</code></td><td align="center">è¿›å…¥å¯è§†åŒ–æ¨¡å¼</td></tr><tr><td align="center"><code>&lt;ESC&gt;</code></td><td align="center">é€€å‡ºå¯è§†åŒ–æ¨¡å¼</td></tr></tbody></table><p>å¯è§†åŒ–æ¨¡å¼ä¸‹å¯ä»¥è¿›è¡Œæ‰¹é‡æ“ä½œï¼Œå¦‚å¤šè¡Œã€å¤šåˆ—çš„é€‰æ‹©ä¸ç¼–è¾‘ã€‚</p><h4 id="1-7-æ‰¹é‡æ·»åŠ ä¸ä¿®æ”¹å­—ç¬¦"><a href="#1-7-æ‰¹é‡æ·»åŠ ä¸ä¿®æ”¹å­—ç¬¦" class="headerlink" title="1.7. æ‰¹é‡æ·»åŠ ä¸ä¿®æ”¹å­—ç¬¦"></a>1.7. æ‰¹é‡æ·»åŠ ä¸ä¿®æ”¹å­—ç¬¦</h4><h5 id="1-7-1-æ‰¹é‡æ·»åŠ å­—ç¬¦"><a href="#1-7-1-æ‰¹é‡æ·»åŠ å­—ç¬¦" class="headerlink" title="1.7.1  æ‰¹é‡æ·»åŠ å­—ç¬¦"></a>1.7.1  æ‰¹é‡æ·»åŠ å­—ç¬¦</h5><ol><li><code>ctrl + v</code>é€‰ä¸­æ’å…¥è¡Œæ‰€åœ¨åˆ—ã€‚</li><li>æŒ‰å¤§å†™<code>I</code>è¿›å…¥æ’å…¥æ¨¡å¼ã€‚</li><li>æ’å…¥è¦å†™å…¥çš„å­—ç¬¦ã€‚</li><li><code>ESC</code>é€€å‡ºæ’å…¥æ¨¡å¼ï¼ˆååº”å¯èƒ½ä¼šæ¯”è¾ƒæ…¢ï¼‰ã€‚</li></ol><h5 id="1-7-2-æ‰¹é‡ä¿®æ”¹å­—ç¬¦"><a href="#1-7-2-æ‰¹é‡ä¿®æ”¹å­—ç¬¦" class="headerlink" title="1.7.2  æ‰¹é‡ä¿®æ”¹å­—ç¬¦"></a>1.7.2  æ‰¹é‡ä¿®æ”¹å­—ç¬¦</h5><table><thead><tr><th align="center"></th><th align="center"></th></tr></thead><tbody><tr><td align="center"><code>%s/åŸå­—ç¬¦/æ›¿æ¢å­—ç¬¦/g</code></td><td align="center">%å…¨æ–‡çš„è¡Œï¼Œgå…¨æ–‡çš„åˆ—</td></tr><tr><td align="center"><code>1,5s/:/#/g</code></td><td align="center">1,5ï¼š1-5è¡Œ</td></tr><tr><td align="center"><code>/lp/,/halt/s/:/##/g</code></td><td align="center">&#x2F;lp&#x2F;,&#x2F;halt&#x2F;:lpå­—ç¬¦åˆ°haltå­—ç¬¦ä¹‹é—´çš„</td></tr></tbody></table><h4 id="1-8-åˆ†å±åŠŸèƒ½"><a href="#1-8-åˆ†å±åŠŸèƒ½" class="headerlink" title="1.8. åˆ†å±åŠŸèƒ½"></a>1.8. åˆ†å±åŠŸèƒ½</h4><table><thead><tr><th align="center">æ“ä½œ</th><th align="center">ç›®çš„</th></tr></thead><tbody><tr><td align="center"><code>&lt;ctrl&gt; + w</code>    <code>s</code></td><td align="center">ä¸Šä¸‹åˆ†å±</td></tr><tr><td align="center"><code>&lt;ctrl&gt; + w</code>    <code>v</code></td><td align="center">å·¦å³åˆ†å±</td></tr><tr><td align="center"><code>&lt;ctrl&gt; + w</code>    <code>ä¸Šä¸‹å·¦å³</code></td><td align="center">å…‰æ ‡åœ¨ä¸åŒå±ä¹‹é—´åˆ‡æ¢ç§»åŠ¨</td></tr><tr><td align="center"><code>&lt;ctrl&gt; + w</code>    <code>c</code></td><td align="center">å–æ¶ˆåˆ†å±</td></tr></tbody></table><h3 id="2-æ’å…¥æ¨¡å¼"><a href="#2-æ’å…¥æ¨¡å¼" class="headerlink" title="2. æ’å…¥æ¨¡å¼"></a>2. æ’å…¥æ¨¡å¼</h3><p>å‘½ä»¤æ¨¡å¼ä¸‹ï¼Œè¿›å…¥æ–¹å¼ï¼š</p><table><thead><tr><th align="center">æ“ä½œ</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">i</td><td align="center">å…‰æ ‡æ‰€åœ¨ä½ç½®æ’å…¥</td></tr><tr><td align="center">I</td><td align="center">å…‰æ ‡æ‰€åœ¨è¡Œçš„è¡Œé¦–æ’å…¥</td></tr><tr><td align="center">a</td><td align="center">å…‰æ ‡æ‰€åœ¨å­—ç¬¦çš„ä¸‹ä¸€ä¸ªå­—ç¬¦æ’å…¥</td></tr><tr><td align="center">A</td><td align="center">å…‰æ ‡æ‰€åœ¨è¡Œçš„è¡Œå°¾æ’å…¥</td></tr><tr><td align="center">o</td><td align="center">å…‰æ ‡æ‰€åœ¨è¡Œçš„ä¸Šä¸€è¡Œæ’å…¥</td></tr><tr><td align="center">O</td><td align="center">å…‰æ ‡æ‰€åœ¨è¡Œçš„ä¸‹ä¸€è¡Œæ’å…¥</td></tr><tr><td align="center">s</td><td align="center">åˆ é™¤å…‰æ ‡æ‰€åœ¨å­—ç¬¦æ’å…¥</td></tr><tr><td align="center">S</td><td align="center">åˆ é™¤å…‰æ ‡æ‰€åœ¨è¡Œæ’å…¥</td></tr></tbody></table><h3 id="3-é€€å‡ºæ¨¡å¼"><a href="#3-é€€å‡ºæ¨¡å¼" class="headerlink" title="3. é€€å‡ºæ¨¡å¼"></a>3. é€€å‡ºæ¨¡å¼</h3><p>å‘½ä»¤æ¨¡å¼ä¸‹ï¼Œè¾“å…¥<code>:</code> ã€‚</p><table><thead><tr><th align="center">æ“ä½œ</th><th align="center">è¯´æ˜</th></tr></thead><tbody><tr><td align="center">:wq</td><td align="center">ä¿å­˜é€€å‡º</td></tr><tr><td align="center">:wq!</td><td align="center">å¼ºè¡Œä¿å­˜é€€å‡º</td></tr><tr><td align="center">:q</td><td align="center">é€€å‡º</td></tr><tr><td align="center">:q!</td><td align="center">å¼ºåˆ¶é€€å‡ºä¸ä¿å­˜</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>vim</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Zookeeperå®‰è£…</title>
    <link href="/20230314161000/"/>
    <url>/20230314161000/</url>
    
    <content type="html"><![CDATA[<h1 id="Zookeeperå®‰è£…"><a href="#Zookeeperå®‰è£…" class="headerlink" title="Zookeeperå®‰è£…"></a>Zookeeperå®‰è£…</h1><h2 id="1-ç¯å¢ƒå‡†å¤‡"><a href="#1-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="1. ç¯å¢ƒå‡†å¤‡"></a>1. ç¯å¢ƒå‡†å¤‡</h2><p>zookeeperæœåŠ¡å™¨æ˜¯ç”¨Javaåˆ›å»ºçš„ï¼Œå®ƒè¿è¡Œåœ¨JVMä¹‹ä¸Šã€‚éœ€è¦<em><strong>å…ˆå®‰è£…JDK 7æˆ–æ›´é«˜ç‰ˆæœ¬</strong></em>ã€‚</p><h3 id="1-1-ä¸‹è½½"><a href="#1-1-ä¸‹è½½" class="headerlink" title="1.1 ä¸‹è½½"></a>1.1 ä¸‹è½½</h3><p><a href="https://zookeeper.apache.org/releases.html#download">ä¸‹è½½zookeeper</a>ï¼Œç„¶åå°†å‹ç¼©åŒ…ä¼ åˆ°Linuxã€‚</p><p>æˆ–è€…ç›´æ¥åœ¨Linuxç³»ç»Ÿä¸­ä½¿ç”¨ <code>wget</code> å‘½ä»¤ä¸‹è½½ï¼Œå¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget https://dlcdn.apache.org/zookeeper/zookeeper-3.5.10/apache-zookeeper-3.5.10-bin.tar.gz<br></code></pre></td></tr></table></figure><h3 id="1-2-è§£å‹"><a href="#1-2-è§£å‹" class="headerlink" title="1.2 è§£å‹"></a>1.2 è§£å‹</h3><p>å°†ä¸‹è½½çš„zookeeperæ”¾åˆ° <code>cd /usr</code> ç›®å½•ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æ‰“å¼€ç›®å½•</span><br>cd /usr<br><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ›å»ºzookeeperç›®å½•</span><br>mkdir zookeeper<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å°†zookeeperå®‰è£…åŒ…ç§»åŠ¨åˆ°zookeeper</span><br>mv apache-zookeeper-3.5.6-bin.tar.gz zookeeper/<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å°†taråŒ…è§£å‹åˆ°/zookeeperç›®å½•ä¸‹</span><br>cd zookeeper/<br>tar -zxvf apache-zookeeper-3.5.6-bin.tar.gz <br><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ›å»ºzookeeperå­˜å‚¨ç›®å½•</span><br>mkdir zkdata<br></code></pre></td></tr></table></figure><h2 id="2-é…ç½®å¯åŠ¨"><a href="#2-é…ç½®å¯åŠ¨" class="headerlink" title="2. é…ç½®å¯åŠ¨"></a>2. é…ç½®å¯åŠ¨</h2><h3 id="2-1-é…ç½®zoo-cfg"><a href="#2-1-é…ç½®zoo-cfg" class="headerlink" title="2.1 é…ç½®zoo.cfg"></a>2.1 é…ç½®zoo.cfg</h3><p>è¿›å…¥åˆ°confç›®å½•æ‹·è´ä¸€ä¸ªzoo_sample.cfg</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">è¿›å…¥åˆ°confç›®å½•</span><br>cd /usr/zookeeper/apache-zookeeper-3.5.6-bin/conf<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ‹·è´ä¸€ä»½é…ç½®</span><br>cp zoo_sample.cfg zoo.cfg<br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¿®æ”¹zoo.cfg</span><br>vim zoo.cfg<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹å­˜å‚¨ç›®å½•ï¼š<code>dataDir=/usr/zookeeper/zkdata</code></p><p><img src="/20230314161000/image-20230315150758570.png" alt="ä¿®æ”¹zkæ•°æ®å­˜å‚¨ç›®å½•"></p><h3 id="2-2-å¯åŠ¨zookeeper"><a href="#2-2-å¯åŠ¨zookeeper" class="headerlink" title="2.2 å¯åŠ¨zookeeper"></a>2.2 å¯åŠ¨zookeeper</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">è¿›å…¥ç›®å½•</span><br>cd /usr/zookeeper/apache-zookeeper-3.5.6-bin/bin/<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¯åŠ¨</span><br>./zkServer.sh  start<br></code></pre></td></tr></table></figure><p><img src="/20230314161000/image-20230315151243489.png" alt="å¯åŠ¨zookeeper"></p><p>çœ‹åˆ°ä¸Šå›¾è¡¨ç¤ºzookeeperæˆåŠŸå¯åŠ¨</p><h3 id="2-3-æŸ¥çœ‹zookeeperçŠ¶æ€"><a href="#2-3-æŸ¥çœ‹zookeeperçŠ¶æ€" class="headerlink" title="2.3 æŸ¥çœ‹zookeeperçŠ¶æ€"></a>2.3 æŸ¥çœ‹zookeeperçŠ¶æ€</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æŸ¥çœ‹zookeeperçŠ¶æ€</span><br>./zkServer.sh status<br></code></pre></td></tr></table></figure><p><img src="/20230314161000/image-20230315162213920.png" alt="æŸ¥çœ‹zookeeperçŠ¶æ€"></p><p>ä¸Šå›¾è¯´æ˜zookeeperå¯åŠ¨æˆåŠŸã€‚standaloneä»£è¡¨zkæ²¡æœ‰æ­å»ºé›†ç¾¤ï¼Œç°åœ¨æ˜¯å•èŠ‚ç‚¹ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Zookeeper</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Zookeeper</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Dubboä»‹ç»</title>
    <link href="/20230314160000/"/>
    <url>/20230314160000/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä¸»è¦ä»‹ç»RPCæ¡†æ¶Dubboï¼Œç®€å•ä»‹ç»äº†Dubboçš„ä¸€äº›åŠŸèƒ½ç‰¹æ€§ã€‚</p><p>ğŸ‘‰<a href="https://cn.dubbo.apache.org/zh-cn/">å®˜ç½‘åœ°å€</a>ã€‚</p></blockquote><h1 id="Dubboæ¦‚å¿µ"><a href="#Dubboæ¦‚å¿µ" class="headerlink" title="Dubboæ¦‚å¿µ"></a>Dubboæ¦‚å¿µ</h1><p>Dubboæ˜¯é˜¿é‡Œå·´å·´å…¬å¸å¼€æºçš„ä¸€ä¸ªé«˜æ€§èƒ½ã€è½»é‡çº§çš„ <em><strong>Java RPC æ¡†æ¶</strong></em>ã€‚</p><p>è‡´åŠ›äºæä¾›é«˜æ€§èƒ½å’Œé€æ˜åŒ–çš„ RPC è¿œç¨‹æœåŠ¡è°ƒç”¨æ–¹æ¡ˆï¼Œä»¥åŠ SOA æœåŠ¡æ²»ç†æ–¹æ¡ˆã€‚</p><p>ğŸ‘‰<a href="https://cn.dubbo.apache.org/zh-cn/">å®˜ç½‘åœ°å€</a>ã€‚</p><h1 id="Dubboæ¶æ„"><a href="#Dubboæ¶æ„" class="headerlink" title="Dubboæ¶æ„"></a>Dubboæ¶æ„</h1><p>ğŸ‘‰<a href="https://cn.dubbo.apache.org/zh-cn/overview/mannual/java-sdk/concepts-and-architecture/overall-architecture/">å®˜æ–¹Dubboæ¶æ„ä»‹ç»</a>ã€‚</p><h2 id="æ¶æ„å›¾"><a href="#æ¶æ„å›¾" class="headerlink" title="æ¶æ„å›¾"></a>æ¶æ„å›¾</h2><p><img src="/20230314160000/image-20230314162351986-1678865274029-2.png" alt="å®˜æ–¹Dubboæ¶æ„å›¾"></p><h2 id="èŠ‚ç‚¹è§’è‰²è¯´æ˜"><a href="#èŠ‚ç‚¹è§’è‰²è¯´æ˜" class="headerlink" title="èŠ‚ç‚¹è§’è‰²è¯´æ˜"></a>èŠ‚ç‚¹è§’è‰²è¯´æ˜</h2><table><thead><tr><th>èŠ‚ç‚¹</th><th>è§’è‰²è¯´æ˜</th></tr></thead><tbody><tr><td><code>Provider</code></td><td>æš´éœ²æœåŠ¡çš„æœåŠ¡æä¾›æ–¹</td></tr><tr><td><code>Consumer</code></td><td>è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æœåŠ¡æ¶ˆè´¹æ–¹</td></tr><tr><td><code>Registry</code></td><td>æœåŠ¡æ³¨å†Œä¸å‘ç°çš„æ³¨å†Œä¸­å¿ƒ</td></tr><tr><td><code>Monitor</code></td><td>ç»Ÿè®¡æœåŠ¡çš„è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´çš„ç›‘æ§ä¸­å¿ƒ</td></tr><tr><td><code>Container</code></td><td>æœåŠ¡è¿è¡Œå®¹å™¨</td></tr></tbody></table><h1 id="Dubboå¿«é€Ÿå…¥é—¨"><a href="#Dubboå¿«é€Ÿå…¥é—¨" class="headerlink" title="Dubboå¿«é€Ÿå…¥é—¨"></a>Dubboå¿«é€Ÿå…¥é—¨</h1><p>å¯ä»¥å‚è€ƒ<a href="https://cn.dubbo.apache.org/zh-cn/overview/home/">å®˜æ–¹ä¸­æ–‡æ–‡æ¡£</a>è¿›è¡Œä½¿ç”¨ã€‚</p><p>ä½¿ç”¨dubboæœ‰ä¸€ä¸ªå¤§å‰æï¼šéœ€è¦å…ˆå®‰è£…æ³¨å†Œä¸­å¿ƒï¼Œå¦‚<strong>zookeeper</strong>ï¼ˆå®˜æ–¹æ¨èï¼‰ã€<strong>nacos</strong>ã€<strong>redis</strong>ç­‰ã€‚</p><h1 id="Dubboé«˜çº§ç‰¹æ€§"><a href="#Dubboé«˜çº§ç‰¹æ€§" class="headerlink" title="Dubboé«˜çº§ç‰¹æ€§"></a>Dubboé«˜çº§ç‰¹æ€§</h1><h2 id="1-dubbo-admin"><a href="#1-dubbo-admin" class="headerlink" title="1. dubbo-admin"></a>1. dubbo-admin</h2><p>dubbo-adminæ˜¯dubboçš„ä¸€ä¸ªç®¡ç†å¹³å°ï¼Œæä¾›å›¾å½¢åŒ–çš„æœåŠ¡ç®¡ç†é¡µé¢ã€‚</p><p>æ˜¯ä¸€ä¸ªå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ï¼Œå‰ç«¯ä½¿ç”¨vueï¼Œåç«¯ä½¿ç”¨springbootã€‚</p><p>å®‰è£… dubbo-admin å…¶å®å°±æ˜¯éƒ¨ç½²è¯¥é¡¹ç›®ã€‚</p><p>ğŸ‘‰<a href="https://github.com/apache/dubbo-admin">é¡¹ç›®åœ°å€</a>ã€‚</p><h2 id="2-åºåˆ—åŒ–"><a href="#2-åºåˆ—åŒ–" class="headerlink" title="2. åºåˆ—åŒ–"></a>2. åºåˆ—åŒ–</h2><p><img src="/20230314160000/image-20230315154021110.png" alt="Dubboçš„Javaå¯¹è±¡ä¼ è¾“"></p><p>dubbo å†…éƒ¨å·²ç»å°†åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„è¿‡ç¨‹å†…éƒ¨å°è£…äº†ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨å®šä¹‰pojoç±»æ—¶<strong>å®ç°Serializableæ¥å£</strong>å³å¯ã€‚ä¸€èˆ¬ä¼šå®šä¹‰ä¸€ä¸ªå…¬å…±çš„åŒ…å«pojoçš„æ¨¡å—ï¼Œè®©ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éƒ½ä¾èµ–è¯¥æ¨¡å—ã€‚</p><h2 id="3-åœ°å€ç¼“å­˜"><a href="#3-åœ°å€ç¼“å­˜" class="headerlink" title="3. åœ°å€ç¼“å­˜"></a>3. åœ°å€ç¼“å­˜</h2><p>æ³¨å†Œä¸­å¿ƒæŒ‚äº†ï¼ŒæœåŠ¡æ˜¯å¦å¯ä»¥æ­£å¸¸è®¿é—®ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯å¯ä»¥ã€‚</p><p>å› ä¸ºdubboæœåŠ¡æ¶ˆè´¹è€…åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ï¼Œä¼šå°†æœåŠ¡æä¾›æ–¹åœ°å€ç¼“å­˜åˆ°æœ¬åœ°ï¼Œä»¥ååœ¨è°ƒç”¨åˆ™ä¸ä¼šè®¿é—®æ³¨å†Œä¸­å¿ƒã€‚</p><p>å½“æœåŠ¡æä¾›è€…åœ°å€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ³¨å†Œä¸­å¿ƒä¼šé€šçŸ¥æœåŠ¡æ¶ˆè´¹è€…ã€‚</p><h2 id="4-è¶…æ—¶"><a href="#4-è¶…æ—¶" class="headerlink" title="4. è¶…æ—¶"></a>4. è¶…æ—¶</h2><p>æœåŠ¡æ¶ˆè´¹è€…åœ¨è°ƒç”¨æœåŠ¡æä¾›è€…çš„æ—¶å€™å‘ç”Ÿäº†é˜»å¡ã€ç­‰å¾…çš„æƒ…å½¢ï¼Œè¿™ä¸ªæ—¶å€™ï¼ŒæœåŠ¡æ¶ˆè´¹è€…ä¼šä¸€ç›´ç­‰å¾…ä¸‹å»ã€‚</p><p>åœ¨æŸä¸ªå³°å€¼æ—¶åˆ»ï¼Œå¤§é‡çš„è¯·æ±‚éƒ½åœ¨åŒæ—¶è¯·æ±‚æœåŠ¡æ¶ˆè´¹è€…ï¼Œä¼šé€ æˆçº¿ç¨‹çš„å¤§é‡å †ç§¯ï¼ŒåŠ¿å¿…ä¼šé€ æˆé›ªå´©ã€‚</p><p>dubbo åˆ©ç”¨è¶…æ—¶æœºåˆ¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œåœ¨è¿™ä¸ªæ—¶é—´æ®µå†…ï¼Œæ— æ³•å®ŒæˆæœåŠ¡è®¿é—®ï¼Œåˆ™è‡ªåŠ¨æ–­å¼€è¿æ¥ã€‚ä½¿ç”¨ timeout å±æ€§é…ç½®è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤å€¼1000ï¼Œå•ä½æ¯«ç§’ã€‚</p><p>è®¾ç½®æ–¹å¼ï¼š</p><ul><li><p>ç”Ÿäº§è€…ï¼šdubboçš„**@Service<strong>æ³¨è§£æ·»åŠ </strong>timeout**å±æ€§ã€‚</p></li><li><p>æ¶ˆè´¹è€…ï¼šdubboçš„**@Reference<strong>æ³¨è§£æ·»åŠ </strong>timeout**å±æ€§ã€‚</p></li></ul><h2 id="5-é‡è¯•"><a href="#5-é‡è¯•" class="headerlink" title="5. é‡è¯•"></a>5. é‡è¯•</h2><p>è®¾ç½®äº†è¶…æ—¶æ—¶é—´ï¼Œåœ¨è¿™ä¸ªæ—¶é—´æ®µå†…ï¼Œæ— æ³•å®ŒæˆæœåŠ¡è®¿é—®ï¼Œåˆ™è‡ªåŠ¨æ–­å¼€è¿æ¥ã€‚</p><p>å¦‚æœå‡ºç°ç½‘ç»œæŠ–åŠ¨ï¼Œåˆ™è¿™ä¸€æ¬¡è¯·æ±‚å°±ä¼šå¤±è´¥ã€‚</p><p>Dubbo æä¾›é‡è¯•æœºåˆ¶æ¥é¿å…ç±»ä¼¼é—®é¢˜çš„å‘ç”Ÿã€‚</p><p>é€šè¿‡è®¾ç½® retries å±æ€§æ¥è®¾ç½®é‡è¯•æ¬¡æ•°ã€‚é»˜è®¤ä¸º 2 æ¬¡ã€‚</p><p>è®¾ç½®æ–¹å¼ï¼š</p><ul><li>ç”Ÿäº§è€…ï¼šdubboçš„**@Service<strong>æ³¨è§£æ·»åŠ </strong>retries**å±æ€§ã€‚</li><li>æ¶ˆè´¹è€…ï¼šdubboçš„**@Reference<strong>æ³¨è§£æ·»åŠ </strong>retries**å±æ€§ã€‚</li></ul><h2 id="6-å¤šç‰ˆæœ¬"><a href="#6-å¤šç‰ˆæœ¬" class="headerlink" title="6. å¤šç‰ˆæœ¬"></a>6. å¤šç‰ˆæœ¬</h2><p>ç°åº¦å‘å¸ƒï¼šå½“å‡ºç°æ–°åŠŸèƒ½æ—¶ï¼Œä¼šè®©ä¸€éƒ¨åˆ†ç”¨æˆ·å…ˆä½¿ç”¨æ–°åŠŸèƒ½ï¼Œç”¨æˆ·åé¦ˆæ²¡é—®é¢˜æ—¶ï¼Œå†å°†æ‰€æœ‰ç”¨æˆ·è¿ç§»åˆ°æ–°åŠŸèƒ½ã€‚</p><p>dubbo ä¸­ä½¿ç”¨ version å±æ€§æ¥è®¾ç½®å’Œè°ƒç”¨åŒä¸€ä¸ªæ¥å£çš„ä¸åŒç‰ˆæœ¬ã€‚</p><p>è®¾ç½®æ–¹å¼ï¼š</p><ul><li><p>ç”Ÿäº§è€…ï¼šdubboçš„**@Service<strong>æ³¨è§£æ·»åŠ </strong>version**å±æ€§ã€‚</p></li><li><p>æ¶ˆè´¹è€…ï¼šdubboçš„**@Reference<strong>æ³¨è§£æ·»åŠ </strong>version**å±æ€§ã€‚</p></li></ul><h2 id="7-è´Ÿè½½å‡è¡¡"><a href="#7-è´Ÿè½½å‡è¡¡" class="headerlink" title="7. è´Ÿè½½å‡è¡¡"></a>7. è´Ÿè½½å‡è¡¡</h2><p>è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆ4ç§ï¼‰ï¼š</p><ul><li><p>Random ï¼šæŒ‰æƒé‡éšæœºï¼Œé»˜è®¤å€¼ã€‚æŒ‰æƒé‡è®¾ç½®éšæœºæ¦‚ç‡ã€‚</p></li><li><p>RoundRobin ï¼šæŒ‰æƒé‡è½®è¯¢ã€‚</p></li><li><p>LeastActiveï¼šæœ€å°‘æ´»è·ƒè°ƒç”¨æ•°ï¼Œç›¸åŒæ´»è·ƒæ•°çš„éšæœºã€‚</p></li><li><p>ConsistentHashï¼šä¸€è‡´æ€§ Hashï¼Œç›¸åŒå‚æ•°çš„è¯·æ±‚æ€»æ˜¯å‘åˆ°åŒä¸€æä¾›è€…ã€‚</p></li></ul><p>è®¾ç½®æ–¹å¼ï¼š</p><ul><li>ç”Ÿäº§è€…ï¼šdubboçš„**@Service<strong>æ³¨è§£æ·»åŠ </strong>loadBalance**å±æ€§ã€‚</li></ul><h2 id="8-é›†ç¾¤å®¹é”™"><a href="#8-é›†ç¾¤å®¹é”™" class="headerlink" title="8. é›†ç¾¤å®¹é”™"></a>8. é›†ç¾¤å®¹é”™</h2><p>é›†ç¾¤å®¹é”™ï¼š</p><ul><li><p>Failover Clusterï¼šå¤±è´¥é‡è¯•ã€‚é»˜è®¤å€¼ã€‚å½“å‡ºç°å¤±è´¥ï¼Œé‡è¯•å…¶å®ƒæœåŠ¡å™¨ ï¼Œé»˜è®¤é‡è¯•2æ¬¡ï¼Œä½¿ç”¨ retries é…ç½®ã€‚ä¸€èˆ¬ç”¨äºè¯»æ“ä½œ</p></li><li><p>Failfast Cluster ï¼šå¿«é€Ÿå¤±è´¥ï¼Œåªå‘èµ·ä¸€æ¬¡è°ƒç”¨ï¼Œå¤±è´¥ç«‹å³æŠ¥é”™ã€‚é€šå¸¸ç”¨äºå†™æ“ä½œã€‚</p></li><li><p>Failsafe Cluster ï¼šå¤±è´¥å®‰å…¨ï¼Œå‡ºç°å¼‚å¸¸æ—¶ï¼Œç›´æ¥å¿½ç•¥ã€‚è¿”å›ä¸€ä¸ªç©ºç»“æœã€‚</p></li><li><p>Failback Cluster ï¼šå¤±è´¥è‡ªåŠ¨æ¢å¤ï¼Œåå°è®°å½•å¤±è´¥è¯·æ±‚ï¼Œå®šæ—¶é‡å‘ã€‚é€šå¸¸ç”¨äºæ¶ˆæ¯é€šçŸ¥æ“ä½œã€‚</p></li><li><p>Forking Cluster ï¼šå¹¶è¡Œè°ƒç”¨å¤šä¸ªæœåŠ¡å™¨ï¼Œåªè¦ä¸€ä¸ªæˆåŠŸå³è¿”å›ã€‚</p></li><li><p>Broadcast  Cluster ï¼šå¹¿æ’­è°ƒç”¨æ‰€æœ‰æä¾›è€…ï¼Œé€ä¸ªè°ƒç”¨ï¼Œä»»æ„ä¸€å°æŠ¥é”™åˆ™æŠ¥é”™ã€‚</p></li></ul><p>è®¾ç½®æ–¹å¼ï¼š</p><ul><li>ç”Ÿäº§è€…ï¼šdubboçš„**@Service<strong>æ³¨è§£æ·»åŠ </strong>cluster**å±æ€§ã€‚</li></ul><h2 id="9-æœåŠ¡é™çº§"><a href="#9-æœåŠ¡é™çº§" class="headerlink" title="9. æœåŠ¡é™çº§"></a>9. æœåŠ¡é™çº§</h2><p>æœåŠ¡é™çº§ï¼Œé€šè¿‡ä¸€å®šçš„è®¾ç½®æ¥é™ä½éƒ¨åˆ†æœåŠ¡çš„ä½¿ç”¨ç‡ï¼Œä»¥è¾¾åˆ°æé«˜å…¶ä»–æœåŠ¡æ€§èƒ½çš„ç›®çš„ã€‚</p><p><code>mock=force:return null</code> ï¼Œä¸è¿œç¨‹è°ƒç”¨æœåŠ¡ï¼Œç›´æ¥è¿”å›nullã€‚</p><p><code>mock=fail:return null</code> ï¼ŒæœåŠ¡å¦‚æœè°ƒç”¨å¤±è´¥ï¼Œç›´æ¥è¿”å›nullã€‚</p><p>è®¾ç½®æ–¹å¼ï¼š</p><ul><li>ç”Ÿäº§è€…ï¼šdubboçš„**@Service<strong>æ³¨è§£æ·»åŠ </strong>mock**å±æ€§ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Dubbo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Dubbo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç³»ç»Ÿæ¶æ„çš„æ¼”è¿›</title>
    <link href="/20230314150000/"/>
    <url>/20230314150000/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä¸»è¦ä»‹ç»ç³»ç»Ÿæ¶æ„çš„æ¼”è¿›ã€‚</p></blockquote><h1 id="ç³»ç»Ÿæ¶æ„çš„æ¼”è¿›"><a href="#ç³»ç»Ÿæ¶æ„çš„æ¼”è¿›" class="headerlink" title="ç³»ç»Ÿæ¶æ„çš„æ¼”è¿›"></a>ç³»ç»Ÿæ¶æ„çš„æ¼”è¿›</h1><h2 id="äº’è”ç½‘é¡¹ç›®ç›®æ ‡"><a href="#äº’è”ç½‘é¡¹ç›®ç›®æ ‡" class="headerlink" title="äº’è”ç½‘é¡¹ç›®ç›®æ ‡"></a>äº’è”ç½‘é¡¹ç›®ç›®æ ‡</h2><p><strong>é«˜æ€§èƒ½</strong>ï¼šæä¾›å¿«é€Ÿçš„è®¿é—®ä½“éªŒã€‚</p><p><strong>é«˜å¯ç”¨</strong>ï¼šç½‘ç«™æœåŠ¡ä¸€ç›´å¯ä»¥æ­£å¸¸è®¿é—®ã€‚</p><p><strong>å¯ä¼¸ç¼©</strong>ï¼šé€šè¿‡ç¡¬ä»¶å¢åŠ &#x2F;å‡å°‘ï¼Œæé«˜&#x2F;é™ä½å¤„ç†èƒ½åŠ›ã€‚</p><p><strong>é«˜å¯æ‰©å±•</strong>ï¼šç³»ç»Ÿé—´è€¦åˆä½ï¼Œæ–¹ä¾¿çš„é€šè¿‡æ–°å¢&#x2F;ç§»é™¤æ–¹å¼ï¼Œå¢åŠ &#x2F;å‡å°‘æ–°çš„åŠŸèƒ½&#x2F;æ¨¡å—ã€‚ </p><p><strong>å®‰å…¨æ€§</strong>ï¼šæä¾›ç½‘ç«™å®‰å…¨è®¿é—®å’Œæ•°æ®åŠ å¯†ï¼Œå®‰å…¨å­˜å‚¨ç­‰ç­–ç•¥ã€‚</p><p><strong>æ•æ·æ€§</strong>ï¼šéšéœ€åº”å˜ï¼Œå¿«é€Ÿå“åº”ã€‚</p><h3 id="è¡¡é‡ç½‘ç«™çš„æ€§èƒ½æŒ‡æ ‡"><a href="#è¡¡é‡ç½‘ç«™çš„æ€§èƒ½æŒ‡æ ‡" class="headerlink" title="è¡¡é‡ç½‘ç«™çš„æ€§èƒ½æŒ‡æ ‡"></a>è¡¡é‡ç½‘ç«™çš„æ€§èƒ½æŒ‡æ ‡</h3><p><strong>è¡¡é‡ç½‘ç«™çš„æ€§èƒ½æŒ‡æ ‡ï¼š</strong></p><ul><li><p><strong>å“åº”æ—¶é—´</strong>ï¼šæŒ‡æ‰§è¡Œä¸€ä¸ªè¯·æ±‚ä»å¼€å§‹åˆ°æœ€åæ”¶åˆ°å“åº”æ•°æ®æ‰€èŠ±è´¹çš„æ€»ä½“æ—¶é—´ã€‚</p></li><li><p><strong>å¹¶å‘æ•°</strong>ï¼šæŒ‡ç³»ç»ŸåŒæ—¶èƒ½å¤„ç†çš„è¯·æ±‚æ•°é‡ã€‚</p></li><li><p><strong>å¹¶å‘è¿æ¥æ•°</strong>ï¼šæŒ‡çš„æ˜¯å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œå¹¶å»ºç«‹äº†TCPè¿æ¥ã€‚æ¯ç§’é’ŸæœåŠ¡å™¨è¿æ¥çš„æ€»TCPæ•°é‡</p></li><li><p><strong>è¯·æ±‚æ•°</strong>ï¼šä¹Ÿç§°ä¸ºQPS(Query Per Second) æŒ‡æ¯ç§’å¤šå°‘è¯·æ±‚.</p></li><li><p><strong>å¹¶å‘ç”¨æˆ·æ•°</strong>ï¼šå•ä½æ—¶é—´å†…æœ‰å¤šå°‘ç”¨æˆ·</p></li><li><p><strong>ååé‡</strong>ï¼šæŒ‡å•ä½æ—¶é—´å†…ç³»ç»Ÿèƒ½å¤„ç†çš„è¯·æ±‚æ•°é‡ã€‚</p></li><li><p><strong>QPS</strong>ï¼šQuery Per Second æ¯ç§’æŸ¥è¯¢æ•°ã€‚ </p></li><li><p><strong>TPS</strong>ï¼šTransactions Per Second æ¯ç§’äº‹åŠ¡æ•°ã€‚</p></li></ul><p>ä¸€ä¸ªäº‹åŠ¡æ˜¯æŒ‡ä¸€ä¸ªå®¢æˆ·æœºå‘æœåŠ¡å™¨å‘é€è¯·æ±‚ç„¶åæœåŠ¡å™¨åšå‡ºååº”çš„è¿‡ç¨‹ã€‚å®¢æˆ·æœºåœ¨å‘é€è¯·æ±‚æ—¶å¼€å§‹è®¡æ—¶ï¼Œæ”¶åˆ°æœåŠ¡å™¨å“åº”åç»“æŸè®¡æ—¶ï¼Œä»¥æ­¤æ¥è®¡ç®—ä½¿ç”¨çš„æ—¶é—´å’Œå®Œæˆçš„äº‹åŠ¡ä¸ªæ•°ã€‚</p><p>ä¸€ä¸ªé¡µé¢çš„ä¸€æ¬¡è®¿é—®ï¼Œåªä¼šå½¢æˆä¸€ä¸ªTPSï¼›ä½†ä¸€æ¬¡é¡µé¢è¯·æ±‚ï¼Œå¯èƒ½äº§ç”Ÿå¤šæ¬¡å¯¹æœåŠ¡å™¨çš„è¯·æ±‚ï¼Œå°±ä¼šæœ‰å¤šä¸ªQPS</p><p>æ‰€ä»¥ï¼š<strong>QPS &gt;&#x3D; å¹¶å‘è¿æ¥æ•° &gt;&#x3D; TPS</strong></p><h2 id="é›†ç¾¤å’Œåˆ†å¸ƒå¼æ¦‚å¿µ"><a href="#é›†ç¾¤å’Œåˆ†å¸ƒå¼æ¦‚å¿µ" class="headerlink" title="é›†ç¾¤å’Œåˆ†å¸ƒå¼æ¦‚å¿µ"></a>é›†ç¾¤å’Œåˆ†å¸ƒå¼æ¦‚å¿µ</h2><p><img src="/20230314150000/image-20230315161301567.png" alt="é›†ç¾¤å’Œåˆ†å¸ƒå¼çš„æ¦‚å¿µ"></p><p><img src="/20230314150000/image-20230315161428193.png" alt="é›†ç¾¤æ¶æ„å›¾"></p><p><img src="/20230314150000/image-20230315161506381.png" alt="é›†ç¾¤åˆ†å¸ƒå¼æ¶æ„å›¾"></p><h2 id="æ¶æ„æ¼”è¿›"><a href="#æ¶æ„æ¼”è¿›" class="headerlink" title="æ¶æ„æ¼”è¿›"></a>æ¶æ„æ¼”è¿›</h2><p><img src="/20230314150000/image-20230315161535570.png" alt="æ¶æ„æ¼”è¿›"></p><h3 id="1-å•ä½“æ¶æ„"><a href="#1-å•ä½“æ¶æ„" class="headerlink" title="1. å•ä½“æ¶æ„"></a>1. å•ä½“æ¶æ„</h3><p><img src="/20230314150000/image-20230315161622245.png" alt="å•ä½“æ¶æ„"></p><h3 id="2-å‚ç›´æ¶æ„"><a href="#2-å‚ç›´æ¶æ„" class="headerlink" title="2. å‚ç›´æ¶æ„"></a>2. å‚ç›´æ¶æ„</h3><p><img src="/20230314150000/image-20230315161643604.png" alt="å‚ç›´æ¶æ„"></p><h3 id="3-åˆ†å¸ƒå¼æ¶æ„"><a href="#3-åˆ†å¸ƒå¼æ¶æ„" class="headerlink" title="3. åˆ†å¸ƒå¼æ¶æ„"></a>3. åˆ†å¸ƒå¼æ¶æ„</h3><p><img src="/20230314150000/image-20230315161712957.png" alt="åˆ†å¸ƒå¼æ¶æ„"></p><h3 id="4-SOAæ¶æ„"><a href="#4-SOAæ¶æ„" class="headerlink" title="4. SOAæ¶æ„"></a>4. SOAæ¶æ„</h3><p><img src="/20230314150000/image-20230315161735308.png" alt="SOAæ¶æ„"></p><h3 id="5-å¾®æœåŠ¡"><a href="#5-å¾®æœåŠ¡" class="headerlink" title="5. å¾®æœåŠ¡"></a>5. å¾®æœåŠ¡</h3><p><img src="/20230314150000/image-20230315161801852.png" alt="å¾®æœåŠ¡æ¶æ„"></p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>å¾…åˆ†ç±»</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç³»ç»Ÿæ¶æ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redisé«˜çº§ç¯‡ - åˆ†å¸ƒå¼ç¼“å­˜</title>
    <link href="/20221205140000/"/>
    <url>/20221205140000/</url>
    
    <content type="html"><![CDATA[<h1 id="Redisé«˜çº§ç¯‡-åˆ†å¸ƒå¼ç¼“å­˜"><a href="#Redisé«˜çº§ç¯‡-åˆ†å¸ƒå¼ç¼“å­˜" class="headerlink" title="Redisé«˜çº§ç¯‡ - åˆ†å¸ƒå¼ç¼“å­˜"></a>Redisé«˜çº§ç¯‡ - åˆ†å¸ƒå¼ç¼“å­˜</h1><p>Redisåˆ†å¸ƒå¼ç¼“å­˜ï¼Œæä¾›å•æœºRediså­˜åœ¨é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚</p><h1 id="å•æœºçš„Rediså­˜åœ¨å››å¤§é—®é¢˜"><a href="#å•æœºçš„Rediså­˜åœ¨å››å¤§é—®é¢˜" class="headerlink" title="å•æœºçš„Rediså­˜åœ¨å››å¤§é—®é¢˜"></a>å•æœºçš„Rediså­˜åœ¨å››å¤§é—®é¢˜</h1><p><img src="/20221205140000/image-20210725144240631.png" alt="å•æœºçš„Rediså­˜åœ¨å››å¤§é—®é¢˜"></p><h1 id="1-RedisæŒä¹…åŒ–"><a href="#1-RedisæŒä¹…åŒ–" class="headerlink" title="1.RedisæŒä¹…åŒ–"></a>1.RedisæŒä¹…åŒ–</h1><p>Redisæœ‰ä¸¤ç§æŒä¹…åŒ–æ–¹æ¡ˆï¼š</p><ul><li>RDBæŒä¹…åŒ–</li><li>AOFæŒä¹…åŒ–</li></ul><h2 id="1-1-RDBæŒä¹…åŒ–"><a href="#1-1-RDBæŒä¹…åŒ–" class="headerlink" title="1.1.RDBæŒä¹…åŒ–"></a>1.1.RDBæŒä¹…åŒ–</h2><p>RDBå…¨ç§°Redis Database Backup fileï¼ˆRedisæ•°æ®å¤‡ä»½æ–‡ä»¶ï¼‰ï¼Œä¹Ÿè¢«å«åšRedisæ•°æ®å¿«ç…§ã€‚ç®€å•æ¥è¯´å°±æ˜¯æŠŠå†…å­˜ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½è®°å½•åˆ°ç£ç›˜ä¸­ã€‚å½“Rediså®ä¾‹æ•…éšœé‡å¯åï¼Œä»ç£ç›˜è¯»å–å¿«ç…§æ–‡ä»¶ï¼Œæ¢å¤æ•°æ®ã€‚å¿«ç…§æ–‡ä»¶ç§°ä¸ºRDBæ–‡ä»¶ï¼Œé»˜è®¤æ˜¯ä¿å­˜åœ¨å½“å‰è¿è¡Œç›®å½•ã€‚</p><h3 id="1-1-1-æ‰§è¡Œæ—¶æœº"><a href="#1-1-1-æ‰§è¡Œæ—¶æœº" class="headerlink" title="1.1.1.æ‰§è¡Œæ—¶æœº"></a>1.1.1.æ‰§è¡Œæ—¶æœº</h3><p>RDBæŒä¹…åŒ–åœ¨å››ç§æƒ…å†µä¸‹ä¼šæ‰§è¡Œï¼š</p><ul><li>æ‰§è¡Œsaveå‘½ä»¤</li><li>æ‰§è¡Œbgsaveå‘½ä»¤</li><li>Redisåœæœºæ—¶</li><li>è§¦å‘RDBæ¡ä»¶æ—¶</li></ul><p><strong>1ï¼‰saveå‘½ä»¤</strong></p><p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå¯ä»¥ç«‹å³æ‰§è¡Œä¸€æ¬¡RDBï¼š</p><p><img src="/20221205140000/image-20210725144536958.png"></p><p>saveå‘½ä»¤ä¼šå¯¼è‡´ä¸»è¿›ç¨‹æ‰§è¡ŒRDBï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­å…¶å®ƒæ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«é˜»å¡ã€‚åªæœ‰åœ¨æ•°æ®è¿ç§»æ—¶å¯èƒ½ç”¨åˆ°ã€‚</p><p><strong>2ï¼‰bgsaveå‘½ä»¤</strong></p><p>ä¸‹é¢çš„å‘½ä»¤å¯ä»¥å¼‚æ­¥æ‰§è¡ŒRDBï¼š</p><p><img src="/20221205140000/image-20210725144725943.png"></p><p>è¿™ä¸ªå‘½ä»¤æ‰§è¡Œåä¼šå¼€å¯ç‹¬ç«‹è¿›ç¨‹å®ŒæˆRDBï¼Œä¸»è¿›ç¨‹å¯ä»¥æŒç»­å¤„ç†ç”¨æˆ·è¯·æ±‚ï¼Œä¸å—å½±å“ã€‚</p><p><strong>3ï¼‰åœæœºæ—¶</strong></p><p>Redisåœæœºæ—¶ä¼šæ‰§è¡Œä¸€æ¬¡saveå‘½ä»¤ï¼Œå®ç°RDBæŒä¹…åŒ–ã€‚</p><p><strong>4ï¼‰è§¦å‘RDBæ¡ä»¶</strong></p><p>Rediså†…éƒ¨æœ‰è§¦å‘RDBçš„æœºåˆ¶ï¼Œå¯ä»¥åœ¨redis.confæ–‡ä»¶ä¸­æ‰¾åˆ°ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># 900ç§’å†…ï¼Œå¦‚æœè‡³å°‘æœ‰1ä¸ªkeyè¢«ä¿®æ”¹ï¼Œåˆ™æ‰§è¡Œbgsave ï¼Œ å¦‚æœæ˜¯save &quot;&quot; åˆ™è¡¨ç¤ºç¦ç”¨RDB</span><br><span class="hljs-attr">save</span> <span class="hljs-string">900 1  </span><br><span class="hljs-attr">save</span> <span class="hljs-string">300 10  </span><br><span class="hljs-attr">save</span> <span class="hljs-string">60 10000 </span><br></code></pre></td></tr></table></figure><p>RDBçš„å…¶å®ƒé…ç½®ä¹Ÿå¯ä»¥åœ¨redis.confæ–‡ä»¶ä¸­è®¾ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># æ˜¯å¦å‹ç¼© ,å»ºè®®ä¸å¼€å¯ï¼Œå‹ç¼©ä¹Ÿä¼šæ¶ˆè€—cpuï¼Œç£ç›˜çš„è¯ä¸å€¼é’±</span><br><span class="hljs-attr">rdbcompression</span> <span class="hljs-string">yes</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># RDBæ–‡ä»¶åç§°</span><br><span class="hljs-attr">dbfilename</span> <span class="hljs-string">dump.rdb  </span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># æ–‡ä»¶ä¿å­˜çš„è·¯å¾„ç›®å½•</span><br><span class="hljs-attr">dir</span> <span class="hljs-string">./ </span><br></code></pre></td></tr></table></figure><h3 id="1-1-2-RDBåŸç†"><a href="#1-1-2-RDBåŸç†" class="headerlink" title="1.1.2.RDBåŸç†"></a>1.1.2.RDBåŸç†</h3><p>bgsaveå¼€å§‹æ—¶ä¼šforkä¸»è¿›ç¨‹å¾—åˆ°å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹å…±äº«ä¸»è¿›ç¨‹çš„å†…å­˜æ•°æ®ã€‚å®Œæˆforkåè¯»å–å†…å­˜æ•°æ®å¹¶å†™å…¥ RDB æ–‡ä»¶ã€‚</p><p>forké‡‡ç”¨çš„æ˜¯copy-on-writeæŠ€æœ¯ï¼š</p><ul><li>å½“ä¸»è¿›ç¨‹æ‰§è¡Œè¯»æ“ä½œæ—¶ï¼Œè®¿é—®å…±äº«å†…å­˜ï¼›</li><li>å½“ä¸»è¿›ç¨‹æ‰§è¡Œå†™æ“ä½œæ—¶ï¼Œåˆ™ä¼šæ‹·è´ä¸€ä»½æ•°æ®ï¼Œæ‰§è¡Œå†™æ“ä½œã€‚</li></ul><p><img src="/20221205140000/image-20210725151319695.png" alt="RDBåŸç†"></p><h3 id="1-1-3-å°ç»“"><a href="#1-1-3-å°ç»“" class="headerlink" title="1.1.3.å°ç»“"></a>1.1.3.å°ç»“</h3><p>RDBæ–¹å¼bgsaveçš„åŸºæœ¬æµç¨‹ï¼Ÿ</p><ul><li>forkä¸»è¿›ç¨‹å¾—åˆ°ä¸€ä¸ªå­è¿›ç¨‹ï¼Œå…±äº«å†…å­˜ç©ºé—´</li><li>å­è¿›ç¨‹è¯»å–å†…å­˜æ•°æ®å¹¶å†™å…¥æ–°çš„RDBæ–‡ä»¶</li><li>ç”¨æ–°RDBæ–‡ä»¶æ›¿æ¢æ—§çš„RDBæ–‡ä»¶</li></ul><p>RDBä¼šåœ¨ä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Ÿsave 60 1000ä»£è¡¨ä»€ä¹ˆå«ä¹‰ï¼Ÿ</p><ul><li>é»˜è®¤æ˜¯æœåŠ¡åœæ­¢æ—¶</li><li>ä»£è¡¨60ç§’å†…è‡³å°‘æ‰§è¡Œ1000æ¬¡ä¿®æ”¹åˆ™è§¦å‘RDB</li></ul><p>RDBçš„ç¼ºç‚¹ï¼Ÿ</p><ul><li>RDBæ‰§è¡Œé—´éš”æ—¶é—´é•¿ï¼Œä¸¤æ¬¡RDBä¹‹é—´å†™å…¥æ•°æ®æœ‰ä¸¢å¤±çš„é£é™©</li><li>forkå­è¿›ç¨‹ã€å‹ç¼©ã€å†™å‡ºRDBæ–‡ä»¶éƒ½æ¯”è¾ƒè€—æ—¶</li></ul><h2 id="1-2-AOFæŒä¹…åŒ–"><a href="#1-2-AOFæŒä¹…åŒ–" class="headerlink" title="1.2.AOFæŒä¹…åŒ–"></a>1.2.AOFæŒä¹…åŒ–</h2><h3 id="1-2-1-AOFåŸç†"><a href="#1-2-1-AOFåŸç†" class="headerlink" title="1.2.1.AOFåŸç†"></a>1.2.1.AOFåŸç†</h3><p>AOFå…¨ç§°ä¸ºAppend Only Fileï¼ˆè¿½åŠ æ–‡ä»¶ï¼‰ã€‚Rediså¤„ç†çš„æ¯ä¸€ä¸ªå†™å‘½ä»¤éƒ½ä¼šè®°å½•åœ¨AOFæ–‡ä»¶ï¼Œå¯ä»¥çœ‹åšæ˜¯å‘½ä»¤æ—¥å¿—æ–‡ä»¶ã€‚</p><p><img src="/20221205140000/image-20210725151543640.png" alt="AOFåŸç†"></p><h3 id="1-2-2-AOFé…ç½®"><a href="#1-2-2-AOFé…ç½®" class="headerlink" title="1.2.2.AOFé…ç½®"></a>1.2.2.AOFé…ç½®</h3><p>AOFé»˜è®¤æ˜¯å…³é—­çš„ï¼Œéœ€è¦ä¿®æ”¹redis.confé…ç½®æ–‡ä»¶æ¥å¼€å¯AOFï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># æ˜¯å¦å¼€å¯AOFåŠŸèƒ½ï¼Œé»˜è®¤æ˜¯no</span><br><span class="hljs-attr">appendonly</span> <span class="hljs-string">yes</span><br><span class="hljs-comment"># AOFæ–‡ä»¶çš„åç§°</span><br><span class="hljs-attr">appendfilename</span> <span class="hljs-string">&quot;appendonly.aof&quot;</span><br></code></pre></td></tr></table></figure><p>AOFçš„å‘½ä»¤è®°å½•çš„é¢‘ç‡ä¹Ÿå¯ä»¥é€šè¿‡redis.confæ–‡ä»¶æ¥é…ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># è¡¨ç¤ºæ¯æ‰§è¡Œä¸€æ¬¡å†™å‘½ä»¤ï¼Œç«‹å³è®°å½•åˆ°AOFæ–‡ä»¶</span><br><span class="hljs-attr">appendfsync</span> <span class="hljs-string">always </span><br><span class="hljs-comment"># å†™å‘½ä»¤æ‰§è¡Œå®Œå…ˆæ”¾å…¥AOFç¼“å†²åŒºï¼Œç„¶åè¡¨ç¤ºæ¯éš”1ç§’å°†ç¼“å†²åŒºæ•°æ®å†™åˆ°AOFæ–‡ä»¶ï¼Œæ˜¯é»˜è®¤æ–¹æ¡ˆ</span><br><span class="hljs-attr">appendfsync</span> <span class="hljs-string">everysec </span><br><span class="hljs-comment"># å†™å‘½ä»¤æ‰§è¡Œå®Œå…ˆæ”¾å…¥AOFç¼“å†²åŒºï¼Œç”±æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶å°†ç¼“å†²åŒºå†…å®¹å†™å›ç£ç›˜</span><br><span class="hljs-attr">appendfsync</span> <span class="hljs-string">no</span><br></code></pre></td></tr></table></figure><p>ä¸‰ç§ç­–ç•¥å¯¹æ¯”ï¼š</p><p><img src="/20221205140000/image-20210725151654046.png" alt="ä¸‰ç§ç­–ç•¥å¯¹æ¯”"></p><h3 id="1-2-3-AOFæ–‡ä»¶é‡å†™"><a href="#1-2-3-AOFæ–‡ä»¶é‡å†™" class="headerlink" title="1.2.3.AOFæ–‡ä»¶é‡å†™"></a>1.2.3.AOFæ–‡ä»¶é‡å†™</h3><p>å› ä¸ºæ˜¯è®°å½•å‘½ä»¤ï¼ŒAOFæ–‡ä»¶ä¼šæ¯”RDBæ–‡ä»¶å¤§çš„å¤šã€‚è€Œä¸”AOFä¼šè®°å½•å¯¹åŒä¸€ä¸ªkeyçš„å¤šæ¬¡å†™æ“ä½œï¼Œä½†åªæœ‰æœ€åä¸€æ¬¡å†™æ“ä½œæ‰æœ‰æ„ä¹‰ã€‚é€šè¿‡æ‰§è¡Œbgrewriteaofå‘½ä»¤ï¼Œå¯ä»¥è®©AOFæ–‡ä»¶æ‰§è¡Œé‡å†™åŠŸèƒ½ï¼Œç”¨æœ€å°‘çš„å‘½ä»¤è¾¾åˆ°ç›¸åŒæ•ˆæœã€‚</p><p><img src="/20221205140000/image-20210725151729118.png" alt="AOFæ–‡ä»¶é‡å†™"></p><p>å¦‚å›¾ï¼ŒAOFåŸæœ¬æœ‰ä¸‰ä¸ªå‘½ä»¤ï¼Œä½†æ˜¯<code>set num 123 å’Œ set num 666</code>éƒ½æ˜¯å¯¹numçš„æ“ä½œï¼Œç¬¬äºŒæ¬¡ä¼šè¦†ç›–ç¬¬ä¸€æ¬¡çš„å€¼ï¼Œå› æ­¤ç¬¬ä¸€ä¸ªå‘½ä»¤è®°å½•ä¸‹æ¥æ²¡æœ‰æ„ä¹‰ã€‚</p><p>æ‰€ä»¥é‡å†™å‘½ä»¤åï¼ŒAOFæ–‡ä»¶å†…å®¹å°±æ˜¯ï¼š<code>mset name jack num 666</code></p><p>Redisä¹Ÿä¼šåœ¨è§¦å‘é˜ˆå€¼æ—¶è‡ªåŠ¨å»é‡å†™AOFæ–‡ä»¶ã€‚é˜ˆå€¼ä¹Ÿå¯ä»¥åœ¨redis.confä¸­é…ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># AOFæ–‡ä»¶æ¯”ä¸Šæ¬¡æ–‡ä»¶ å¢é•¿è¶…è¿‡å¤šå°‘ç™¾åˆ†æ¯”åˆ™è§¦å‘é‡å†™</span><br><span class="hljs-attr">auto-aof-rewrite-percentage</span> <span class="hljs-string">100</span><br><span class="hljs-comment"># AOFæ–‡ä»¶ä½“ç§¯æœ€å°å¤šå¤§ä»¥ä¸Šæ‰è§¦å‘é‡å†™ </span><br><span class="hljs-attr">auto-aof-rewrite-min-size</span> <span class="hljs-string">64mb </span><br></code></pre></td></tr></table></figure><h2 id="1-3-RDBä¸AOFå¯¹æ¯”"><a href="#1-3-RDBä¸AOFå¯¹æ¯”" class="headerlink" title="1.3.RDBä¸AOFå¯¹æ¯”"></a>1.3.RDBä¸AOFå¯¹æ¯”</h2><p>RDBå’ŒAOFå„æœ‰è‡ªå·±çš„ä¼˜ç¼ºç‚¹ï¼Œå¦‚æœå¯¹æ•°æ®å®‰å…¨æ€§è¦æ±‚è¾ƒé«˜ï¼Œåœ¨å®é™…å¼€å‘ä¸­å¾€å¾€ä¼š<strong>ç»“åˆ</strong>ä¸¤è€…æ¥ä½¿ç”¨ã€‚</p><p><img src="/20221205140000/image-20210725151940515.png" alt="RDBä¸AOFå¯¹æ¯”"></p><h1 id="2-Redisä¸»ä»"><a href="#2-Redisä¸»ä»" class="headerlink" title="2.Redisä¸»ä»"></a>2.Redisä¸»ä»</h1><h2 id="2-1-æ­å»ºä¸»ä»æ¶æ„"><a href="#2-1-æ­å»ºä¸»ä»æ¶æ„" class="headerlink" title="2.1.æ­å»ºä¸»ä»æ¶æ„"></a>2.1.æ­å»ºä¸»ä»æ¶æ„</h2><p>å•èŠ‚ç‚¹Redisçš„å¹¶å‘èƒ½åŠ›æ˜¯æœ‰ä¸Šé™çš„ï¼Œè¦è¿›ä¸€æ­¥æé«˜Redisçš„å¹¶å‘èƒ½åŠ›ï¼Œå°±éœ€è¦æ­å»ºä¸»ä»é›†ç¾¤ï¼Œå®ç°è¯»å†™åˆ†ç¦»ã€‚</p><p><img src="/20221205140000/image-20210725152037611.png" alt="Redisä¸»ä»"></p><p>å…·ä½“æ­å»ºæµç¨‹å‚è€ƒåšå®¢æ–‡ç«  <em><strong>ã€ŠRedisé›†ç¾¤æ­å»ºã€‹</strong></em>ã€‚</p><h2 id="2-2-ä¸»ä»æ•°æ®åŒæ­¥åŸç†"><a href="#2-2-ä¸»ä»æ•°æ®åŒæ­¥åŸç†" class="headerlink" title="2.2.ä¸»ä»æ•°æ®åŒæ­¥åŸç†"></a>2.2.ä¸»ä»æ•°æ®åŒæ­¥åŸç†</h2><h3 id="2-2-1-å…¨é‡åŒæ­¥"><a href="#2-2-1-å…¨é‡åŒæ­¥" class="headerlink" title="2.2.1.å…¨é‡åŒæ­¥"></a>2.2.1.å…¨é‡åŒæ­¥</h3><p>ä¸»ä»ç¬¬ä¸€æ¬¡å»ºç«‹è¿æ¥æ—¶ï¼Œä¼šæ‰§è¡Œ<strong>å…¨é‡åŒæ­¥</strong>ï¼Œå°†masterèŠ‚ç‚¹çš„æ‰€æœ‰æ•°æ®éƒ½æ‹·è´ç»™slaveèŠ‚ç‚¹ï¼Œæµç¨‹ï¼š</p><p><img src="/20221205140000/image-20210725152222497.png" alt="å…¨é‡åŒæ­¥åŸç†"></p><p>è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œmasterå¦‚ä½•å¾—çŸ¥salveæ˜¯ç¬¬ä¸€æ¬¡æ¥è¿æ¥å‘¢ï¼Ÿï¼Ÿ</p><p>æœ‰å‡ ä¸ªæ¦‚å¿µï¼Œå¯ä»¥ä½œä¸ºåˆ¤æ–­ä¾æ®ï¼š</p><ul><li><strong>Replication Id</strong>ï¼šç®€ç§°replidï¼Œæ˜¯æ•°æ®é›†çš„æ ‡è®°ï¼Œidä¸€è‡´åˆ™è¯´æ˜æ˜¯åŒä¸€æ•°æ®é›†ã€‚æ¯ä¸€ä¸ªmasteréƒ½æœ‰å”¯ä¸€çš„replidï¼Œslaveåˆ™ä¼šç»§æ‰¿masterèŠ‚ç‚¹çš„replid</li><li><strong>offset</strong>ï¼šåç§»é‡ï¼Œéšç€è®°å½•åœ¨repl_baklogä¸­çš„æ•°æ®å¢å¤šè€Œé€æ¸å¢å¤§ã€‚slaveå®ŒæˆåŒæ­¥æ—¶ä¹Ÿä¼šè®°å½•å½“å‰åŒæ­¥çš„offsetã€‚å¦‚æœslaveçš„offsetå°äºmasterçš„offsetï¼Œè¯´æ˜slaveæ•°æ®è½åäºmasterï¼Œéœ€è¦æ›´æ–°ã€‚</li></ul><p>å› æ­¤slaveåšæ•°æ®åŒæ­¥ï¼Œå¿…é¡»å‘masterå£°æ˜è‡ªå·±çš„replication id å’Œoffsetï¼Œmasteræ‰å¯ä»¥åˆ¤æ–­åˆ°åº•éœ€è¦åŒæ­¥å“ªäº›æ•°æ®ã€‚</p><p>å› ä¸ºslaveåŸæœ¬ä¹Ÿæ˜¯ä¸€ä¸ªmasterï¼Œæœ‰è‡ªå·±çš„replidå’Œoffsetï¼Œå½“ç¬¬ä¸€æ¬¡å˜æˆslaveï¼Œä¸masterå»ºç«‹è¿æ¥æ—¶ï¼Œå‘é€çš„replidå’Œoffsetæ˜¯è‡ªå·±çš„replidå’Œoffsetã€‚</p><p>masteråˆ¤æ–­å‘ç°slaveå‘é€æ¥çš„replidä¸è‡ªå·±çš„ä¸ä¸€è‡´ï¼Œè¯´æ˜è¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„slaveï¼Œå°±çŸ¥é“è¦åšå…¨é‡åŒæ­¥äº†ã€‚</p><p>masterä¼šå°†è‡ªå·±çš„replidå’Œoffsetéƒ½å‘é€ç»™è¿™ä¸ªslaveï¼Œslaveä¿å­˜è¿™äº›ä¿¡æ¯ã€‚ä»¥åslaveçš„replidå°±ä¸masterä¸€è‡´äº†ã€‚</p><p>å› æ­¤ï¼Œ<strong>masteråˆ¤æ–­ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡åŒæ­¥çš„ä¾æ®ï¼Œå°±æ˜¯çœ‹replidæ˜¯å¦ä¸€è‡´</strong>ã€‚</p><p>å¦‚å›¾ï¼š</p><p><img src="/20221205140000/image-20210725152700914.png" alt="å…¨é‡åŒæ­¥åŸç†"></p><p>å®Œæ•´æµç¨‹æè¿°ï¼š</p><ul><li>slaveèŠ‚ç‚¹è¯·æ±‚å¢é‡åŒæ­¥</li><li>masterèŠ‚ç‚¹åˆ¤æ–­replidï¼Œå‘ç°ä¸ä¸€è‡´ï¼Œæ‹’ç»å¢é‡åŒæ­¥</li><li>masterå°†å®Œæ•´å†…å­˜æ•°æ®ç”ŸæˆRDBï¼Œå‘é€RDBåˆ°slave</li><li>slaveæ¸…ç©ºæœ¬åœ°æ•°æ®ï¼ŒåŠ è½½masterçš„RDB</li><li>masterå°†RDBæœŸé—´çš„å‘½ä»¤è®°å½•åœ¨repl_baklogï¼Œå¹¶æŒç»­å°†logä¸­çš„å‘½ä»¤å‘é€ç»™slave</li><li>slaveæ‰§è¡Œæ¥æ”¶åˆ°çš„å‘½ä»¤ï¼Œä¿æŒä¸masterä¹‹é—´çš„åŒæ­¥</li></ul><h3 id="2-2-2-å¢é‡åŒæ­¥"><a href="#2-2-2-å¢é‡åŒæ­¥" class="headerlink" title="2.2.2.å¢é‡åŒæ­¥"></a>2.2.2.å¢é‡åŒæ­¥</h3><p>å…¨é‡åŒæ­¥éœ€è¦å…ˆåšRDBï¼Œç„¶åå°†RDBæ–‡ä»¶é€šè¿‡ç½‘ç»œä¼ è¾“ä¸ªslaveï¼Œæˆæœ¬å¤ªé«˜äº†ã€‚å› æ­¤é™¤äº†ç¬¬ä¸€æ¬¡åšå…¨é‡åŒæ­¥ï¼Œå…¶å®ƒå¤§å¤šæ•°æ—¶å€™slaveä¸masteréƒ½æ˜¯åš<strong>å¢é‡åŒæ­¥</strong>ã€‚</p><p>ä»€ä¹ˆæ˜¯å¢é‡åŒæ­¥ï¼Ÿå°±æ˜¯åªæ›´æ–°slaveä¸masterå­˜åœ¨å·®å¼‚çš„éƒ¨åˆ†æ•°æ®ã€‚å¦‚å›¾ï¼š</p><p><img src="/20221205140000/image-20210725153201086.png" alt="å¢é‡åŒæ­¥åŸç†"></p><p>é‚£ä¹ˆmasteræ€ä¹ˆçŸ¥é“slaveä¸è‡ªå·±çš„æ•°æ®å·®å¼‚åœ¨å“ªé‡Œå‘¢?</p><h3 id="2-2-3-repl-backlogåŸç†"><a href="#2-2-3-repl-backlogåŸç†" class="headerlink" title="2.2.3.repl_backlogåŸç†"></a>2.2.3.repl_backlogåŸç†</h3><p>masteræ€ä¹ˆçŸ¥é“slaveä¸è‡ªå·±çš„æ•°æ®å·®å¼‚åœ¨å“ªé‡Œå‘¢?</p><p>è¿™å°±è¦è¯´åˆ°å…¨é‡åŒæ­¥æ—¶çš„repl_baklogæ–‡ä»¶äº†ã€‚</p><p>è¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„æ•°ç»„ï¼Œåªä¸è¿‡æ•°ç»„æ˜¯ç¯å½¢ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>è§’æ ‡åˆ°è¾¾æ•°ç»„æœ«å°¾åï¼Œä¼šå†æ¬¡ä»0å¼€å§‹è¯»å†™</strong>ï¼Œè¿™æ ·æ•°ç»„å¤´éƒ¨çš„æ•°æ®å°±ä¼šè¢«è¦†ç›–ã€‚</p><p>repl_baklogä¸­ä¼šè®°å½•Rediså¤„ç†è¿‡çš„å‘½ä»¤æ—¥å¿—åŠoffsetï¼ŒåŒ…æ‹¬masterå½“å‰çš„offsetï¼Œå’Œslaveå·²ç»æ‹·è´åˆ°çš„offsetï¼š</p><p><img src="/20221205140000/image-20210725153359022.png" alt="åŸç†å›¾"> </p><p>slaveä¸masterçš„offsetä¹‹é—´çš„å·®å¼‚ï¼Œå°±æ˜¯salveéœ€è¦å¢é‡æ‹·è´çš„æ•°æ®äº†ã€‚</p><p>éšç€ä¸æ–­æœ‰æ•°æ®å†™å…¥ï¼Œmasterçš„offseté€æ¸å˜å¤§ï¼Œslaveä¹Ÿä¸æ–­çš„æ‹·è´ï¼Œè¿½èµ¶masterçš„offsetï¼š</p><p><img src="/20221205140000/image-20210725153524190.png" alt="åŸç†å›¾"> </p><p>ç›´åˆ°æ•°ç»„è¢«å¡«æ»¡ï¼š</p><p><img src="/20221205140000/image-20210725153715910.png" alt="åŸç†å›¾"> </p><p>æ­¤æ—¶ï¼Œå¦‚æœæœ‰æ–°çš„æ•°æ®å†™å…¥ï¼Œå°±ä¼šè¦†ç›–æ•°ç»„ä¸­çš„æ—§æ•°æ®ã€‚ä¸è¿‡ï¼Œæ—§çš„æ•°æ®åªè¦æ˜¯ç»¿è‰²çš„ï¼Œè¯´æ˜æ˜¯å·²ç»è¢«åŒæ­¥åˆ°slaveçš„æ•°æ®ï¼Œå³ä¾¿è¢«è¦†ç›–äº†ä¹Ÿæ²¡ä»€ä¹ˆå½±å“ã€‚å› ä¸ºæœªåŒæ­¥çš„ä»…ä»…æ˜¯çº¢è‰²éƒ¨åˆ†ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœslaveå‡ºç°ç½‘ç»œé˜»å¡ï¼Œå¯¼è‡´masterçš„offsetè¿œè¿œè¶…è¿‡äº†slaveçš„offsetï¼š </p><p><img src="/20221205140000/image-20210725153937031.png" alt="åŸç†å›¾"> </p><p>å¦‚æœmasterç»§ç»­å†™å…¥æ–°æ•°æ®ï¼Œå…¶offsetå°±ä¼šè¦†ç›–æ—§çš„æ•°æ®ï¼Œç›´åˆ°å°†slaveç°åœ¨çš„offsetä¹Ÿè¦†ç›–ï¼š</p><p><img src="/20221205140000/image-20210725154155984.png" alt="åŸç†å›¾"> </p><p>æ£•è‰²æ¡†ä¸­çš„çº¢è‰²éƒ¨åˆ†ï¼Œå°±æ˜¯å°šæœªåŒæ­¥ï¼Œä½†æ˜¯å´å·²ç»è¢«è¦†ç›–çš„æ•°æ®ã€‚æ­¤æ—¶å¦‚æœslaveæ¢å¤ï¼Œéœ€è¦åŒæ­¥ï¼Œå´å‘ç°è‡ªå·±çš„offsetéƒ½æ²¡æœ‰äº†ï¼Œæ— æ³•å®Œæˆå¢é‡åŒæ­¥äº†ã€‚åªèƒ½åšå…¨é‡åŒæ­¥ã€‚</p><p><img src="/20221205140000/image-20210725154216392.png" alt="æ³¨æ„äº‹é¡¹"></p><h2 id="2-3-ä¸»ä»åŒæ­¥ä¼˜åŒ–"><a href="#2-3-ä¸»ä»åŒæ­¥ä¼˜åŒ–" class="headerlink" title="2.3.ä¸»ä»åŒæ­¥ä¼˜åŒ–"></a>2.3.ä¸»ä»åŒæ­¥ä¼˜åŒ–</h2><p>ä¸»ä»åŒæ­¥å¯ä»¥ä¿è¯ä¸»ä»æ•°æ®çš„ä¸€è‡´æ€§ï¼Œéå¸¸é‡è¦ã€‚</p><p>å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥ä¼˜åŒ–Redisä¸»ä»å°±é›†ç¾¤ï¼š</p><ul><li>åœ¨masterä¸­é…ç½®repl-diskless-sync yeså¯ç”¨æ— ç£ç›˜å¤åˆ¶ï¼Œé¿å…å…¨é‡åŒæ­¥æ—¶çš„ç£ç›˜IOã€‚</li><li>Rediså•èŠ‚ç‚¹ä¸Šçš„å†…å­˜å ç”¨ä¸è¦å¤ªå¤§ï¼Œå‡å°‘RDBå¯¼è‡´çš„è¿‡å¤šç£ç›˜IO</li><li>é€‚å½“æé«˜repl_baklogçš„å¤§å°ï¼Œå‘ç°slaveå®•æœºæ—¶å°½å¿«å®ç°æ•…éšœæ¢å¤ï¼Œå°½å¯èƒ½é¿å…å…¨é‡åŒæ­¥</li><li>é™åˆ¶ä¸€ä¸ªmasterä¸Šçš„slaveèŠ‚ç‚¹æ•°é‡ï¼Œå¦‚æœå®åœ¨æ˜¯å¤ªå¤šslaveï¼Œåˆ™å¯ä»¥é‡‡ç”¨ä¸»-ä»-ä»é“¾å¼ç»“æ„ï¼Œå‡å°‘masterå‹åŠ›</li></ul><p>ä¸»ä»ä»æ¶æ„å›¾ï¼š</p><p><img src="/20221205140000/image-20210725154405899.png" alt="ä¸»ä»ä»æ¶æ„å›¾"></p><h2 id="2-4-å°ç»“"><a href="#2-4-å°ç»“" class="headerlink" title="2.4.å°ç»“"></a>2.4.å°ç»“</h2><p>ç®€è¿°å…¨é‡åŒæ­¥å’Œå¢é‡åŒæ­¥åŒºåˆ«ï¼Ÿ</p><ul><li>å…¨é‡åŒæ­¥ï¼šmasterå°†å®Œæ•´å†…å­˜æ•°æ®ç”ŸæˆRDBï¼Œå‘é€RDBåˆ°slaveã€‚åç»­å‘½ä»¤åˆ™è®°å½•åœ¨repl_baklogï¼Œé€ä¸ªå‘é€ç»™slaveã€‚</li><li>å¢é‡åŒæ­¥ï¼šslaveæäº¤è‡ªå·±çš„offsetåˆ°masterï¼Œmasterè·å–repl_baklogä¸­ä»offsetä¹‹åçš„å‘½ä»¤ç»™slave</li></ul><p>ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå…¨é‡åŒæ­¥ï¼Ÿ</p><ul><li>slaveèŠ‚ç‚¹ç¬¬ä¸€æ¬¡è¿æ¥masterèŠ‚ç‚¹æ—¶</li><li>slaveèŠ‚ç‚¹æ–­å¼€æ—¶é—´å¤ªä¹…ï¼Œrepl_baklogä¸­çš„offsetå·²ç»è¢«è¦†ç›–æ—¶</li></ul><p>ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå¢é‡åŒæ­¥ï¼Ÿ</p><ul><li>slaveèŠ‚ç‚¹æ–­å¼€åˆæ¢å¤ï¼Œå¹¶ä¸”åœ¨repl_baklogä¸­èƒ½æ‰¾åˆ°offsetæ—¶</li></ul><h1 id="3-Rediså“¨å…µ"><a href="#3-Rediså“¨å…µ" class="headerlink" title="3.Rediså“¨å…µ"></a>3.Rediså“¨å…µ</h1><p>Redisæä¾›äº†å“¨å…µï¼ˆSentinelï¼‰æœºåˆ¶æ¥å®ç°ä¸»ä»é›†ç¾¤çš„è‡ªåŠ¨æ•…éšœæ¢å¤ã€‚</p><h2 id="3-1-å“¨å…µåŸç†"><a href="#3-1-å“¨å…µåŸç†" class="headerlink" title="3.1.å“¨å…µåŸç†"></a>3.1.å“¨å…µåŸç†</h2><h3 id="3-1-1-é›†ç¾¤ç»“æ„å’Œä½œç”¨"><a href="#3-1-1-é›†ç¾¤ç»“æ„å’Œä½œç”¨" class="headerlink" title="3.1.1.é›†ç¾¤ç»“æ„å’Œä½œç”¨"></a>3.1.1.é›†ç¾¤ç»“æ„å’Œä½œç”¨</h3><p>å“¨å…µçš„ç»“æ„å¦‚å›¾ï¼š</p><p><img src="/20221205140000/image-20210725154528072.png" alt="å“¨å…µçš„ç»“æ„å›¾"></p><p>å“¨å…µçš„ä½œç”¨å¦‚ä¸‹ï¼š</p><ul><li><strong>ç›‘æ§</strong>ï¼šSentinel ä¼šä¸æ–­æ£€æŸ¥æ‚¨çš„masterå’Œslaveæ˜¯å¦æŒ‰é¢„æœŸå·¥ä½œ</li><li><strong>è‡ªåŠ¨æ•…éšœæ¢å¤</strong>ï¼šå¦‚æœmasteræ•…éšœï¼ŒSentinelä¼šå°†ä¸€ä¸ªslaveæå‡ä¸ºmasterã€‚å½“æ•…éšœå®ä¾‹æ¢å¤åä¹Ÿä»¥æ–°çš„masterä¸ºä¸»</li><li><strong>é€šçŸ¥</strong>ï¼šSentinelå……å½“Rediså®¢æˆ·ç«¯çš„æœåŠ¡å‘ç°æ¥æºï¼Œå½“é›†ç¾¤å‘ç”Ÿæ•…éšœè½¬ç§»æ—¶ï¼Œä¼šå°†æœ€æ–°ä¿¡æ¯æ¨é€ç»™Redisçš„å®¢æˆ·ç«¯</li></ul><h3 id="3-1-2-é›†ç¾¤ç›‘æ§åŸç†"><a href="#3-1-2-é›†ç¾¤ç›‘æ§åŸç†" class="headerlink" title="3.1.2.é›†ç¾¤ç›‘æ§åŸç†"></a>3.1.2.é›†ç¾¤ç›‘æ§åŸç†</h3><p>SentinelåŸºäºå¿ƒè·³æœºåˆ¶ç›‘æµ‹æœåŠ¡çŠ¶æ€ï¼Œæ¯éš”1ç§’å‘é›†ç¾¤çš„æ¯ä¸ªå®ä¾‹å‘é€pingå‘½ä»¤ï¼š</p><p>â€¢ä¸»è§‚ä¸‹çº¿ï¼šå¦‚æœæŸsentinelèŠ‚ç‚¹å‘ç°æŸå®ä¾‹æœªåœ¨è§„å®šæ—¶é—´å“åº”ï¼Œåˆ™è®¤ä¸ºè¯¥å®ä¾‹<strong>ä¸»è§‚ä¸‹çº¿</strong>ã€‚</p><p>â€¢å®¢è§‚ä¸‹çº¿ï¼šè‹¥è¶…è¿‡æŒ‡å®šæ•°é‡ï¼ˆquorumï¼‰çš„sentineléƒ½è®¤ä¸ºè¯¥å®ä¾‹ä¸»è§‚ä¸‹çº¿ï¼Œåˆ™è¯¥å®ä¾‹<strong>å®¢è§‚ä¸‹çº¿</strong>ã€‚quorumå€¼æœ€å¥½è¶…è¿‡Sentinelå®ä¾‹æ•°é‡çš„ä¸€åŠã€‚</p><p><img src="/20221205140000/image-20210725154632354.png" alt="é›†ç¾¤ç›‘æ§åŸç†å›¾"></p><h3 id="3-1-3-é›†ç¾¤æ•…éšœæ¢å¤åŸç†"><a href="#3-1-3-é›†ç¾¤æ•…éšœæ¢å¤åŸç†" class="headerlink" title="3.1.3.é›†ç¾¤æ•…éšœæ¢å¤åŸç†"></a>3.1.3.é›†ç¾¤æ•…éšœæ¢å¤åŸç†</h3><p>ä¸€æ—¦å‘ç°masteræ•…éšœï¼Œsentineléœ€è¦åœ¨salveä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºæ–°çš„masterï¼Œé€‰æ‹©ä¾æ®æ˜¯è¿™æ ·çš„ï¼š</p><ul><li>é¦–å…ˆä¼šåˆ¤æ–­slaveèŠ‚ç‚¹ä¸masterèŠ‚ç‚¹æ–­å¼€æ—¶é—´é•¿çŸ­ï¼Œå¦‚æœè¶…è¿‡æŒ‡å®šå€¼ï¼ˆdown-after-milliseconds * 10ï¼‰åˆ™ä¼šæ’é™¤è¯¥slaveèŠ‚ç‚¹</li><li>ç„¶ååˆ¤æ–­slaveèŠ‚ç‚¹çš„slave-priorityå€¼ï¼Œè¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼Œå¦‚æœæ˜¯0åˆ™æ°¸ä¸å‚ä¸é€‰ä¸¾</li><li>å¦‚æœslave-prorityä¸€æ ·ï¼Œåˆ™åˆ¤æ–­slaveèŠ‚ç‚¹çš„offsetå€¼ï¼Œè¶Šå¤§è¯´æ˜æ•°æ®è¶Šæ–°ï¼Œä¼˜å…ˆçº§è¶Šé«˜</li><li>æœ€åæ˜¯åˆ¤æ–­slaveèŠ‚ç‚¹çš„è¿è¡Œidå¤§å°ï¼Œè¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ã€‚</li></ul><p>å½“é€‰å‡ºä¸€ä¸ªæ–°çš„masteråï¼Œè¯¥å¦‚ä½•å®ç°åˆ‡æ¢å‘¢ï¼Ÿ</p><p>æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>sentinelç»™å¤‡é€‰çš„slave1èŠ‚ç‚¹å‘é€slaveof no oneå‘½ä»¤ï¼Œè®©è¯¥èŠ‚ç‚¹æˆä¸ºmaster</li><li>sentinelç»™æ‰€æœ‰å…¶å®ƒslaveå‘é€slaveof 192.168.150.101 7002 å‘½ä»¤ï¼Œè®©è¿™äº›slaveæˆä¸ºæ–°masterçš„ä»èŠ‚ç‚¹ï¼Œå¼€å§‹ä»æ–°çš„masterä¸ŠåŒæ­¥æ•°æ®ã€‚</li><li>æœ€åï¼Œsentinelå°†æ•…éšœèŠ‚ç‚¹æ ‡è®°ä¸ºslaveï¼Œå½“æ•…éšœèŠ‚ç‚¹æ¢å¤åä¼šè‡ªåŠ¨æˆä¸ºæ–°çš„masterçš„slaveèŠ‚ç‚¹</li></ul><p><img src="/20221205140000/image-20210725154816841.png" alt="é›†ç¾¤æ•…éšœæ¢å¤åŸç†"></p><h3 id="3-1-4-å°ç»“"><a href="#3-1-4-å°ç»“" class="headerlink" title="3.1.4.å°ç»“"></a>3.1.4.å°ç»“</h3><p>Sentinelçš„ä¸‰ä¸ªä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>ç›‘æ§</li><li>æ•…éšœè½¬ç§»</li><li>é€šçŸ¥</li></ul><p>Sentinelå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªrediså®ä¾‹æ˜¯å¦å¥åº·ï¼Ÿ</p><ul><li>æ¯éš”1ç§’å‘é€ä¸€æ¬¡pingå‘½ä»¤ï¼Œå¦‚æœè¶…è¿‡ä¸€å®šæ—¶é—´æ²¡æœ‰ç›¸å‘åˆ™è®¤ä¸ºæ˜¯ä¸»è§‚ä¸‹çº¿</li><li>å¦‚æœå¤§å¤šæ•°sentineléƒ½è®¤ä¸ºå®ä¾‹ä¸»è§‚ä¸‹çº¿ï¼Œåˆ™åˆ¤å®šæœåŠ¡ä¸‹çº¿</li></ul><p>æ•…éšœè½¬ç§»æ­¥éª¤æœ‰å“ªäº›ï¼Ÿ</p><ul><li>é¦–å…ˆé€‰å®šä¸€ä¸ªslaveä½œä¸ºæ–°çš„masterï¼Œæ‰§è¡Œslaveof no one</li><li>ç„¶åè®©æ‰€æœ‰èŠ‚ç‚¹éƒ½æ‰§è¡Œslaveof æ–°master</li><li>ä¿®æ”¹æ•…éšœèŠ‚ç‚¹é…ç½®ï¼Œæ·»åŠ slaveof æ–°master</li></ul><h2 id="3-2-æ­å»ºå“¨å…µé›†ç¾¤"><a href="#3-2-æ­å»ºå“¨å…µé›†ç¾¤" class="headerlink" title="3.2.æ­å»ºå“¨å…µé›†ç¾¤"></a>3.2.æ­å»ºå“¨å…µé›†ç¾¤</h2><p>å…·ä½“æ­å»ºæµç¨‹å‚è€ƒåšå®¢æ–‡ç«  <em><strong>ã€ŠRedisé›†ç¾¤æ­å»ºã€‹</strong></em>ã€‚</p><h2 id="3-3-RedisTemplate"><a href="#3-3-RedisTemplate" class="headerlink" title="3.3.RedisTemplate"></a>3.3.RedisTemplate</h2><p>åœ¨Sentinelé›†ç¾¤ç›‘ç®¡ä¸‹çš„Redisä¸»ä»é›†ç¾¤ï¼Œå…¶èŠ‚ç‚¹ä¼šå› ä¸ºè‡ªåŠ¨æ•…éšœè½¬ç§»è€Œå‘ç”Ÿå˜åŒ–ï¼ŒRedisçš„å®¢æˆ·ç«¯å¿…é¡»æ„ŸçŸ¥è¿™ç§å˜åŒ–ï¼ŒåŠæ—¶æ›´æ–°è¿æ¥ä¿¡æ¯ã€‚Springçš„RedisTemplateåº•å±‚åˆ©ç”¨lettuceå®ç°äº†èŠ‚ç‚¹çš„æ„ŸçŸ¥å’Œè‡ªåŠ¨åˆ‡æ¢ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæµ‹è¯•æ¥å®ç°RedisTemplateé›†æˆå“¨å…µæœºåˆ¶ã€‚</p><h3 id="3-3-1-å¯¼å…¥Demoå·¥ç¨‹"><a href="#3-3-1-å¯¼å…¥Demoå·¥ç¨‹" class="headerlink" title="3.3.1.å¯¼å…¥Demoå·¥ç¨‹"></a>3.3.1.å¯¼å…¥Demoå·¥ç¨‹</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¼•å…¥è¯¾å‰èµ„æ–™æä¾›çš„Demoå·¥ç¨‹ï¼š</p><p><img src="/20221205140000/image-20210725155124958.png" alt="image-20210725155124958"> </p><h3 id="3-3-2-å¼•å…¥ä¾èµ–"><a href="#3-3-2-å¼•å…¥ä¾èµ–" class="headerlink" title="3.3.2.å¼•å…¥ä¾èµ–"></a>3.3.2.å¼•å…¥ä¾èµ–</h3><p>åœ¨é¡¹ç›®çš„pomæ–‡ä»¶ä¸­å¼•å…¥ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="3-3-3-é…ç½®Redisåœ°å€"><a href="#3-3-3-é…ç½®Redisåœ°å€" class="headerlink" title="3.3.3.é…ç½®Redisåœ°å€"></a>3.3.3.é…ç½®Redisåœ°å€</h3><p>ç„¶ååœ¨é…ç½®æ–‡ä»¶application.ymlä¸­æŒ‡å®šredisçš„sentinelç›¸å…³ä¿¡æ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java">spring:<br>  redis:<br>    sentinel:<br>      master: mymaster<br>      nodes:<br>        - <span class="hljs-number">192.168</span><span class="hljs-number">.150</span><span class="hljs-number">.101</span>:<span class="hljs-number">27001</span><br>        - <span class="hljs-number">192.168</span><span class="hljs-number">.150</span><span class="hljs-number">.101</span>:<span class="hljs-number">27002</span><br>        - <span class="hljs-number">192.168</span><span class="hljs-number">.150</span><span class="hljs-number">.101</span>:<span class="hljs-number">27003</span><br></code></pre></td></tr></table></figure><h3 id="3-3-4-é…ç½®è¯»å†™åˆ†ç¦»"><a href="#3-3-4-é…ç½®è¯»å†™åˆ†ç¦»" class="headerlink" title="3.3.4.é…ç½®è¯»å†™åˆ†ç¦»"></a>3.3.4.é…ç½®è¯»å†™åˆ†ç¦»</h3><p>åœ¨é¡¹ç›®çš„å¯åŠ¨ç±»ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªæ–°çš„beanï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> LettuceClientConfigurationBuilderCustomizer <span class="hljs-title function_">clientConfigurationBuilderCustomizer</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-keyword">return</span> clientConfigurationBuilder -&gt; clientConfigurationBuilder.readFrom(ReadFrom.REPLICA_PREFERRED);<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªbeanä¸­é…ç½®çš„å°±æ˜¯è¯»å†™ç­–ç•¥ï¼ŒåŒ…æ‹¬å››ç§ï¼š</p><ul><li>MASTERï¼šä»ä¸»èŠ‚ç‚¹è¯»å–</li><li>MASTER_PREFERREDï¼šä¼˜å…ˆä»masterèŠ‚ç‚¹è¯»å–ï¼Œmasterä¸å¯ç”¨æ‰è¯»å–replica</li><li>REPLICAï¼šä»slaveï¼ˆreplicaï¼‰èŠ‚ç‚¹è¯»å–</li><li>REPLICA _PREFERREDï¼šä¼˜å…ˆä»slaveï¼ˆreplicaï¼‰èŠ‚ç‚¹è¯»å–ï¼Œæ‰€æœ‰çš„slaveéƒ½ä¸å¯ç”¨æ‰è¯»å–master</li></ul><h1 id="4-Redisåˆ†ç‰‡é›†ç¾¤"><a href="#4-Redisåˆ†ç‰‡é›†ç¾¤" class="headerlink" title="4.Redisåˆ†ç‰‡é›†ç¾¤"></a>4.Redisåˆ†ç‰‡é›†ç¾¤</h1><h2 id="4-1-æ­å»ºåˆ†ç‰‡é›†ç¾¤"><a href="#4-1-æ­å»ºåˆ†ç‰‡é›†ç¾¤" class="headerlink" title="4.1.æ­å»ºåˆ†ç‰‡é›†ç¾¤"></a>4.1.æ­å»ºåˆ†ç‰‡é›†ç¾¤</h2><p>ä¸»ä»å’Œå“¨å…µå¯ä»¥è§£å†³é«˜å¯ç”¨ã€é«˜å¹¶å‘è¯»çš„é—®é¢˜ã€‚ä½†æ˜¯ä¾ç„¶æœ‰ä¸¤ä¸ªé—®é¢˜æ²¡æœ‰è§£å†³ï¼š</p><ul><li><p>æµ·é‡æ•°æ®å­˜å‚¨é—®é¢˜</p></li><li><p>é«˜å¹¶å‘å†™çš„é—®é¢˜</p></li></ul><p>ä½¿ç”¨åˆ†ç‰‡é›†ç¾¤å¯ä»¥è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå¦‚å›¾:</p><p><img src="/20221205140000/image-20210725155747294.png" alt="Redisåˆ†ç‰‡é›†ç¾¤"></p><p>åˆ†ç‰‡é›†ç¾¤ç‰¹å¾ï¼š</p><ul><li><p>é›†ç¾¤ä¸­æœ‰å¤šä¸ªmasterï¼Œæ¯ä¸ªmasterä¿å­˜ä¸åŒæ•°æ®</p></li><li><p>æ¯ä¸ªmasteréƒ½å¯ä»¥æœ‰å¤šä¸ªslaveèŠ‚ç‚¹</p></li><li><p>masterä¹‹é—´é€šè¿‡pingç›‘æµ‹å½¼æ­¤å¥åº·çŠ¶æ€</p></li><li><p>å®¢æˆ·ç«¯è¯·æ±‚å¯ä»¥è®¿é—®é›†ç¾¤ä»»æ„èŠ‚ç‚¹ï¼Œæœ€ç»ˆéƒ½ä¼šè¢«è½¬å‘åˆ°æ­£ç¡®èŠ‚ç‚¹</p></li></ul><p>å…·ä½“æ­å»ºæµç¨‹å‚è€ƒåšå®¢æ–‡ç«  <em><strong>ã€ŠRedisé›†ç¾¤æ­å»ºã€‹</strong></em>ã€‚</p><h2 id="4-2-æ•£åˆ—æ’æ§½"><a href="#4-2-æ•£åˆ—æ’æ§½" class="headerlink" title="4.2.æ•£åˆ—æ’æ§½"></a>4.2.æ•£åˆ—æ’æ§½</h2><h3 id="4-2-1-æ’æ§½åŸç†"><a href="#4-2-1-æ’æ§½åŸç†" class="headerlink" title="4.2.1.æ’æ§½åŸç†"></a>4.2.1.æ’æ§½åŸç†</h3><p>Redisä¼šæŠŠæ¯ä¸€ä¸ªmasterèŠ‚ç‚¹æ˜ å°„åˆ°0~16383å…±16384ä¸ªæ’æ§½ï¼ˆhash slotï¼‰ä¸Šï¼ŒæŸ¥çœ‹é›†ç¾¤ä¿¡æ¯æ—¶å°±èƒ½çœ‹åˆ°ï¼š</p><p><img src="/20221205140000/image-20210725155820320.png" alt="Redisæ’æ§½"></p><p>æ•°æ®keyä¸æ˜¯ä¸èŠ‚ç‚¹ç»‘å®šï¼Œè€Œæ˜¯ä¸æ’æ§½ç»‘å®šã€‚redisä¼šæ ¹æ®keyçš„æœ‰æ•ˆéƒ¨åˆ†è®¡ç®—æ’æ§½å€¼ï¼Œåˆ†ä¸¤ç§æƒ…å†µï¼š</p><ul><li>keyä¸­åŒ…å«â€{}â€ï¼Œä¸”â€œ{}â€ä¸­è‡³å°‘åŒ…å«1ä¸ªå­—ç¬¦ï¼Œâ€œ{}â€ä¸­çš„éƒ¨åˆ†æ˜¯æœ‰æ•ˆéƒ¨åˆ†</li><li>keyä¸­ä¸åŒ…å«â€œ{}â€ï¼Œæ•´ä¸ªkeyéƒ½æ˜¯æœ‰æ•ˆéƒ¨åˆ†</li></ul><p>ä¾‹å¦‚ï¼škeyæ˜¯numï¼Œé‚£ä¹ˆå°±æ ¹æ®numè®¡ç®—ï¼Œå¦‚æœæ˜¯{itcast}numï¼Œåˆ™æ ¹æ®itcastè®¡ç®—ã€‚è®¡ç®—æ–¹å¼æ˜¯åˆ©ç”¨CRC16ç®—æ³•å¾—åˆ°ä¸€ä¸ªhashå€¼ï¼Œç„¶åå¯¹16384å–ä½™ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯slotå€¼ã€‚</p><p><img src="/20221205140000/image-20210725155850200.png"> </p><p>å¦‚å›¾ï¼Œåœ¨7001è¿™ä¸ªèŠ‚ç‚¹æ‰§è¡Œset a 1æ—¶ï¼Œå¯¹aåšhashè¿ç®—ï¼Œå¯¹16384å–ä½™ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯15495ï¼Œå› æ­¤è¦å­˜å‚¨åˆ°103èŠ‚ç‚¹ã€‚</p><p>åˆ°äº†7003åï¼Œæ‰§è¡Œ<code>get num</code>æ—¶ï¼Œå¯¹numåšhashè¿ç®—ï¼Œå¯¹16384å–ä½™ï¼Œå¾—åˆ°çš„ç»“æœæ˜¯2765ï¼Œå› æ­¤éœ€è¦åˆ‡æ¢åˆ°7001èŠ‚ç‚¹</p><h3 id="4-2-1-å°ç»“"><a href="#4-2-1-å°ç»“" class="headerlink" title="4.2.1.å°ç»“"></a>4.2.1.å°ç»“</h3><p>Rediså¦‚ä½•åˆ¤æ–­æŸä¸ªkeyåº”è¯¥åœ¨å“ªä¸ªå®ä¾‹ï¼Ÿ</p><ul><li>å°†16384ä¸ªæ’æ§½åˆ†é…åˆ°ä¸åŒçš„å®ä¾‹</li><li>æ ¹æ®keyçš„æœ‰æ•ˆéƒ¨åˆ†è®¡ç®—å“ˆå¸Œå€¼ï¼Œå¯¹16384å–ä½™</li><li>ä½™æ•°ä½œä¸ºæ’æ§½ï¼Œå¯»æ‰¾æ’æ§½æ‰€åœ¨å®ä¾‹å³å¯</li></ul><p>å¦‚ä½•å°†åŒä¸€ç±»æ•°æ®å›ºå®šçš„ä¿å­˜åœ¨åŒä¸€ä¸ªRediså®ä¾‹ï¼Ÿ</p><ul><li>è¿™ä¸€ç±»æ•°æ®ä½¿ç”¨ç›¸åŒçš„æœ‰æ•ˆéƒ¨åˆ†ï¼Œä¾‹å¦‚keyéƒ½ä»¥{typeId}ä¸ºå‰ç¼€</li></ul><h2 id="4-3-é›†ç¾¤ä¼¸ç¼©"><a href="#4-3-é›†ç¾¤ä¼¸ç¼©" class="headerlink" title="4.3.é›†ç¾¤ä¼¸ç¼©"></a>4.3.é›†ç¾¤ä¼¸ç¼©</h2><p>redis-cli â€“clusteræä¾›äº†å¾ˆå¤šæ“ä½œé›†ç¾¤çš„å‘½ä»¤ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢æ–¹å¼æŸ¥çœ‹ï¼š</p><p><img src="/20221205140000/image-20210725160138290.png" alt="Redisé›†ç¾¤å‘½ä»¤"></p><p>æ¯”å¦‚ï¼Œæ·»åŠ èŠ‚ç‚¹çš„å‘½ä»¤ï¼š</p><p><img src="/20221205140000/image-20210725160448139.png" alt="Redisé›†ç¾¤å‘½ä»¤"></p><h3 id="4-3-1-éœ€æ±‚åˆ†æ"><a href="#4-3-1-éœ€æ±‚åˆ†æ" class="headerlink" title="4.3.1.éœ€æ±‚åˆ†æ"></a>4.3.1.éœ€æ±‚åˆ†æ</h3><p>éœ€æ±‚ï¼šå‘é›†ç¾¤ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„masterèŠ‚ç‚¹ï¼Œå¹¶å‘å…¶ä¸­å­˜å‚¨ num &#x3D; 10</p><ul><li>å¯åŠ¨ä¸€ä¸ªæ–°çš„rediså®ä¾‹ï¼Œç«¯å£ä¸º7004</li><li>æ·»åŠ 7004åˆ°ä¹‹å‰çš„é›†ç¾¤ï¼Œå¹¶ä½œä¸ºä¸€ä¸ªmasterèŠ‚ç‚¹</li><li>ç»™7004èŠ‚ç‚¹åˆ†é…æ’æ§½ï¼Œä½¿å¾—numè¿™ä¸ªkeyå¯ä»¥å­˜å‚¨åˆ°7004å®ä¾‹</li></ul><p>è¿™é‡Œéœ€è¦ä¸¤ä¸ªæ–°çš„åŠŸèƒ½ï¼š</p><ul><li>æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹åˆ°é›†ç¾¤ä¸­</li><li>å°†éƒ¨åˆ†æ’æ§½åˆ†é…åˆ°æ–°æ’æ§½</li></ul><h3 id="4-3-2-åˆ›å»ºæ–°çš„rediså®ä¾‹"><a href="#4-3-2-åˆ›å»ºæ–°çš„rediså®ä¾‹" class="headerlink" title="4.3.2.åˆ›å»ºæ–°çš„rediså®ä¾‹"></a>4.3.2.åˆ›å»ºæ–°çš„rediså®ä¾‹</h3><p>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">mkdir</span> 7004<br></code></pre></td></tr></table></figure><p>æ‹·è´é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cp</span> redis.conf /7004<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">sed /s/6379/7004/g 7004/redis.conf<br></code></pre></td></tr></table></figure><p>å¯åŠ¨</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">redis-server 7004/redis.conf<br></code></pre></td></tr></table></figure><h3 id="4-3-3-æ·»åŠ æ–°èŠ‚ç‚¹åˆ°redis"><a href="#4-3-3-æ·»åŠ æ–°èŠ‚ç‚¹åˆ°redis" class="headerlink" title="4.3.3.æ·»åŠ æ–°èŠ‚ç‚¹åˆ°redis"></a>4.3.3.æ·»åŠ æ–°èŠ‚ç‚¹åˆ°redis</h3><p>æ·»åŠ èŠ‚ç‚¹çš„è¯­æ³•å¦‚ä¸‹ï¼š</p><p><img src="/20221205140000/image-20210725160448139.png" alt="æ·»åŠ æ–°èŠ‚ç‚¹åˆ°redis"></p><p>æ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">redis-cli --cluster add-node  192.168.150.101:7004 192.168.150.101:7001<br></code></pre></td></tr></table></figure><p>é€šè¿‡å‘½ä»¤æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">redis-cli -p 7001 cluster nodes<br></code></pre></td></tr></table></figure><p>å¦‚å›¾ï¼Œ7004åŠ å…¥äº†é›†ç¾¤ï¼Œå¹¶ä¸”é»˜è®¤æ˜¯ä¸€ä¸ªmasterèŠ‚ç‚¹ï¼š</p><p><img src="/20221205140000/image-20210725161007099.png"></p><p>ä½†æ˜¯ï¼Œå¯ä»¥çœ‹åˆ°7004èŠ‚ç‚¹çš„æ’æ§½æ•°é‡ä¸º0ï¼Œå› æ­¤æ²¡æœ‰ä»»ä½•æ•°æ®å¯ä»¥å­˜å‚¨åˆ°7004ä¸Š</p><h3 id="4-3-4-è½¬ç§»æ’æ§½"><a href="#4-3-4-è½¬ç§»æ’æ§½" class="headerlink" title="4.3.4.è½¬ç§»æ’æ§½"></a>4.3.4.è½¬ç§»æ’æ§½</h3><p>æˆ‘ä»¬è¦å°†numå­˜å‚¨åˆ°7004èŠ‚ç‚¹ï¼Œå› æ­¤éœ€è¦å…ˆçœ‹çœ‹numçš„æ’æ§½æ˜¯å¤šå°‘ï¼š</p><p><img src="/20221205140000/image-20210725161241793.png"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œnumçš„æ’æ§½ä¸º2765.</p><p>æˆ‘ä»¬å¯ä»¥å°†0~3000çš„æ’æ§½ä»7001è½¬ç§»åˆ°7004ï¼Œå‘½ä»¤æ ¼å¼å¦‚ä¸‹ï¼š</p><p><img src="/20221205140000/image-20210725161401925.png"></p><p>å…·ä½“å‘½ä»¤å¦‚ä¸‹ï¼š</p><p>å»ºç«‹è¿æ¥ï¼š</p><p><img src="/20221205140000/image-20210725161506241.png"></p><p>å¾—åˆ°ä¸‹é¢çš„åé¦ˆï¼š</p><p><img src="/20221205140000/image-20210725161540841.png"></p><p>è¯¢é—®è¦ç§»åŠ¨å¤šå°‘ä¸ªæ’æ§½ï¼Œæˆ‘ä»¬è®¡åˆ’æ˜¯3000ä¸ªï¼š</p><p>æ–°çš„é—®é¢˜æ¥äº†ï¼š</p><p><img src="/20221205140000/image-20210725161637152.png"></p><p>é‚£ä¸ªnodeæ¥æ¥æ”¶è¿™äº›æ’æ§½ï¼Ÿï¼Ÿ</p><p>æ˜¾ç„¶æ˜¯7004ï¼Œé‚£ä¹ˆ7004èŠ‚ç‚¹çš„idæ˜¯å¤šå°‘å‘¢ï¼Ÿ</p><p><img src="/20221205140000/image-20210725161731738.png"></p><p>å¤åˆ¶è¿™ä¸ªidï¼Œç„¶åæ‹·è´åˆ°åˆšæ‰çš„æ§åˆ¶å°åï¼š</p><p><img src="/20221205140000/image-20210725161817642.png"></p><p>è¿™é‡Œè¯¢é—®ï¼Œä½ çš„æ’æ§½æ˜¯ä»å“ªé‡Œç§»åŠ¨è¿‡æ¥çš„ï¼Ÿ</p><ul><li>allï¼šä»£è¡¨å…¨éƒ¨ï¼Œä¹Ÿå°±æ˜¯ä¸‰ä¸ªèŠ‚ç‚¹å„è½¬ç§»ä¸€éƒ¨åˆ†</li><li>å…·ä½“çš„idï¼šç›®æ ‡èŠ‚ç‚¹çš„id</li><li>doneï¼šæ²¡æœ‰äº†</li></ul><p>è¿™é‡Œæˆ‘ä»¬è¦ä»7001è·å–ï¼Œå› æ­¤å¡«å†™7001çš„idï¼š</p><p><img src="/20221205140000/image-20210725162030478.png"></p><p>å¡«å®Œåï¼Œç‚¹å‡»doneï¼Œè¿™æ ·æ’æ§½è½¬ç§»å°±å‡†å¤‡å¥½äº†ï¼š</p><p><img src="/20221205140000/image-20210725162101228.png"></p><p>ç¡®è®¤è¦è½¬ç§»å—ï¼Ÿè¾“å…¥yesï¼š</p><p>ç„¶åï¼Œé€šè¿‡å‘½ä»¤æŸ¥çœ‹ç»“æœï¼š</p><p><img src="/20221205140000/image-20210725162145497.png"> </p><p>å¯ä»¥çœ‹åˆ°ï¼š </p><p><img src="/20221205140000/image-20210725162224058.png"></p><p>ç›®çš„è¾¾æˆã€‚</p><h2 id="4-4-æ•…éšœè½¬ç§»"><a href="#4-4-æ•…éšœè½¬ç§»" class="headerlink" title="4.4.æ•…éšœè½¬ç§»"></a>4.4.æ•…éšœè½¬ç§»</h2><p>é›†ç¾¤åˆè¯†çŠ¶æ€æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="/20221205140000/image-20210727161152065.png"></p><p>å…¶ä¸­7001ã€7002ã€7003éƒ½æ˜¯masterï¼Œæˆ‘ä»¬è®¡åˆ’è®©7002å®•æœºã€‚</p><h3 id="4-4-1-è‡ªåŠ¨æ•…éšœè½¬ç§»"><a href="#4-4-1-è‡ªåŠ¨æ•…éšœè½¬ç§»" class="headerlink" title="4.4.1.è‡ªåŠ¨æ•…éšœè½¬ç§»"></a>4.4.1.è‡ªåŠ¨æ•…éšœè½¬ç§»</h3><p>å½“é›†ç¾¤ä¸­æœ‰ä¸€ä¸ªmasterå®•æœºä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ç›´æ¥åœæ­¢ä¸€ä¸ªrediså®ä¾‹ï¼Œä¾‹å¦‚7002ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">redis-cli -p 7002 shutdown<br></code></pre></td></tr></table></figure><p>1ï¼‰é¦–å…ˆæ˜¯è¯¥å®ä¾‹ä¸å…¶å®ƒå®ä¾‹å¤±å»è¿æ¥</p><p>2ï¼‰ç„¶åæ˜¯ç–‘ä¼¼å®•æœºï¼š</p><p><img src="/20221205140000/image-20210725162319490.png"></p><p>3ï¼‰æœ€åæ˜¯ç¡®å®šä¸‹çº¿ï¼Œè‡ªåŠ¨æå‡ä¸€ä¸ªslaveä¸ºæ–°çš„masterï¼š</p><p><img src="/20221205140000/image-20210725162408979.png"></p><p>4ï¼‰å½“7002å†æ¬¡å¯åŠ¨ï¼Œå°±ä¼šå˜ä¸ºä¸€ä¸ªslaveèŠ‚ç‚¹äº†ï¼š</p><p><img src="/20221205140000/image-20210727160803386.png"></p><h3 id="4-4-2-æ‰‹åŠ¨æ•…éšœè½¬ç§»"><a href="#4-4-2-æ‰‹åŠ¨æ•…éšœè½¬ç§»" class="headerlink" title="4.4.2.æ‰‹åŠ¨æ•…éšœè½¬ç§»"></a>4.4.2.æ‰‹åŠ¨æ•…éšœè½¬ç§»</h3><p>åˆ©ç”¨cluster failoverå‘½ä»¤å¯ä»¥æ‰‹åŠ¨è®©é›†ç¾¤ä¸­çš„æŸä¸ªmasterå®•æœºï¼Œåˆ‡æ¢åˆ°æ‰§è¡Œcluster failoverå‘½ä»¤çš„è¿™ä¸ªslaveèŠ‚ç‚¹ï¼Œå®ç°æ— æ„ŸçŸ¥çš„æ•°æ®è¿ç§»ã€‚å…¶æµç¨‹å¦‚ä¸‹ï¼š</p><p><img src="/20221205140000/image-20210725162441407.png" alt="æ•°æ®è¿ç§»"></p><p>è¿™ç§failoverå‘½ä»¤å¯ä»¥æŒ‡å®šä¸‰ç§æ¨¡å¼ï¼š</p><ul><li>ç¼ºçœï¼šé»˜è®¤çš„æµç¨‹ï¼Œå¦‚å›¾1~6æ­©</li><li>forceï¼šçœç•¥äº†å¯¹offsetçš„ä¸€è‡´æ€§æ ¡éªŒ</li><li>takeoverï¼šç›´æ¥æ‰§è¡Œç¬¬5æ­©ï¼Œå¿½ç•¥æ•°æ®ä¸€è‡´æ€§ã€å¿½ç•¥masterçŠ¶æ€å’Œå…¶å®ƒmasterçš„æ„è§</li></ul><p><strong>æ¡ˆä¾‹éœ€æ±‚</strong>ï¼šåœ¨7002è¿™ä¸ªslaveèŠ‚ç‚¹æ‰§è¡Œæ‰‹åŠ¨æ•…éšœè½¬ç§»ï¼Œé‡æ–°å¤ºå›masteråœ°ä½</p><p>æ­¥éª¤å¦‚ä¸‹ï¼š</p><p>1ï¼‰åˆ©ç”¨redis-cliè¿æ¥7002è¿™ä¸ªèŠ‚ç‚¹</p><p>2ï¼‰æ‰§è¡Œcluster failoverå‘½ä»¤</p><p>å¦‚å›¾ï¼š</p><p><img src="/20221205140000/image-20210727160037766.png"></p><p>æ•ˆæœï¼š</p><p><img src="/20221205140000/image-20210727161152065.png"></p><h2 id="4-5-RedisTemplateè®¿é—®åˆ†ç‰‡é›†ç¾¤"><a href="#4-5-RedisTemplateè®¿é—®åˆ†ç‰‡é›†ç¾¤" class="headerlink" title="4.5.RedisTemplateè®¿é—®åˆ†ç‰‡é›†ç¾¤"></a>4.5.RedisTemplateè®¿é—®åˆ†ç‰‡é›†ç¾¤</h2><p>RedisTemplateåº•å±‚åŒæ ·åŸºäºlettuceå®ç°äº†åˆ†ç‰‡é›†ç¾¤çš„æ”¯æŒï¼Œè€Œä½¿ç”¨çš„æ­¥éª¤ä¸å“¨å…µæ¨¡å¼åŸºæœ¬ä¸€è‡´ï¼š</p><p>1ï¼‰å¼•å…¥redisçš„starterä¾èµ–</p><p>2ï¼‰é…ç½®åˆ†ç‰‡é›†ç¾¤åœ°å€</p><p>3ï¼‰é…ç½®è¯»å†™åˆ†ç¦»</p><p>ä¸å“¨å…µæ¨¡å¼ç›¸æ¯”ï¼Œå…¶ä¸­åªæœ‰åˆ†ç‰‡é›†ç¾¤çš„é…ç½®æ–¹å¼ç•¥æœ‰å·®å¼‚ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">cluster:</span><br>      <span class="hljs-attr">nodes:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.150</span><span class="hljs-number">.101</span><span class="hljs-string">:7001</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.150</span><span class="hljs-number">.101</span><span class="hljs-string">:7002</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.150</span><span class="hljs-number">.101</span><span class="hljs-string">:7003</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.150</span><span class="hljs-number">.101</span><span class="hljs-string">:8001</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.150</span><span class="hljs-number">.101</span><span class="hljs-string">:8002</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-number">192.168</span><span class="hljs-number">.150</span><span class="hljs-number">.101</span><span class="hljs-string">:8003</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Redisé«˜çº§ç¯‡ - é›†ç¾¤æ­å»º</title>
    <link href="/20221205130000/"/>
    <url>/20221205130000/</url>
    
    <content type="html"><![CDATA[<h1 id="Redisé›†ç¾¤æ­å»º"><a href="#Redisé›†ç¾¤æ­å»º" class="headerlink" title="Redisé›†ç¾¤æ­å»º"></a>Redisé›†ç¾¤æ­å»º</h1><p>æœ¬ç« æ˜¯åŸºäºCentOS7ä¸‹çš„Redisé›†ç¾¤æ­å»ºæ•™ç¨‹ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>å•æœºå®‰è£…Redis</li><li>Redisä¸»ä»</li><li>æ­å»ºå“¨å…µé›†ç¾¤</li><li>Redisåˆ†ç‰‡é›†ç¾¤</li></ul><h1 id="1-å•æœºå®‰è£…Redis"><a href="#1-å•æœºå®‰è£…Redis" class="headerlink" title="1.å•æœºå®‰è£…Redis"></a>1.å•æœºå®‰è£…Redis</h1><p>é¦–å…ˆéœ€è¦å®‰è£…Redisæ‰€éœ€è¦çš„ä¾èµ–ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install -y gcc tcl<br></code></pre></td></tr></table></figure><p>å°†Rediså®‰è£…åŒ…ä¸Šä¼ åˆ°è™šæ‹Ÿæœºçš„ä»»æ„ç›®å½•ï¼š</p><p><img src="/20221205130000/image-20210629114325516.png"></p><p>ä¾‹å¦‚ï¼Œæˆ‘æ”¾åˆ°äº†&#x2F;tmpç›®å½•ï¼š</p><p><img src="/20221205130000/image-20210629114830642.png"></p><p>è§£å‹ç¼©ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">tar -xzf redis-6.2.4.tar.gz<br></code></pre></td></tr></table></figure><p>è§£å‹åï¼š</p><p><img src="/20221205130000/image-20210629114941810.png"></p><p>è¿›å…¥redisç›®å½•ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">cd</span> redis-6.2.4<br></code></pre></td></tr></table></figure><p>è¿è¡Œç¼–è¯‘å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">make &amp;&amp; make install<br></code></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰å‡ºé”™ï¼Œåº”è¯¥å°±å®‰è£…æˆåŠŸäº†ã€‚</p><p>ç„¶åä¿®æ”¹redis.confæ–‡ä»¶ä¸­çš„ä¸€äº›é…ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># ç»‘å®šåœ°å€ï¼Œé»˜è®¤æ˜¯127.0.0.1ï¼Œä¼šå¯¼è‡´åªèƒ½åœ¨æœ¬åœ°è®¿é—®ã€‚ä¿®æ”¹ä¸º0.0.0.0åˆ™å¯ä»¥åœ¨ä»»æ„IPè®¿é—®</span><br><span class="hljs-attr">bind</span> <span class="hljs-string">0.0.0.0</span><br><span class="hljs-comment"># ä¿æŠ¤æ¨¡å¼ï¼Œå…³é—­ä¿æŠ¤æ¨¡å¼</span><br><span class="hljs-attr">protected-mode</span> <span class="hljs-string">no</span><br><span class="hljs-comment"># æ•°æ®åº“æ•°é‡ï¼Œè®¾ç½®ä¸º1</span><br><span class="hljs-attr">databases</span> <span class="hljs-string">1</span><br></code></pre></td></tr></table></figure><p>å¯åŠ¨Redisï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">redis-server redis.conf<br></code></pre></td></tr></table></figure><p>åœæ­¢redisæœåŠ¡ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">redis-cli shutdown<br></code></pre></td></tr></table></figure><h1 id="2-Redisä¸»ä»é›†ç¾¤"><a href="#2-Redisä¸»ä»é›†ç¾¤" class="headerlink" title="2.Redisä¸»ä»é›†ç¾¤"></a>2.Redisä¸»ä»é›†ç¾¤</h1><h2 id="2-1-é›†ç¾¤ç»“æ„"><a href="#2-1-é›†ç¾¤ç»“æ„" class="headerlink" title="2.1.é›†ç¾¤ç»“æ„"></a>2.1.é›†ç¾¤ç»“æ„</h2><p>æˆ‘ä»¬æ­å»ºçš„ä¸»ä»é›†ç¾¤ç»“æ„å¦‚å›¾ï¼š</p><p><img src="/20221205130000/image-20210630111505799.png" alt="ä¸»ä»é›†ç¾¤ç»“æ„"></p><p>å…±åŒ…å«ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œä¸¤ä¸ªä»èŠ‚ç‚¹ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä¼šåœ¨åŒä¸€å°è™šæ‹Ÿæœºä¸­å¼€å¯3ä¸ªrediså®ä¾‹ï¼Œæ¨¡æ‹Ÿä¸»ä»é›†ç¾¤ï¼Œä¿¡æ¯å¦‚ä¸‹ï¼š</p><table><thead><tr><th align="center">IP</th><th align="center">PORT</th><th align="center">è§’è‰²</th></tr></thead><tbody><tr><td align="center">192.168.150.101</td><td align="center">7001</td><td align="center">master</td></tr><tr><td align="center">192.168.150.101</td><td align="center">7002</td><td align="center">slave</td></tr><tr><td align="center">192.168.150.101</td><td align="center">7003</td><td align="center">slave</td></tr></tbody></table><h2 id="2-2-å‡†å¤‡å®ä¾‹å’Œé…ç½®"><a href="#2-2-å‡†å¤‡å®ä¾‹å’Œé…ç½®" class="headerlink" title="2.2.å‡†å¤‡å®ä¾‹å’Œé…ç½®"></a>2.2.å‡†å¤‡å®ä¾‹å’Œé…ç½®</h2><p>è¦åœ¨åŒä¸€å°è™šæ‹Ÿæœºå¼€å¯3ä¸ªå®ä¾‹ï¼Œå¿…é¡»å‡†å¤‡ä¸‰ä»½ä¸åŒçš„é…ç½®æ–‡ä»¶å’Œç›®å½•ï¼Œé…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•ä¹Ÿå°±æ˜¯å·¥ä½œç›®å½•ã€‚</p><p>1ï¼‰åˆ›å»ºç›®å½•</p><p>æˆ‘ä»¬åˆ›å»ºä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼Œåå­—åˆ†åˆ«å«7001ã€7002ã€7003ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># è¿›å…¥/tmpç›®å½•</span><br><span class="hljs-built_in">cd</span> /tmp<br><span class="hljs-comment"># åˆ›å»ºç›®å½•</span><br><span class="hljs-built_in">mkdir</span> 7001 7002 7003<br></code></pre></td></tr></table></figure><p>å¦‚å›¾ï¼š</p><p><img src="/20221205130000/image-20210630113929868.png"></p><p>2ï¼‰æ¢å¤åŸå§‹é…ç½®</p><p>ä¿®æ”¹redis-6.2.4&#x2F;redis.confæ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„æŒä¹…åŒ–æ¨¡å¼æ”¹ä¸ºé»˜è®¤çš„RDBæ¨¡å¼ï¼ŒAOFä¿æŒå…³é—­çŠ¶æ€ã€‚</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># å¼€å¯RDB</span><br><span class="hljs-comment"># save &quot;&quot;</span><br><span class="hljs-attr">save</span> <span class="hljs-string">3600 1</span><br><span class="hljs-attr">save</span> <span class="hljs-string">300 100</span><br><span class="hljs-attr">save</span> <span class="hljs-string">60 10000</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># å…³é—­AOF</span><br><span class="hljs-attr">appendonly</span> <span class="hljs-string">no</span><br></code></pre></td></tr></table></figure><p>3ï¼‰æ‹·è´é…ç½®æ–‡ä»¶åˆ°æ¯ä¸ªå®ä¾‹ç›®å½•</p><p>ç„¶åå°†redis-6.2.4&#x2F;redis.confæ–‡ä»¶æ‹·è´åˆ°ä¸‰ä¸ªç›®å½•ä¸­ï¼ˆåœ¨&#x2F;tmpç›®å½•æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼‰ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># æ–¹å¼ä¸€ï¼šé€ä¸ªæ‹·è´</span><br><span class="hljs-built_in">cp</span> redis-6.2.4/redis.conf 7001<br><span class="hljs-built_in">cp</span> redis-6.2.4/redis.conf 7002<br><span class="hljs-built_in">cp</span> redis-6.2.4/redis.conf 7003<br><br><span class="hljs-comment"># æ–¹å¼äºŒï¼šç®¡é“ç»„åˆå‘½ä»¤ï¼Œä¸€é”®æ‹·è´</span><br><span class="hljs-built_in">echo</span> 7001 7002 7003 | xargs -t -n 1 <span class="hljs-built_in">cp</span> redis-6.2.4/redis.conf<br></code></pre></td></tr></table></figure><p>4ï¼‰ä¿®æ”¹æ¯ä¸ªå®ä¾‹çš„ç«¯å£ã€å·¥ä½œç›®å½•</p><p>ä¿®æ”¹æ¯ä¸ªæ–‡ä»¶å¤¹å†…çš„é…ç½®æ–‡ä»¶ï¼Œå°†ç«¯å£åˆ†åˆ«ä¿®æ”¹ä¸º7001ã€7002ã€7003ï¼Œå°†rdbæ–‡ä»¶ä¿å­˜ä½ç½®éƒ½ä¿®æ”¹ä¸ºè‡ªå·±æ‰€åœ¨ç›®å½•ï¼ˆåœ¨&#x2F;tmpç›®å½•æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼‰ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh">sed -i -e <span class="hljs-string">&#x27;s/6379/7001/g&#x27;</span> -e <span class="hljs-string">&#x27;s/dir .\//dir \/tmp\/7001\//g&#x27;</span> 7001/redis.conf<br>sed -i -e <span class="hljs-string">&#x27;s/6379/7002/g&#x27;</span> -e <span class="hljs-string">&#x27;s/dir .\//dir \/tmp\/7002\//g&#x27;</span> 7002/redis.conf<br>sed -i -e <span class="hljs-string">&#x27;s/6379/7003/g&#x27;</span> -e <span class="hljs-string">&#x27;s/dir .\//dir \/tmp\/7003\//g&#x27;</span> 7003/redis.conf<br></code></pre></td></tr></table></figure><p>5ï¼‰ä¿®æ”¹æ¯ä¸ªå®ä¾‹çš„å£°æ˜IP</p><p>è™šæ‹Ÿæœºæœ¬èº«æœ‰å¤šä¸ªIPï¼Œä¸ºäº†é¿å…å°†æ¥æ··ä¹±ï¼Œæˆ‘ä»¬éœ€è¦åœ¨redis.confæ–‡ä»¶ä¸­æŒ‡å®šæ¯ä¸€ä¸ªå®ä¾‹çš„ç»‘å®šipä¿¡æ¯ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># rediså®ä¾‹çš„å£°æ˜ IP</span><br><span class="hljs-attr">replica-announce-ip</span> <span class="hljs-string">192.168.150.101</span><br></code></pre></td></tr></table></figure><p>æ¯ä¸ªç›®å½•éƒ½è¦æ”¹ï¼Œæˆ‘ä»¬ä¸€é”®å®Œæˆä¿®æ”¹ï¼ˆåœ¨&#x2F;tmpç›®å½•æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼‰ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># é€ä¸€æ‰§è¡Œ</span><br>sed -i <span class="hljs-string">&#x27;1a replica-announce-ip 192.168.150.101&#x27;</span> 7001/redis.conf<br>sed -i <span class="hljs-string">&#x27;1a replica-announce-ip 192.168.150.101&#x27;</span> 7002/redis.conf<br>sed -i <span class="hljs-string">&#x27;1a replica-announce-ip 192.168.150.101&#x27;</span> 7003/redis.conf<br><br><span class="hljs-comment"># æˆ–è€…ä¸€é”®ä¿®æ”¹</span><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;%s\n&#x27;</span> 7001 7002 7003 | xargs -I&#123;&#125; -t sed -i <span class="hljs-string">&#x27;1a replica-announce-ip 192.168.150.101&#x27;</span> &#123;&#125;/redis.conf<br></code></pre></td></tr></table></figure><h2 id="2-3-å¯åŠ¨"><a href="#2-3-å¯åŠ¨" class="headerlink" title="2.3.å¯åŠ¨"></a>2.3.å¯åŠ¨</h2><p>ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹æ—¥å¿—ï¼Œæˆ‘ä»¬æ‰“å¼€3ä¸ªsshçª—å£ï¼Œåˆ†åˆ«å¯åŠ¨3ä¸ªrediså®ä¾‹ï¼Œå¯åŠ¨å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># ç¬¬1ä¸ª</span><br>redis-server 7001/redis.conf<br><span class="hljs-comment"># ç¬¬2ä¸ª</span><br>redis-server 7002/redis.conf<br><span class="hljs-comment"># ç¬¬3ä¸ª</span><br>redis-server 7003/redis.conf<br></code></pre></td></tr></table></figure><p>å¯åŠ¨åï¼š</p><p><img src="/20221205130000/image-20210630183914491.png"></p><p>å¦‚æœè¦ä¸€é”®åœæ­¢ï¼Œå¯ä»¥è¿è¡Œä¸‹é¢å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;%s\n&#x27;</span> 7001 7002 7003 | xargs -I&#123;&#125; -t redis-cli -p &#123;&#125; shutdown<br></code></pre></td></tr></table></figure><h2 id="2-4-å¼€å¯ä¸»ä»å…³ç³»"><a href="#2-4-å¼€å¯ä¸»ä»å…³ç³»" class="headerlink" title="2.4.å¼€å¯ä¸»ä»å…³ç³»"></a>2.4.å¼€å¯ä¸»ä»å…³ç³»</h2><p>ç°åœ¨ä¸‰ä¸ªå®ä¾‹è¿˜æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œè¦é…ç½®ä¸»ä»å¯ä»¥ä½¿ç”¨replicaof æˆ–è€…slaveofï¼ˆ5.0ä»¥å‰ï¼‰å‘½ä»¤ã€‚</p><p>æœ‰ä¸´æ—¶å’Œæ°¸ä¹…ä¸¤ç§æ¨¡å¼ï¼š</p><ul><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆæ°¸ä¹…ç”Ÿæ•ˆï¼‰</p><ul><li>åœ¨redis.confä¸­æ·»åŠ ä¸€è¡Œé…ç½®ï¼š<code>slaveof &lt;masterip&gt; &lt;masterport&gt;</code></li></ul></li><li><p>ä½¿ç”¨redis-cliå®¢æˆ·ç«¯è¿æ¥åˆ°redisæœåŠ¡ï¼Œæ‰§è¡Œslaveofå‘½ä»¤ï¼ˆé‡å¯åå¤±æ•ˆï¼‰ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">slaveof &lt;masterip&gt; &lt;masterport&gt;<br></code></pre></td></tr></table></figure></li></ul><p><strong><font color="red">æ³¨æ„</font></strong>ï¼šåœ¨5.0ä»¥åæ–°å¢å‘½ä»¤replicaofï¼Œä¸salveofæ•ˆæœä¸€è‡´ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä¸ºäº†æ¼”ç¤ºæ–¹ä¾¿ï¼Œä½¿ç”¨æ–¹å¼äºŒã€‚</p><p>é€šè¿‡redis-cliå‘½ä»¤è¿æ¥7002ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># è¿æ¥ 7002</span><br>redis-cli -p 7002<br><span class="hljs-comment"># æ‰§è¡Œslaveof</span><br>slaveof 192.168.150.101 7001<br></code></pre></td></tr></table></figure><p>é€šè¿‡redis-cliå‘½ä»¤è¿æ¥7003ï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># è¿æ¥ 7003</span><br>redis-cli -p 7003<br><span class="hljs-comment"># æ‰§è¡Œslaveof</span><br>slaveof 192.168.150.101 7001<br></code></pre></td></tr></table></figure><p>ç„¶åè¿æ¥ 7001èŠ‚ç‚¹ï¼ŒæŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># è¿æ¥ 7001</span><br>redis-cli -p 7001<br><span class="hljs-comment"># æŸ¥çœ‹çŠ¶æ€</span><br>info replication<br></code></pre></td></tr></table></figure><p>ç»“æœï¼š</p><p><img src="/20221205130000/image-20210630201258802.png"></p><h2 id="2-5-æµ‹è¯•"><a href="#2-5-æµ‹è¯•" class="headerlink" title="2.5.æµ‹è¯•"></a>2.5.æµ‹è¯•</h2><p>æ‰§è¡Œä¸‹åˆ—æ“ä½œä»¥æµ‹è¯•ï¼š</p><ul><li><p>åˆ©ç”¨redis-cliè¿æ¥7001ï¼Œæ‰§è¡Œ<code>set num 123</code></p></li><li><p>åˆ©ç”¨redis-cliè¿æ¥7002ï¼Œæ‰§è¡Œ<code>get num</code>ï¼Œå†æ‰§è¡Œ<code>set num 666</code></p></li><li><p>åˆ©ç”¨redis-cliè¿æ¥7003ï¼Œæ‰§è¡Œ<code>get num</code>ï¼Œå†æ‰§è¡Œ<code>set num 888</code></p></li></ul><p>å¯ä»¥å‘ç°ï¼Œåªæœ‰åœ¨7001è¿™ä¸ªmasterèŠ‚ç‚¹ä¸Šå¯ä»¥æ‰§è¡Œå†™æ“ä½œï¼Œ7002å’Œ7003è¿™ä¸¤ä¸ªslaveèŠ‚ç‚¹åªèƒ½æ‰§è¡Œè¯»æ“ä½œã€‚</p><h1 id="3-æ­å»ºå“¨å…µé›†ç¾¤"><a href="#3-æ­å»ºå“¨å…µé›†ç¾¤" class="headerlink" title="3.æ­å»ºå“¨å…µé›†ç¾¤"></a>3.æ­å»ºå“¨å…µé›†ç¾¤</h1><h2 id="3-1-é›†ç¾¤ç»“æ„"><a href="#3-1-é›†ç¾¤ç»“æ„" class="headerlink" title="3.1.é›†ç¾¤ç»“æ„"></a>3.1.é›†ç¾¤ç»“æ„</h2><p>è¿™é‡Œæˆ‘ä»¬æ­å»ºä¸€ä¸ªä¸‰èŠ‚ç‚¹å½¢æˆçš„Sentinelé›†ç¾¤ï¼Œæ¥ç›‘ç®¡ä¹‹å‰çš„Redisä¸»ä»é›†ç¾¤ã€‚å¦‚å›¾ï¼š</p><p><img src="/20221205130000/image-20210701215227018.png" alt="å“¨å…µé›†ç¾¤"></p><p>ä¸‰ä¸ªsentinelå®ä¾‹ä¿¡æ¯å¦‚ä¸‹ï¼š</p><table><thead><tr><th>èŠ‚ç‚¹</th><th align="center">IP</th><th align="center">PORT</th></tr></thead><tbody><tr><td>s1</td><td align="center">192.168.150.101</td><td align="center">27001</td></tr><tr><td>s2</td><td align="center">192.168.150.101</td><td align="center">27002</td></tr><tr><td>s3</td><td align="center">192.168.150.101</td><td align="center">27003</td></tr></tbody></table><h2 id="3-2-å‡†å¤‡å®ä¾‹å’Œé…ç½®"><a href="#3-2-å‡†å¤‡å®ä¾‹å’Œé…ç½®" class="headerlink" title="3.2.å‡†å¤‡å®ä¾‹å’Œé…ç½®"></a>3.2.å‡†å¤‡å®ä¾‹å’Œé…ç½®</h2><p>è¦åœ¨åŒä¸€å°è™šæ‹Ÿæœºå¼€å¯3ä¸ªå®ä¾‹ï¼Œå¿…é¡»å‡†å¤‡ä¸‰ä»½ä¸åŒçš„é…ç½®æ–‡ä»¶å’Œç›®å½•ï¼Œé…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½•ä¹Ÿå°±æ˜¯å·¥ä½œç›®å½•ã€‚</p><p>æˆ‘ä»¬åˆ›å»ºä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼Œåå­—åˆ†åˆ«å«s1ã€s2ã€s3ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># è¿›å…¥/tmpç›®å½•</span><br><span class="hljs-built_in">cd</span> /tmp<br><span class="hljs-comment"># åˆ›å»ºç›®å½•</span><br><span class="hljs-built_in">mkdir</span> s1 s2 s3<br></code></pre></td></tr></table></figure><p>å¦‚å›¾ï¼š</p><p><img src="/20221205130000/image-20210701215534714.png"></p><p>ç„¶åæˆ‘ä»¬åœ¨s1ç›®å½•åˆ›å»ºä¸€ä¸ªsentinel.confæ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢çš„å†…å®¹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ini">port 27001<br>sentinel announce-ip 192.168.150.101<br>sentinel monitor mymaster 192.168.150.101 7001 2<br>sentinel down-after-milliseconds mymaster 5000<br>sentinel failover-timeout mymaster 60000<br>dir &quot;/tmp/s1&quot;<br></code></pre></td></tr></table></figure><p>è§£è¯»ï¼š</p><ul><li><code>port 27001</code>ï¼šæ˜¯å½“å‰sentinelå®ä¾‹çš„ç«¯å£</li><li><code>sentinel monitor mymaster 192.168.150.101 7001 2</code>ï¼šæŒ‡å®šä¸»èŠ‚ç‚¹ä¿¡æ¯<ul><li><code>mymaster</code>ï¼šä¸»èŠ‚ç‚¹åç§°ï¼Œè‡ªå®šä¹‰ï¼Œä»»æ„å†™</li><li><code>192.168.150.101 7001</code>ï¼šä¸»èŠ‚ç‚¹çš„ipå’Œç«¯å£</li><li><code>2</code>ï¼šé€‰ä¸¾masteræ—¶çš„quorumå€¼</li></ul></li></ul><p>ç„¶åå°†s1&#x2F;sentinel.confæ–‡ä»¶æ‹·è´åˆ°s2ã€s3ä¸¤ä¸ªç›®å½•ä¸­ï¼ˆåœ¨&#x2F;tmpç›®å½•æ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼‰ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># æ–¹å¼ä¸€ï¼šé€ä¸ªæ‹·è´</span><br><span class="hljs-built_in">cp</span> s1/sentinel.conf s2<br><span class="hljs-built_in">cp</span> s1/sentinel.conf s3<br><span class="hljs-comment"># æ–¹å¼äºŒï¼šç®¡é“ç»„åˆå‘½ä»¤ï¼Œä¸€é”®æ‹·è´</span><br><span class="hljs-built_in">echo</span> s2 s3 | xargs -t -n 1 <span class="hljs-built_in">cp</span> s1/sentinel.conf<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹s2ã€s3ä¸¤ä¸ªæ–‡ä»¶å¤¹å†…çš„é…ç½®æ–‡ä»¶ï¼Œå°†ç«¯å£åˆ†åˆ«ä¿®æ”¹ä¸º27002ã€27003ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh">sed -i -e <span class="hljs-string">&#x27;s/27001/27002/g&#x27;</span> -e <span class="hljs-string">&#x27;s/s1/s2/g&#x27;</span> s2/sentinel.conf<br>sed -i -e <span class="hljs-string">&#x27;s/27001/27003/g&#x27;</span> -e <span class="hljs-string">&#x27;s/s1/s3/g&#x27;</span> s3/sentinel.conf<br></code></pre></td></tr></table></figure><h2 id="3-3-å¯åŠ¨"><a href="#3-3-å¯åŠ¨" class="headerlink" title="3.3.å¯åŠ¨"></a>3.3.å¯åŠ¨</h2><p>ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹æ—¥å¿—ï¼Œæˆ‘ä»¬æ‰“å¼€3ä¸ªsshçª—å£ï¼Œåˆ†åˆ«å¯åŠ¨3ä¸ªrediså®ä¾‹ï¼Œå¯åŠ¨å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># ç¬¬1ä¸ª</span><br>redis-sentinel s1/sentinel.conf<br><span class="hljs-comment"># ç¬¬2ä¸ª</span><br>redis-sentinel s2/sentinel.conf<br><span class="hljs-comment"># ç¬¬3ä¸ª</span><br>redis-sentinel s3/sentinel.conf<br></code></pre></td></tr></table></figure><p>å¯åŠ¨åï¼š</p><p><img src="/20221205130000/image-20210701220714104.png"></p><h2 id="3-4-æµ‹è¯•"><a href="#3-4-æµ‹è¯•" class="headerlink" title="3.4.æµ‹è¯•"></a>3.4.æµ‹è¯•</h2><p>å°è¯•è®©masterèŠ‚ç‚¹7001å®•æœºï¼ŒæŸ¥çœ‹sentinelæ—¥å¿—ï¼š</p><p><img src="/20221205130000/image-20210701222857997.png" alt="sentinelæ—¥å¿—"></p><p>æŸ¥çœ‹7003çš„æ—¥å¿—ï¼š</p><p><img src="/20221205130000/image-20210701223025709.png" alt="7003çš„æ—¥å¿—"></p><p>æŸ¥çœ‹7002çš„æ—¥å¿—ï¼š</p><p><img src="/20221205130000/image-20210701223131264.png" alt="7002çš„æ—¥å¿—"></p><h1 id="4-æ­å»ºåˆ†ç‰‡é›†ç¾¤"><a href="#4-æ­å»ºåˆ†ç‰‡é›†ç¾¤" class="headerlink" title="4.æ­å»ºåˆ†ç‰‡é›†ç¾¤"></a>4.æ­å»ºåˆ†ç‰‡é›†ç¾¤</h1><h2 id="4-1-é›†ç¾¤ç»“æ„"><a href="#4-1-é›†ç¾¤ç»“æ„" class="headerlink" title="4.1.é›†ç¾¤ç»“æ„"></a>4.1.é›†ç¾¤ç»“æ„</h2><p>åˆ†ç‰‡é›†ç¾¤éœ€è¦çš„èŠ‚ç‚¹æ•°é‡è¾ƒå¤šï¼Œè¿™é‡Œæˆ‘ä»¬æ­å»ºä¸€ä¸ªæœ€å°çš„åˆ†ç‰‡é›†ç¾¤ï¼ŒåŒ…å«3ä¸ªmasterèŠ‚ç‚¹ï¼Œæ¯ä¸ªmasteråŒ…å«ä¸€ä¸ªslaveèŠ‚ç‚¹ï¼Œç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/20221205130000/image-20210702164116027.png" alt="åˆ†ç‰‡é›†ç¾¤"></p><p>è¿™é‡Œæˆ‘ä»¬ä¼šåœ¨åŒä¸€å°è™šæ‹Ÿæœºä¸­å¼€å¯6ä¸ªrediså®ä¾‹ï¼Œæ¨¡æ‹Ÿåˆ†ç‰‡é›†ç¾¤ï¼Œä¿¡æ¯å¦‚ä¸‹ï¼š</p><table><thead><tr><th align="center">IP</th><th align="center">PORT</th><th align="center">è§’è‰²</th></tr></thead><tbody><tr><td align="center">192.168.150.101</td><td align="center">7001</td><td align="center">master</td></tr><tr><td align="center">192.168.150.101</td><td align="center">7002</td><td align="center">master</td></tr><tr><td align="center">192.168.150.101</td><td align="center">7003</td><td align="center">master</td></tr><tr><td align="center">192.168.150.101</td><td align="center">8001</td><td align="center">slave</td></tr><tr><td align="center">192.168.150.101</td><td align="center">8002</td><td align="center">slave</td></tr><tr><td align="center">192.168.150.101</td><td align="center">8003</td><td align="center">slave</td></tr></tbody></table><h2 id="4-2-å‡†å¤‡å®ä¾‹å’Œé…ç½®"><a href="#4-2-å‡†å¤‡å®ä¾‹å’Œé…ç½®" class="headerlink" title="4.2.å‡†å¤‡å®ä¾‹å’Œé…ç½®"></a>4.2.å‡†å¤‡å®ä¾‹å’Œé…ç½®</h2><p>åˆ é™¤ä¹‹å‰çš„7001ã€7002ã€7003è¿™å‡ ä¸ªç›®å½•ï¼Œé‡æ–°åˆ›å»ºå‡º7001ã€7002ã€7003ã€8001ã€8002ã€8003ç›®å½•ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># è¿›å…¥/tmpç›®å½•</span><br><span class="hljs-built_in">cd</span> /tmp<br><span class="hljs-comment"># åˆ é™¤æ—§çš„ï¼Œé¿å…é…ç½®å¹²æ‰°</span><br><span class="hljs-built_in">rm</span> -rf 7001 7002 7003<br><span class="hljs-comment"># åˆ›å»ºç›®å½•</span><br><span class="hljs-built_in">mkdir</span> 7001 7002 7003 8001 8002 8003<br></code></pre></td></tr></table></figure><p>åœ¨&#x2F;tmpä¸‹å‡†å¤‡ä¸€ä¸ªæ–°çš„redis.confæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs ini">port 6379<br><span class="hljs-comment"># å¼€å¯é›†ç¾¤åŠŸèƒ½</span><br>cluster-enabled yes<br><span class="hljs-comment"># é›†ç¾¤çš„é…ç½®æ–‡ä»¶åç§°ï¼Œä¸éœ€è¦æˆ‘ä»¬åˆ›å»ºï¼Œç”±redisè‡ªå·±ç»´æŠ¤</span><br>cluster-config-file /tmp/6379/nodes.conf<br><span class="hljs-comment"># èŠ‚ç‚¹å¿ƒè·³å¤±è´¥çš„è¶…æ—¶æ—¶é—´</span><br>cluster-node-timeout 5000<br><span class="hljs-comment"># æŒä¹…åŒ–æ–‡ä»¶å­˜æ”¾ç›®å½•</span><br>dir /tmp/6379<br><span class="hljs-comment"># ç»‘å®šåœ°å€</span><br>bind 0.0.0.0<br><span class="hljs-comment"># è®©redisåå°è¿è¡Œ</span><br>daemonize yes<br><span class="hljs-comment"># æ³¨å†Œçš„å®ä¾‹ip</span><br>replica-announce-ip 192.168.150.101<br><span class="hljs-comment"># ä¿æŠ¤æ¨¡å¼</span><br>protected-mode no<br><span class="hljs-comment"># æ•°æ®åº“æ•°é‡</span><br>databases 1<br><span class="hljs-comment"># æ—¥å¿—</span><br>logfile /tmp/6379/run.log<br></code></pre></td></tr></table></figure><p>å°†è¿™ä¸ªæ–‡ä»¶æ‹·è´åˆ°æ¯ä¸ªç›®å½•ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># è¿›å…¥/tmpç›®å½•</span><br><span class="hljs-built_in">cd</span> /tmp<br><span class="hljs-comment"># æ‰§è¡Œæ‹·è´</span><br><span class="hljs-built_in">echo</span> 7001 7002 7003 8001 8002 8003 | xargs -t -n 1 <span class="hljs-built_in">cp</span> redis.conf<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹æ¯ä¸ªç›®å½•ä¸‹çš„redis.confï¼Œå°†å…¶ä¸­çš„6379ä¿®æ”¹ä¸ºä¸æ‰€åœ¨ç›®å½•ä¸€è‡´ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># è¿›å…¥/tmpç›®å½•</span><br><span class="hljs-built_in">cd</span> /tmp<br><span class="hljs-comment"># ä¿®æ”¹é…ç½®æ–‡ä»¶</span><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;%s\n&#x27;</span> 7001 7002 7003 8001 8002 8003 | xargs -I&#123;&#125; -t sed -i <span class="hljs-string">&#x27;s/6379/&#123;&#125;/g&#x27;</span> &#123;&#125;/redis.conf<br></code></pre></td></tr></table></figure><h2 id="4-3-å¯åŠ¨"><a href="#4-3-å¯åŠ¨" class="headerlink" title="4.3.å¯åŠ¨"></a>4.3.å¯åŠ¨</h2><p>å› ä¸ºå·²ç»é…ç½®äº†åå°å¯åŠ¨æ¨¡å¼ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å¯åŠ¨æœåŠ¡ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># è¿›å…¥/tmpç›®å½•</span><br><span class="hljs-built_in">cd</span> /tmp<br><span class="hljs-comment"># ä¸€é”®å¯åŠ¨æ‰€æœ‰æœåŠ¡</span><br><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;%s\n&#x27;</span> 7001 7002 7003 8001 8002 8003 | xargs -I&#123;&#125; -t redis-server &#123;&#125;/redis.conf<br></code></pre></td></tr></table></figure><p>é€šè¿‡psæŸ¥çœ‹çŠ¶æ€ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ps -ef | grep redis<br></code></pre></td></tr></table></figure><p>å‘ç°æœåŠ¡éƒ½å·²ç»æ­£å¸¸å¯åŠ¨ï¼š</p><p><img src="/20221205130000/image-20210702174255799.png"></p><p>å¦‚æœè¦å…³é—­æ‰€æœ‰è¿›ç¨‹ï¼Œå¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">ps -ef | grep redis | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span> | xargs <span class="hljs-built_in">kill</span><br></code></pre></td></tr></table></figure><p>æˆ–è€…ï¼ˆæ¨èè¿™ç§æ–¹å¼ï¼‰ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-built_in">printf</span> <span class="hljs-string">&#x27;%s\n&#x27;</span> 7001 7002 7003 8001 8002 8003 | xargs -I&#123;&#125; -t redis-cli -p &#123;&#125; shutdown<br></code></pre></td></tr></table></figure><h2 id="4-4-åˆ›å»ºé›†ç¾¤"><a href="#4-4-åˆ›å»ºé›†ç¾¤" class="headerlink" title="4.4.åˆ›å»ºé›†ç¾¤"></a>4.4.åˆ›å»ºé›†ç¾¤</h2><p>è™½ç„¶æœåŠ¡å¯åŠ¨äº†ï¼Œä½†æ˜¯ç›®å‰æ¯ä¸ªæœåŠ¡ä¹‹é—´éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œæ²¡æœ‰ä»»ä½•å…³è”ã€‚</p><p>æˆ‘ä»¬éœ€è¦æ‰§è¡Œå‘½ä»¤æ¥åˆ›å»ºé›†ç¾¤ï¼Œåœ¨Redis5.0ä¹‹å‰åˆ›å»ºé›†ç¾¤æ¯”è¾ƒéº»çƒ¦ï¼Œ5.0ä¹‹åé›†ç¾¤ç®¡ç†å‘½ä»¤éƒ½é›†æˆåˆ°äº†redis-cliä¸­ã€‚</p><p>1ï¼‰Redis5.0ä¹‹å‰</p><p>Redis5.0ä¹‹å‰é›†ç¾¤å‘½ä»¤éƒ½æ˜¯ç”¨rediså®‰è£…åŒ…ä¸‹çš„src&#x2F;redis-trib.rbæ¥å®ç°çš„ã€‚å› ä¸ºredis-trib.rbæ˜¯æœ‰rubyè¯­è¨€ç¼–å†™çš„æ‰€ä»¥éœ€è¦å®‰è£…rubyç¯å¢ƒã€‚</p> <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># å®‰è£…ä¾èµ–</span><br>yum -y install zlib ruby rubygems<br>gem install redis<br></code></pre></td></tr></table></figure><p>ç„¶åé€šè¿‡å‘½ä»¤æ¥ç®¡ç†é›†ç¾¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># è¿›å…¥redisçš„srcç›®å½•</span><br><span class="hljs-built_in">cd</span> /tmp/redis-6.2.4/src<br><span class="hljs-comment"># åˆ›å»ºé›†ç¾¤</span><br>./redis-trib.rb create --replicas 1 192.168.150.101:7001 192.168.150.101:7002 192.168.150.101:7003 192.168.150.101:8001 192.168.150.101:8002 192.168.150.101:8003<br></code></pre></td></tr></table></figure><p>2ï¼‰Redis5.0ä»¥å</p><p>æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯Redis6.2.4ç‰ˆæœ¬ï¼Œé›†ç¾¤ç®¡ç†ä»¥åŠé›†æˆåˆ°äº†redis-cliä¸­ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">redis-cli --cluster create --cluster-replicas 1 192.168.150.101:7001 192.168.150.101:7002 192.168.150.101:7003 192.168.150.101:8001 192.168.150.101:8002 192.168.150.101:8003<br></code></pre></td></tr></table></figure><p>å‘½ä»¤è¯´æ˜ï¼š</p><ul><li><code>redis-cli --cluster</code>æˆ–è€…<code>./redis-trib.rb</code>ï¼šä»£è¡¨é›†ç¾¤æ“ä½œå‘½ä»¤</li><li><code>create</code>ï¼šä»£è¡¨æ˜¯åˆ›å»ºé›†ç¾¤</li><li><code>--replicas 1</code>æˆ–è€…<code>--cluster-replicas 1</code> ï¼šæŒ‡å®šé›†ç¾¤ä¸­æ¯ä¸ªmasterçš„å‰¯æœ¬ä¸ªæ•°ä¸º1ï¼Œæ­¤æ—¶<code>èŠ‚ç‚¹æ€»æ•° Ã· (replicas + 1)</code> å¾—åˆ°çš„å°±æ˜¯masterçš„æ•°é‡ã€‚å› æ­¤èŠ‚ç‚¹åˆ—è¡¨ä¸­çš„å‰nä¸ªå°±æ˜¯masterï¼Œå…¶å®ƒèŠ‚ç‚¹éƒ½æ˜¯slaveèŠ‚ç‚¹ï¼Œéšæœºåˆ†é…åˆ°ä¸åŒmaster</li></ul><p>è¿è¡Œåçš„æ ·å­ï¼š</p><p><img src="/20221205130000/image-20210702181101969.png"></p><p>è¿™é‡Œè¾“å…¥yesï¼Œåˆ™é›†ç¾¤å¼€å§‹åˆ›å»ºï¼š</p><p><img src="/20221205130000/image-20210702181215705.png"></p><p>é€šè¿‡å‘½ä»¤å¯ä»¥æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">redis-cli -p 7001 cluster nodes<br></code></pre></td></tr></table></figure><p><img src="/20221205130000/image-20210702181922809.png"></p><h2 id="4-5-æµ‹è¯•"><a href="#4-5-æµ‹è¯•" class="headerlink" title="4.5.æµ‹è¯•"></a>4.5.æµ‹è¯•</h2><p>å°è¯•è¿æ¥7001èŠ‚ç‚¹ï¼Œå­˜å‚¨ä¸€ä¸ªæ•°æ®ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># è¿æ¥</span><br>redis-cli -p 7001<br><span class="hljs-comment"># å­˜å‚¨æ•°æ®</span><br><span class="hljs-built_in">set</span> num 123<br><span class="hljs-comment"># è¯»å–æ•°æ®</span><br>get num<br><span class="hljs-comment"># å†æ¬¡å­˜å‚¨</span><br><span class="hljs-built_in">set</span> a 1<br></code></pre></td></tr></table></figure><p>ç»“æœæ‚²å‰§äº†ï¼š</p><p><img src="/20221205130000/image-20210702182343979.png"></p><p>é›†ç¾¤æ“ä½œæ—¶ï¼Œéœ€è¦ç»™<code>redis-cli</code>åŠ ä¸Š<code>-c</code>å‚æ•°æ‰å¯ä»¥ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">redis-cli -c -p 7001<br></code></pre></td></tr></table></figure><p>è¿™æ¬¡å¯ä»¥äº†ï¼š</p><p><img src="/20221205130000/image-20210702182602145.png"></p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Rediså®æˆ˜ç¯‡ - é»‘é©¬ç‚¹è¯„é¡¹ç›®</title>
    <link href="/20221205120000/"/>
    <url>/20221205120000/</url>
    
    <content type="html"><![CDATA[<h1 id="Rediså®æˆ˜ç¯‡ï¼ˆé»‘é©¬ç‚¹è¯„é¡¹ç›®ï¼‰"><a href="#Rediså®æˆ˜ç¯‡ï¼ˆé»‘é©¬ç‚¹è¯„é¡¹ç›®ï¼‰" class="headerlink" title="Rediså®æˆ˜ç¯‡ï¼ˆé»‘é©¬ç‚¹è¯„é¡¹ç›®ï¼‰"></a>Rediså®æˆ˜ç¯‡ï¼ˆé»‘é©¬ç‚¹è¯„é¡¹ç›®ï¼‰</h1><h2 id="å¼€ç¯‡å¯¼è¯»"><a href="#å¼€ç¯‡å¯¼è¯»" class="headerlink" title="å¼€ç¯‡å¯¼è¯»"></a>å¼€ç¯‡å¯¼è¯»</h2><p>äº²çˆ±çš„å°ä¼™ä¼´ä»¬å¤§å®¶å¥½ï¼Œé©¬ä¸Šå’±ä»¬å°±å¼€å§‹å®æˆ˜ç¯‡çš„å†…å®¹äº†ï¼Œç›¸ä¿¡é€šè¿‡æœ¬ç« çš„å­¦ä¹ ï¼Œå°ä¼™ä¼´ä»¬å°±èƒ½ç†è§£å„ç§redisçš„ä½¿ç”¨å•¦ï¼Œæ¥ä¸‹æ¥å’±ä»¬æ¥ä¸€èµ·çœ‹çœ‹å®æˆ˜ç¯‡æˆ‘ä»¬è¦å­¦ä¹ ä¸€äº›ä»€ä¹ˆæ ·çš„å†…å®¹</p><ul><li>çŸ­ä¿¡ç™»å½•</li></ul><p>è¿™ä¸€å—æˆ‘ä»¬ä¼šä½¿ç”¨rediså…±äº«sessionæ¥å®ç°</p><ul><li>å•†æˆ·æŸ¥è¯¢ç¼“å­˜</li></ul><p>é€šè¿‡æœ¬ç« èŠ‚ï¼Œæˆ‘ä»¬ä¼šç†è§£ç¼“å­˜å‡»ç©¿ï¼Œç¼“å­˜ç©¿é€ï¼Œç¼“å­˜é›ªå´©ç­‰é—®é¢˜ï¼Œè®©å°ä¼™ä¼´çš„å¯¹äºè¿™äº›æ¦‚å¿µçš„ç†è§£ä¸ä»…ä»…æ˜¯åœç•™åœ¨æ¦‚å¿µä¸Šï¼Œæ›´æ˜¯èƒ½åœ¨ä»£ç ä¸­çœ‹åˆ°å¯¹åº”çš„å†…å®¹</p><p><a href="https://www.bilibili.com/video/BV1cr4y1671t/?p=47&spm_id_from=pageDriver&vd_source=a07c282e889f7133403a50b521d35bc7">æŸ¥çœ‹é˜¶æ®µæ€»ç»“</a></p><ul><li>ä¼˜æƒ åˆ¸ç§’æ€</li></ul><p>é€šè¿‡æœ¬ç« èŠ‚ï¼Œæˆ‘ä»¬å¯ä»¥å­¦ä¼šRedisçš„è®¡æ•°å™¨åŠŸèƒ½ï¼Œ ç»“åˆLuaå®Œæˆé«˜æ€§èƒ½çš„redisæ“ä½œï¼ŒåŒæ—¶å­¦ä¼šRedisåˆ†å¸ƒå¼é”çš„åŸç†ï¼ŒåŒ…æ‹¬Redisçš„ä¸‰ç§æ¶ˆæ¯é˜Ÿåˆ—</p><ul><li>é™„è¿‘çš„å•†æˆ·</li></ul><p>æˆ‘ä»¬åˆ©ç”¨Redisçš„GEOHashæ¥å®Œæˆå¯¹äºåœ°ç†åæ ‡çš„æ“ä½œ</p><ul><li>UVç»Ÿè®¡</li></ul><p>ä¸»è¦æ˜¯ä½¿ç”¨Redisæ¥å®Œæˆç»Ÿè®¡åŠŸèƒ½</p><ul><li>ç”¨æˆ·ç­¾åˆ°</li></ul><p>ä½¿ç”¨Redisçš„BitMapæ•°æ®ç»Ÿè®¡åŠŸèƒ½</p><ul><li>å¥½å‹å…³æ³¨</li></ul><p>åŸºäºSeté›†åˆçš„å…³æ³¨ã€å–æ¶ˆå…³æ³¨ï¼Œå…±åŒå…³æ³¨ç­‰ç­‰åŠŸèƒ½ï¼Œè¿™ä¸€å—çŸ¥è¯†å’±ä»¬ä¹‹å‰å°±è®²è¿‡ï¼Œè¿™æ¬¡æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­æ¥ä½¿ç”¨ä¸€ä¸‹</p><ul><li>æ‰“äººæ¢åº—</li></ul><p>åŸºäºListæ¥å®Œæˆç‚¹èµåˆ—è¡¨çš„æ“ä½œï¼ŒåŒæ—¶åŸºäºSortedSetæ¥å®Œæˆç‚¹èµçš„æ’è¡Œæ¦œåŠŸèƒ½</p><p>ä»¥ä¸Šè¿™äº›å†…å®¹å’±ä»¬ç»Ÿç»Ÿéƒ½ä¼šç»™å°ä¼™ä¼´ä»¬è®²è§£æ¸…æ¥šï¼Œè®©å¤§å®¶å……åˆ†ç†è§£å¦‚ä½•ä½¿ç”¨Redis</p><p><img src="/20221205120000/1653056228879.png" alt="ç³»ç»ŸåŠŸèƒ½ä»‹ç»"></p><h2 id="1ã€çŸ­ä¿¡ç™»å½•"><a href="#1ã€çŸ­ä¿¡ç™»å½•" class="headerlink" title="1ã€çŸ­ä¿¡ç™»å½•"></a>1ã€çŸ­ä¿¡ç™»å½•</h2><h3 id="1-1ã€å¯¼å…¥é»‘é©¬ç‚¹è¯„é¡¹ç›®"><a href="#1-1ã€å¯¼å…¥é»‘é©¬ç‚¹è¯„é¡¹ç›®" class="headerlink" title="1.1ã€å¯¼å…¥é»‘é©¬ç‚¹è¯„é¡¹ç›®"></a>1.1ã€å¯¼å…¥é»‘é©¬ç‚¹è¯„é¡¹ç›®</h3><h4 id="1-1-1-ã€å¯¼å…¥SQL"><a href="#1-1-1-ã€å¯¼å…¥SQL" class="headerlink" title="1.1.1 ã€å¯¼å…¥SQL"></a>1.1.1 ã€å¯¼å…¥SQL</h4><p><img src="/20221205120000/1653057872536.png" alt="ç›¸å…³è¡¨"></p><h4 id="1-1-2ã€æœ‰å…³å½“å‰æ¨¡å‹"><a href="#1-1-2ã€æœ‰å…³å½“å‰æ¨¡å‹" class="headerlink" title="1.1.2ã€æœ‰å…³å½“å‰æ¨¡å‹"></a>1.1.2ã€æœ‰å…³å½“å‰æ¨¡å‹</h4><p>æ‰‹æœºæˆ–è€…appç«¯å‘èµ·è¯·æ±‚ï¼Œè¯·æ±‚æˆ‘ä»¬çš„nginxæœåŠ¡å™¨ï¼ŒnginxåŸºäºä¸ƒå±‚æ¨¡å‹èµ°çš„äº‹HTTPåè®®ï¼Œå¯ä»¥å®ç°åŸºäºLuaç›´æ¥ç»•å¼€tomcatè®¿é—®redisï¼Œä¹Ÿå¯ä»¥ä½œä¸ºé™æ€èµ„æºæœåŠ¡å™¨ï¼Œè½»æ¾æ‰›ä¸‹ä¸Šä¸‡å¹¶å‘ï¼Œ è´Ÿè½½å‡è¡¡åˆ°ä¸‹æ¸¸tomcatæœåŠ¡å™¨ï¼Œæ‰“æ•£æµé‡ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ä¸€å°4æ ¸8Gçš„tomcatï¼Œåœ¨ä¼˜åŒ–å’Œå¤„ç†ç®€å•ä¸šåŠ¡çš„åŠ æŒä¸‹ï¼Œå¤§ä¸äº†å°±å¤„ç†1000å·¦å³çš„å¹¶å‘ï¼Œ ç»è¿‡nginxçš„è´Ÿè½½å‡è¡¡åˆ†æµåï¼Œåˆ©ç”¨é›†ç¾¤æ”¯æ’‘èµ·æ•´ä¸ªé¡¹ç›®ï¼ŒåŒæ—¶nginxåœ¨éƒ¨ç½²äº†å‰ç«¯é¡¹ç›®åï¼Œæ›´æ˜¯å¯ä»¥åšåˆ°åŠ¨é™åˆ†ç¦»ï¼Œè¿›ä¸€æ­¥é™ä½tomcatæœåŠ¡çš„å‹åŠ›ï¼Œè¿™äº›åŠŸèƒ½éƒ½å¾—é nginxèµ·ä½œç”¨ï¼Œæ‰€ä»¥nginxæ˜¯æ•´ä¸ªé¡¹ç›®ä¸­é‡è¦çš„ä¸€ç¯ã€‚</p><p>åœ¨tomcatæ”¯æ’‘èµ·å¹¶å‘æµé‡åï¼Œæˆ‘ä»¬å¦‚æœè®©tomcatç›´æ¥å»è®¿é—®Mysqlï¼Œæ ¹æ®ç»éªŒMysqlä¼ä¸šçº§æœåŠ¡å™¨åªè¦ä¸Šç‚¹å¹¶å‘ï¼Œä¸€èˆ¬æ˜¯16æˆ–32 æ ¸å¿ƒcpuï¼Œ32 æˆ–64Gå†…å­˜ï¼Œåƒä¼ä¸šçº§mysqlåŠ ä¸Šå›ºæ€ç¡¬ç›˜èƒ½å¤Ÿæ”¯æ’‘çš„å¹¶å‘ï¼Œå¤§æ¦‚å°±æ˜¯4000èµ·~7000å·¦å³ï¼Œä¸Šä¸‡å¹¶å‘ï¼Œ ç¬é—´å°±ä¼šè®©MysqlæœåŠ¡å™¨çš„cpuï¼Œç¡¬ç›˜å…¨éƒ¨æ‰“æ»¡ï¼Œå®¹æ˜“å´©æºƒï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œä¼šé€‰æ‹©ä½¿ç”¨mysqlé›†ç¾¤ï¼ŒåŒæ—¶ä¸ºäº†è¿›ä¸€æ­¥é™ä½Mysqlçš„å‹åŠ›ï¼ŒåŒæ—¶å¢åŠ è®¿é—®çš„æ€§èƒ½ï¼Œæˆ‘ä»¬ä¹Ÿä¼šåŠ å…¥Redisï¼ŒåŒæ—¶ä½¿ç”¨Redisé›†ç¾¤ä½¿å¾—Rediså¯¹å¤–æä¾›æ›´å¥½çš„æœåŠ¡ã€‚</p><p><img src="/20221205120000/1653059409865.png" alt="ç³»ç»Ÿæ¶æ„å›¾"></p><h4 id="1-1-3ã€å¯¼å…¥åç«¯é¡¹ç›®"><a href="#1-1-3ã€å¯¼å…¥åç«¯é¡¹ç›®" class="headerlink" title="1.1.3ã€å¯¼å…¥åç«¯é¡¹ç›®"></a>1.1.3ã€å¯¼å…¥åç«¯é¡¹ç›®</h4><p>åœ¨èµ„æ–™ä¸­æä¾›äº†ä¸€ä¸ªé¡¹ç›®æºç ï¼š</p><p><img src="/20221205120000/1653060237073.png" alt="1653060237073"></p><h4 id="1-1-4ã€å¯¼å…¥å‰ç«¯å·¥ç¨‹"><a href="#1-1-4ã€å¯¼å…¥å‰ç«¯å·¥ç¨‹" class="headerlink" title="1.1.4ã€å¯¼å…¥å‰ç«¯å·¥ç¨‹"></a>1.1.4ã€å¯¼å…¥å‰ç«¯å·¥ç¨‹</h4><p><img src="/20221205120000/1653060337562.png" alt="1653060337562"></p><h4 id="1-1-5-è¿è¡Œå‰ç«¯é¡¹ç›®"><a href="#1-1-5-è¿è¡Œå‰ç«¯é¡¹ç›®" class="headerlink" title="1.1.5 è¿è¡Œå‰ç«¯é¡¹ç›®"></a>1.1.5 è¿è¡Œå‰ç«¯é¡¹ç›®</h4><p><img src="/20221205120000/1653060588190.png" alt="1653060588190"></p><h3 id="1-2-ã€åŸºäºSessionå®ç°ç™»å½•æµç¨‹"><a href="#1-2-ã€åŸºäºSessionå®ç°ç™»å½•æµç¨‹" class="headerlink" title="1.2 ã€åŸºäºSessionå®ç°ç™»å½•æµç¨‹"></a>1.2 ã€åŸºäºSessionå®ç°ç™»å½•æµç¨‹</h3><p><strong>å‘é€éªŒè¯ç ï¼š</strong></p><p>ç”¨æˆ·åœ¨æäº¤æ‰‹æœºå·åï¼Œä¼šæ ¡éªŒæ‰‹æœºå·æ˜¯å¦åˆæ³•ï¼Œå¦‚æœä¸åˆæ³•ï¼Œåˆ™è¦æ±‚ç”¨æˆ·é‡æ–°è¾“å…¥æ‰‹æœºå·</p><p>å¦‚æœæ‰‹æœºå·åˆæ³•ï¼Œåå°æ­¤æ—¶ç”Ÿæˆå¯¹åº”çš„éªŒè¯ç ï¼ŒåŒæ—¶å°†éªŒè¯ç è¿›è¡Œä¿å­˜ï¼Œç„¶åå†é€šè¿‡çŸ­ä¿¡çš„æ–¹å¼å°†éªŒè¯ç å‘é€ç»™ç”¨æˆ·</p><p><strong>çŸ­ä¿¡éªŒè¯ç ç™»å½•ã€æ³¨å†Œï¼š</strong></p><p>ç”¨æˆ·å°†éªŒè¯ç å’Œæ‰‹æœºå·è¿›è¡Œè¾“å…¥ï¼Œåå°ä»sessionä¸­æ‹¿åˆ°å½“å‰éªŒè¯ç ï¼Œç„¶åå’Œç”¨æˆ·è¾“å…¥çš„éªŒè¯ç è¿›è¡Œæ ¡éªŒï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œåˆ™æ— æ³•é€šè¿‡æ ¡éªŒï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™åå°æ ¹æ®æ‰‹æœºå·æŸ¥è¯¢ç”¨æˆ·ï¼Œå¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œåˆ™ä¸ºç”¨æˆ·åˆ›å»ºè´¦å·ä¿¡æ¯ï¼Œä¿å­˜åˆ°æ•°æ®åº“ï¼Œæ— è®ºæ˜¯å¦å­˜åœ¨ï¼Œéƒ½ä¼šå°†ç”¨æˆ·ä¿¡æ¯ä¿å­˜åˆ°sessionä¸­ï¼Œæ–¹ä¾¿åç»­è·å¾—å½“å‰ç™»å½•ä¿¡æ¯</p><p><strong>æ ¡éªŒç™»å½•çŠ¶æ€:</strong></p><p>ç”¨æˆ·åœ¨è¯·æ±‚æ—¶å€™ï¼Œä¼šä»cookieä¸­æºå¸¦è€…JsessionIdåˆ°åå°ï¼Œåå°é€šè¿‡JsessionIdä»sessionä¸­æ‹¿åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰sessionä¿¡æ¯ï¼Œåˆ™è¿›è¡Œæ‹¦æˆªï¼Œå¦‚æœæœ‰sessionä¿¡æ¯ï¼Œåˆ™å°†ç”¨æˆ·ä¿¡æ¯ä¿å­˜åˆ°threadLocalä¸­ï¼Œå¹¶ä¸”æ”¾è¡Œ</p><p><img src="/20221205120000/1653066208144.png" alt="1653066208144"></p><h3 id="1-3-ã€å®ç°å‘é€çŸ­ä¿¡éªŒè¯ç åŠŸèƒ½"><a href="#1-3-ã€å®ç°å‘é€çŸ­ä¿¡éªŒè¯ç åŠŸèƒ½" class="headerlink" title="1.3 ã€å®ç°å‘é€çŸ­ä¿¡éªŒè¯ç åŠŸèƒ½"></a>1.3 ã€å®ç°å‘é€çŸ­ä¿¡éªŒè¯ç åŠŸèƒ½</h3><p><strong>é¡µé¢æµç¨‹</strong></p><p><img src="/20221205120000/1653067054461.png" alt="1653067054461"></p><p><strong>å…·ä½“ä»£ç å¦‚ä¸‹</strong></p><p><strong>è´´å¿ƒå°æç¤ºï¼š</strong></p><p>å…·ä½“é€»è¾‘ä¸Šæ–‡å·²ç»åˆ†æï¼Œæˆ‘ä»¬ä»…ä»…åªéœ€è¦æŒ‰ç…§æç¤ºçš„é€»è¾‘å†™å‡ºä»£ç å³å¯ã€‚</p><ul><li>å‘é€éªŒè¯ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">sendCode</span><span class="hljs-params">(String phone, HttpSession session)</span> &#123;<br>    <span class="hljs-comment">// 1.æ ¡éªŒæ‰‹æœºå·</span><br>    <span class="hljs-keyword">if</span> (RegexUtils.isPhoneInvalid(phone)) &#123;<br>        <span class="hljs-comment">// 2.å¦‚æœä¸ç¬¦åˆï¼Œè¿”å›é”™è¯¯ä¿¡æ¯</span><br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;æ‰‹æœºå·æ ¼å¼é”™è¯¯ï¼&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">// 3.ç¬¦åˆï¼Œç”ŸæˆéªŒè¯ç </span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> RandomUtil.randomNumbers(<span class="hljs-number">6</span>);<br><br>    <span class="hljs-comment">// 4.ä¿å­˜éªŒè¯ç åˆ° session</span><br>    session.setAttribute(<span class="hljs-string">&quot;code&quot;</span>,code);<br>    <span class="hljs-comment">// 5.å‘é€éªŒè¯ç </span><br>    log.debug(<span class="hljs-string">&quot;å‘é€çŸ­ä¿¡éªŒè¯ç æˆåŠŸï¼ŒéªŒè¯ç ï¼š&#123;&#125;&quot;</span>, code);<br>    <span class="hljs-comment">// è¿”å›ok</span><br>    <span class="hljs-keyword">return</span> Result.ok();<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ç™»å½•</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">login</span><span class="hljs-params">(LoginFormDTO loginForm, HttpSession session)</span> &#123;<br>    <span class="hljs-comment">// 1.æ ¡éªŒæ‰‹æœºå·</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> loginForm.getPhone();<br>    <span class="hljs-keyword">if</span> (RegexUtils.isPhoneInvalid(phone)) &#123;<br>        <span class="hljs-comment">// 2.å¦‚æœä¸ç¬¦åˆï¼Œè¿”å›é”™è¯¯ä¿¡æ¯</span><br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;æ‰‹æœºå·æ ¼å¼é”™è¯¯ï¼&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">// 3.æ ¡éªŒéªŒè¯ç </span><br>    <span class="hljs-type">Object</span> <span class="hljs-variable">cacheCode</span> <span class="hljs-operator">=</span> session.getAttribute(<span class="hljs-string">&quot;code&quot;</span>);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> loginForm.getCode();<br>    <span class="hljs-keyword">if</span>(cacheCode == <span class="hljs-literal">null</span> || !cacheCode.toString().equals(code))&#123;<br>         <span class="hljs-comment">//3.ä¸ä¸€è‡´ï¼ŒæŠ¥é”™</span><br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;éªŒè¯ç é”™è¯¯&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">//ä¸€è‡´ï¼Œæ ¹æ®æ‰‹æœºå·æŸ¥è¯¢ç”¨æˆ·</span><br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> query().eq(<span class="hljs-string">&quot;phone&quot;</span>, phone).one();<br><br>    <span class="hljs-comment">//5.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span><br>    <span class="hljs-keyword">if</span>(user == <span class="hljs-literal">null</span>)&#123;<br>        <span class="hljs-comment">//ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»º</span><br>        user =  createUserWithPhone(phone);<br>    &#125;<br>    <span class="hljs-comment">//7.ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°sessionä¸­</span><br>    session.setAttribute(<span class="hljs-string">&quot;user&quot;</span>,user);<br><br>    <span class="hljs-keyword">return</span> Result.ok();<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1-4ã€å®ç°ç™»å½•æ‹¦æˆªåŠŸèƒ½"><a href="#1-4ã€å®ç°ç™»å½•æ‹¦æˆªåŠŸèƒ½" class="headerlink" title="1.4ã€å®ç°ç™»å½•æ‹¦æˆªåŠŸèƒ½"></a>1.4ã€å®ç°ç™»å½•æ‹¦æˆªåŠŸèƒ½</h3><p><strong>æ¸©é¦¨å°è´´å£«ï¼štomcatçš„è¿è¡ŒåŸç†</strong></p><p><img src="/20221205120000/1653068196656.png" alt="1653068196656"></p><p>å½“ç”¨æˆ·å‘èµ·è¯·æ±‚æ—¶ï¼Œä¼šè®¿é—®æˆ‘ä»¬åƒtomcatæ³¨å†Œçš„ç«¯å£ï¼Œä»»ä½•ç¨‹åºæƒ³è¦è¿è¡Œï¼Œéƒ½éœ€è¦æœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹å½“å‰ç«¯å£å·è¿›è¡Œç›‘å¬ï¼Œtomcatä¹Ÿä¸ä¾‹å¤–ï¼Œå½“ç›‘å¬çº¿ç¨‹çŸ¥é“ç”¨æˆ·æƒ³è¦å’Œtomcatè¿æ¥è¿æ¥æ—¶ï¼Œé‚£ä¼šç”±ç›‘å¬çº¿ç¨‹åˆ›å»ºsocketè¿æ¥ï¼Œsocketéƒ½æ˜¯æˆå¯¹å‡ºç°çš„ï¼Œç”¨æˆ·é€šè¿‡socketåƒäº’ç›¸ä¼ é€’æ•°æ®ï¼Œå½“tomcatç«¯çš„socketæ¥å—åˆ°æ•°æ®åï¼Œæ­¤æ—¶ç›‘å¬çº¿ç¨‹ä¼šä»tomcatçš„çº¿ç¨‹æ± ä¸­å–å‡ºä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç”¨æˆ·è¯·æ±‚ï¼Œåœ¨æˆ‘ä»¬çš„æœåŠ¡éƒ¨ç½²åˆ°tomcatåï¼Œçº¿ç¨‹ä¼šæ‰¾åˆ°ç”¨æˆ·æƒ³è¦è®¿é—®çš„å·¥ç¨‹ï¼Œç„¶åç”¨è¿™ä¸ªçº¿ç¨‹è½¬å‘åˆ°å·¥ç¨‹ä¸­çš„controllerï¼Œserviceï¼Œdaoä¸­ï¼Œå¹¶ä¸”è®¿é—®å¯¹åº”çš„DBï¼Œåœ¨ç”¨æˆ·æ‰§è¡Œå®Œè¯·æ±‚åï¼Œå†ç»Ÿä¸€è¿”å›ï¼Œå†æ‰¾åˆ°tomcatç«¯çš„socketï¼Œå†å°†æ•°æ®å†™å›åˆ°ç”¨æˆ·ç«¯çš„socketï¼Œå®Œæˆè¯·æ±‚å’Œå“åº”</p><p>é€šè¿‡ä»¥ä¸Šè®²è§£ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ æ¯ä¸ªç”¨æˆ·å…¶å®å¯¹åº”éƒ½æ˜¯å»æ‰¾tomcatçº¿ç¨‹æ± ä¸­çš„ä¸€ä¸ªçº¿ç¨‹æ¥å®Œæˆå·¥ä½œçš„ï¼Œ ä½¿ç”¨å®Œæˆåå†è¿›è¡Œå›æ”¶ï¼Œæ—¢ç„¶æ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œæ‰€ä»¥åœ¨æ¯ä¸ªç”¨æˆ·å»è®¿é—®æˆ‘ä»¬çš„å·¥ç¨‹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨threadlocalæ¥åšåˆ°çº¿ç¨‹éš”ç¦»ï¼Œæ¯ä¸ªçº¿ç¨‹æ“ä½œè‡ªå·±çš„ä¸€ä»½æ•°æ®</p><p><strong>æ¸©é¦¨å°è´´å£«ï¼šå…³äºthreadlocal</strong></p><p>å¦‚æœå°ä¼™ä¼´ä»¬çœ‹è¿‡threadLocalçš„æºç ï¼Œä½ ä¼šå‘ç°åœ¨threadLocalä¸­ï¼Œæ— è®ºæ˜¯ä»–çš„putæ–¹æ³•å’Œä»–çš„getæ–¹æ³•ï¼Œ éƒ½æ˜¯å…ˆä»è·å¾—å½“å‰ç”¨æˆ·çš„çº¿ç¨‹ï¼Œç„¶åä»çº¿ç¨‹ä¸­å–å‡ºçº¿ç¨‹çš„æˆå‘˜å˜é‡mapï¼Œåªè¦çº¿ç¨‹ä¸ä¸€æ ·ï¼Œmapå°±ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥åšåˆ°çº¿ç¨‹éš”ç¦»</p><p><img src="/20221205120000/1653068874258.png" alt="1653068874258"></p><p>æ‹¦æˆªå™¨ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>       <span class="hljs-comment">//1.è·å–session</span><br>        <span class="hljs-type">HttpSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> request.getSession();<br>        <span class="hljs-comment">//2.è·å–sessionä¸­çš„ç”¨æˆ·</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> session.getAttribute(<span class="hljs-string">&quot;user&quot;</span>);<br>        <span class="hljs-comment">//3.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span><br>        <span class="hljs-keyword">if</span>(user == <span class="hljs-literal">null</span>)&#123;<br>              <span class="hljs-comment">//4.ä¸å­˜åœ¨ï¼Œæ‹¦æˆªï¼Œè¿”å›401çŠ¶æ€ç </span><br>              response.setStatus(<span class="hljs-number">401</span>);<br>              <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-comment">//5.å­˜åœ¨ï¼Œä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°Threadlocal</span><br>        UserHolder.saveUser((User)user);<br>        <span class="hljs-comment">//6.æ”¾è¡Œ</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è®©æ‹¦æˆªå™¨ç”Ÿæ•ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MvcConfig</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">WebMvcConfigurer</span> &#123;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> StringRedisTemplate stringRedisTemplate;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addInterceptors</span><span class="hljs-params">(InterceptorRegistry registry)</span> &#123;<br>        <span class="hljs-comment">// ç™»å½•æ‹¦æˆªå™¨</span><br>        registry.addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginInterceptor</span>())<br>                .excludePathPatterns(<br>                        <span class="hljs-string">&quot;/shop/**&quot;</span>,<br>                        <span class="hljs-string">&quot;/voucher/**&quot;</span>,<br>                        <span class="hljs-string">&quot;/shop-type/**&quot;</span>,<br>                        <span class="hljs-string">&quot;/upload/**&quot;</span>,<br>                        <span class="hljs-string">&quot;/blog/hot&quot;</span>,<br>                        <span class="hljs-string">&quot;/user/code&quot;</span>,<br>                        <span class="hljs-string">&quot;/user/login&quot;</span><br>                ).order(<span class="hljs-number">1</span>);<br>        <span class="hljs-comment">// tokenåˆ·æ–°çš„æ‹¦æˆªå™¨</span><br>        registry.addInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RefreshTokenInterceptor</span>(stringRedisTemplate)).addPathPatterns(<span class="hljs-string">&quot;/**&quot;</span>).order(<span class="hljs-number">0</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1-5ã€éšè—ç”¨æˆ·æ•æ„Ÿä¿¡æ¯"><a href="#1-5ã€éšè—ç”¨æˆ·æ•æ„Ÿä¿¡æ¯" class="headerlink" title="1.5ã€éšè—ç”¨æˆ·æ•æ„Ÿä¿¡æ¯"></a>1.5ã€éšè—ç”¨æˆ·æ•æ„Ÿä¿¡æ¯</h3><p>æˆ‘ä»¬é€šè¿‡æµè§ˆå™¨è§‚å¯Ÿåˆ°æ­¤æ—¶ç”¨æˆ·çš„å…¨éƒ¨ä¿¡æ¯éƒ½åœ¨ï¼Œè¿™æ ·æä¸ºä¸é è°±ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”å½“åœ¨è¿”å›ç”¨æˆ·ä¿¡æ¯ä¹‹å‰ï¼Œå°†ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯è¿›è¡Œéšè—ï¼Œé‡‡ç”¨çš„æ ¸å¿ƒæ€è·¯å°±æ˜¯ä¹¦å†™ä¸€ä¸ªUserDtoå¯¹è±¡ï¼Œè¿™ä¸ªUserDtoå¯¹è±¡å°±æ²¡æœ‰æ•æ„Ÿä¿¡æ¯äº†ï¼Œæˆ‘ä»¬åœ¨è¿”å›å‰ï¼Œå°†æœ‰ç”¨æˆ·æ•æ„Ÿä¿¡æ¯çš„Userå¯¹è±¡è½¬åŒ–æˆæ²¡æœ‰æ•æ„Ÿä¿¡æ¯çš„UserDtoå¯¹è±¡ï¼Œé‚£ä¹ˆå°±èƒ½å¤Ÿé¿å…è¿™ä¸ªå°´å°¬çš„é—®é¢˜äº†</p><p><strong>åœ¨ç™»å½•æ–¹æ³•å¤„ä¿®æ”¹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//7.ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°sessionä¸­</span><br>session.setAttribute(<span class="hljs-string">&quot;user&quot;</span>, BeanUtils.copyProperties(user,UserDTO.class));<br></code></pre></td></tr></table></figure><p><strong>åœ¨æ‹¦æˆªå™¨å¤„ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//5.å­˜åœ¨ï¼Œä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°Threadlocal</span><br>UserHolder.saveUser((UserDTO) user);<br></code></pre></td></tr></table></figure><p><strong>åœ¨UserHolderå¤„ï¼šå°†userå¯¹è±¡æ¢æˆUserDTO</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserHolder</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;UserDTO&gt; tl = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveUser</span><span class="hljs-params">(UserDTO user)</span>&#123;<br>        tl.set(user);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> UserDTO <span class="hljs-title function_">getUser</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> tl.get();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">removeUser</span><span class="hljs-params">()</span>&#123;<br>        tl.remove();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1-6ã€sessionå…±äº«é—®é¢˜"><a href="#1-6ã€sessionå…±äº«é—®é¢˜" class="headerlink" title="1.6ã€sessionå…±äº«é—®é¢˜"></a>1.6ã€sessionå…±äº«é—®é¢˜</h3><p><strong>æ ¸å¿ƒæ€è·¯åˆ†æï¼š</strong></p><p>æ¯ä¸ªtomcatä¸­éƒ½æœ‰ä¸€ä»½å±äºè‡ªå·±çš„session,å‡è®¾ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®ç¬¬ä¸€å°tomcatï¼Œå¹¶ä¸”æŠŠè‡ªå·±çš„ä¿¡æ¯å­˜æ”¾åˆ°ç¬¬ä¸€å°æœåŠ¡å™¨çš„sessionä¸­ï¼Œä½†æ˜¯ç¬¬äºŒæ¬¡è¿™ä¸ªç”¨æˆ·è®¿é—®åˆ°äº†ç¬¬äºŒå°tomcatï¼Œé‚£ä¹ˆåœ¨ç¬¬äºŒå°æœåŠ¡å™¨ä¸Šï¼Œè‚¯å®šæ²¡æœ‰ç¬¬ä¸€å°æœåŠ¡å™¨å­˜æ”¾çš„sessionï¼Œæ‰€ä»¥æ­¤æ—¶ æ•´ä¸ªç™»å½•æ‹¦æˆªåŠŸèƒ½å°±ä¼šå‡ºç°é—®é¢˜ï¼Œæˆ‘ä»¬èƒ½å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæ—©æœŸçš„æ–¹æ¡ˆæ˜¯sessionæ‹·è´ï¼Œå°±æ˜¯è¯´è™½ç„¶æ¯ä¸ªtomcatä¸Šéƒ½æœ‰ä¸åŒçš„sessionï¼Œä½†æ˜¯æ¯å½“ä»»æ„ä¸€å°æœåŠ¡å™¨çš„sessionä¿®æ”¹æ—¶ï¼Œéƒ½ä¼šåŒæ­¥ç»™å…¶ä»–çš„TomcatæœåŠ¡å™¨çš„sessionï¼Œè¿™æ ·çš„è¯ï¼Œå°±å¯ä»¥å®ç°sessionçš„å…±äº«äº†</p><p>ä½†æ˜¯è¿™ç§æ–¹æ¡ˆå…·æœ‰ä¸¤ä¸ªå¤§é—®é¢˜</p><p>1ã€æ¯å°æœåŠ¡å™¨ä¸­éƒ½æœ‰å®Œæ•´çš„ä¸€ä»½sessionæ•°æ®ï¼ŒæœåŠ¡å™¨å‹åŠ›è¿‡å¤§ã€‚</p><p>2ã€sessionæ‹·è´æ•°æ®æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°å»¶è¿Ÿ</p><p>æ‰€ä»¥å’±ä»¬åæ¥é‡‡ç”¨çš„æ–¹æ¡ˆéƒ½æ˜¯åŸºäºredisæ¥å®Œæˆï¼Œæˆ‘ä»¬æŠŠsessionæ¢æˆredisï¼Œredisæ•°æ®æœ¬èº«å°±æ˜¯å…±äº«çš„ï¼Œå°±å¯ä»¥é¿å…sessionå…±äº«çš„é—®é¢˜äº†</p><p><img src="/20221205120000/1653069893050.png" alt="1653069893050"></p><h3 id="1-7-Redisä»£æ›¿sessionçš„ä¸šåŠ¡æµç¨‹"><a href="#1-7-Redisä»£æ›¿sessionçš„ä¸šåŠ¡æµç¨‹" class="headerlink" title="1.7 Redisä»£æ›¿sessionçš„ä¸šåŠ¡æµç¨‹"></a>1.7 Redisä»£æ›¿sessionçš„ä¸šåŠ¡æµç¨‹</h3><h4 id="1-7-1ã€è®¾è®¡keyçš„ç»“æ„"><a href="#1-7-1ã€è®¾è®¡keyçš„ç»“æ„" class="headerlink" title="1.7.1ã€è®¾è®¡keyçš„ç»“æ„"></a>1.7.1ã€è®¾è®¡keyçš„ç»“æ„</h4><p>é¦–å…ˆæˆ‘ä»¬è¦æ€è€ƒä¸€ä¸‹åˆ©ç”¨redisæ¥å­˜å‚¨æ•°æ®ï¼Œé‚£ä¹ˆåˆ°åº•ä½¿ç”¨å“ªç§ç»“æ„å‘¢ï¼Ÿç”±äºå­˜å…¥çš„æ•°æ®æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨Stringï¼Œæˆ–è€…æ˜¯ä½¿ç”¨å“ˆå¸Œï¼Œå¦‚ä¸‹å›¾ï¼Œå¦‚æœä½¿ç”¨Stringï¼ŒåŒå­¦ä»¬æ³¨æ„ä»–çš„valueï¼Œç”¨å¤šå ç”¨ä¸€ç‚¹ç©ºé—´ï¼Œå¦‚æœä½¿ç”¨å“ˆå¸Œï¼Œåˆ™ä»–çš„valueä¸­åªä¼šå­˜å‚¨ä»–æ•°æ®æœ¬èº«ï¼Œå¦‚æœä¸æ˜¯ç‰¹åˆ«åœ¨æ„å†…å­˜ï¼Œå…¶å®ä½¿ç”¨Stringå°±å¯ä»¥å•¦ã€‚</p><p><img src="/20221205120000/1653319261433.png" alt="1653319261433"></p><h4 id="1-7-2ã€è®¾è®¡keyçš„å…·ä½“ç»†èŠ‚"><a href="#1-7-2ã€è®¾è®¡keyçš„å…·ä½“ç»†èŠ‚" class="headerlink" title="1.7.2ã€è®¾è®¡keyçš„å…·ä½“ç»†èŠ‚"></a>1.7.2ã€è®¾è®¡keyçš„å…·ä½“ç»†èŠ‚</h4><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Stringç»“æ„ï¼Œå°±æ˜¯ä¸€ä¸ªç®€å•çš„keyï¼Œvalueé”®å€¼å¯¹çš„æ–¹å¼ï¼Œä½†æ˜¯å…³äºkeyçš„å¤„ç†ï¼Œsessionä»–æ˜¯æ¯ä¸ªç”¨æˆ·éƒ½æœ‰è‡ªå·±çš„sessionï¼Œä½†æ˜¯redisçš„keyæ˜¯å…±äº«çš„ï¼Œå’±ä»¬å°±ä¸èƒ½ä½¿ç”¨codeäº†</p><p>åœ¨è®¾è®¡è¿™ä¸ªkeyçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹‹å‰è®²è¿‡éœ€è¦æ»¡è¶³ä¸¤ç‚¹</p><p>1ã€keyè¦å…·æœ‰å”¯ä¸€æ€§</p><p>2ã€keyè¦æ–¹ä¾¿æºå¸¦</p><p>å¦‚æœæˆ‘ä»¬é‡‡ç”¨phoneï¼šæ‰‹æœºå·è¿™ä¸ªçš„æ•°æ®æ¥å­˜å‚¨å½“ç„¶æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯å¦‚æœæŠŠè¿™æ ·çš„æ•æ„Ÿæ•°æ®å­˜å‚¨åˆ°redisä¸­å¹¶ä¸”ä»é¡µé¢ä¸­å¸¦è¿‡æ¥æ¯•ç«Ÿä¸å¤ªåˆé€‚ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨åå°ç”Ÿæˆä¸€ä¸ªéšæœºä¸²tokenï¼Œç„¶åè®©å‰ç«¯å¸¦æ¥è¿™ä¸ªtokenå°±èƒ½å®Œæˆæˆ‘ä»¬çš„æ•´ä½“é€»è¾‘äº†</p><h4 id="1-7-3ã€æ•´ä½“è®¿é—®æµç¨‹"><a href="#1-7-3ã€æ•´ä½“è®¿é—®æµç¨‹" class="headerlink" title="1.7.3ã€æ•´ä½“è®¿é—®æµç¨‹"></a>1.7.3ã€æ•´ä½“è®¿é—®æµç¨‹</h4><p>å½“æ³¨å†Œå®Œæˆåï¼Œç”¨æˆ·å»ç™»å½•ä¼šå»æ ¡éªŒç”¨æˆ·æäº¤çš„æ‰‹æœºå·å’ŒéªŒè¯ç ï¼Œæ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™æ ¹æ®æ‰‹æœºå·æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œä¸å­˜åœ¨åˆ™æ–°å»ºï¼Œæœ€åå°†ç”¨æˆ·æ•°æ®ä¿å­˜åˆ°redisï¼Œå¹¶ä¸”ç”Ÿæˆtokenä½œä¸ºredisçš„keyï¼Œå½“æˆ‘ä»¬æ ¡éªŒç”¨æˆ·æ˜¯å¦ç™»å½•æ—¶ï¼Œä¼šå»æºå¸¦ç€tokenè¿›è¡Œè®¿é—®ï¼Œä»redisä¸­å–å‡ºtokenå¯¹åº”çš„valueï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨è¿™ä¸ªæ•°æ®ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ‹¦æˆªï¼Œå¦‚æœå­˜åœ¨åˆ™å°†å…¶ä¿å­˜åˆ°threadLocalä¸­ï¼Œå¹¶ä¸”æ”¾è¡Œã€‚</p><p><img src="/20221205120000/1653319474181.png" alt="1653319474181"></p><h3 id="1-8-åŸºäºRediså®ç°çŸ­ä¿¡ç™»å½•"><a href="#1-8-åŸºäºRediså®ç°çŸ­ä¿¡ç™»å½•" class="headerlink" title="1.8 åŸºäºRediså®ç°çŸ­ä¿¡ç™»å½•"></a>1.8 åŸºäºRediså®ç°çŸ­ä¿¡ç™»å½•</h3><p>è¿™é‡Œå…·ä½“é€»è¾‘å°±ä¸åˆ†æäº†ï¼Œä¹‹å‰å’±ä»¬å·²ç»é‡ç‚¹åˆ†æè¿‡è¿™ä¸ªé€»è¾‘å•¦ã€‚</p><p><strong>UserServiceImplä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">login</span><span class="hljs-params">(LoginFormDTO loginForm, HttpSession session)</span> &#123;<br>    <span class="hljs-comment">// 1.æ ¡éªŒæ‰‹æœºå·</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">phone</span> <span class="hljs-operator">=</span> loginForm.getPhone();<br>    <span class="hljs-keyword">if</span> (RegexUtils.isPhoneInvalid(phone)) &#123;<br>        <span class="hljs-comment">// 2.å¦‚æœä¸ç¬¦åˆï¼Œè¿”å›é”™è¯¯ä¿¡æ¯</span><br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;æ‰‹æœºå·æ ¼å¼é”™è¯¯ï¼&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">// 3.ä»redisè·å–éªŒè¯ç å¹¶æ ¡éªŒ</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">cacheCode</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue().get(LOGIN_CODE_KEY + phone);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> loginForm.getCode();<br>    <span class="hljs-keyword">if</span> (cacheCode == <span class="hljs-literal">null</span> || !cacheCode.equals(code)) &#123;<br>        <span class="hljs-comment">// ä¸ä¸€è‡´ï¼ŒæŠ¥é”™</span><br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;éªŒè¯ç é”™è¯¯&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// 4.ä¸€è‡´ï¼Œæ ¹æ®æ‰‹æœºå·æŸ¥è¯¢ç”¨æˆ· select * from tb_user where phone = ?</span><br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> query().eq(<span class="hljs-string">&quot;phone&quot;</span>, phone).one();<br><br>    <span class="hljs-comment">// 5.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span><br>    <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">// 6.ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°ç”¨æˆ·å¹¶ä¿å­˜</span><br>        user = createUserWithPhone(phone);<br>    &#125;<br><br>    <span class="hljs-comment">// 7.ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ° redisä¸­</span><br>    <span class="hljs-comment">// 7.1.éšæœºç”Ÿæˆtokenï¼Œä½œä¸ºç™»å½•ä»¤ç‰Œ</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString(<span class="hljs-literal">true</span>);<br>    <span class="hljs-comment">// 7.2.å°†Userå¯¹è±¡è½¬ä¸ºHashMapå­˜å‚¨</span><br>    <span class="hljs-type">UserDTO</span> <span class="hljs-variable">userDTO</span> <span class="hljs-operator">=</span> BeanUtil.copyProperties(user, UserDTO.class);<br>    Map&lt;String, Object&gt; userMap = BeanUtil.beanToMap(userDTO, <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(),<br>            CopyOptions.create()<br>                    .setIgnoreNullValue(<span class="hljs-literal">true</span>)<br>                    .setFieldValueEditor((fieldName, fieldValue) -&gt; fieldValue.toString()));<br>    <span class="hljs-comment">// 7.3.å­˜å‚¨</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">tokenKey</span> <span class="hljs-operator">=</span> LOGIN_USER_KEY + token;<br>    stringRedisTemplate.opsForHash().putAll(tokenKey, userMap);<br>    <span class="hljs-comment">// 7.4.è®¾ç½®tokenæœ‰æ•ˆæœŸ</span><br>    stringRedisTemplate.expire(tokenKey, LOGIN_USER_TTL, TimeUnit.MINUTES);<br><br>    <span class="hljs-comment">// 8.è¿”å›token</span><br>    <span class="hljs-keyword">return</span> Result.ok(token);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1-9-è§£å†³çŠ¶æ€ç™»å½•åˆ·æ–°é—®é¢˜"><a href="#1-9-è§£å†³çŠ¶æ€ç™»å½•åˆ·æ–°é—®é¢˜" class="headerlink" title="1.9 è§£å†³çŠ¶æ€ç™»å½•åˆ·æ–°é—®é¢˜"></a>1.9 è§£å†³çŠ¶æ€ç™»å½•åˆ·æ–°é—®é¢˜</h3><h4 id="1-9-1-åˆå§‹æ–¹æ¡ˆæ€è·¯æ€»ç»“ï¼š"><a href="#1-9-1-åˆå§‹æ–¹æ¡ˆæ€è·¯æ€»ç»“ï¼š" class="headerlink" title="1.9.1 åˆå§‹æ–¹æ¡ˆæ€è·¯æ€»ç»“ï¼š"></a>1.9.1 åˆå§‹æ–¹æ¡ˆæ€è·¯æ€»ç»“ï¼š</h4><p>åœ¨è¿™ä¸ªæ–¹æ¡ˆä¸­ï¼Œä»–ç¡®å®å¯ä»¥ä½¿ç”¨å¯¹åº”è·¯å¾„çš„æ‹¦æˆªï¼ŒåŒæ—¶åˆ·æ–°ç™»å½•tokenä»¤ç‰Œçš„å­˜æ´»æ—¶é—´ï¼Œä½†æ˜¯ç°åœ¨è¿™ä¸ªæ‹¦æˆªå™¨ä»–åªæ˜¯æ‹¦æˆªéœ€è¦è¢«æ‹¦æˆªçš„è·¯å¾„ï¼Œå‡è®¾å½“å‰ç”¨æˆ·è®¿é—®äº†ä¸€äº›ä¸éœ€è¦æ‹¦æˆªçš„è·¯å¾„ï¼Œé‚£ä¹ˆè¿™ä¸ªæ‹¦æˆªå™¨å°±ä¸ä¼šç”Ÿæ•ˆï¼Œæ‰€ä»¥æ­¤æ—¶ä»¤ç‰Œåˆ·æ–°çš„åŠ¨ä½œå®é™…ä¸Šå°±ä¸ä¼šæ‰§è¡Œï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ¡ˆä»–æ˜¯å­˜åœ¨é—®é¢˜çš„</p><p><img src="/20221205120000/1653320822964.png" alt="1653320822964"></p><h4 id="1-9-2-ä¼˜åŒ–æ–¹æ¡ˆ"><a href="#1-9-2-ä¼˜åŒ–æ–¹æ¡ˆ" class="headerlink" title="1.9.2 ä¼˜åŒ–æ–¹æ¡ˆ"></a>1.9.2 ä¼˜åŒ–æ–¹æ¡ˆ</h4><p>æ—¢ç„¶ä¹‹å‰çš„æ‹¦æˆªå™¨æ— æ³•å¯¹ä¸éœ€è¦æ‹¦æˆªçš„è·¯å¾„ç”Ÿæ•ˆï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œåœ¨ç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨ä¸­æ‹¦æˆªæ‰€æœ‰çš„è·¯å¾„ï¼ŒæŠŠç¬¬äºŒä¸ªæ‹¦æˆªå™¨åšçš„äº‹æƒ…æ”¾å…¥åˆ°ç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨ä¸­ï¼ŒåŒæ—¶åˆ·æ–°ä»¤ç‰Œï¼Œå› ä¸ºç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨æœ‰äº†threadLocalçš„æ•°æ®ï¼Œæ‰€ä»¥æ­¤æ—¶ç¬¬äºŒä¸ªæ‹¦æˆªå™¨åªéœ€è¦åˆ¤æ–­æ‹¦æˆªå™¨ä¸­çš„userå¯¹è±¡æ˜¯å¦å­˜åœ¨å³å¯ï¼Œå®Œæˆæ•´ä½“åˆ·æ–°åŠŸèƒ½ã€‚</p><p><img src="/20221205120000/1653320764547.png" alt="1653320764547"></p><h4 id="1-9-3-ä»£ç "><a href="#1-9-3-ä»£ç " class="headerlink" title="1.9.3 ä»£ç "></a>1.9.3 ä»£ç </h4><p><strong>RefreshTokenInterceptor</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RefreshTokenInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br><br>    <span class="hljs-keyword">private</span> StringRedisTemplate stringRedisTemplate;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RefreshTokenInterceptor</span><span class="hljs-params">(StringRedisTemplate stringRedisTemplate)</span> &#123;<br>        <span class="hljs-built_in">this</span>.stringRedisTemplate = stringRedisTemplate;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// 1.è·å–è¯·æ±‚å¤´ä¸­çš„token</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">&quot;authorization&quot;</span>);<br>        <span class="hljs-keyword">if</span> (StrUtil.isBlank(token)) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-comment">// 2.åŸºäºTOKENè·å–redisä¸­çš„ç”¨æˆ·</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span>  <span class="hljs-operator">=</span> LOGIN_USER_KEY + token;<br>        Map&lt;Object, Object&gt; userMap = stringRedisTemplate.opsForHash().entries(key);<br>        <span class="hljs-comment">// 3.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span><br>        <span class="hljs-keyword">if</span> (userMap.isEmpty()) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>        <span class="hljs-comment">// 5.å°†æŸ¥è¯¢åˆ°çš„hashæ•°æ®è½¬ä¸ºUserDTO</span><br>        <span class="hljs-type">UserDTO</span> <span class="hljs-variable">userDTO</span> <span class="hljs-operator">=</span> BeanUtil.fillBeanWithMap(userMap, <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDTO</span>(), <span class="hljs-literal">false</span>);<br>        <span class="hljs-comment">// 6.å­˜åœ¨ï¼Œä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ° ThreadLocal</span><br>        UserHolder.saveUser(userDTO);<br>        <span class="hljs-comment">// 7.åˆ·æ–°tokenæœ‰æ•ˆæœŸ</span><br>        stringRedisTemplate.expire(key, LOGIN_USER_TTL, TimeUnit.MINUTES);<br>        <span class="hljs-comment">// 8.æ”¾è¡Œ</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterCompletion</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// ç§»é™¤ç”¨æˆ·</span><br>        UserHolder.removeUser();<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>LoginInterceptor</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// 1.åˆ¤æ–­æ˜¯å¦éœ€è¦æ‹¦æˆªï¼ˆThreadLocalä¸­æ˜¯å¦æœ‰ç”¨æˆ·ï¼‰</span><br>        <span class="hljs-keyword">if</span> (UserHolder.getUser() == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// æ²¡æœ‰ï¼Œéœ€è¦æ‹¦æˆªï¼Œè®¾ç½®çŠ¶æ€ç </span><br>            response.setStatus(<span class="hljs-number">401</span>);<br>            <span class="hljs-comment">// æ‹¦æˆª</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <span class="hljs-comment">// æœ‰ç”¨æˆ·ï¼Œåˆ™æ”¾è¡Œ</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2ã€å•†æˆ·æŸ¥è¯¢ç¼“å­˜"><a href="#2ã€å•†æˆ·æŸ¥è¯¢ç¼“å­˜" class="headerlink" title="2ã€å•†æˆ·æŸ¥è¯¢ç¼“å­˜"></a>2ã€å•†æˆ·æŸ¥è¯¢ç¼“å­˜</h2><h3 id="2-1-ä»€ä¹ˆæ˜¯ç¼“å­˜"><a href="#2-1-ä»€ä¹ˆæ˜¯ç¼“å­˜" class="headerlink" title="2.1 ä»€ä¹ˆæ˜¯ç¼“å­˜?"></a>2.1 ä»€ä¹ˆæ˜¯ç¼“å­˜?</h3><p><strong>å‰è¨€</strong>:<strong>ä»€ä¹ˆæ˜¯ç¼“å­˜?</strong></p><p>å°±åƒè‡ªè¡Œè½¦,è¶Šé‡è½¦çš„é¿éœ‡å™¨<img src="/20221205120000/%E9%81%BF%E9%9C%87%E5%99%A8.gif"></p><p>ä¸¾ä¸ªä¾‹å­:è¶Šé‡è½¦,å±±åœ°è‡ªè¡Œè½¦,éƒ½æ‹¥æœ‰â€é¿éœ‡å™¨â€,<strong>é˜²æ­¢</strong>è½¦ä½“åŠ é€Ÿåå› æƒ¯æ€§,åœ¨é…·ä¼¼â€Uâ€å­—æ¯çš„åœ°å½¢ä¸Šé£è·ƒ,ç¡¬ç€é™†å¯¼è‡´çš„<strong>æŸå®³</strong>,åƒä¸ªå¼¹ç°§ä¸€æ ·;</p><p>åŒæ ·,å®é™…å¼€å‘ä¸­,ç³»ç»Ÿä¹Ÿéœ€è¦â€é¿éœ‡å™¨â€,é˜²æ­¢è¿‡é«˜çš„æ•°æ®è®¿é—®çŒ›å†²ç³»ç»Ÿ,å¯¼è‡´å…¶æ“ä½œçº¿ç¨‹æ— æ³•åŠæ—¶å¤„ç†ä¿¡æ¯è€Œç˜«ç—ª;</p><p>è¿™åœ¨å®é™…å¼€å‘ä¸­å¯¹ä¼ä¸šè®²,å¯¹äº§å“å£ç¢‘,ç”¨æˆ·è¯„ä»·éƒ½æ˜¯è‡´å‘½çš„;æ‰€ä»¥ä¼ä¸šéå¸¸é‡è§†ç¼“å­˜æŠ€æœ¯;</p><p><strong>ç¼“å­˜(<strong>Cache),å°±æ˜¯æ•°æ®äº¤æ¢çš„</strong>ç¼“å†²åŒº</strong>,ä¿—ç§°çš„ç¼“å­˜å°±æ˜¯<strong>ç¼“å†²åŒºå†…çš„æ•°æ®</strong>,ä¸€èˆ¬ä»æ•°æ®åº“ä¸­è·å–,å­˜å‚¨äºæœ¬åœ°ä»£ç (ä¾‹å¦‚:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">ä¾‹<span class="hljs-number">1</span>:Static <span class="hljs-keyword">final</span> ConcurrentHashMap&lt;K,V&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConcurrentHashMap</span>&lt;&gt;(); æœ¬åœ°ç”¨äºé«˜å¹¶å‘<br><br>ä¾‹<span class="hljs-number">2</span>:<span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Cache&lt;K,V&gt; USER_CACHE = CacheBuilder.newBuilder().build(); ç”¨äºredisç­‰ç¼“å­˜<br><br>ä¾‹<span class="hljs-number">3</span>:Static <span class="hljs-keyword">final</span> Map&lt;K,V&gt; map =  <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>(); æœ¬åœ°ç¼“å­˜<br></code></pre></td></tr></table></figure><p>ç”±äºå…¶è¢«<strong>Static</strong>ä¿®é¥°,æ‰€ä»¥éšç€ç±»çš„åŠ è½½è€Œè¢«åŠ è½½åˆ°<strong>å†…å­˜ä¹‹ä¸­</strong>,ä½œä¸ºæœ¬åœ°ç¼“å­˜,ç”±äºå…¶åˆè¢«<strong>final</strong>ä¿®é¥°,æ‰€ä»¥å…¶å¼•ç”¨(ä¾‹3:map)å’Œå¯¹è±¡(ä¾‹3:new HashMap())ä¹‹é—´çš„å…³ç³»æ˜¯å›ºå®šçš„,ä¸èƒ½æ”¹å˜,å› æ­¤ä¸ç”¨æ‹…å¿ƒèµ‹å€¼(&#x3D;)å¯¼è‡´ç¼“å­˜å¤±æ•ˆ;</p><h4 id="2-1-1-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç¼“å­˜"><a href="#2-1-1-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç¼“å­˜" class="headerlink" title="2.1.1 ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç¼“å­˜"></a>2.1.1 ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ç¼“å­˜</h4><p>ä¸€å¥è¯:å› ä¸º<strong>é€Ÿåº¦å¿«,å¥½ç”¨</strong></p><p>ç¼“å­˜æ•°æ®å­˜å‚¨äºä»£ç ä¸­,è€Œä»£ç è¿è¡Œåœ¨å†…å­˜ä¸­,å†…å­˜çš„è¯»å†™æ€§èƒ½è¿œé«˜äºç£ç›˜,ç¼“å­˜å¯ä»¥å¤§å¤§é™ä½<strong>ç”¨æˆ·è®¿é—®å¹¶å‘é‡å¸¦æ¥çš„</strong>æœåŠ¡å™¨è¯»å†™å‹åŠ›</p><p>å®é™…å¼€å‘è¿‡ç¨‹ä¸­,ä¼ä¸šçš„æ•°æ®é‡,å°‘åˆ™å‡ åä¸‡,å¤šåˆ™å‡ åƒä¸‡,è¿™ä¹ˆå¤§æ•°æ®é‡,å¦‚æœæ²¡æœ‰ç¼“å­˜æ¥ä½œä¸ºâ€é¿éœ‡å™¨â€,ç³»ç»Ÿæ˜¯å‡ ä¹æ’‘ä¸ä½çš„,æ‰€ä»¥ä¼ä¸šä¼šå¤§é‡è¿ç”¨åˆ°ç¼“å­˜æŠ€æœ¯;</p><p>ä½†æ˜¯ç¼“å­˜ä¹Ÿä¼šå¢åŠ ä»£ç å¤æ‚åº¦å’Œè¿è¥çš„æˆæœ¬:</p><p><img src="/20221205120000/image-20220523214414123.png"></p><h4 id="2-1-2-å¦‚ä½•ä½¿ç”¨ç¼“å­˜"><a href="#2-1-2-å¦‚ä½•ä½¿ç”¨ç¼“å­˜" class="headerlink" title="2.1.2 å¦‚ä½•ä½¿ç”¨ç¼“å­˜"></a>2.1.2 å¦‚ä½•ä½¿ç”¨ç¼“å­˜</h4><p>å®é™…å¼€å‘ä¸­,ä¼šæ„ç­‘å¤šçº§ç¼“å­˜æ¥ä½¿ç³»ç»Ÿè¿è¡Œé€Ÿåº¦è¿›ä¸€æ­¥æå‡,ä¾‹å¦‚:æœ¬åœ°ç¼“å­˜ä¸redisä¸­çš„ç¼“å­˜å¹¶å‘ä½¿ç”¨</p><p><strong>æµè§ˆå™¨ç¼“å­˜</strong>ï¼šä¸»è¦æ˜¯å­˜åœ¨äºæµè§ˆå™¨ç«¯çš„ç¼“å­˜</p><p><strong>åº”ç”¨å±‚ç¼“å­˜ï¼š</strong>å¯ä»¥åˆ†ä¸ºtomcatæœ¬åœ°ç¼“å­˜ï¼Œæ¯”å¦‚ä¹‹å‰æåˆ°çš„mapï¼Œæˆ–è€…æ˜¯ä½¿ç”¨redisä½œä¸ºç¼“å­˜</p><p><strong>æ•°æ®åº“ç¼“å­˜ï¼š</strong>åœ¨æ•°æ®åº“ä¸­æœ‰ä¸€ç‰‡ç©ºé—´æ˜¯ buffer poolï¼Œå¢æ”¹æŸ¥æ•°æ®éƒ½ä¼šå…ˆåŠ è½½åˆ°mysqlçš„ç¼“å­˜ä¸­</p><p><strong>CPUç¼“å­˜ï¼š</strong>å½“ä»£è®¡ç®—æœºæœ€å¤§çš„é—®é¢˜æ˜¯ cpuæ€§èƒ½æå‡äº†ï¼Œä½†å†…å­˜è¯»å†™é€Ÿåº¦æ²¡æœ‰è·Ÿä¸Šï¼Œæ‰€ä»¥ä¸ºäº†é€‚åº”å½“ä¸‹çš„æƒ…å†µï¼Œå¢åŠ äº†cpuçš„L1ï¼ŒL2ï¼ŒL3çº§çš„ç¼“å­˜</p><p><img src="/20221205120000/image-20220523212915666.png"></p><h3 id="2-2-æ·»åŠ å•†æˆ·ç¼“å­˜"><a href="#2-2-æ·»åŠ å•†æˆ·ç¼“å­˜" class="headerlink" title="2.2 æ·»åŠ å•†æˆ·ç¼“å­˜"></a>2.2 æ·»åŠ å•†æˆ·ç¼“å­˜</h3><p>åœ¨æˆ‘ä»¬æŸ¥è¯¢å•†æˆ·ä¿¡æ¯æ—¶ï¼Œæˆ‘ä»¬æ˜¯ç›´æ¥æ“ä½œä»æ•°æ®åº“ä¸­å»è¿›è¡ŒæŸ¥è¯¢çš„ï¼Œå¤§è‡´é€»è¾‘æ˜¯è¿™æ ·ï¼Œç›´æ¥æŸ¥è¯¢æ•°æ®åº“é‚£è‚¯å®šæ…¢å’¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¢åŠ ç¼“å­˜</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@GetMapping</span>(<span class="hljs-string">&quot;/&#123;id&#125;&quot;</span>)<br>public Result <span class="hljs-built_in">queryShopById</span>(<span class="hljs-variable">@PathVariable</span>(<span class="hljs-string">&quot;id&quot;</span>) Long id) &#123;<br>    <span class="hljs-comment">//è¿™é‡Œæ˜¯ç›´æ¥æŸ¥è¯¢æ•°æ®åº“</span><br>    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">shopService</span><span class="hljs-selector-class">.queryById</span>(id);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="2-2-1-ã€ç¼“å­˜æ¨¡å‹å’Œæ€è·¯"><a href="#2-2-1-ã€ç¼“å­˜æ¨¡å‹å’Œæ€è·¯" class="headerlink" title="2.2.1 ã€ç¼“å­˜æ¨¡å‹å’Œæ€è·¯"></a>2.2.1 ã€ç¼“å­˜æ¨¡å‹å’Œæ€è·¯</h4><p>æ ‡å‡†çš„æ“ä½œæ–¹å¼å°±æ˜¯æŸ¥è¯¢æ•°æ®åº“ä¹‹å‰å…ˆæŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜æ•°æ®å­˜åœ¨ï¼Œåˆ™ç›´æ¥ä»ç¼“å­˜ä¸­è¿”å›ï¼Œå¦‚æœç¼“å­˜æ•°æ®ä¸å­˜åœ¨ï¼Œå†æŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åå°†æ•°æ®å­˜å…¥redisã€‚</p><p><img src="/20221205120000/1653322097736.png" alt="1653322097736"></p><h4 id="2-1-2ã€ä»£ç å¦‚ä¸‹"><a href="#2-1-2ã€ä»£ç å¦‚ä¸‹" class="headerlink" title="2.1.2ã€ä»£ç å¦‚ä¸‹"></a>2.1.2ã€ä»£ç å¦‚ä¸‹</h4><p>ä»£ç æ€è·¯ï¼šå¦‚æœç¼“å­˜æœ‰ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œå¦‚æœç¼“å­˜ä¸å­˜åœ¨ï¼Œåˆ™æŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åå­˜å…¥redisã€‚</p><p><img src="/20221205120000/1653322190155.png" alt="1653322190155"></p><h3 id="2-3-ç¼“å­˜æ›´æ–°ç­–ç•¥"><a href="#2-3-ç¼“å­˜æ›´æ–°ç­–ç•¥" class="headerlink" title="2.3 ç¼“å­˜æ›´æ–°ç­–ç•¥"></a>2.3 ç¼“å­˜æ›´æ–°ç­–ç•¥</h3><p>ç¼“å­˜æ›´æ–°æ˜¯redisä¸ºäº†èŠ‚çº¦å†…å­˜è€Œè®¾è®¡å‡ºæ¥çš„ä¸€ä¸ªä¸œè¥¿ï¼Œä¸»è¦æ˜¯å› ä¸ºå†…å­˜æ•°æ®å®è´µï¼Œå½“æˆ‘ä»¬å‘redisæ’å…¥å¤ªå¤šæ•°æ®ï¼Œæ­¤æ—¶å°±å¯èƒ½ä¼šå¯¼è‡´ç¼“å­˜ä¸­çš„æ•°æ®è¿‡å¤šï¼Œæ‰€ä»¥redisä¼šå¯¹éƒ¨åˆ†æ•°æ®è¿›è¡Œæ›´æ–°ï¼Œæˆ–è€…æŠŠä»–å«ä¸ºæ·˜æ±°æ›´åˆé€‚ã€‚</p><p><strong>å†…å­˜æ·˜æ±°ï¼š</strong>redisè‡ªåŠ¨è¿›è¡Œï¼Œå½“rediså†…å­˜è¾¾åˆ°å’±ä»¬è®¾å®šçš„max-memeryçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è§¦å‘æ·˜æ±°æœºåˆ¶ï¼Œæ·˜æ±°æ‰ä¸€äº›ä¸é‡è¦çš„æ•°æ®(å¯ä»¥è‡ªå·±è®¾ç½®ç­–ç•¥æ–¹å¼)</p><p><strong>è¶…æ—¶å‰”é™¤ï¼š</strong>å½“æˆ‘ä»¬ç»™redisè®¾ç½®äº†è¿‡æœŸæ—¶é—´ttlä¹‹åï¼Œredisä¼šå°†è¶…æ—¶çš„æ•°æ®è¿›è¡Œåˆ é™¤ï¼Œæ–¹ä¾¿å’±ä»¬ç»§ç»­ä½¿ç”¨ç¼“å­˜</p><p><strong>ä¸»åŠ¨æ›´æ–°ï¼š</strong>æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è°ƒç”¨æ–¹æ³•æŠŠç¼“å­˜åˆ æ‰ï¼Œé€šå¸¸ç”¨äºè§£å†³ç¼“å­˜å’Œæ•°æ®åº“ä¸ä¸€è‡´é—®é¢˜</p><p><img src="/20221205120000/1653322506393.png" alt="1653322506393"></p><h4 id="2-3-1-ã€æ•°æ®åº“ç¼“å­˜ä¸ä¸€è‡´è§£å†³æ–¹æ¡ˆï¼š"><a href="#2-3-1-ã€æ•°æ®åº“ç¼“å­˜ä¸ä¸€è‡´è§£å†³æ–¹æ¡ˆï¼š" class="headerlink" title="2.3.1 ã€æ•°æ®åº“ç¼“å­˜ä¸ä¸€è‡´è§£å†³æ–¹æ¡ˆï¼š"></a>2.3.1 ã€æ•°æ®åº“ç¼“å­˜ä¸ä¸€è‡´è§£å†³æ–¹æ¡ˆï¼š</h4><p>ç”±äºæˆ‘ä»¬çš„<strong>ç¼“å­˜çš„æ•°æ®æºæ¥è‡ªäºæ•°æ®åº“</strong>,è€Œæ•°æ®åº“çš„<strong>æ•°æ®æ˜¯ä¼šå‘ç”Ÿå˜åŒ–çš„</strong>,å› æ­¤,å¦‚æœå½“æ•°æ®åº“ä¸­<strong>æ•°æ®å‘ç”Ÿå˜åŒ–,è€Œç¼“å­˜å´æ²¡æœ‰åŒæ­¥</strong>,æ­¤æ—¶å°±ä¼šæœ‰<strong>ä¸€è‡´æ€§é—®é¢˜å­˜åœ¨</strong>,å…¶åæœæ˜¯:</p><p>ç”¨æˆ·ä½¿ç”¨ç¼“å­˜ä¸­çš„è¿‡æ—¶æ•°æ®,å°±ä¼šäº§ç”Ÿç±»ä¼¼å¤šçº¿ç¨‹æ•°æ®å®‰å…¨é—®é¢˜,ä»è€Œå½±å“ä¸šåŠ¡,äº§å“å£ç¢‘ç­‰;æ€ä¹ˆè§£å†³å‘¢ï¼Ÿæœ‰å¦‚ä¸‹å‡ ç§æ–¹æ¡ˆ</p><p>Cache Aside Pattern äººå·¥ç¼–ç æ–¹å¼ï¼šç¼“å­˜è°ƒç”¨è€…åœ¨æ›´æ–°å®Œæ•°æ®åº“åå†å»æ›´æ–°ç¼“å­˜ï¼Œä¹Ÿç§°ä¹‹ä¸ºåŒå†™æ–¹æ¡ˆ</p><p>Read&#x2F;Write Through Pattern : ç”±ç³»ç»Ÿæœ¬èº«å®Œæˆï¼Œæ•°æ®åº“ä¸ç¼“å­˜çš„é—®é¢˜äº¤ç”±ç³»ç»Ÿæœ¬èº«å»å¤„ç†</p><p>Write Behind Caching Pattern ï¼šè°ƒç”¨è€…åªæ“ä½œç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹å»å¼‚æ­¥å¤„ç†æ•°æ®åº“ï¼Œå®ç°æœ€ç»ˆä¸€è‡´</p><p><img src="/20221205120000/1653322857620.png" alt="1653322857620"></p><h4 id="2-3-2-ã€æ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´é‡‡ç”¨ä»€ä¹ˆæ–¹æ¡ˆ"><a href="#2-3-2-ã€æ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´é‡‡ç”¨ä»€ä¹ˆæ–¹æ¡ˆ" class="headerlink" title="2.3.2 ã€æ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´é‡‡ç”¨ä»€ä¹ˆæ–¹æ¡ˆ"></a>2.3.2 ã€æ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´é‡‡ç”¨ä»€ä¹ˆæ–¹æ¡ˆ</h4><p>ç»¼åˆè€ƒè™‘ä½¿ç”¨æ–¹æ¡ˆä¸€ï¼Œä½†æ˜¯æ–¹æ¡ˆä¸€è°ƒç”¨è€…å¦‚ä½•å¤„ç†å‘¢ï¼Ÿè¿™é‡Œæœ‰å‡ ä¸ªé—®é¢˜</p><p>æ“ä½œç¼“å­˜å’Œæ•°æ®åº“æ—¶æœ‰ä¸‰ä¸ªé—®é¢˜éœ€è¦è€ƒè™‘ï¼š</p><p>å¦‚æœé‡‡ç”¨ç¬¬ä¸€ä¸ªæ–¹æ¡ˆï¼Œé‚£ä¹ˆå‡è®¾æˆ‘ä»¬æ¯æ¬¡æ“ä½œæ•°æ®åº“åï¼Œéƒ½æ“ä½œç¼“å­˜ï¼Œä½†æ˜¯ä¸­é—´å¦‚æœæ²¡æœ‰äººæŸ¥è¯¢ï¼Œé‚£ä¹ˆè¿™ä¸ªæ›´æ–°åŠ¨ä½œå®é™…ä¸Šåªæœ‰æœ€åä¸€æ¬¡ç”Ÿæ•ˆï¼Œä¸­é—´çš„æ›´æ–°åŠ¨ä½œæ„ä¹‰å¹¶ä¸å¤§ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠç¼“å­˜åˆ é™¤ï¼Œç­‰å¾…å†æ¬¡æŸ¥è¯¢æ—¶ï¼Œå°†ç¼“å­˜ä¸­çš„æ•°æ®åŠ è½½å‡ºæ¥</p><ul><li><p>åˆ é™¤ç¼“å­˜è¿˜æ˜¯æ›´æ–°ç¼“å­˜ï¼Ÿ</p><ul><li>æ›´æ–°ç¼“å­˜ï¼šæ¯æ¬¡æ›´æ–°æ•°æ®åº“éƒ½æ›´æ–°ç¼“å­˜ï¼Œæ— æ•ˆå†™æ“ä½œè¾ƒå¤š</li><li>åˆ é™¤ç¼“å­˜ï¼šæ›´æ–°æ•°æ®åº“æ—¶è®©ç¼“å­˜å¤±æ•ˆï¼ŒæŸ¥è¯¢æ—¶å†æ›´æ–°ç¼“å­˜</li></ul></li><li><p>å¦‚ä½•ä¿è¯ç¼“å­˜ä¸æ•°æ®åº“çš„æ“ä½œçš„åŒæ—¶æˆåŠŸæˆ–å¤±è´¥ï¼Ÿ</p><ul><li>å•ä½“ç³»ç»Ÿï¼Œå°†ç¼“å­˜ä¸æ•°æ®åº“æ“ä½œæ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡</li><li>åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œåˆ©ç”¨TCCç­‰åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ</li></ul></li></ul><p>åº”è¯¥å…·ä½“æ“ä½œç¼“å­˜è¿˜æ˜¯æ“ä½œæ•°æ®åº“ï¼Œæˆ‘ä»¬åº”å½“æ˜¯å…ˆæ“ä½œæ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼ŒåŸå› åœ¨äºï¼Œå¦‚æœä½ é€‰æ‹©ç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œåœ¨ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘æ¥è®¿é—®æ—¶ï¼Œå‡è®¾çº¿ç¨‹1å…ˆæ¥ï¼Œä»–å…ˆæŠŠç¼“å­˜åˆ äº†ï¼Œæ­¤æ—¶çº¿ç¨‹2è¿‡æ¥ï¼Œä»–æŸ¥è¯¢ç¼“å­˜æ•°æ®å¹¶ä¸å­˜åœ¨ï¼Œæ­¤æ—¶ä»–å†™å…¥ç¼“å­˜ï¼Œå½“ä»–å†™å…¥ç¼“å­˜åï¼Œçº¿ç¨‹1å†æ‰§è¡Œæ›´æ–°åŠ¨ä½œæ—¶ï¼Œå®é™…ä¸Šå†™å…¥çš„å°±æ˜¯æ—§çš„æ•°æ®ï¼Œæ–°çš„æ•°æ®è¢«æ—§æ•°æ®è¦†ç›–äº†ã€‚</p><ul><li>å…ˆæ“ä½œç¼“å­˜è¿˜æ˜¯å…ˆæ“ä½œæ•°æ®åº“ï¼Ÿ<ul><li>å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ“ä½œæ•°æ®åº“</li><li>å…ˆæ“ä½œæ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</li></ul></li></ul><p><img src="/20221205120000/1653323595206.png" alt="1653323595206"></p><h3 id="2-4-å®ç°å•†é“ºå’Œç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´"><a href="#2-4-å®ç°å•†é“ºå’Œç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´" class="headerlink" title="2.4 å®ç°å•†é“ºå’Œç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´"></a>2.4 å®ç°å•†é“ºå’Œç¼“å­˜ä¸æ•°æ®åº“åŒå†™ä¸€è‡´</h3><p>æ ¸å¿ƒæ€è·¯å¦‚ä¸‹ï¼š</p><p>ä¿®æ”¹ShopControllerä¸­çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ»¡è¶³ä¸‹é¢çš„éœ€æ±‚ï¼š</p><p>æ ¹æ®idæŸ¥è¯¢åº—é“ºæ—¶ï¼Œå¦‚æœç¼“å­˜æœªå‘½ä¸­ï¼Œåˆ™æŸ¥è¯¢æ•°æ®åº“ï¼Œå°†æ•°æ®åº“ç»“æœå†™å…¥ç¼“å­˜ï¼Œå¹¶è®¾ç½®è¶…æ—¶æ—¶é—´</p><p>æ ¹æ®idä¿®æ”¹åº—é“ºæ—¶ï¼Œå…ˆä¿®æ”¹æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</p><p><strong>ä¿®æ”¹é‡ç‚¹ä»£ç 1</strong>ï¼šä¿®æ”¹<strong>ShopServiceImpl</strong>çš„queryByIdæ–¹æ³•</p><p><strong>è®¾ç½®redisç¼“å­˜æ—¶æ·»åŠ è¿‡æœŸæ—¶é—´</strong></p><p><img src="/20221205120000/1653325871232.png" alt="1653325871232"></p><p><strong>ä¿®æ”¹é‡ç‚¹ä»£ç 2</strong></p><p>ä»£ç åˆ†æï¼šé€šè¿‡ä¹‹å‰çš„æ·˜æ±°ï¼Œæˆ‘ä»¬ç¡®å®šäº†é‡‡ç”¨åˆ é™¤ç­–ç•¥ï¼Œæ¥è§£å†³åŒå†™é—®é¢˜ï¼Œå½“æˆ‘ä»¬ä¿®æ”¹äº†æ•°æ®ä¹‹åï¼Œç„¶åæŠŠç¼“å­˜ä¸­çš„æ•°æ®è¿›è¡Œåˆ é™¤ï¼ŒæŸ¥è¯¢æ—¶å‘ç°ç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®ï¼Œåˆ™ä¼šä»mysqlä¸­åŠ è½½æœ€æ–°çš„æ•°æ®ï¼Œä»è€Œé¿å…æ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´çš„é—®é¢˜</p><p><img src="/20221205120000/1653325929549.png" alt="1653325929549"></p><h3 id="2-5-ç¼“å­˜ç©¿é€é—®é¢˜çš„è§£å†³æ€è·¯"><a href="#2-5-ç¼“å­˜ç©¿é€é—®é¢˜çš„è§£å†³æ€è·¯" class="headerlink" title="2.5 ç¼“å­˜ç©¿é€é—®é¢˜çš„è§£å†³æ€è·¯"></a>2.5 ç¼“å­˜ç©¿é€é—®é¢˜çš„è§£å†³æ€è·¯</h3><p>ç¼“å­˜ç©¿é€ ï¼šç¼“å­˜ç©¿é€æ˜¯æŒ‡å®¢æˆ·ç«¯è¯·æ±‚çš„æ•°æ®åœ¨ç¼“å­˜ä¸­å’Œæ•°æ®åº“ä¸­éƒ½ä¸å­˜åœ¨ï¼Œè¿™æ ·ç¼“å­˜æ°¸è¿œä¸ä¼šç”Ÿæ•ˆï¼Œè¿™äº›è¯·æ±‚éƒ½ä¼šæ‰“åˆ°æ•°æ®åº“ã€‚</p><p>å¸¸è§çš„è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š</p><ul><li>ç¼“å­˜ç©ºå¯¹è±¡<ul><li>ä¼˜ç‚¹ï¼šå®ç°ç®€å•ï¼Œç»´æŠ¤æ–¹ä¾¿</li><li>ç¼ºç‚¹ï¼š<ul><li>é¢å¤–çš„å†…å­˜æ¶ˆè€—</li><li>å¯èƒ½é€ æˆçŸ­æœŸçš„ä¸ä¸€è‡´</li></ul></li></ul></li><li>å¸ƒéš†è¿‡æ»¤<ul><li>ä¼˜ç‚¹ï¼šå†…å­˜å ç”¨è¾ƒå°‘ï¼Œæ²¡æœ‰å¤šä½™key</li><li>ç¼ºç‚¹ï¼š<ul><li>å®ç°å¤æ‚</li><li>å­˜åœ¨è¯¯åˆ¤å¯èƒ½</li></ul></li></ul></li></ul><p><strong>ç¼“å­˜ç©ºå¯¹è±¡æ€è·¯åˆ†æï¼š</strong>å½“æˆ‘ä»¬å®¢æˆ·ç«¯è®¿é—®ä¸å­˜åœ¨çš„æ•°æ®æ—¶ï¼Œå…ˆè¯·æ±‚redisï¼Œä½†æ˜¯æ­¤æ—¶redisä¸­æ²¡æœ‰æ•°æ®ï¼Œæ­¤æ—¶ä¼šè®¿é—®åˆ°æ•°æ®åº“ï¼Œä½†æ˜¯æ•°æ®åº“ä¸­ä¹Ÿæ²¡æœ‰æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®ç©¿é€äº†ç¼“å­˜ï¼Œç›´å‡»æ•°æ®åº“ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“æ•°æ®åº“èƒ½å¤Ÿæ‰¿è½½çš„å¹¶å‘ä¸å¦‚redisè¿™ä¹ˆé«˜ï¼Œå¦‚æœå¤§é‡çš„è¯·æ±‚åŒæ—¶è¿‡æ¥è®¿é—®è¿™ç§ä¸å­˜åœ¨çš„æ•°æ®ï¼Œè¿™äº›è¯·æ±‚å°±éƒ½ä¼šè®¿é—®åˆ°æ•°æ®åº“ï¼Œç®€å•çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯å“ªæ€•è¿™ä¸ªæ•°æ®åœ¨æ•°æ®åº“ä¸­ä¹Ÿä¸å­˜åœ¨ï¼Œæˆ‘ä»¬ä¹ŸæŠŠè¿™ä¸ªæ•°æ®å­˜å…¥åˆ°redisä¸­å»ï¼Œè¿™æ ·ï¼Œä¸‹æ¬¡ç”¨æˆ·è¿‡æ¥è®¿é—®è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®ï¼Œé‚£ä¹ˆåœ¨redisä¸­ä¹Ÿèƒ½æ‰¾åˆ°è¿™ä¸ªæ•°æ®å°±ä¸ä¼šè¿›å…¥åˆ°ç¼“å­˜äº†</p><p><strong>å¸ƒéš†è¿‡æ»¤ï¼š</strong>å¸ƒéš†è¿‡æ»¤å™¨å…¶å®é‡‡ç”¨çš„æ˜¯å“ˆå¸Œæ€æƒ³æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé€šè¿‡ä¸€ä¸ªåºå¤§çš„äºŒè¿›åˆ¶æ•°ç»„ï¼Œèµ°å“ˆå¸Œæ€æƒ³å»åˆ¤æ–­å½“å‰è¿™ä¸ªè¦æŸ¥è¯¢çš„è¿™ä¸ªæ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­å­˜åœ¨ï¼Œåˆ™æ”¾è¡Œï¼Œè¿™ä¸ªè¯·æ±‚ä¼šå»è®¿é—®redisï¼Œå“ªæ€•æ­¤æ—¶redisä¸­çš„æ•°æ®è¿‡æœŸäº†ï¼Œä½†æ˜¯æ•°æ®åº“ä¸­ä¸€å®šå­˜åœ¨è¿™ä¸ªæ•°æ®ï¼Œåœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢å‡ºæ¥è¿™ä¸ªæ•°æ®åï¼Œå†å°†å…¶æ”¾å…¥åˆ°redisä¸­ï¼Œ</p><p>å‡è®¾å¸ƒéš†è¿‡æ»¤å™¨åˆ¤æ–­è¿™ä¸ªæ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›</p><p>è¿™ç§æ–¹å¼ä¼˜ç‚¹åœ¨äºèŠ‚çº¦å†…å­˜ç©ºé—´ï¼Œå­˜åœ¨è¯¯åˆ¤ï¼Œè¯¯åˆ¤åŸå› åœ¨äºï¼šå¸ƒéš†è¿‡æ»¤å™¨èµ°çš„æ˜¯å“ˆå¸Œæ€æƒ³ï¼Œåªè¦å“ˆå¸Œæ€æƒ³ï¼Œå°±å¯èƒ½å­˜åœ¨å“ˆå¸Œå†²çª</p><p><img src="/20221205120000/1653326156516.png" alt="1653326156516"></p><h3 id="2-6-ç¼–ç è§£å†³å•†å“æŸ¥è¯¢çš„ç¼“å­˜ç©¿é€é—®é¢˜ï¼š"><a href="#2-6-ç¼–ç è§£å†³å•†å“æŸ¥è¯¢çš„ç¼“å­˜ç©¿é€é—®é¢˜ï¼š" class="headerlink" title="2.6 ç¼–ç è§£å†³å•†å“æŸ¥è¯¢çš„ç¼“å­˜ç©¿é€é—®é¢˜ï¼š"></a>2.6 ç¼–ç è§£å†³å•†å“æŸ¥è¯¢çš„ç¼“å­˜ç©¿é€é—®é¢˜ï¼š</h3><p>æ ¸å¿ƒæ€è·¯å¦‚ä¸‹ï¼š</p><p>åœ¨åŸæ¥çš„é€»è¾‘ä¸­ï¼Œæˆ‘ä»¬å¦‚æœå‘ç°è¿™ä¸ªæ•°æ®åœ¨mysqlä¸­ä¸å­˜åœ¨ï¼Œç›´æ¥å°±è¿”å›404äº†ï¼Œè¿™æ ·æ˜¯ä¼šå­˜åœ¨ç¼“å­˜ç©¿é€é—®é¢˜çš„</p><p>ç°åœ¨çš„é€»è¾‘ä¸­ï¼šå¦‚æœè¿™ä¸ªæ•°æ®ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬ä¸ä¼šè¿”å›404 ï¼Œè¿˜æ˜¯ä¼šæŠŠè¿™ä¸ªæ•°æ®å†™å…¥åˆ°Redisä¸­ï¼Œå¹¶ä¸”å°†valueè®¾ç½®ä¸ºç©ºï¼Œæ¬§å½“å†æ¬¡å‘èµ·æŸ¥è¯¢æ—¶ï¼Œæˆ‘ä»¬å¦‚æœå‘ç°å‘½ä¸­ä¹‹åï¼Œåˆ¤æ–­è¿™ä¸ªvalueæ˜¯å¦æ˜¯nullï¼Œå¦‚æœæ˜¯nullï¼Œåˆ™æ˜¯ä¹‹å‰å†™å…¥çš„æ•°æ®ï¼Œè¯æ˜æ˜¯ç¼“å­˜ç©¿é€æ•°æ®ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ç›´æ¥è¿”å›æ•°æ®ã€‚</p><p><img src="/20221205120000/1653327124561.png" alt="1653327124561"></p><p><strong>å°æ€»ç»“ï¼š</strong></p><p>ç¼“å­˜ç©¿é€äº§ç”Ÿçš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>ç”¨æˆ·è¯·æ±‚çš„æ•°æ®åœ¨ç¼“å­˜ä¸­å’Œæ•°æ®åº“ä¸­éƒ½ä¸å­˜åœ¨ï¼Œä¸æ–­å‘èµ·è¿™æ ·çš„è¯·æ±‚ï¼Œç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§å‹åŠ›</li></ul><p>ç¼“å­˜ç©¿é€çš„è§£å†³æ–¹æ¡ˆæœ‰å“ªäº›ï¼Ÿ</p><ul><li>ç¼“å­˜nullå€¼</li><li>å¸ƒéš†è¿‡æ»¤</li><li>å¢å¼ºidçš„å¤æ‚åº¦ï¼Œé¿å…è¢«çŒœæµ‹idè§„å¾‹</li><li>åšå¥½æ•°æ®çš„åŸºç¡€æ ¼å¼æ ¡éªŒ</li><li>åŠ å¼ºç”¨æˆ·æƒé™æ ¡éªŒ</li><li>åšå¥½çƒ­ç‚¹å‚æ•°çš„é™æµ</li></ul><h3 id="2-7-ç¼“å­˜é›ªå´©é—®é¢˜åŠè§£å†³æ€è·¯"><a href="#2-7-ç¼“å­˜é›ªå´©é—®é¢˜åŠè§£å†³æ€è·¯" class="headerlink" title="2.7 ç¼“å­˜é›ªå´©é—®é¢˜åŠè§£å†³æ€è·¯"></a>2.7 ç¼“å­˜é›ªå´©é—®é¢˜åŠè§£å†³æ€è·¯</h3><p>ç¼“å­˜é›ªå´©æ˜¯æŒ‡åœ¨åŒä¸€æ—¶æ®µå¤§é‡çš„ç¼“å­˜keyåŒæ—¶å¤±æ•ˆæˆ–è€…RedisæœåŠ¡å®•æœºï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚åˆ°è¾¾æ•°æ®åº“ï¼Œå¸¦æ¥å·¨å¤§å‹åŠ›ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>ç»™ä¸åŒçš„Keyçš„TTLæ·»åŠ éšæœºå€¼</li><li>åˆ©ç”¨Redisé›†ç¾¤æé«˜æœåŠ¡çš„å¯ç”¨æ€§</li><li>ç»™ç¼“å­˜ä¸šåŠ¡æ·»åŠ é™çº§é™æµç­–ç•¥</li><li>ç»™ä¸šåŠ¡æ·»åŠ å¤šçº§ç¼“å­˜</li></ul><p><img src="/20221205120000/1653327884526.png" alt="1653327884526"></p><h3 id="2-8-ç¼“å­˜å‡»ç©¿é—®é¢˜åŠè§£å†³æ€è·¯"><a href="#2-8-ç¼“å­˜å‡»ç©¿é—®é¢˜åŠè§£å†³æ€è·¯" class="headerlink" title="2.8 ç¼“å­˜å‡»ç©¿é—®é¢˜åŠè§£å†³æ€è·¯"></a>2.8 ç¼“å­˜å‡»ç©¿é—®é¢˜åŠè§£å†³æ€è·¯</h3><p>ç¼“å­˜å‡»ç©¿é—®é¢˜ä¹Ÿå«çƒ­ç‚¹Keyé—®é¢˜ï¼Œå°±æ˜¯ä¸€ä¸ªè¢«é«˜å¹¶å‘è®¿é—®å¹¶ä¸”ç¼“å­˜é‡å»ºä¸šåŠ¡è¾ƒå¤æ‚çš„keyçªç„¶å¤±æ•ˆäº†ï¼Œæ— æ•°çš„è¯·æ±‚è®¿é—®ä¼šåœ¨ç¬é—´ç»™æ•°æ®åº“å¸¦æ¥å·¨å¤§çš„å†²å‡»ã€‚</p><p>å¸¸è§çš„è§£å†³æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼š</p><ul><li>äº’æ–¥é”</li><li>é€»è¾‘è¿‡æœŸ</li></ul><p>é€»è¾‘åˆ†æï¼šå‡è®¾çº¿ç¨‹1åœ¨æŸ¥è¯¢ç¼“å­˜ä¹‹åï¼Œæœ¬æ¥åº”è¯¥å»æŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åæŠŠè¿™ä¸ªæ•°æ®é‡æ–°åŠ è½½åˆ°ç¼“å­˜çš„ï¼Œæ­¤æ—¶åªè¦çº¿ç¨‹1èµ°å®Œè¿™ä¸ªé€»è¾‘ï¼Œå…¶ä»–çº¿ç¨‹å°±éƒ½èƒ½ä»ç¼“å­˜ä¸­åŠ è½½è¿™äº›æ•°æ®äº†ï¼Œä½†æ˜¯å‡è®¾åœ¨çº¿ç¨‹1æ²¡æœ‰èµ°å®Œçš„æ—¶å€™ï¼Œåç»­çš„çº¿ç¨‹2ï¼Œçº¿ç¨‹3ï¼Œçº¿ç¨‹4åŒæ—¶è¿‡æ¥è®¿é—®å½“å‰è¿™ä¸ªæ–¹æ³•ï¼Œ é‚£ä¹ˆè¿™äº›çº¿ç¨‹éƒ½ä¸èƒ½ä»ç¼“å­˜ä¸­æŸ¥è¯¢åˆ°æ•°æ®ï¼Œé‚£ä¹ˆä»–ä»¬å°±ä¼šåŒä¸€æ—¶åˆ»æ¥è®¿é—®æŸ¥è¯¢ç¼“å­˜ï¼Œéƒ½æ²¡æŸ¥åˆ°ï¼Œæ¥ç€åŒä¸€æ—¶é—´å»è®¿é—®æ•°æ®åº“ï¼ŒåŒæ—¶çš„å»æ‰§è¡Œæ•°æ®åº“ä»£ç ï¼Œå¯¹æ•°æ®åº“è®¿é—®å‹åŠ›è¿‡å¤§</p><p><img src="/20221205120000/1653328022622.png" alt="1653328022622"></p><p>è§£å†³æ–¹æ¡ˆä¸€ã€ä½¿ç”¨é”æ¥è§£å†³ï¼š</p><p>å› ä¸ºé”èƒ½å®ç°äº’æ–¥æ€§ã€‚å‡è®¾çº¿ç¨‹è¿‡æ¥ï¼Œåªèƒ½ä¸€ä¸ªäººä¸€ä¸ªäººçš„æ¥è®¿é—®æ•°æ®åº“ï¼Œä»è€Œé¿å…å¯¹äºæ•°æ®åº“è®¿é—®å‹åŠ›è¿‡å¤§ï¼Œä½†è¿™ä¹Ÿä¼šå½±å“æŸ¥è¯¢çš„æ€§èƒ½ï¼Œå› ä¸ºæ­¤æ—¶ä¼šè®©æŸ¥è¯¢çš„æ€§èƒ½ä»å¹¶è¡Œå˜æˆäº†ä¸²è¡Œï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨tryLockæ–¹æ³• + double checkæ¥è§£å†³è¿™æ ·çš„é—®é¢˜ã€‚</p><p>å‡è®¾ç°åœ¨çº¿ç¨‹1è¿‡æ¥è®¿é—®ï¼Œä»–æŸ¥è¯¢ç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼Œä½†æ˜¯æ­¤æ—¶ä»–è·å¾—åˆ°äº†é”çš„èµ„æºï¼Œé‚£ä¹ˆçº¿ç¨‹1å°±ä¼šä¸€ä¸ªäººå»æ‰§è¡Œé€»è¾‘ï¼Œå‡è®¾ç°åœ¨çº¿ç¨‹2è¿‡æ¥ï¼Œçº¿ç¨‹2åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¹¶æ²¡æœ‰è·å¾—åˆ°é”ï¼Œé‚£ä¹ˆçº¿ç¨‹2å°±å¯ä»¥è¿›è¡Œåˆ°ä¼‘çœ ï¼Œç›´åˆ°çº¿ç¨‹1æŠŠé”é‡Šæ”¾åï¼Œçº¿ç¨‹2è·å¾—åˆ°é”ï¼Œç„¶åå†æ¥æ‰§è¡Œé€»è¾‘ï¼Œæ­¤æ—¶å°±èƒ½å¤Ÿä»ç¼“å­˜ä¸­æ‹¿åˆ°æ•°æ®äº†ã€‚</p><p><img src="/20221205120000/1653328288627.png" alt="1653328288627"></p><p>è§£å†³æ–¹æ¡ˆäºŒã€é€»è¾‘è¿‡æœŸæ–¹æ¡ˆ</p><p>æ–¹æ¡ˆåˆ†æï¼šæˆ‘ä»¬ä¹‹æ‰€ä»¥ä¼šå‡ºç°è¿™ä¸ªç¼“å­˜å‡»ç©¿é—®é¢˜ï¼Œä¸»è¦åŸå› æ˜¯åœ¨äºæˆ‘ä»¬å¯¹keyè®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œå‡è®¾æˆ‘ä»¬ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå…¶å®å°±ä¸ä¼šæœ‰ç¼“å­˜å‡»ç©¿çš„é—®é¢˜ï¼Œä½†æ˜¯ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·æ•°æ®ä¸å°±ä¸€ç›´å ç”¨æˆ‘ä»¬å†…å­˜äº†å—ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨é€»è¾‘è¿‡æœŸæ–¹æ¡ˆã€‚</p><p>æˆ‘ä»¬æŠŠè¿‡æœŸæ—¶é—´è®¾ç½®åœ¨ redisçš„valueä¸­ï¼Œæ³¨æ„ï¼šè¿™ä¸ªè¿‡æœŸæ—¶é—´å¹¶ä¸ä¼šç›´æ¥ä½œç”¨äºredisï¼Œè€Œæ˜¯æˆ‘ä»¬åç»­é€šè¿‡é€»è¾‘å»å¤„ç†ã€‚å‡è®¾çº¿ç¨‹1å»æŸ¥è¯¢ç¼“å­˜ï¼Œç„¶åä»valueä¸­åˆ¤æ–­å‡ºæ¥å½“å‰çš„æ•°æ®å·²ç»è¿‡æœŸäº†ï¼Œæ­¤æ—¶çº¿ç¨‹1å»è·å¾—äº’æ–¥é”ï¼Œé‚£ä¹ˆå…¶ä»–çº¿ç¨‹ä¼šè¿›è¡Œé˜»å¡ï¼Œè·å¾—äº†é”çš„çº¿ç¨‹ä»–ä¼šå¼€å¯ä¸€ä¸ª çº¿ç¨‹å»è¿›è¡Œ ä»¥å‰çš„é‡æ„æ•°æ®çš„é€»è¾‘ï¼Œç›´åˆ°æ–°å¼€çš„çº¿ç¨‹å®Œæˆè¿™ä¸ªé€»è¾‘åï¼Œæ‰é‡Šæ”¾é”ï¼Œ è€Œçº¿ç¨‹1ç›´æ¥è¿›è¡Œè¿”å›ï¼Œå‡è®¾ç°åœ¨çº¿ç¨‹3è¿‡æ¥è®¿é—®ï¼Œç”±äºçº¿ç¨‹çº¿ç¨‹2æŒæœ‰ç€é”ï¼Œæ‰€ä»¥çº¿ç¨‹3æ— æ³•è·å¾—é”ï¼Œçº¿ç¨‹3ä¹Ÿç›´æ¥è¿”å›æ•°æ®ï¼Œåªæœ‰ç­‰åˆ°æ–°å¼€çš„çº¿ç¨‹2æŠŠé‡å»ºæ•°æ®æ„å»ºå®Œåï¼Œå…¶ä»–çº¿ç¨‹æ‰èƒ½èµ°è¿”å›æ­£ç¡®çš„æ•°æ®ã€‚</p><p>è¿™ç§æ–¹æ¡ˆå·§å¦™åœ¨äºï¼Œå¼‚æ­¥çš„æ„å»ºç¼“å­˜ï¼Œç¼ºç‚¹åœ¨äºåœ¨æ„å»ºå®Œç¼“å­˜ä¹‹å‰ï¼Œè¿”å›çš„éƒ½æ˜¯è„æ•°æ®ã€‚</p><p><img src="/20221205120000/1653328663897.png" alt="1653328663897"></p><p>è¿›è¡Œå¯¹æ¯”</p><p><strong>äº’æ–¥é”æ–¹æ¡ˆï¼š</strong>ç”±äºä¿è¯äº†äº’æ–¥æ€§ï¼Œæ‰€ä»¥æ•°æ®ä¸€è‡´ï¼Œä¸”å®ç°ç®€å•ï¼Œå› ä¸ºä»…ä»…åªéœ€è¦åŠ ä¸€æŠŠé”è€Œå·²ï¼Œä¹Ÿæ²¡å…¶ä»–çš„äº‹æƒ…éœ€è¦æ“å¿ƒï¼Œæ‰€ä»¥æ²¡æœ‰é¢å¤–çš„å†…å­˜æ¶ˆè€—ï¼Œç¼ºç‚¹åœ¨äºæœ‰é”å°±æœ‰æ­»é”é—®é¢˜çš„å‘ç”Ÿï¼Œä¸”åªèƒ½ä¸²è¡Œæ‰§è¡Œæ€§èƒ½è‚¯å®šå—åˆ°å½±å“</p><p><strong>é€»è¾‘è¿‡æœŸæ–¹æ¡ˆï¼š</strong> çº¿ç¨‹è¯»å–è¿‡ç¨‹ä¸­ä¸éœ€è¦ç­‰å¾…ï¼Œæ€§èƒ½å¥½ï¼Œæœ‰ä¸€ä¸ªé¢å¤–çš„çº¿ç¨‹æŒæœ‰é”å»è¿›è¡Œé‡æ„æ•°æ®ï¼Œä½†æ˜¯åœ¨é‡æ„æ•°æ®å®Œæˆå‰ï¼Œå…¶ä»–çš„çº¿ç¨‹åªèƒ½è¿”å›ä¹‹å‰çš„æ•°æ®ï¼Œä¸”å®ç°èµ·æ¥éº»çƒ¦</p><p><img src="/20221205120000/1653357522914.png" alt="1653357522914"></p><h3 id="2-9-åˆ©ç”¨äº’æ–¥é”è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜"><a href="#2-9-åˆ©ç”¨äº’æ–¥é”è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜" class="headerlink" title="2.9 åˆ©ç”¨äº’æ–¥é”è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜"></a>2.9 åˆ©ç”¨äº’æ–¥é”è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</h3><p>æ ¸å¿ƒæ€è·¯ï¼šç›¸è¾ƒäºåŸæ¥ä»ç¼“å­˜ä¸­æŸ¥è¯¢ä¸åˆ°æ•°æ®åç›´æ¥æŸ¥è¯¢æ•°æ®åº“è€Œè¨€ï¼Œç°åœ¨çš„æ–¹æ¡ˆæ˜¯ è¿›è¡ŒæŸ¥è¯¢ä¹‹åï¼Œå¦‚æœä»ç¼“å­˜æ²¡æœ‰æŸ¥è¯¢åˆ°æ•°æ®ï¼Œåˆ™è¿›è¡Œäº’æ–¥é”çš„è·å–ï¼Œè·å–äº’æ–¥é”åï¼Œåˆ¤æ–­æ˜¯å¦è·å¾—åˆ°äº†é”ï¼Œå¦‚æœæ²¡æœ‰è·å¾—åˆ°ï¼Œåˆ™ä¼‘çœ ï¼Œè¿‡ä¸€ä¼šå†è¿›è¡Œå°è¯•ï¼Œç›´åˆ°è·å–åˆ°é”ä¸ºæ­¢ï¼Œæ‰èƒ½è¿›è¡ŒæŸ¥è¯¢</p><p>å¦‚æœè·å–åˆ°äº†é”çš„çº¿ç¨‹ï¼Œå†å»è¿›è¡ŒæŸ¥è¯¢ï¼ŒæŸ¥è¯¢åå°†æ•°æ®å†™å…¥redisï¼Œå†é‡Šæ”¾é”ï¼Œè¿”å›æ•°æ®ï¼Œåˆ©ç”¨äº’æ–¥é”å°±èƒ½ä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œæ“ä½œæ•°æ®åº“çš„é€»è¾‘ï¼Œé˜²æ­¢ç¼“å­˜å‡»ç©¿</p><p><img src="/20221205120000/1653357860001.png" alt="1653357860001"></p><p><strong>æ“ä½œé”çš„ä»£ç ï¼š</strong></p><p>æ ¸å¿ƒæ€è·¯å°±æ˜¯åˆ©ç”¨redisçš„setnxæ–¹æ³•æ¥è¡¨ç¤ºè·å–é”ï¼Œè¯¥æ–¹æ³•å«ä¹‰æ˜¯redisä¸­å¦‚æœæ²¡æœ‰è¿™ä¸ªkeyï¼Œåˆ™æ’å…¥æˆåŠŸï¼Œè¿”å›1ï¼Œåœ¨stringRedisTemplateä¸­è¿”å›trueï¼Œ  å¦‚æœæœ‰è¿™ä¸ªkeyåˆ™æ’å…¥å¤±è´¥ï¼Œåˆ™è¿”å›0ï¼Œåœ¨stringRedisTemplateè¿”å›falseï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡trueï¼Œæˆ–è€…æ˜¯falseï¼Œæ¥è¡¨ç¤ºæ˜¯å¦æœ‰çº¿ç¨‹æˆåŠŸæ’å…¥keyï¼ŒæˆåŠŸæ’å…¥çš„keyçš„çº¿ç¨‹æˆ‘ä»¬è®¤ä¸ºä»–å°±æ˜¯è·å¾—åˆ°é”çš„çº¿ç¨‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(String key)</span> &#123;<br>    <span class="hljs-type">Boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue().setIfAbsent(key, <span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-number">10</span>, TimeUnit.SECONDS);<br>    <span class="hljs-keyword">return</span> BooleanUtil.isTrue(flag);<br>&#125;<br><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">(String key)</span> &#123;<br>    stringRedisTemplate.delete(key);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ“ä½œä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> Shop <span class="hljs-title function_">queryWithMutex</span><span class="hljs-params">(Long id)</span>  &#123;<br>       <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> CACHE_SHOP_KEY + id;<br>       <span class="hljs-comment">// 1ã€ä»redisä¸­æŸ¥è¯¢å•†é“ºç¼“å­˜</span><br>       <span class="hljs-type">String</span> <span class="hljs-variable">shopJson</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue().get(<span class="hljs-string">&quot;key&quot;</span>);<br>       <span class="hljs-comment">// 2ã€åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span><br>       <span class="hljs-keyword">if</span> (StrUtil.isNotBlank(shopJson)) &#123;<br>           <span class="hljs-comment">// å­˜åœ¨,ç›´æ¥è¿”å›</span><br>           <span class="hljs-keyword">return</span> JSONUtil.toBean(shopJson, Shop.class);<br>       &#125;<br>       <span class="hljs-comment">//åˆ¤æ–­å‘½ä¸­çš„å€¼æ˜¯å¦æ˜¯ç©ºå€¼</span><br>       <span class="hljs-keyword">if</span> (shopJson != <span class="hljs-literal">null</span>) &#123;<br>           <span class="hljs-comment">//è¿”å›ä¸€ä¸ªé”™è¯¯ä¿¡æ¯</span><br>           <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>       &#125;<br>       <span class="hljs-comment">// 4.å®ç°ç¼“å­˜é‡æ„</span><br>       <span class="hljs-comment">//4.1 è·å–äº’æ–¥é”</span><br>       <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;lock:shop:&quot;</span> + id;<br>       <span class="hljs-type">Shop</span> <span class="hljs-variable">shop</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>       <span class="hljs-keyword">try</span> &#123;<br>           <span class="hljs-type">boolean</span> <span class="hljs-variable">isLock</span> <span class="hljs-operator">=</span> tryLock(lockKey);<br>           <span class="hljs-comment">// 4.2 åˆ¤æ–­å¦è·å–æˆåŠŸ</span><br>           <span class="hljs-keyword">if</span>(!isLock)&#123;<br>               <span class="hljs-comment">//4.3 å¤±è´¥ï¼Œåˆ™ä¼‘çœ é‡è¯•</span><br>               Thread.sleep(<span class="hljs-number">50</span>);<br>               <span class="hljs-keyword">return</span> queryWithMutex(id);<br>           &#125;<br>           <span class="hljs-comment">//4.4 æˆåŠŸï¼Œæ ¹æ®idæŸ¥è¯¢æ•°æ®åº“</span><br>            shop = getById(id);<br>           <span class="hljs-comment">// 5.ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯</span><br>           <span class="hljs-keyword">if</span>(shop == <span class="hljs-literal">null</span>)&#123;<br>                <span class="hljs-comment">//å°†ç©ºå€¼å†™å…¥redis</span><br>               stringRedisTemplate.opsForValue().set(key,<span class="hljs-string">&quot;&quot;</span>,CACHE_NULL_TTL,TimeUnit.MINUTES);<br>               <span class="hljs-comment">//è¿”å›é”™è¯¯ä¿¡æ¯</span><br>               <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>           &#125;<br>           <span class="hljs-comment">//6.å†™å…¥redis</span><br>           stringRedisTemplate.opsForValue().set(key,JSONUtil.toJsonStr(shop),CACHE_NULL_TTL,TimeUnit.MINUTES);<br><br>       &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>           <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>       &#125;<br>       <span class="hljs-keyword">finally</span> &#123;<br>           <span class="hljs-comment">//7.é‡Šæ”¾äº’æ–¥é”</span><br>           unlock(lockKey);<br>       &#125;<br>       <span class="hljs-keyword">return</span> shop;<br>   &#125;<br></code></pre></td></tr></table></figure><h3 id="3-0-ã€åˆ©ç”¨é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜"><a href="#3-0-ã€åˆ©ç”¨é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜" class="headerlink" title="3.0 ã€åˆ©ç”¨é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜"></a>3.0 ã€åˆ©ç”¨é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</h3><p><strong>éœ€æ±‚ï¼šä¿®æ”¹æ ¹æ®idæŸ¥è¯¢å•†é“ºçš„ä¸šåŠ¡ï¼ŒåŸºäºé€»è¾‘è¿‡æœŸæ–¹å¼æ¥è§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</strong></p><p>æ€è·¯åˆ†æï¼šå½“ç”¨æˆ·å¼€å§‹æŸ¥è¯¢redisæ—¶ï¼Œåˆ¤æ–­æ˜¯å¦å‘½ä¸­ï¼Œå¦‚æœæ²¡æœ‰å‘½ä¸­åˆ™ç›´æ¥è¿”å›ç©ºæ•°æ®ï¼Œä¸æŸ¥è¯¢æ•°æ®åº“ï¼Œè€Œä¸€æ—¦å‘½ä¸­åï¼Œå°†valueå–å‡ºï¼Œåˆ¤æ–­valueä¸­çš„è¿‡æœŸæ—¶é—´æ˜¯å¦æ»¡è¶³ï¼Œå¦‚æœæ²¡æœ‰è¿‡æœŸï¼Œåˆ™ç›´æ¥è¿”å›redisä¸­çš„æ•°æ®ï¼Œå¦‚æœè¿‡æœŸï¼Œåˆ™åœ¨å¼€å¯ç‹¬ç«‹çº¿ç¨‹åç›´æ¥è¿”å›ä¹‹å‰çš„æ•°æ®ï¼Œç‹¬ç«‹çº¿ç¨‹å»é‡æ„æ•°æ®ï¼Œé‡æ„å®Œæˆåé‡Šæ”¾äº’æ–¥é”ã€‚</p><p><img src="/20221205120000/1653360308731.png" alt="1653360308731"></p><p>å¦‚æœå°è£…æ•°æ®ï¼šå› ä¸ºç°åœ¨redisä¸­å­˜å‚¨çš„æ•°æ®çš„valueéœ€è¦å¸¦ä¸Šè¿‡æœŸæ—¶é—´ï¼Œæ­¤æ—¶è¦ä¹ˆä½ å»ä¿®æ”¹åŸæ¥çš„å®ä½“ç±»ï¼Œè¦ä¹ˆä½ </p><p><strong>æ­¥éª¤ä¸€ã€</strong></p><p>æ–°å»ºä¸€ä¸ªå®ä½“ç±»ï¼Œæˆ‘ä»¬é‡‡ç”¨ç¬¬äºŒä¸ªæ–¹æ¡ˆï¼Œè¿™ä¸ªæ–¹æ¡ˆï¼Œå¯¹åŸæ¥ä»£ç æ²¡æœ‰ä¾µå…¥æ€§ã€‚</p><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisData</span> &#123;<br>    <span class="hljs-keyword">private</span> LocalDateTime expireTime;<br>    <span class="hljs-keyword">private</span> Object <span class="hljs-keyword">data</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ­¥éª¤äºŒã€</strong></p><p>åœ¨<strong>ShopServiceImpl</strong> æ–°å¢æ­¤æ–¹æ³•ï¼Œåˆ©ç”¨å•å…ƒæµ‹è¯•è¿›è¡Œç¼“å­˜é¢„çƒ­</p><p><img src="/20221205120000/1653360807133.png" alt="1653360807133"></p><p><strong>åœ¨æµ‹è¯•ç±»ä¸­</strong></p><p><img src="/20221205120000/1653360864839.png" alt="1653360864839"></p><p>æ­¥éª¤ä¸‰ï¼šæ­£å¼ä»£ç </p><p><strong>ShopServiceImpl</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">CACHE_REBUILD_EXECUTOR</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">10</span>);<br><span class="hljs-keyword">public</span> Shop <span class="hljs-title function_">queryWithLogicalExpire</span><span class="hljs-params">( Long id )</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> CACHE_SHOP_KEY + id;<br>    <span class="hljs-comment">// 1.ä»redisæŸ¥è¯¢å•†é“ºç¼“å­˜</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue().get(key);<br>    <span class="hljs-comment">// 2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span><br>    <span class="hljs-keyword">if</span> (StrUtil.isBlank(json)) &#123;<br>        <span class="hljs-comment">// 3.å­˜åœ¨ï¼Œç›´æ¥è¿”å›</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br>    <span class="hljs-comment">// 4.å‘½ä¸­ï¼Œéœ€è¦å…ˆæŠŠjsonååºåˆ—åŒ–ä¸ºå¯¹è±¡</span><br>    <span class="hljs-type">RedisData</span> <span class="hljs-variable">redisData</span> <span class="hljs-operator">=</span> JSONUtil.toBean(json, RedisData.class);<br>    <span class="hljs-type">Shop</span> <span class="hljs-variable">shop</span> <span class="hljs-operator">=</span> JSONUtil.toBean((JSONObject) redisData.getData(), Shop.class);<br>    <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">expireTime</span> <span class="hljs-operator">=</span> redisData.getExpireTime();<br>    <span class="hljs-comment">// 5.åˆ¤æ–­æ˜¯å¦è¿‡æœŸ</span><br>    <span class="hljs-keyword">if</span>(expireTime.isAfter(LocalDateTime.now())) &#123;<br>        <span class="hljs-comment">// 5.1.æœªè¿‡æœŸï¼Œç›´æ¥è¿”å›åº—é“ºä¿¡æ¯</span><br>        <span class="hljs-keyword">return</span> shop;<br>    &#125;<br>    <span class="hljs-comment">// 5.2.å·²è¿‡æœŸï¼Œéœ€è¦ç¼“å­˜é‡å»º</span><br>    <span class="hljs-comment">// 6.ç¼“å­˜é‡å»º</span><br>    <span class="hljs-comment">// 6.1.è·å–äº’æ–¥é”</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> LOCK_SHOP_KEY + id;<br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">isLock</span> <span class="hljs-operator">=</span> tryLock(lockKey);<br>    <span class="hljs-comment">// 6.2.åˆ¤æ–­æ˜¯å¦è·å–é”æˆåŠŸ</span><br>    <span class="hljs-keyword">if</span> (isLock)&#123;<br>        CACHE_REBUILD_EXECUTOR.submit( ()-&gt;&#123;<br><br>            <span class="hljs-keyword">try</span>&#123;<br>                <span class="hljs-comment">//é‡å»ºç¼“å­˜</span><br>                <span class="hljs-built_in">this</span>.saveShop2Redis(id,<span class="hljs-number">20L</span>);<br>            &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>            &#125;<span class="hljs-keyword">finally</span> &#123;<br>                unlock(lockKey);<br>            &#125;<br>        &#125;);<br>    &#125;<br>    <span class="hljs-comment">// 6.4.è¿”å›è¿‡æœŸçš„å•†é“ºä¿¡æ¯</span><br>    <span class="hljs-keyword">return</span> shop;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-1ã€å°è£…Rediså·¥å…·ç±»"><a href="#3-1ã€å°è£…Rediså·¥å…·ç±»" class="headerlink" title="3.1ã€å°è£…Rediså·¥å…·ç±»"></a>3.1ã€å°è£…Rediså·¥å…·ç±»</h3><p>åŸºäºStringRedisTemplateå°è£…ä¸€ä¸ªç¼“å­˜å·¥å…·ç±»ï¼Œæ»¡è¶³ä¸‹åˆ—éœ€æ±‚ï¼š</p><ul><li>æ–¹æ³•1ï¼šå°†ä»»æ„Javaå¯¹è±¡åºåˆ—åŒ–ä¸ºjsonå¹¶å­˜å‚¨åœ¨stringç±»å‹çš„keyä¸­ï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®TTLè¿‡æœŸæ—¶é—´</li><li>æ–¹æ³•2ï¼šå°†ä»»æ„Javaå¯¹è±¡åºåˆ—åŒ–ä¸ºjsonå¹¶å­˜å‚¨åœ¨stringç±»å‹çš„keyä¸­ï¼Œå¹¶ä¸”å¯ä»¥è®¾ç½®é€»è¾‘è¿‡æœŸæ—¶é—´ï¼Œç”¨äºå¤„ç†ç¼“</li></ul><p>å­˜å‡»ç©¿é—®é¢˜</p><ul><li>æ–¹æ³•3ï¼šæ ¹æ®æŒ‡å®šçš„keyæŸ¥è¯¢ç¼“å­˜ï¼Œå¹¶ååºåˆ—åŒ–ä¸ºæŒ‡å®šç±»å‹ï¼Œåˆ©ç”¨ç¼“å­˜ç©ºå€¼çš„æ–¹å¼è§£å†³ç¼“å­˜ç©¿é€é—®é¢˜</li><li>æ–¹æ³•4ï¼šæ ¹æ®æŒ‡å®šçš„keyæŸ¥è¯¢ç¼“å­˜ï¼Œå¹¶ååºåˆ—åŒ–ä¸ºæŒ‡å®šç±»å‹ï¼Œéœ€è¦åˆ©ç”¨é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿é—®é¢˜</li></ul><p>å°†é€»è¾‘è¿›è¡Œå°è£…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheClient</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> StringRedisTemplate stringRedisTemplate;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">CACHE_REBUILD_EXECUTOR</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">10</span>);<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CacheClient</span><span class="hljs-params">(StringRedisTemplate stringRedisTemplate)</span> &#123;<br>        <span class="hljs-built_in">this</span>.stringRedisTemplate = stringRedisTemplate;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(String key, Object value, Long time, TimeUnit unit)</span> &#123;<br>        stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(value), time, unit);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setWithLogicalExpire</span><span class="hljs-params">(String key, Object value, Long time, TimeUnit unit)</span> &#123;<br>        <span class="hljs-comment">// è®¾ç½®é€»è¾‘è¿‡æœŸ</span><br>        <span class="hljs-type">RedisData</span> <span class="hljs-variable">redisData</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisData</span>();<br>        redisData.setData(value);<br>        redisData.setExpireTime(LocalDateTime.now().plusSeconds(unit.toSeconds(time)));<br>        <span class="hljs-comment">// å†™å…¥Redis</span><br>        stringRedisTemplate.opsForValue().set(key, JSONUtil.toJsonStr(redisData));<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> &lt;R,ID&gt; R <span class="hljs-title function_">queryWithPassThrough</span><span class="hljs-params">(</span><br><span class="hljs-params">            String keyPrefix, ID id, Class&lt;R&gt; type, Function&lt;ID, R&gt; dbFallback, Long time, TimeUnit unit)</span>&#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> keyPrefix + id;<br>        <span class="hljs-comment">// 1.ä»redisæŸ¥è¯¢å•†é“ºç¼“å­˜</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue().get(key);<br>        <span class="hljs-comment">// 2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span><br>        <span class="hljs-keyword">if</span> (StrUtil.isNotBlank(json)) &#123;<br>            <span class="hljs-comment">// 3.å­˜åœ¨ï¼Œç›´æ¥è¿”å›</span><br>            <span class="hljs-keyword">return</span> JSONUtil.toBean(json, type);<br>        &#125;<br>        <span class="hljs-comment">// åˆ¤æ–­å‘½ä¸­çš„æ˜¯å¦æ˜¯ç©ºå€¼</span><br>        <span class="hljs-keyword">if</span> (json != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// è¿”å›ä¸€ä¸ªé”™è¯¯ä¿¡æ¯</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 4.ä¸å­˜åœ¨ï¼Œæ ¹æ®idæŸ¥è¯¢æ•°æ®åº“</span><br>        <span class="hljs-type">R</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> dbFallback.apply(id);<br>        <span class="hljs-comment">// 5.ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯</span><br>        <span class="hljs-keyword">if</span> (r == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// å°†ç©ºå€¼å†™å…¥redis</span><br>            stringRedisTemplate.opsForValue().set(key, <span class="hljs-string">&quot;&quot;</span>, CACHE_NULL_TTL, TimeUnit.MINUTES);<br>            <span class="hljs-comment">// è¿”å›é”™è¯¯ä¿¡æ¯</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-comment">// 6.å­˜åœ¨ï¼Œå†™å…¥redis</span><br>        <span class="hljs-built_in">this</span>.set(key, r, time, unit);<br>        <span class="hljs-keyword">return</span> r;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> &lt;R, ID&gt; R <span class="hljs-title function_">queryWithLogicalExpire</span><span class="hljs-params">(</span><br><span class="hljs-params">            String keyPrefix, ID id, Class&lt;R&gt; type, Function&lt;ID, R&gt; dbFallback, Long time, TimeUnit unit)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> keyPrefix + id;<br>        <span class="hljs-comment">// 1.ä»redisæŸ¥è¯¢å•†é“ºç¼“å­˜</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">json</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue().get(key);<br>        <span class="hljs-comment">// 2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span><br>        <span class="hljs-keyword">if</span> (StrUtil.isBlank(json)) &#123;<br>            <span class="hljs-comment">// 3.å­˜åœ¨ï¼Œç›´æ¥è¿”å›</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-comment">// 4.å‘½ä¸­ï¼Œéœ€è¦å…ˆæŠŠjsonååºåˆ—åŒ–ä¸ºå¯¹è±¡</span><br>        <span class="hljs-type">RedisData</span> <span class="hljs-variable">redisData</span> <span class="hljs-operator">=</span> JSONUtil.toBean(json, RedisData.class);<br>        <span class="hljs-type">R</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> JSONUtil.toBean((JSONObject) redisData.getData(), type);<br>        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">expireTime</span> <span class="hljs-operator">=</span> redisData.getExpireTime();<br>        <span class="hljs-comment">// 5.åˆ¤æ–­æ˜¯å¦è¿‡æœŸ</span><br>        <span class="hljs-keyword">if</span>(expireTime.isAfter(LocalDateTime.now())) &#123;<br>            <span class="hljs-comment">// 5.1.æœªè¿‡æœŸï¼Œç›´æ¥è¿”å›åº—é“ºä¿¡æ¯</span><br>            <span class="hljs-keyword">return</span> r;<br>        &#125;<br>        <span class="hljs-comment">// 5.2.å·²è¿‡æœŸï¼Œéœ€è¦ç¼“å­˜é‡å»º</span><br>        <span class="hljs-comment">// 6.ç¼“å­˜é‡å»º</span><br>        <span class="hljs-comment">// 6.1.è·å–äº’æ–¥é”</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> LOCK_SHOP_KEY + id;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">isLock</span> <span class="hljs-operator">=</span> tryLock(lockKey);<br>        <span class="hljs-comment">// 6.2.åˆ¤æ–­æ˜¯å¦è·å–é”æˆåŠŸ</span><br>        <span class="hljs-keyword">if</span> (isLock)&#123;<br>            <span class="hljs-comment">// 6.3.æˆåŠŸï¼Œå¼€å¯ç‹¬ç«‹çº¿ç¨‹ï¼Œå®ç°ç¼“å­˜é‡å»º</span><br>            CACHE_REBUILD_EXECUTOR.submit(() -&gt; &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-comment">// æŸ¥è¯¢æ•°æ®åº“</span><br>                    <span class="hljs-type">R</span> <span class="hljs-variable">newR</span> <span class="hljs-operator">=</span> dbFallback.apply(id);<br>                    <span class="hljs-comment">// é‡å»ºç¼“å­˜</span><br>                    <span class="hljs-built_in">this</span>.setWithLogicalExpire(key, newR, time, unit);<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>                &#125;<span class="hljs-keyword">finally</span> &#123;<br>                    <span class="hljs-comment">// é‡Šæ”¾é”</span><br>                    unlock(lockKey);<br>                &#125;<br>            &#125;);<br>        &#125;<br>        <span class="hljs-comment">// 6.4.è¿”å›è¿‡æœŸçš„å•†é“ºä¿¡æ¯</span><br>        <span class="hljs-keyword">return</span> r;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> &lt;R, ID&gt; R <span class="hljs-title function_">queryWithMutex</span><span class="hljs-params">(</span><br><span class="hljs-params">            String keyPrefix, ID id, Class&lt;R&gt; type, Function&lt;ID, R&gt; dbFallback, Long time, TimeUnit unit)</span> &#123;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> keyPrefix + id;<br>        <span class="hljs-comment">// 1.ä»redisæŸ¥è¯¢å•†é“ºç¼“å­˜</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">shopJson</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue().get(key);<br>        <span class="hljs-comment">// 2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span><br>        <span class="hljs-keyword">if</span> (StrUtil.isNotBlank(shopJson)) &#123;<br>            <span class="hljs-comment">// 3.å­˜åœ¨ï¼Œç›´æ¥è¿”å›</span><br>            <span class="hljs-keyword">return</span> JSONUtil.toBean(shopJson, type);<br>        &#125;<br>        <span class="hljs-comment">// åˆ¤æ–­å‘½ä¸­çš„æ˜¯å¦æ˜¯ç©ºå€¼</span><br>        <span class="hljs-keyword">if</span> (shopJson != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// è¿”å›ä¸€ä¸ªé”™è¯¯ä¿¡æ¯</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br><br>        <span class="hljs-comment">// 4.å®ç°ç¼“å­˜é‡å»º</span><br>        <span class="hljs-comment">// 4.1.è·å–äº’æ–¥é”</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> LOCK_SHOP_KEY + id;<br>        <span class="hljs-type">R</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">isLock</span> <span class="hljs-operator">=</span> tryLock(lockKey);<br>            <span class="hljs-comment">// 4.2.åˆ¤æ–­æ˜¯å¦è·å–æˆåŠŸ</span><br>            <span class="hljs-keyword">if</span> (!isLock) &#123;<br>                <span class="hljs-comment">// 4.3.è·å–é”å¤±è´¥ï¼Œä¼‘çœ å¹¶é‡è¯•</span><br>                Thread.sleep(<span class="hljs-number">50</span>);<br>                <span class="hljs-keyword">return</span> queryWithMutex(keyPrefix, id, type, dbFallback, time, unit);<br>            &#125;<br>            <span class="hljs-comment">// 4.4.è·å–é”æˆåŠŸï¼Œæ ¹æ®idæŸ¥è¯¢æ•°æ®åº“</span><br>            r = dbFallback.apply(id);<br>            <span class="hljs-comment">// 5.ä¸å­˜åœ¨ï¼Œè¿”å›é”™è¯¯</span><br>            <span class="hljs-keyword">if</span> (r == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-comment">// å°†ç©ºå€¼å†™å…¥redis</span><br>                stringRedisTemplate.opsForValue().set(key, <span class="hljs-string">&quot;&quot;</span>, CACHE_NULL_TTL, TimeUnit.MINUTES);<br>                <span class="hljs-comment">// è¿”å›é”™è¯¯ä¿¡æ¯</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>            &#125;<br>            <span class="hljs-comment">// 6.å­˜åœ¨ï¼Œå†™å…¥redis</span><br>            <span class="hljs-built_in">this</span>.set(key, r, time, unit);<br>        &#125; <span class="hljs-keyword">catch</span> (InterruptedException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(e);<br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-comment">// 7.é‡Šæ”¾é”</span><br>            unlock(lockKey);<br>        &#125;<br>        <span class="hljs-comment">// 8.è¿”å›</span><br>        <span class="hljs-keyword">return</span> r;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(String key)</span> &#123;<br>        <span class="hljs-type">Boolean</span> <span class="hljs-variable">flag</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue().setIfAbsent(key, <span class="hljs-string">&quot;1&quot;</span>, <span class="hljs-number">10</span>, TimeUnit.SECONDS);<br>        <span class="hljs-keyword">return</span> BooleanUtil.isTrue(flag);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">(String key)</span> &#123;<br>        stringRedisTemplate.delete(key);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ShopServiceImpl ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Resource</span><br><span class="hljs-keyword">private</span> CacheClient cacheClient;<br><br> <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryById</span><span class="hljs-params">(Long id)</span> &#123;<br>        <span class="hljs-comment">// è§£å†³ç¼“å­˜ç©¿é€</span><br>        <span class="hljs-type">Shop</span> <span class="hljs-variable">shop</span> <span class="hljs-operator">=</span> cacheClient<br>                .queryWithPassThrough(CACHE_SHOP_KEY, id, Shop.class, <span class="hljs-built_in">this</span>::getById, CACHE_SHOP_TTL, TimeUnit.MINUTES);<br><br>        <span class="hljs-comment">// äº’æ–¥é”è§£å†³ç¼“å­˜å‡»ç©¿</span><br>        <span class="hljs-comment">// Shop shop = cacheClient</span><br>        <span class="hljs-comment">//         .queryWithMutex(CACHE_SHOP_KEY, id, Shop.class, this::getById, CACHE_SHOP_TTL, TimeUnit.MINUTES);</span><br><br>        <span class="hljs-comment">// é€»è¾‘è¿‡æœŸè§£å†³ç¼“å­˜å‡»ç©¿</span><br>        <span class="hljs-comment">// Shop shop = cacheClient</span><br>        <span class="hljs-comment">//         .queryWithLogicalExpire(CACHE_SHOP_KEY, id, Shop.class, this::getById, 20L, TimeUnit.SECONDS);</span><br><br>        <span class="hljs-keyword">if</span> (shop == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;åº—é“ºä¸å­˜åœ¨ï¼&quot;</span>);<br>        &#125;<br>        <span class="hljs-comment">// 7.è¿”å›</span><br>        <span class="hljs-keyword">return</span> Result.ok(shop);<br>    &#125;<br></code></pre></td></tr></table></figure><h2 id="3ã€ä¼˜æƒ åˆ¸ç§’æ€"><a href="#3ã€ä¼˜æƒ åˆ¸ç§’æ€" class="headerlink" title="3ã€ä¼˜æƒ åˆ¸ç§’æ€"></a>3ã€ä¼˜æƒ åˆ¸ç§’æ€</h2><h3 id="3-1-å…¨å±€å”¯ä¸€ID"><a href="#3-1-å…¨å±€å”¯ä¸€ID" class="headerlink" title="3.1 -å…¨å±€å”¯ä¸€ID"></a>3.1 -å…¨å±€å”¯ä¸€ID</h3><p>æ¯ä¸ªåº—é“ºéƒ½å¯ä»¥å‘å¸ƒä¼˜æƒ åˆ¸ï¼š</p><p><img src="/20221205120000/1653362612286.png" alt="1653362612286"></p><p>å½“ç”¨æˆ·æŠ¢è´­æ—¶ï¼Œå°±ä¼šç”Ÿæˆè®¢å•å¹¶ä¿å­˜åˆ°tb_voucher_orderè¿™å¼ è¡¨ä¸­ï¼Œè€Œè®¢å•è¡¨å¦‚æœä½¿ç”¨æ•°æ®åº“è‡ªå¢IDå°±å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</p><ul><li>idçš„è§„å¾‹æ€§å¤ªæ˜æ˜¾</li><li>å—å•è¡¨æ•°æ®é‡çš„é™åˆ¶</li></ul><p>åœºæ™¯åˆ†æï¼šå¦‚æœæˆ‘ä»¬çš„idå…·æœ‰å¤ªæ˜æ˜¾çš„è§„åˆ™ï¼Œç”¨æˆ·æˆ–è€…è¯´å•†ä¸šå¯¹æ‰‹å¾ˆå®¹æ˜“çŒœæµ‹å‡ºæ¥æˆ‘ä»¬çš„ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œæ¯”å¦‚å•†åŸåœ¨ä¸€å¤©æ—¶é—´å†…ï¼Œå–å‡ºäº†å¤šå°‘å•ï¼Œè¿™æ˜æ˜¾ä¸åˆé€‚ã€‚</p><p>åœºæ™¯åˆ†æäºŒï¼šéšç€æˆ‘ä»¬å•†åŸè§„æ¨¡è¶Šæ¥è¶Šå¤§ï¼Œmysqlçš„å•è¡¨çš„å®¹é‡ä¸å®œè¶…è¿‡500Wï¼Œæ•°æ®é‡è¿‡å¤§ä¹‹åï¼Œæˆ‘ä»¬è¦è¿›è¡Œæ‹†åº“æ‹†è¡¨ï¼Œä½†æ‹†åˆ†è¡¨äº†ä¹‹åï¼Œä»–ä»¬ä»é€»è¾‘ä¸Šè®²ä»–ä»¬æ˜¯åŒä¸€å¼ è¡¨ï¼Œæ‰€ä»¥ä»–ä»¬çš„idæ˜¯ä¸èƒ½ä¸€æ ·çš„ï¼Œ äºæ˜¯ä¹æˆ‘ä»¬éœ€è¦ä¿è¯idçš„å”¯ä¸€æ€§ã€‚</p><p><strong>å…¨å±€IDç”Ÿæˆå™¨</strong>ï¼Œæ˜¯ä¸€ç§åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ç”¨æ¥ç”Ÿæˆå…¨å±€å”¯ä¸€IDçš„å·¥å…·ï¼Œä¸€èˆ¬è¦æ»¡è¶³ä¸‹åˆ—ç‰¹æ€§ï¼š</p><p><img src="/20221205120000/1653363100502.png" alt="1653363100502"></p><p>ä¸ºäº†å¢åŠ IDçš„å®‰å…¨æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ç›´æ¥ä½¿ç”¨Redisè‡ªå¢çš„æ•°å€¼ï¼Œè€Œæ˜¯æ‹¼æ¥ä¸€äº›å…¶å®ƒä¿¡æ¯ï¼š</p><p><img src="/20221205120000/1653363172079.png" alt="1653363172079">IDçš„ç»„æˆéƒ¨åˆ†ï¼šç¬¦å·ä½ï¼š1bitï¼Œæ°¸è¿œä¸º0</p><p>æ—¶é—´æˆ³ï¼š31bitï¼Œä»¥ç§’ä¸ºå•ä½ï¼Œå¯ä»¥ä½¿ç”¨69å¹´</p><p>åºåˆ—å·ï¼š32bitï¼Œç§’å†…çš„è®¡æ•°å™¨ï¼Œæ”¯æŒæ¯ç§’äº§ç”Ÿ2^32ä¸ªä¸åŒID</p><h3 id="3-2-Rediså®ç°å…¨å±€å”¯ä¸€Id"><a href="#3-2-Rediså®ç°å…¨å±€å”¯ä¸€Id" class="headerlink" title="3.2 -Rediså®ç°å…¨å±€å”¯ä¸€Id"></a>3.2 -Rediså®ç°å…¨å±€å”¯ä¸€Id</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisIdWorker</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å¼€å§‹æ—¶é—´æˆ³</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">BEGIN_TIMESTAMP</span> <span class="hljs-operator">=</span> <span class="hljs-number">1640995200L</span>;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åºåˆ—å·çš„ä½æ•°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">COUNT_BITS</span> <span class="hljs-operator">=</span> <span class="hljs-number">32</span>;<br><br>    <span class="hljs-keyword">private</span> StringRedisTemplate stringRedisTemplate;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RedisIdWorker</span><span class="hljs-params">(StringRedisTemplate stringRedisTemplate)</span> &#123;<br>        <span class="hljs-built_in">this</span>.stringRedisTemplate = stringRedisTemplate;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">long</span> <span class="hljs-title function_">nextId</span><span class="hljs-params">(String keyPrefix)</span> &#123;<br>        <span class="hljs-comment">// 1.ç”Ÿæˆæ—¶é—´æˆ³</span><br>        <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();<br>        <span class="hljs-type">long</span> <span class="hljs-variable">nowSecond</span> <span class="hljs-operator">=</span> now.toEpochSecond(ZoneOffset.UTC);<br>        <span class="hljs-type">long</span> <span class="hljs-variable">timestamp</span> <span class="hljs-operator">=</span> nowSecond - BEGIN_TIMESTAMP;<br><br>        <span class="hljs-comment">// 2.ç”Ÿæˆåºåˆ—å·</span><br>        <span class="hljs-comment">// 2.1.è·å–å½“å‰æ—¥æœŸï¼Œç²¾ç¡®åˆ°å¤©</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">date</span> <span class="hljs-operator">=</span> now.format(DateTimeFormatter.ofPattern(<span class="hljs-string">&quot;yyyy:MM:dd&quot;</span>));<br>        <span class="hljs-comment">// 2.2.è‡ªå¢é•¿</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue().increment(<span class="hljs-string">&quot;icr:&quot;</span> + keyPrefix + <span class="hljs-string">&quot;:&quot;</span> + date);<br><br>        <span class="hljs-comment">// 3.æ‹¼æ¥å¹¶è¿”å›</span><br>        <span class="hljs-keyword">return</span> timestamp &lt;&lt; COUNT_BITS | count;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æµ‹è¯•ç±»</p><p>çŸ¥è¯†å°è´´å£«ï¼šå…³äºcountdownlatch</p><p>countdownlatchåä¸ºä¿¡å·æªï¼šä¸»è¦çš„ä½œç”¨æ˜¯åŒæ­¥åè°ƒåœ¨å¤šçº¿ç¨‹çš„ç­‰å¾…äºå”¤é†’é—®é¢˜</p><p>æˆ‘ä»¬å¦‚æœæ²¡æœ‰CountDownLatch ï¼Œé‚£ä¹ˆç”±äºç¨‹åºæ˜¯å¼‚æ­¥çš„ï¼Œå½“å¼‚æ­¥ç¨‹åºæ²¡æœ‰æ‰§è¡Œå®Œæ—¶ï¼Œä¸»çº¿ç¨‹å°±å·²ç»æ‰§è¡Œå®Œäº†ï¼Œç„¶åæˆ‘ä»¬æœŸæœ›çš„æ˜¯åˆ†çº¿ç¨‹å…¨éƒ¨èµ°å®Œä¹‹åï¼Œä¸»çº¿ç¨‹å†èµ°ï¼Œæ‰€ä»¥æˆ‘ä»¬æ­¤æ—¶éœ€è¦ä½¿ç”¨åˆ°CountDownLatch</p><p>CountDownLatch ä¸­æœ‰ä¸¤ä¸ªæœ€é‡è¦çš„æ–¹æ³•</p><p>1ã€countDown</p><p>2ã€await</p><p>await æ–¹æ³• æ˜¯é˜»å¡æ–¹æ³•ï¼Œæˆ‘ä»¬æ‹…å¿ƒåˆ†çº¿ç¨‹æ²¡æœ‰æ‰§è¡Œå®Œæ—¶ï¼Œmainçº¿ç¨‹å°±å…ˆæ‰§è¡Œï¼Œæ‰€ä»¥ä½¿ç”¨awaitå¯ä»¥è®©mainçº¿ç¨‹é˜»å¡ï¼Œé‚£ä¹ˆä»€ä¹ˆæ—¶å€™mainçº¿ç¨‹ä¸å†é˜»å¡å‘¢ï¼Ÿå½“CountDownLatch  å†…éƒ¨ç»´æŠ¤çš„ å˜é‡å˜ä¸º0æ—¶ï¼Œå°±ä¸å†é˜»å¡ï¼Œç›´æ¥æ”¾è¡Œï¼Œé‚£ä¹ˆä»€ä¹ˆæ—¶å€™CountDownLatch   ç»´æŠ¤çš„å˜é‡å˜ä¸º0 å‘¢ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒç”¨ä¸€æ¬¡countDown ï¼Œå†…éƒ¨å˜é‡å°±å‡å°‘1ï¼Œæˆ‘ä»¬è®©åˆ†çº¿ç¨‹å’Œå˜é‡ç»‘å®šï¼Œ æ‰§è¡Œå®Œä¸€ä¸ªåˆ†çº¿ç¨‹å°±å‡å°‘ä¸€ä¸ªå˜é‡ï¼Œå½“åˆ†çº¿ç¨‹å…¨éƒ¨èµ°å®Œï¼ŒCountDownLatch ç»´æŠ¤çš„å˜é‡å°±æ˜¯0ï¼Œæ­¤æ—¶awaitå°±ä¸å†é˜»å¡ï¼Œç»Ÿè®¡å‡ºæ¥çš„æ—¶é—´ä¹Ÿå°±æ˜¯æ‰€æœ‰åˆ†çº¿ç¨‹æ‰§è¡Œå®Œåçš„æ—¶é—´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testIdWorker</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException &#123;<br>    <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">latch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">300</span>);<br><br>    <span class="hljs-type">Runnable</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> () -&gt; &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) &#123;<br>            <span class="hljs-type">long</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> redisIdWorker.nextId(<span class="hljs-string">&quot;order&quot;</span>);<br>            System.out.println(<span class="hljs-string">&quot;id = &quot;</span> + id);<br>        &#125;<br>        latch.countDown();<br>    &#125;;<br>    <span class="hljs-type">long</span> <span class="hljs-variable">begin</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">300</span>; i++) &#123;<br>        es.submit(task);<br>    &#125;<br>    latch.await();<br>    <span class="hljs-type">long</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> System.currentTimeMillis();<br>    System.out.println(<span class="hljs-string">&quot;time = &quot;</span> + (end - begin));<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-3-æ·»åŠ ä¼˜æƒ åˆ¸"><a href="#3-3-æ·»åŠ ä¼˜æƒ åˆ¸" class="headerlink" title="3.3 æ·»åŠ ä¼˜æƒ åˆ¸"></a>3.3 æ·»åŠ ä¼˜æƒ åˆ¸</h3><p>æ¯ä¸ªåº—é“ºéƒ½å¯ä»¥å‘å¸ƒä¼˜æƒ åˆ¸ï¼Œåˆ†ä¸ºå¹³ä»·åˆ¸å’Œç‰¹ä»·åˆ¸ã€‚å¹³ä»·åˆ¸å¯ä»¥ä»»æ„è´­ä¹°ï¼Œè€Œç‰¹ä»·åˆ¸éœ€è¦ç§’æ€æŠ¢è´­ï¼š</p><p><img src="/20221205120000/1653365145124.png" alt="1653365145124"></p><p>tb_voucherï¼šä¼˜æƒ åˆ¸çš„åŸºæœ¬ä¿¡æ¯ï¼Œä¼˜æƒ é‡‘é¢ã€ä½¿ç”¨è§„åˆ™ç­‰<br>tb_seckill_voucherï¼šä¼˜æƒ åˆ¸çš„åº“å­˜ã€å¼€å§‹æŠ¢è´­æ—¶é—´ï¼Œç»“æŸæŠ¢è´­æ—¶é—´ã€‚ç‰¹ä»·ä¼˜æƒ åˆ¸æ‰éœ€è¦å¡«å†™è¿™äº›ä¿¡æ¯</p><p>å¹³ä»·åˆ¸ç”±äºä¼˜æƒ åŠ›åº¦å¹¶ä¸æ˜¯å¾ˆå¤§ï¼Œæ‰€ä»¥æ˜¯å¯ä»¥ä»»æ„é¢†å–</p><p>è€Œä»£é‡‘åˆ¸ç”±äºä¼˜æƒ åŠ›åº¦å¤§ï¼Œæ‰€ä»¥åƒç¬¬äºŒç§åˆ¸ï¼Œå°±å¾—é™åˆ¶æ•°é‡ï¼Œä»è¡¨ç»“æ„ä¸Šä¹Ÿèƒ½çœ‹å‡ºï¼Œç‰¹ä»·åˆ¸é™¤äº†å…·æœ‰ä¼˜æƒ åˆ¸çš„åŸºæœ¬ä¿¡æ¯ä»¥å¤–ï¼Œè¿˜å…·æœ‰åº“å­˜ï¼ŒæŠ¢è´­æ—¶é—´ï¼Œç»“æŸæ—¶é—´ç­‰ç­‰å­—æ®µ</p><p>**æ–°å¢æ™®é€šåˆ¸ä»£ç ï¼š  **VoucherController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">addVoucher</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Voucher voucher)</span> &#123;<br>    voucherService.save(voucher);<br>    <span class="hljs-keyword">return</span> Result.ok(voucher.getId());<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æ–°å¢ç§’æ€åˆ¸ä»£ç ï¼š</strong></p><p><strong>VoucherController</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;seckill&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">addSeckillVoucher</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Voucher voucher)</span> &#123;<br>    voucherService.addSeckillVoucher(voucher);<br>    <span class="hljs-keyword">return</span> Result.ok(voucher.getId());<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>VoucherServiceImpl</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addSeckillVoucher</span><span class="hljs-params">(Voucher voucher)</span> &#123;<br>    <span class="hljs-comment">// ä¿å­˜ä¼˜æƒ åˆ¸</span><br>    save(voucher);<br>    <span class="hljs-comment">// ä¿å­˜ç§’æ€ä¿¡æ¯</span><br>    <span class="hljs-type">SeckillVoucher</span> <span class="hljs-variable">seckillVoucher</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SeckillVoucher</span>();<br>    seckillVoucher.setVoucherId(voucher.getId());<br>    seckillVoucher.setStock(voucher.getStock());<br>    seckillVoucher.setBeginTime(voucher.getBeginTime());<br>    seckillVoucher.setEndTime(voucher.getEndTime());<br>    seckillVoucherService.save(seckillVoucher);<br>    <span class="hljs-comment">// ä¿å­˜ç§’æ€åº“å­˜åˆ°Redisä¸­</span><br>    stringRedisTemplate.opsForValue().set(SECKILL_STOCK_KEY + voucher.getId(), voucher.getStock().toString());<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-4-å®ç°ç§’æ€ä¸‹å•"><a href="#3-4-å®ç°ç§’æ€ä¸‹å•" class="headerlink" title="3.4 å®ç°ç§’æ€ä¸‹å•"></a>3.4 å®ç°ç§’æ€ä¸‹å•</h3><p>ä¸‹å•æ ¸å¿ƒæ€è·¯ï¼šå½“æˆ‘ä»¬ç‚¹å‡»æŠ¢è´­æ—¶ï¼Œä¼šè§¦å‘å³ä¾§çš„è¯·æ±‚ï¼Œæˆ‘ä»¬åªéœ€è¦ç¼–å†™å¯¹åº”çš„controllerå³å¯</p><p><img src="/20221205120000/1653365839526.png" alt="1653365839526"></p><p>ç§’æ€ä¸‹å•åº”è¯¥æ€è€ƒçš„å†…å®¹ï¼š</p><p>ä¸‹å•æ—¶éœ€è¦åˆ¤æ–­ä¸¤ç‚¹ï¼š</p><ul><li>ç§’æ€æ˜¯å¦å¼€å§‹æˆ–ç»“æŸï¼Œå¦‚æœå°šæœªå¼€å§‹æˆ–å·²ç»ç»“æŸåˆ™æ— æ³•ä¸‹å•</li><li>åº“å­˜æ˜¯å¦å……è¶³ï¼Œä¸è¶³åˆ™æ— æ³•ä¸‹å•</li></ul><p>ä¸‹å•æ ¸å¿ƒé€»è¾‘åˆ†æï¼š</p><p>å½“ç”¨æˆ·å¼€å§‹è¿›è¡Œä¸‹å•ï¼Œæˆ‘ä»¬åº”å½“å»æŸ¥è¯¢ä¼˜æƒ åˆ¸ä¿¡æ¯ï¼ŒæŸ¥è¯¢åˆ°ä¼˜æƒ åˆ¸ä¿¡æ¯ï¼Œåˆ¤æ–­æ˜¯å¦æ»¡è¶³ç§’æ€æ¡ä»¶</p><p>æ¯”å¦‚æ—¶é—´æ˜¯å¦å……è¶³ï¼Œå¦‚æœæ—¶é—´å……è¶³ï¼Œåˆ™è¿›ä¸€æ­¥åˆ¤æ–­åº“å­˜æ˜¯å¦è¶³å¤Ÿï¼Œå¦‚æœä¸¤è€…éƒ½æ»¡è¶³ï¼Œåˆ™æ‰£å‡åº“å­˜ï¼Œåˆ›å»ºè®¢å•ï¼Œç„¶åè¿”å›è®¢å•idï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ¡ä»¶ä¸æ»¡è¶³åˆ™ç›´æ¥ç»“æŸã€‚</p><p><img src="/20221205120000/1653366238564.png" alt="1653366238564"></p><p>VoucherOrderServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">seckillVoucher</span><span class="hljs-params">(Long voucherId)</span> &#123;<br>    <span class="hljs-comment">// 1.æŸ¥è¯¢ä¼˜æƒ åˆ¸</span><br>    <span class="hljs-type">SeckillVoucher</span> <span class="hljs-variable">voucher</span> <span class="hljs-operator">=</span> seckillVoucherService.getById(voucherId);<br>    <span class="hljs-comment">// 2.åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹</span><br>    <span class="hljs-keyword">if</span> (voucher.getBeginTime().isAfter(LocalDateTime.now())) &#123;<br>        <span class="hljs-comment">// å°šæœªå¼€å§‹</span><br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;ç§’æ€å°šæœªå¼€å§‹ï¼&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">// 3.åˆ¤æ–­ç§’æ€æ˜¯å¦å·²ç»ç»“æŸ</span><br>    <span class="hljs-keyword">if</span> (voucher.getEndTime().isBefore(LocalDateTime.now())) &#123;<br>        <span class="hljs-comment">// å°šæœªå¼€å§‹</span><br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;ç§’æ€å·²ç»ç»“æŸï¼&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">// 4.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span><br>    <span class="hljs-keyword">if</span> (voucher.getStock() &lt; <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-comment">// åº“å­˜ä¸è¶³</span><br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">//5ï¼Œæ‰£å‡åº“å­˜</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> seckillVoucherService.update()<br>            .setSql(<span class="hljs-string">&quot;stock= stock -1&quot;</span>)<br>            .eq(<span class="hljs-string">&quot;voucher_id&quot;</span>, voucherId).update();<br>    <span class="hljs-keyword">if</span> (!success) &#123;<br>        <span class="hljs-comment">//æ‰£å‡åº“å­˜</span><br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">//6.åˆ›å»ºè®¢å•</span><br>    <span class="hljs-type">VoucherOrder</span> <span class="hljs-variable">voucherOrder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VoucherOrder</span>();<br>    <span class="hljs-comment">// 6.1.è®¢å•id</span><br>    <span class="hljs-type">long</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> redisIdWorker.nextId(<span class="hljs-string">&quot;order&quot;</span>);<br>    voucherOrder.setId(orderId);<br>    <span class="hljs-comment">// 6.2.ç”¨æˆ·id</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>    voucherOrder.setUserId(userId);<br>    <span class="hljs-comment">// 6.3.ä»£é‡‘åˆ¸id</span><br>    voucherOrder.setVoucherId(voucherId);<br>    save(voucherOrder);<br><br>    <span class="hljs-keyword">return</span> Result.ok(orderId);<br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-5-åº“å­˜è¶…å–é—®é¢˜åˆ†æ"><a href="#3-5-åº“å­˜è¶…å–é—®é¢˜åˆ†æ" class="headerlink" title="3.5 åº“å­˜è¶…å–é—®é¢˜åˆ†æ"></a>3.5 åº“å­˜è¶…å–é—®é¢˜åˆ†æ</h3><p>æœ‰å…³è¶…å–é—®é¢˜åˆ†æï¼šåœ¨æˆ‘ä»¬åŸæœ‰ä»£ç ä¸­æ˜¯è¿™ä¹ˆå†™çš„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (voucher.getStock() &lt; <span class="hljs-number">1</span>) &#123;<br>       <span class="hljs-comment">// åº“å­˜ä¸è¶³</span><br>       <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);<br>   &#125;<br>   <span class="hljs-comment">//5ï¼Œæ‰£å‡åº“å­˜</span><br>   <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> seckillVoucherService.update()<br>           .setSql(<span class="hljs-string">&quot;stock= stock -1&quot;</span>)<br>           .eq(<span class="hljs-string">&quot;voucher_id&quot;</span>, voucherId).update();<br>   <span class="hljs-keyword">if</span> (!success) &#123;<br>       <span class="hljs-comment">//æ‰£å‡åº“å­˜</span><br>       <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);<br>   &#125;<br></code></pre></td></tr></table></figure><p>å‡è®¾çº¿ç¨‹1è¿‡æ¥æŸ¥è¯¢åº“å­˜ï¼Œåˆ¤æ–­å‡ºæ¥åº“å­˜å¤§äº1ï¼Œæ­£å‡†å¤‡å»æ‰£å‡åº“å­˜ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰æ¥å¾—åŠå»æ‰£å‡ï¼Œæ­¤æ—¶çº¿ç¨‹2è¿‡æ¥ï¼Œçº¿ç¨‹2ä¹Ÿå»æŸ¥è¯¢åº“å­˜ï¼Œå‘ç°è¿™ä¸ªæ•°é‡ä¸€å®šä¹Ÿå¤§äº1ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªçº¿ç¨‹éƒ½ä¼šå»æ‰£å‡åº“å­˜ï¼Œæœ€ç»ˆå¤šä¸ªçº¿ç¨‹ç›¸å½“äºä¸€èµ·å»æ‰£å‡åº“å­˜ï¼Œæ­¤æ—¶å°±ä¼šå‡ºç°åº“å­˜çš„è¶…å–é—®é¢˜ã€‚</p><p><img src="/20221205120000/1653368335155.png" alt="1653368335155"></p><p>è¶…å–é—®é¢˜æ˜¯å…¸å‹çš„å¤šçº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œé’ˆå¯¹è¿™ä¸€é—®é¢˜çš„å¸¸è§è§£å†³æ–¹æ¡ˆå°±æ˜¯åŠ é”ï¼šè€Œå¯¹äºåŠ é”ï¼Œæˆ‘ä»¬é€šå¸¸æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼šè§ä¸‹å›¾ï¼š</p><p><img src="/20221205120000/1653368562591.png" alt="1653368562591"></p><p><strong>æ‚²è§‚é”ï¼š</strong></p><p> æ‚²è§‚é”å¯ä»¥å®ç°å¯¹äºæ•°æ®çš„ä¸²è¡ŒåŒ–æ‰§è¡Œï¼Œæ¯”å¦‚synï¼Œå’Œlockéƒ½æ˜¯æ‚²è§‚é”çš„ä»£è¡¨ï¼ŒåŒæ—¶ï¼Œæ‚²è§‚é”ä¸­åˆå¯ä»¥å†ç»†åˆ†ä¸ºå…¬å¹³é”ï¼Œéå…¬å¹³é”ï¼Œå¯é‡å…¥é”ï¼Œç­‰ç­‰</p><p><strong>ä¹è§‚é”ï¼š</strong></p><p>  ä¹è§‚é”ï¼šä¼šæœ‰ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ¯æ¬¡æ“ä½œæ•°æ®ä¼šå¯¹ç‰ˆæœ¬å·+1ï¼Œå†æäº¤å›æ•°æ®æ—¶ï¼Œä¼šå»æ ¡éªŒæ˜¯å¦æ¯”ä¹‹å‰çš„ç‰ˆæœ¬å¤§1 ï¼Œå¦‚æœå¤§1 ï¼Œåˆ™è¿›è¡Œæ“ä½œæˆåŠŸï¼Œè¿™å¥—æœºåˆ¶çš„æ ¸å¿ƒé€»è¾‘åœ¨äºï¼Œå¦‚æœåœ¨æ“ä½œè¿‡ç¨‹ä¸­ï¼Œç‰ˆæœ¬å·åªæ¯”åŸæ¥å¤§1 ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€æ“ä½œè¿‡ç¨‹ä¸­æ²¡æœ‰äººå¯¹ä»–è¿›è¡Œè¿‡ä¿®æ”¹ï¼Œä»–çš„æ“ä½œå°±æ˜¯å®‰å…¨çš„ï¼Œå¦‚æœä¸å¤§1ï¼Œåˆ™æ•°æ®è¢«ä¿®æ”¹è¿‡ï¼Œå½“ç„¶ä¹è§‚é”è¿˜æœ‰ä¸€äº›å˜ç§çš„å¤„ç†æ–¹å¼æ¯”å¦‚<code>cas</code></p><p>  ä¹è§‚é”çš„å…¸å‹ä»£è¡¨ï¼šå°±æ˜¯casï¼Œåˆ©ç”¨casè¿›è¡Œæ— é”åŒ–æœºåˆ¶åŠ é”ï¼Œvar5 æ˜¯æ“ä½œå‰è¯»å–çš„å†…å­˜å€¼ï¼Œwhileä¸­çš„var1+var2 æ˜¯é¢„ä¼°å€¼ï¼Œå¦‚æœé¢„ä¼°å€¼ &#x3D;&#x3D; å†…å­˜å€¼ï¼Œåˆ™ä»£è¡¨ä¸­é—´æ²¡æœ‰è¢«äººä¿®æ”¹è¿‡ï¼Œæ­¤æ—¶å°±å°†æ–°å€¼å»æ›¿æ¢ å†…å­˜å€¼</p><p>  å…¶ä¸­do while æ˜¯ä¸ºäº†åœ¨æ“ä½œå¤±è´¥æ—¶ï¼Œå†æ¬¡è¿›è¡Œè‡ªæ—‹æ“ä½œï¼Œå³æŠŠä¹‹å‰çš„é€»è¾‘å†æ“ä½œä¸€æ¬¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> var5;<br><span class="hljs-keyword">do</span> &#123;<br>    var5 = <span class="hljs-built_in">this</span>.getIntVolatile(var1, var2);<br>&#125; <span class="hljs-keyword">while</span>(!<span class="hljs-built_in">this</span>.compareAndSwapInt(var1, var2, var5, var5 + var4));<br><br><span class="hljs-keyword">return</span> var5;<br></code></pre></td></tr></table></figure><p><strong>è¯¾ç¨‹ä¸­çš„ä½¿ç”¨æ–¹å¼ï¼š</strong></p><p>è¯¾ç¨‹ä¸­çš„ä½¿ç”¨æ–¹å¼æ˜¯æ²¡æœ‰åƒ<code>cas</code>ä¸€æ ·å¸¦è‡ªæ—‹çš„æ“ä½œï¼Œä¹Ÿæ²¡æœ‰å¯¹versionçš„ç‰ˆæœ¬å·+1 ï¼Œä»–çš„æ“ä½œé€»è¾‘æ˜¯åœ¨æ“ä½œæ—¶ï¼Œå¯¹ç‰ˆæœ¬å·è¿›è¡Œ+1 æ“ä½œï¼Œç„¶åè¦æ±‚version å¦‚æœæ˜¯1 çš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½æ“ä½œï¼Œé‚£ä¹ˆç¬¬ä¸€ä¸ªçº¿ç¨‹åœ¨æ“ä½œåï¼Œæ•°æ®åº“ä¸­çš„versionå˜æˆäº†2ï¼Œä½†æ˜¯ä»–è‡ªå·±æ»¡è¶³version&#x3D;1 ï¼Œæ‰€ä»¥æ²¡æœ‰é—®é¢˜ï¼Œæ­¤æ—¶çº¿ç¨‹2æ‰§è¡Œï¼Œçº¿ç¨‹2 æœ€åä¹Ÿéœ€è¦åŠ ä¸Šæ¡ä»¶version &#x3D;1 ï¼Œä½†æ˜¯ç°åœ¨ç”±äºçº¿ç¨‹1å·²ç»æ“ä½œè¿‡äº†ï¼Œæ‰€ä»¥çº¿ç¨‹2ï¼Œæ“ä½œæ—¶å°±ä¸æ»¡è¶³version&#x3D;1 çš„æ¡ä»¶äº†ï¼Œæ‰€ä»¥çº¿ç¨‹2æ— æ³•æ‰§è¡ŒæˆåŠŸ</p><p><img src="/20221205120000/1653369268550.png" alt="1653369268550"></p><h3 id="3-6-ä¹è§‚é”è§£å†³è¶…å–é—®é¢˜"><a href="#3-6-ä¹è§‚é”è§£å†³è¶…å–é—®é¢˜" class="headerlink" title="3.6 ä¹è§‚é”è§£å†³è¶…å–é—®é¢˜"></a>3.6 ä¹è§‚é”è§£å†³è¶…å–é—®é¢˜</h3><p><strong>ä¿®æ”¹ä»£ç æ–¹æ¡ˆä¸€ã€</strong></p><p>VoucherOrderServiceImpl åœ¨æ‰£å‡åº“å­˜æ—¶ï¼Œæ”¹ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> seckillVoucherService.update()<br>            .setSql(<span class="hljs-string">&quot;stock= stock -1&quot;</span>) <span class="hljs-comment">//set stock = stock -1</span><br>            .eq(<span class="hljs-string">&quot;voucher_id&quot;</span>, voucherId).eq(<span class="hljs-string">&quot;stock&quot;</span>,voucher.getStock()).update(); <span class="hljs-comment">//where id = ï¼Ÿ and stock = ?</span><br></code></pre></td></tr></table></figure><p>ä»¥ä¸Šé€»è¾‘çš„æ ¸å¿ƒå«ä¹‰æ˜¯ï¼šåªè¦æˆ‘æ‰£å‡åº“å­˜æ—¶çš„åº“å­˜å’Œä¹‹å‰æˆ‘æŸ¥è¯¢åˆ°çš„åº“å­˜æ˜¯ä¸€æ ·çš„ï¼Œå°±æ„å‘³ç€æ²¡æœ‰äººåœ¨ä¸­é—´ä¿®æ”¹è¿‡åº“å­˜ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±æ˜¯å®‰å…¨çš„ï¼Œä½†æ˜¯ä»¥ä¸Šè¿™ç§æ–¹å¼é€šè¿‡æµ‹è¯•å‘ç°ä¼šæœ‰å¾ˆå¤šå¤±è´¥çš„æƒ…å†µï¼Œå¤±è´¥çš„åŸå› åœ¨äºï¼šåœ¨ä½¿ç”¨ä¹è§‚é”è¿‡ç¨‹ä¸­å‡è®¾100ä¸ªçº¿ç¨‹åŒæ—¶éƒ½æ‹¿åˆ°äº†100çš„åº“å­˜ï¼Œç„¶åå¤§å®¶ä¸€èµ·å»è¿›è¡Œæ‰£å‡ï¼Œä½†æ˜¯100ä¸ªäººä¸­åªæœ‰1ä¸ªäººèƒ½æ‰£å‡æˆåŠŸï¼Œå…¶ä»–çš„äººåœ¨å¤„ç†æ—¶ï¼Œä»–ä»¬åœ¨æ‰£å‡æ—¶ï¼Œåº“å­˜å·²ç»è¢«ä¿®æ”¹è¿‡äº†ï¼Œæ‰€ä»¥æ­¤æ—¶å…¶ä»–çº¿ç¨‹éƒ½ä¼šå¤±è´¥</p><p><strong>ä¿®æ”¹ä»£ç æ–¹æ¡ˆäºŒã€</strong></p><p>ä¹‹å‰çš„æ–¹å¼è¦ä¿®æ”¹å‰åéƒ½ä¿æŒä¸€è‡´ï¼Œä½†æ˜¯è¿™æ ·æˆ‘ä»¬åˆ†æè¿‡ï¼ŒæˆåŠŸçš„æ¦‚ç‡å¤ªä½ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ä¹è§‚é”éœ€è¦å˜ä¸€ä¸‹ï¼Œæ”¹æˆstockå¤§äº0 å³å¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> seckillVoucherService.update()<br>            .setSql(<span class="hljs-string">&quot;stock= stock -1&quot;</span>)<br>            .eq(<span class="hljs-string">&quot;voucher_id&quot;</span>, voucherId).update().gt(<span class="hljs-string">&quot;stock&quot;</span>,<span class="hljs-number">0</span>); <span class="hljs-comment">//where id = ? and stock &gt; 0</span><br></code></pre></td></tr></table></figure><p><strong>çŸ¥è¯†å°æ‰©å±•ï¼š</strong></p><p>é’ˆå¯¹casä¸­çš„è‡ªæ—‹å‹åŠ›è¿‡å¤§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Longadderè¿™ä¸ªç±»å»è§£å†³</p><p>Java8 æä¾›çš„ä¸€ä¸ªå¯¹AtomicLongæ”¹è¿›åçš„ä¸€ä¸ªç±»ï¼ŒLongAdder</p><p>å¤§é‡çº¿ç¨‹å¹¶å‘æ›´æ–°ä¸€ä¸ªåŸå­æ€§çš„æ—¶å€™ï¼Œå¤©ç„¶çš„é—®é¢˜å°±æ˜¯è‡ªæ—‹ï¼Œä¼šå¯¼è‡´å¹¶å‘æ€§é—®é¢˜ï¼Œå½“ç„¶è¿™ä¹Ÿæ¯”æˆ‘ä»¬ç›´æ¥ä½¿ç”¨synæ¥çš„å¥½</p><p>æ‰€ä»¥åˆ©ç”¨è¿™ä¹ˆä¸€ä¸ªç±»ï¼ŒLongAdderæ¥è¿›è¡Œä¼˜åŒ–</p><p>å¦‚æœè·å–æŸä¸ªå€¼ï¼Œåˆ™ä¼šå¯¹cellå’Œbaseçš„å€¼è¿›è¡Œé€’å¢ï¼Œæœ€åè¿”å›ä¸€ä¸ªå®Œæ•´çš„å€¼</p><p><img src="/20221205120000/1653370271627.png" alt="1653370271627"></p><h3 id="3-6-ä¼˜æƒ åˆ¸ç§’æ€-ä¸€äººä¸€å•"><a href="#3-6-ä¼˜æƒ åˆ¸ç§’æ€-ä¸€äººä¸€å•" class="headerlink" title="3.6 ä¼˜æƒ åˆ¸ç§’æ€-ä¸€äººä¸€å•"></a>3.6 ä¼˜æƒ åˆ¸ç§’æ€-ä¸€äººä¸€å•</h3><p>éœ€æ±‚ï¼šä¿®æ”¹ç§’æ€ä¸šåŠ¡ï¼Œè¦æ±‚åŒä¸€ä¸ªä¼˜æƒ åˆ¸ï¼Œä¸€ä¸ªç”¨æˆ·åªèƒ½ä¸‹ä¸€å•</p><p><strong>ç°åœ¨çš„é—®é¢˜åœ¨äºï¼š</strong></p><p>ä¼˜æƒ åˆ¸æ˜¯ä¸ºäº†å¼•æµï¼Œä½†æ˜¯ç›®å‰çš„æƒ…å†µæ˜¯ï¼Œä¸€ä¸ªäººå¯ä»¥æ— é™åˆ¶çš„æŠ¢è¿™ä¸ªä¼˜æƒ åˆ¸ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”å½“å¢åŠ ä¸€å±‚é€»è¾‘ï¼Œè®©ä¸€ä¸ªç”¨æˆ·åªèƒ½ä¸‹ä¸€ä¸ªå•ï¼Œè€Œä¸æ˜¯è®©ä¸€ä¸ªç”¨æˆ·ä¸‹å¤šä¸ªå•</p><p>å…·ä½“æ“ä½œé€»è¾‘å¦‚ä¸‹ï¼šæ¯”å¦‚æ—¶é—´æ˜¯å¦å……è¶³ï¼Œå¦‚æœæ—¶é—´å……è¶³ï¼Œåˆ™è¿›ä¸€æ­¥åˆ¤æ–­åº“å­˜æ˜¯å¦è¶³å¤Ÿï¼Œç„¶åå†æ ¹æ®ä¼˜æƒ åˆ¸idå’Œç”¨æˆ·idæŸ¥è¯¢æ˜¯å¦å·²ç»ä¸‹è¿‡è¿™ä¸ªè®¢å•ï¼Œå¦‚æœä¸‹è¿‡è¿™ä¸ªè®¢å•ï¼Œåˆ™ä¸å†ä¸‹å•ï¼Œå¦åˆ™è¿›è¡Œä¸‹å•</p><p><img src="/20221205120000/1653371854389.png" alt="1653371854389"></p><p>VoucherOrderServiceImpl  </p><p><strong>åˆæ­¥ä»£ç ï¼šå¢åŠ ä¸€äººä¸€å•é€»è¾‘</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">seckillVoucher</span><span class="hljs-params">(Long voucherId)</span> &#123;<br>    <span class="hljs-comment">// 1.æŸ¥è¯¢ä¼˜æƒ åˆ¸</span><br>    <span class="hljs-type">SeckillVoucher</span> <span class="hljs-variable">voucher</span> <span class="hljs-operator">=</span> seckillVoucherService.getById(voucherId);<br>    <span class="hljs-comment">// 2.åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹</span><br>    <span class="hljs-keyword">if</span> (voucher.getBeginTime().isAfter(LocalDateTime.now())) &#123;<br>        <span class="hljs-comment">// å°šæœªå¼€å§‹</span><br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;ç§’æ€å°šæœªå¼€å§‹ï¼&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">// 3.åˆ¤æ–­ç§’æ€æ˜¯å¦å·²ç»ç»“æŸ</span><br>    <span class="hljs-keyword">if</span> (voucher.getEndTime().isBefore(LocalDateTime.now())) &#123;<br>        <span class="hljs-comment">// å°šæœªå¼€å§‹</span><br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;ç§’æ€å·²ç»ç»“æŸï¼&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">// 4.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span><br>    <span class="hljs-keyword">if</span> (voucher.getStock() &lt; <span class="hljs-number">1</span>) &#123;<br>        <span class="hljs-comment">// åº“å­˜ä¸è¶³</span><br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">// 5.ä¸€äººä¸€å•é€»è¾‘</span><br>    <span class="hljs-comment">// 5.1.ç”¨æˆ·id</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>    <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> query().eq(<span class="hljs-string">&quot;user_id&quot;</span>, userId).eq(<span class="hljs-string">&quot;voucher_id&quot;</span>, voucherId).count();<br>    <span class="hljs-comment">// 5.2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span><br>    <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†</span><br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡ä¸€æ¬¡ï¼&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">//6ï¼Œæ‰£å‡åº“å­˜</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> seckillVoucherService.update()<br>            .setSql(<span class="hljs-string">&quot;stock= stock -1&quot;</span>)<br>            .eq(<span class="hljs-string">&quot;voucher_id&quot;</span>, voucherId).update();<br>    <span class="hljs-keyword">if</span> (!success) &#123;<br>        <span class="hljs-comment">//æ‰£å‡åº“å­˜</span><br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">//7.åˆ›å»ºè®¢å•</span><br>    <span class="hljs-type">VoucherOrder</span> <span class="hljs-variable">voucherOrder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VoucherOrder</span>();<br>    <span class="hljs-comment">// 7.1.è®¢å•id</span><br>    <span class="hljs-type">long</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> redisIdWorker.nextId(<span class="hljs-string">&quot;order&quot;</span>);<br>    voucherOrder.setId(orderId);<br><br>    voucherOrder.setUserId(userId);<br>    <span class="hljs-comment">// 7.3.ä»£é‡‘åˆ¸id</span><br>    voucherOrder.setVoucherId(voucherId);<br>    save(voucherOrder);<br><br>    <span class="hljs-keyword">return</span> Result.ok(orderId);<br><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å­˜åœ¨é—®é¢˜ï¼š</strong>ç°åœ¨çš„é—®é¢˜è¿˜æ˜¯å’Œä¹‹å‰ä¸€æ ·ï¼Œå¹¶å‘è¿‡æ¥ï¼ŒæŸ¥è¯¢æ•°æ®åº“ï¼Œéƒ½ä¸å­˜åœ¨è®¢å•ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯éœ€è¦åŠ é”ï¼Œä½†æ˜¯ä¹è§‚é”æ¯”è¾ƒé€‚åˆæ›´æ–°æ•°æ®ï¼Œè€Œç°åœ¨æ˜¯æ’å…¥æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨æ‚²è§‚é”æ“ä½œ</p><p><strong>æ³¨æ„ï¼š</strong>åœ¨è¿™é‡Œæåˆ°äº†éå¸¸å¤šçš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ…¢æ…¢çš„æ¥æ€è€ƒï¼Œé¦–å…ˆæˆ‘ä»¬çš„åˆå§‹æ–¹æ¡ˆæ˜¯å°è£…äº†ä¸€ä¸ªcreateVoucherOrderæ–¹æ³•ï¼ŒåŒæ—¶ä¸ºäº†ç¡®ä¿ä»–çº¿ç¨‹å®‰å…¨ï¼Œåœ¨æ–¹æ³•ä¸Šæ·»åŠ äº†ä¸€æŠŠsynchronized é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> Result <span class="hljs-title function_">createVoucherOrder</span><span class="hljs-params">(Long voucherId)</span> &#123;<br><br><span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>         <span class="hljs-comment">// 5.1.æŸ¥è¯¢è®¢å•</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> query().eq(<span class="hljs-string">&quot;user_id&quot;</span>, userId).eq(<span class="hljs-string">&quot;voucher_id&quot;</span>, voucherId).count();<br>        <span class="hljs-comment">// 5.2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span><br>        <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†</span><br>            <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡ä¸€æ¬¡ï¼&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-comment">// 6.æ‰£å‡åº“å­˜</span><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> seckillVoucherService.update()<br>                .setSql(<span class="hljs-string">&quot;stock = stock - 1&quot;</span>) <span class="hljs-comment">// set stock = stock - 1</span><br>                .eq(<span class="hljs-string">&quot;voucher_id&quot;</span>, voucherId).gt(<span class="hljs-string">&quot;stock&quot;</span>, <span class="hljs-number">0</span>) <span class="hljs-comment">// where id = ? and stock &gt; 0</span><br>                .update();<br>        <span class="hljs-keyword">if</span> (!success) &#123;<br>            <span class="hljs-comment">// æ‰£å‡å¤±è´¥</span><br>            <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-comment">// 7.åˆ›å»ºè®¢å•</span><br>        <span class="hljs-type">VoucherOrder</span> <span class="hljs-variable">voucherOrder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VoucherOrder</span>();<br>        <span class="hljs-comment">// 7.1.è®¢å•id</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> redisIdWorker.nextId(<span class="hljs-string">&quot;order&quot;</span>);<br>        voucherOrder.setId(orderId);<br>        <span class="hljs-comment">// 7.2.ç”¨æˆ·id</span><br>        voucherOrder.setUserId(userId);<br>        <span class="hljs-comment">// 7.3.ä»£é‡‘åˆ¸id</span><br>        voucherOrder.setVoucherId(voucherId);<br>        save(voucherOrder);<br><br>        <span class="hljs-comment">// 7.è¿”å›è®¢å•id</span><br>        <span class="hljs-keyword">return</span> Result.ok(orderId);<br>&#125;<br></code></pre></td></tr></table></figure><p>ï¼Œä½†æ˜¯è¿™æ ·æ·»åŠ é”ï¼Œé”çš„ç²’åº¦å¤ªç²—äº†ï¼Œåœ¨ä½¿ç”¨é”è¿‡ç¨‹ä¸­ï¼Œæ§åˆ¶<strong>é”ç²’åº¦</strong> æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„äº‹æƒ…ï¼Œå› ä¸ºå¦‚æœé”çš„ç²’åº¦å¤ªå¤§ï¼Œä¼šå¯¼è‡´æ¯ä¸ªçº¿ç¨‹è¿›æ¥éƒ½ä¼šé”ä½ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å»æ§åˆ¶é”çš„ç²’åº¦ï¼Œä»¥ä¸‹è¿™æ®µä»£ç éœ€è¦ä¿®æ”¹ä¸ºï¼š<br>intern() è¿™ä¸ªæ–¹æ³•æ˜¯ä»å¸¸é‡æ± ä¸­æ‹¿åˆ°æ•°æ®ï¼Œå¦‚æœæˆ‘ä»¬ç›´æ¥ä½¿ç”¨userId.toString() ä»–æ‹¿åˆ°çš„å¯¹è±¡å®é™…ä¸Šæ˜¯ä¸åŒçš„å¯¹è±¡ï¼Œnewå‡ºæ¥çš„å¯¹è±¡ï¼Œæˆ‘ä»¬ä½¿ç”¨é”å¿…é¡»ä¿è¯é”å¿…é¡»æ˜¯åŒä¸€æŠŠï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨intern()æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span>  Result <span class="hljs-title function_">createVoucherOrder</span><span class="hljs-params">(Long voucherId)</span> &#123;<br><span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br><span class="hljs-keyword">synchronized</span>(userId.toString().intern())&#123;<br>         <span class="hljs-comment">// 5.1.æŸ¥è¯¢è®¢å•</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> query().eq(<span class="hljs-string">&quot;user_id&quot;</span>, userId).eq(<span class="hljs-string">&quot;voucher_id&quot;</span>, voucherId).count();<br>        <span class="hljs-comment">// 5.2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span><br>        <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†</span><br>            <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡ä¸€æ¬¡ï¼&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-comment">// 6.æ‰£å‡åº“å­˜</span><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> seckillVoucherService.update()<br>                .setSql(<span class="hljs-string">&quot;stock = stock - 1&quot;</span>) <span class="hljs-comment">// set stock = stock - 1</span><br>                .eq(<span class="hljs-string">&quot;voucher_id&quot;</span>, voucherId).gt(<span class="hljs-string">&quot;stock&quot;</span>, <span class="hljs-number">0</span>) <span class="hljs-comment">// where id = ? and stock &gt; 0</span><br>                .update();<br>        <span class="hljs-keyword">if</span> (!success) &#123;<br>            <span class="hljs-comment">// æ‰£å‡å¤±è´¥</span><br>            <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-comment">// 7.åˆ›å»ºè®¢å•</span><br>        <span class="hljs-type">VoucherOrder</span> <span class="hljs-variable">voucherOrder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VoucherOrder</span>();<br>        <span class="hljs-comment">// 7.1.è®¢å•id</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> redisIdWorker.nextId(<span class="hljs-string">&quot;order&quot;</span>);<br>        voucherOrder.setId(orderId);<br>        <span class="hljs-comment">// 7.2.ç”¨æˆ·id</span><br>        voucherOrder.setUserId(userId);<br>        <span class="hljs-comment">// 7.3.ä»£é‡‘åˆ¸id</span><br>        voucherOrder.setVoucherId(voucherId);<br>        save(voucherOrder);<br><br>        <span class="hljs-comment">// 7.è¿”å›è®¢å•id</span><br>        <span class="hljs-keyword">return</span> Result.ok(orderId);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†æ˜¯ä»¥ä¸Šä»£ç è¿˜æ˜¯å­˜åœ¨é—®é¢˜ï¼Œé—®é¢˜çš„åŸå› åœ¨äºå½“å‰æ–¹æ³•è¢«springçš„äº‹åŠ¡æ§åˆ¶ï¼Œå¦‚æœä½ åœ¨æ–¹æ³•å†…éƒ¨åŠ é”ï¼Œå¯èƒ½ä¼šå¯¼è‡´å½“å‰æ–¹æ³•äº‹åŠ¡è¿˜æ²¡æœ‰æäº¤ï¼Œä½†æ˜¯é”å·²ç»é‡Šæ”¾ä¹Ÿä¼šå¯¼è‡´é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©å°†å½“å‰æ–¹æ³•æ•´ä½“åŒ…è£¹èµ·æ¥ï¼Œç¡®ä¿äº‹åŠ¡ä¸ä¼šå‡ºç°é—®é¢˜ï¼šå¦‚ä¸‹ï¼š</p><p>åœ¨seckillVoucher æ–¹æ³•ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹é€»è¾‘ï¼Œè¿™æ ·å°±èƒ½ä¿è¯äº‹åŠ¡çš„ç‰¹æ€§ï¼ŒåŒæ—¶ä¹Ÿæ§åˆ¶äº†é”çš„ç²’åº¦</p><p><img src="/20221205120000/1653373434815.png" alt="1653373434815"></p><p>ä½†æ˜¯ä»¥ä¸Šåšæ³•ä¾ç„¶æœ‰é—®é¢˜ï¼Œå› ä¸ºä½ è°ƒç”¨çš„æ–¹æ³•ï¼Œå…¶å®æ˜¯this.çš„æ–¹å¼è°ƒç”¨çš„ï¼Œäº‹åŠ¡æƒ³è¦ç”Ÿæ•ˆï¼Œè¿˜å¾—åˆ©ç”¨ä»£ç†æ¥ç”Ÿæ•ˆï¼Œæ‰€ä»¥è¿™ä¸ªåœ°æ–¹ï¼Œæˆ‘ä»¬éœ€è¦è·å¾—åŸå§‹çš„äº‹åŠ¡å¯¹è±¡ï¼Œ æ¥æ“ä½œäº‹åŠ¡</p><p><img src="/20221205120000/1653383810643.png" alt="1653383810643"></p><h3 id="3-7-é›†ç¾¤ç¯å¢ƒä¸‹çš„å¹¶å‘é—®é¢˜"><a href="#3-7-é›†ç¾¤ç¯å¢ƒä¸‹çš„å¹¶å‘é—®é¢˜" class="headerlink" title="3.7 é›†ç¾¤ç¯å¢ƒä¸‹çš„å¹¶å‘é—®é¢˜"></a>3.7 é›†ç¾¤ç¯å¢ƒä¸‹çš„å¹¶å‘é—®é¢˜</h3><p>é€šè¿‡åŠ é”å¯ä»¥è§£å†³åœ¨å•æœºæƒ…å†µä¸‹çš„ä¸€äººä¸€å•å®‰å…¨é—®é¢˜ï¼Œä½†æ˜¯åœ¨é›†ç¾¤æ¨¡å¼ä¸‹å°±ä¸è¡Œäº†ã€‚</p><p>1ã€æˆ‘ä»¬å°†æœåŠ¡å¯åŠ¨ä¸¤ä»½ï¼Œç«¯å£åˆ†åˆ«ä¸º8081å’Œ8082ï¼š</p><p><img src="/20221205120000/1653373887844.png" alt="1653373887844"></p><p>2ã€ç„¶åä¿®æ”¹nginxçš„confç›®å½•ä¸‹çš„nginx.confæ–‡ä»¶ï¼Œé…ç½®åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡ï¼š</p><p><img src="/20221205120000/1653373908620.png" alt="1653373908620"></p><p><strong>å…·ä½“æ“ä½œ(ç•¥)</strong></p><p><strong>æœ‰å…³é”å¤±æ•ˆåŸå› åˆ†æ</strong></p><p>ç”±äºç°åœ¨æˆ‘ä»¬éƒ¨ç½²äº†å¤šä¸ªtomcatï¼Œæ¯ä¸ªtomcatéƒ½æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„jvmï¼Œé‚£ä¹ˆå‡è®¾åœ¨æœåŠ¡å™¨Açš„tomcatå†…éƒ¨ï¼Œæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹ç”±äºä½¿ç”¨çš„æ˜¯åŒä¸€ä»½ä»£ç ï¼Œé‚£ä¹ˆä»–ä»¬çš„é”å¯¹è±¡æ˜¯åŒä¸€ä¸ªï¼Œæ˜¯å¯ä»¥å®ç°äº’æ–¥çš„ï¼Œä½†æ˜¯å¦‚æœç°åœ¨æ˜¯æœåŠ¡å™¨Bçš„tomcatå†…éƒ¨ï¼Œåˆæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œä½†æ˜¯ä»–ä»¬çš„é”å¯¹è±¡å†™çš„è™½ç„¶å’ŒæœåŠ¡å™¨Aä¸€æ ·ï¼Œä½†æ˜¯é”å¯¹è±¡å´ä¸æ˜¯åŒä¸€ä¸ªï¼Œæ‰€ä»¥çº¿ç¨‹3å’Œçº¿ç¨‹4å¯ä»¥å®ç°äº’æ–¥ï¼Œä½†æ˜¯å´æ— æ³•å’Œçº¿ç¨‹1å’Œçº¿ç¨‹2å®ç°äº’æ–¥ï¼Œè¿™å°±æ˜¯ é›†ç¾¤ç¯å¢ƒä¸‹ï¼Œsyné”å¤±æ•ˆçš„åŸå› ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼é”æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p><img src="/20221205120000/1653374044740.png" alt="1653374044740"></p><h2 id="4ã€åˆ†å¸ƒå¼é”"><a href="#4ã€åˆ†å¸ƒå¼é”" class="headerlink" title="4ã€åˆ†å¸ƒå¼é”"></a>4ã€åˆ†å¸ƒå¼é”</h2><h3 id="4-1-ã€åŸºæœ¬åŸç†å’Œå®ç°æ–¹å¼å¯¹æ¯”"><a href="#4-1-ã€åŸºæœ¬åŸç†å’Œå®ç°æ–¹å¼å¯¹æ¯”" class="headerlink" title="4.1 ã€åŸºæœ¬åŸç†å’Œå®ç°æ–¹å¼å¯¹æ¯”"></a>4.1 ã€åŸºæœ¬åŸç†å’Œå®ç°æ–¹å¼å¯¹æ¯”</h3><p>åˆ†å¸ƒå¼é”ï¼šæ»¡è¶³åˆ†å¸ƒå¼ç³»ç»Ÿæˆ–é›†ç¾¤æ¨¡å¼ä¸‹å¤šè¿›ç¨‹å¯è§å¹¶ä¸”äº’æ–¥çš„é”ã€‚</p><p>åˆ†å¸ƒå¼é”çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯è®©å¤§å®¶éƒ½ä½¿ç”¨åŒä¸€æŠŠé”ï¼Œåªè¦å¤§å®¶ä½¿ç”¨çš„æ˜¯åŒä¸€æŠŠé”ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½é”ä½çº¿ç¨‹ï¼Œä¸è®©çº¿ç¨‹è¿›è¡Œï¼Œè®©ç¨‹åºä¸²è¡Œæ‰§è¡Œï¼Œè¿™å°±æ˜¯åˆ†å¸ƒå¼é”çš„æ ¸å¿ƒæ€è·¯</p><p><img src="/20221205120000/1653374296906.png" alt="1653374296906"></p><p>é‚£ä¹ˆåˆ†å¸ƒå¼é”ä»–åº”è¯¥æ»¡è¶³ä¸€äº›ä»€ä¹ˆæ ·çš„æ¡ä»¶å‘¢ï¼Ÿ</p><p>å¯è§æ€§ï¼šå¤šä¸ªçº¿ç¨‹éƒ½èƒ½çœ‹åˆ°ç›¸åŒçš„ç»“æœï¼Œæ³¨æ„ï¼šè¿™ä¸ªåœ°æ–¹è¯´çš„å¯è§æ€§å¹¶ä¸æ˜¯å¹¶å‘ç¼–ç¨‹ä¸­æŒ‡çš„å†…å­˜å¯è§æ€§ï¼Œåªæ˜¯è¯´å¤šä¸ªè¿›ç¨‹ä¹‹é—´éƒ½èƒ½æ„ŸçŸ¥åˆ°å˜åŒ–çš„æ„æ€</p><p>äº’æ–¥ï¼šäº’æ–¥æ˜¯åˆ†å¸ƒå¼é”çš„æœ€åŸºæœ¬çš„æ¡ä»¶ï¼Œä½¿å¾—ç¨‹åºä¸²è¡Œæ‰§è¡Œ</p><p>é«˜å¯ç”¨ï¼šç¨‹åºä¸æ˜“å´©æºƒï¼Œæ—¶æ—¶åˆ»åˆ»éƒ½ä¿è¯è¾ƒé«˜çš„å¯ç”¨æ€§</p><p>é«˜æ€§èƒ½ï¼šç”±äºåŠ é”æœ¬èº«å°±è®©æ€§èƒ½é™ä½ï¼Œæ‰€æœ‰å¯¹äºåˆ†å¸ƒå¼é”æœ¬èº«éœ€è¦ä»–å°±è¾ƒé«˜çš„åŠ é”æ€§èƒ½å’Œé‡Šæ”¾é”æ€§èƒ½</p><p>å®‰å…¨æ€§ï¼šå®‰å…¨ä¹Ÿæ˜¯ç¨‹åºä¸­å¿…ä¸å¯å°‘çš„ä¸€ç¯</p><p><img src="/20221205120000/1653381992018.png" alt="1653381992018"></p><p>å¸¸è§çš„åˆ†å¸ƒå¼é”æœ‰ä¸‰ç§</p><p>Mysqlï¼šmysqlæœ¬èº«å°±å¸¦æœ‰é”æœºåˆ¶ï¼Œä½†æ˜¯ç”±äºmysqlæ€§èƒ½æœ¬èº«ä¸€èˆ¬ï¼Œæ‰€ä»¥é‡‡ç”¨åˆ†å¸ƒå¼é”çš„æƒ…å†µä¸‹ï¼Œå…¶å®ä½¿ç”¨mysqlä½œä¸ºåˆ†å¸ƒå¼é”æ¯”è¾ƒå°‘è§</p><p>Redisï¼šredisä½œä¸ºåˆ†å¸ƒå¼é”æ˜¯éå¸¸å¸¸è§çš„ä¸€ç§ä½¿ç”¨æ–¹å¼ï¼Œç°åœ¨ä¼ä¸šçº§å¼€å‘ä¸­åŸºæœ¬éƒ½ä½¿ç”¨redisæˆ–è€…zookeeperä½œä¸ºåˆ†å¸ƒå¼é”ï¼Œåˆ©ç”¨setnxè¿™ä¸ªæ–¹æ³•ï¼Œå¦‚æœæ’å…¥keyæˆåŠŸï¼Œåˆ™è¡¨ç¤ºè·å¾—åˆ°äº†é”ï¼Œå¦‚æœæœ‰äººæ’å…¥æˆåŠŸï¼Œå…¶ä»–äººæ’å…¥å¤±è´¥åˆ™è¡¨ç¤ºæ— æ³•è·å¾—åˆ°é”ï¼Œåˆ©ç”¨è¿™å¥—é€»è¾‘æ¥å®ç°åˆ†å¸ƒå¼é”</p><p>Zookeeperï¼šzookeeperä¹Ÿæ˜¯ä¼ä¸šçº§å¼€å‘ä¸­è¾ƒå¥½çš„ä¸€ä¸ªå®ç°åˆ†å¸ƒå¼é”çš„æ–¹æ¡ˆï¼Œç”±äºæœ¬å¥—è§†é¢‘å¹¶ä¸è®²è§£zookeeperçš„åŸç†å’Œåˆ†å¸ƒå¼é”çš„å®ç°ï¼Œæ‰€ä»¥ä¸è¿‡å¤šé˜è¿°</p><p><img src="/20221205120000/1653382219377.png" alt="1653382219377"></p><h3 id="4-2-ã€Redisåˆ†å¸ƒå¼é”çš„å®ç°æ ¸å¿ƒæ€è·¯"><a href="#4-2-ã€Redisåˆ†å¸ƒå¼é”çš„å®ç°æ ¸å¿ƒæ€è·¯" class="headerlink" title="4.2 ã€Redisåˆ†å¸ƒå¼é”çš„å®ç°æ ¸å¿ƒæ€è·¯"></a>4.2 ã€Redisåˆ†å¸ƒå¼é”çš„å®ç°æ ¸å¿ƒæ€è·¯</h3><p>å®ç°åˆ†å¸ƒå¼é”æ—¶éœ€è¦å®ç°çš„ä¸¤ä¸ªåŸºæœ¬æ–¹æ³•ï¼š</p><ul><li><p>è·å–é”ï¼š</p><ul><li><p>äº’æ–¥ï¼šç¡®ä¿åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è·å–é”</p></li><li><p>éé˜»å¡ï¼šå°è¯•ä¸€æ¬¡ï¼ŒæˆåŠŸè¿”å›trueï¼Œå¤±è´¥è¿”å›false</p><p><img src="/20221205120000/image-20221215160312117.png" alt="image-20221215160312117"></p></li></ul></li><li><p>é‡Šæ”¾é”ï¼š</p><ul><li>æ‰‹åŠ¨é‡Šæ”¾</li><li>è¶…æ—¶é‡Šæ”¾ï¼šè·å–é”æ—¶æ·»åŠ ä¸€ä¸ªè¶…æ—¶æ—¶é—´</li></ul><p><img src="/20221205120000/1653382669900.png" alt="1653382669900"></p></li></ul><p>æ ¸å¿ƒæ€è·¯ï¼š</p><p>æˆ‘ä»¬åˆ©ç”¨redis çš„setNx æ–¹æ³•ï¼Œå½“æœ‰å¤šä¸ªçº¿ç¨‹è¿›å…¥æ—¶ï¼Œæˆ‘ä»¬å°±åˆ©ç”¨è¯¥æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹è¿›å…¥æ—¶ï¼Œredis ä¸­å°±æœ‰è¿™ä¸ªkey äº†ï¼Œè¿”å›äº†1ï¼Œå¦‚æœç»“æœæ˜¯1ï¼Œåˆ™è¡¨ç¤ºä»–æŠ¢åˆ°äº†é”ï¼Œé‚£ä¹ˆä»–å»æ‰§è¡Œä¸šåŠ¡ï¼Œç„¶åå†åˆ é™¤é”ï¼Œé€€å‡ºé”é€»è¾‘ï¼Œæ²¡æœ‰æŠ¢åˆ°é”çš„å“¥ä»¬ï¼Œç­‰å¾…ä¸€å®šæ—¶é—´åé‡è¯•å³å¯</p><p> <img src="/20221205120000/1653382830810.png" alt="1653382830810"></p><h3 id="4-3-å®ç°åˆ†å¸ƒå¼é”ç‰ˆæœ¬ä¸€"><a href="#4-3-å®ç°åˆ†å¸ƒå¼é”ç‰ˆæœ¬ä¸€" class="headerlink" title="4.3 å®ç°åˆ†å¸ƒå¼é”ç‰ˆæœ¬ä¸€"></a>4.3 å®ç°åˆ†å¸ƒå¼é”ç‰ˆæœ¬ä¸€</h3><ul><li>åŠ é”é€»è¾‘</li></ul><p><strong>é”çš„åŸºæœ¬æ¥å£</strong></p><p><img src="/20221205120000/1656079017728.png" alt="1656079017728"></p><p><strong>SimpleRedisLock</strong></p><p>åˆ©ç”¨setnxæ–¹æ³•è¿›è¡ŒåŠ é”ï¼ŒåŒæ—¶å¢åŠ è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢æ­»é”ï¼Œæ­¤æ–¹æ³•å¯ä»¥ä¿è¯åŠ é”å’Œå¢åŠ è¿‡æœŸæ—¶é—´å…·æœ‰åŸå­æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String KEY_PREFIX=<span class="hljs-string">&quot;lock:&quot;</span><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(<span class="hljs-type">long</span> timeoutSec)</span> &#123;<br>    <span class="hljs-comment">// è·å–çº¿ç¨‹æ ‡ç¤º</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">threadId</span> <span class="hljs-operator">=</span> Thread.currentThread().getId()<br>    <span class="hljs-comment">// è·å–é”</span><br>    <span class="hljs-type">Boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue()<br>            .setIfAbsent(KEY_PREFIX + name, threadId + <span class="hljs-string">&quot;&quot;</span>, timeoutSec, TimeUnit.SECONDS);<br>    <span class="hljs-keyword">return</span> Boolean.TRUE.equals(success);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>é‡Šæ”¾é”é€»è¾‘</li></ul><p>SimpleRedisLock</p><p>é‡Šæ”¾é”ï¼Œé˜²æ­¢åˆ é™¤åˆ«äººçš„é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">//é€šè¿‡delåˆ é™¤é”</span><br>    stringRedisTemplate.delete(KEY_PREFIX + name);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ä¿®æ”¹ä¸šåŠ¡ä»£ç </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">seckillVoucher</span><span class="hljs-params">(Long voucherId)</span> &#123;<br>      <span class="hljs-comment">// 1.æŸ¥è¯¢ä¼˜æƒ åˆ¸</span><br>      <span class="hljs-type">SeckillVoucher</span> <span class="hljs-variable">voucher</span> <span class="hljs-operator">=</span> seckillVoucherService.getById(voucherId);<br>      <span class="hljs-comment">// 2.åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹</span><br>      <span class="hljs-keyword">if</span> (voucher.getBeginTime().isAfter(LocalDateTime.now())) &#123;<br>          <span class="hljs-comment">// å°šæœªå¼€å§‹</span><br>          <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;ç§’æ€å°šæœªå¼€å§‹ï¼&quot;</span>);<br>      &#125;<br>      <span class="hljs-comment">// 3.åˆ¤æ–­ç§’æ€æ˜¯å¦å·²ç»ç»“æŸ</span><br>      <span class="hljs-keyword">if</span> (voucher.getEndTime().isBefore(LocalDateTime.now())) &#123;<br>          <span class="hljs-comment">// å°šæœªå¼€å§‹</span><br>          <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;ç§’æ€å·²ç»ç»“æŸï¼&quot;</span>);<br>      &#125;<br>      <span class="hljs-comment">// 4.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span><br>      <span class="hljs-keyword">if</span> (voucher.getStock() &lt; <span class="hljs-number">1</span>) &#123;<br>          <span class="hljs-comment">// åº“å­˜ä¸è¶³</span><br>          <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);<br>      &#125;<br>      <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>      <span class="hljs-comment">//åˆ›å»ºé”å¯¹è±¡(æ–°å¢ä»£ç )</span><br>      <span class="hljs-type">SimpleRedisLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleRedisLock</span>(<span class="hljs-string">&quot;order:&quot;</span> + userId, stringRedisTemplate);<br>      <span class="hljs-comment">//è·å–é”å¯¹è±¡</span><br>      <span class="hljs-type">boolean</span> <span class="hljs-variable">isLock</span> <span class="hljs-operator">=</span> lock.tryLock(<span class="hljs-number">1200</span>);<br><span class="hljs-comment">//åŠ é”å¤±è´¥</span><br>      <span class="hljs-keyword">if</span> (!isLock) &#123;<br>          <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;ä¸å…è®¸é‡å¤ä¸‹å•&quot;</span>);<br>      &#125;<br>      <span class="hljs-keyword">try</span> &#123;<br>          <span class="hljs-comment">//è·å–ä»£ç†å¯¹è±¡(äº‹åŠ¡)</span><br>          <span class="hljs-type">IVoucherOrderService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (IVoucherOrderService) AopContext.currentProxy();<br>          <span class="hljs-keyword">return</span> proxy.createVoucherOrder(voucherId);<br>      &#125; <span class="hljs-keyword">finally</span> &#123;<br>          <span class="hljs-comment">//é‡Šæ”¾é”</span><br>          lock.unlock();<br>      &#125;<br>  &#125;<br></code></pre></td></tr></table></figure><h3 id="4-4-Redisåˆ†å¸ƒå¼é”è¯¯åˆ æƒ…å†µè¯´æ˜"><a href="#4-4-Redisåˆ†å¸ƒå¼é”è¯¯åˆ æƒ…å†µè¯´æ˜" class="headerlink" title="4.4 Redisåˆ†å¸ƒå¼é”è¯¯åˆ æƒ…å†µè¯´æ˜"></a>4.4 Redisåˆ†å¸ƒå¼é”è¯¯åˆ æƒ…å†µè¯´æ˜</h3><p>é€»è¾‘è¯´æ˜ï¼š</p><p>æŒæœ‰é”çš„çº¿ç¨‹åœ¨é”çš„å†…éƒ¨å‡ºç°äº†é˜»å¡ï¼Œå¯¼è‡´ä»–çš„é”è‡ªåŠ¨é‡Šæ”¾ï¼Œè¿™æ—¶å…¶ä»–çº¿ç¨‹ï¼Œçº¿ç¨‹2æ¥å°è¯•è·å¾—é”ï¼Œå°±æ‹¿åˆ°äº†è¿™æŠŠé”ï¼Œç„¶åçº¿ç¨‹2åœ¨æŒæœ‰é”æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹1ååº”è¿‡æ¥ï¼Œç»§ç»­æ‰§è¡Œï¼Œè€Œçº¿ç¨‹1æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œèµ°åˆ°äº†åˆ é™¤é”é€»è¾‘ï¼Œæ­¤æ—¶å°±ä¼šæŠŠæœ¬åº”è¯¥å±äºçº¿ç¨‹2çš„é”è¿›è¡Œåˆ é™¤ï¼Œè¿™å°±æ˜¯è¯¯åˆ åˆ«äººé”çš„æƒ…å†µè¯´æ˜</p><p>è§£å†³æ–¹æ¡ˆï¼šè§£å†³æ–¹æ¡ˆå°±æ˜¯åœ¨æ¯ä¸ªçº¿ç¨‹é‡Šæ”¾é”çš„æ—¶å€™ï¼Œå»åˆ¤æ–­ä¸€ä¸‹å½“å‰è¿™æŠŠé”æ˜¯å¦å±äºè‡ªå·±ï¼Œå¦‚æœå±äºè‡ªå·±ï¼Œåˆ™ä¸è¿›è¡Œé”çš„åˆ é™¤ï¼Œå‡è®¾è¿˜æ˜¯ä¸Šè¾¹çš„æƒ…å†µï¼Œçº¿ç¨‹1å¡é¡¿ï¼Œé”è‡ªåŠ¨é‡Šæ”¾ï¼Œçº¿ç¨‹2è¿›å…¥åˆ°é”çš„å†…éƒ¨æ‰§è¡Œé€»è¾‘ï¼Œæ­¤æ—¶çº¿ç¨‹1ååº”è¿‡æ¥ï¼Œç„¶ååˆ é™¤é”ï¼Œä½†æ˜¯çº¿ç¨‹1ï¼Œä¸€çœ‹å½“å‰è¿™æŠŠé”ä¸æ˜¯å±äºè‡ªå·±ï¼Œäºæ˜¯ä¸è¿›è¡Œåˆ é™¤é”é€»è¾‘ï¼Œå½“çº¿ç¨‹2èµ°åˆ°åˆ é™¤é”é€»è¾‘æ—¶ï¼Œå¦‚æœæ²¡æœ‰å¡è¿‡è‡ªåŠ¨é‡Šæ”¾é”çš„æ—¶é—´ç‚¹ï¼Œåˆ™åˆ¤æ–­å½“å‰è¿™æŠŠé”æ˜¯å±äºè‡ªå·±çš„ï¼Œäºæ˜¯åˆ é™¤è¿™æŠŠé”ã€‚</p><p><img src="/20221205120000/1653385920025.png" alt="1653385920025"></p><h3 id="4-5-è§£å†³Redisåˆ†å¸ƒå¼é”è¯¯åˆ é—®é¢˜"><a href="#4-5-è§£å†³Redisåˆ†å¸ƒå¼é”è¯¯åˆ é—®é¢˜" class="headerlink" title="4.5 è§£å†³Redisåˆ†å¸ƒå¼é”è¯¯åˆ é—®é¢˜"></a>4.5 è§£å†³Redisåˆ†å¸ƒå¼é”è¯¯åˆ é—®é¢˜</h3><p>éœ€æ±‚ï¼šä¿®æ”¹ä¹‹å‰çš„åˆ†å¸ƒå¼é”å®ç°ï¼Œæ»¡è¶³ï¼šåœ¨è·å–é”æ—¶å­˜å…¥çº¿ç¨‹æ ‡ç¤ºï¼ˆå¯ä»¥ç”¨UUIDè¡¨ç¤ºï¼‰<br>åœ¨é‡Šæ”¾é”æ—¶å…ˆè·å–é”ä¸­çš„çº¿ç¨‹æ ‡ç¤ºï¼Œåˆ¤æ–­æ˜¯å¦ä¸å½“å‰çº¿ç¨‹æ ‡ç¤ºä¸€è‡´</p><ul><li>å¦‚æœä¸€è‡´åˆ™é‡Šæ”¾é”</li><li>å¦‚æœä¸ä¸€è‡´åˆ™ä¸é‡Šæ”¾é”</li></ul><p>æ ¸å¿ƒé€»è¾‘ï¼šåœ¨å­˜å…¥é”æ—¶ï¼Œæ”¾å…¥è‡ªå·±çº¿ç¨‹çš„æ ‡è¯†ï¼Œåœ¨åˆ é™¤é”æ—¶ï¼Œåˆ¤æ–­å½“å‰è¿™æŠŠé”çš„æ ‡è¯†æ˜¯ä¸æ˜¯è‡ªå·±å­˜å…¥çš„ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿›è¡Œåˆ é™¤ï¼Œå¦‚æœä¸æ˜¯ï¼Œåˆ™ä¸è¿›è¡Œåˆ é™¤ã€‚</p><p><img src="/20221205120000/1653387398820.png" alt="1653387398820"></p><p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼šåŠ é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">ID_PREFIX</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString(<span class="hljs-literal">true</span>) + <span class="hljs-string">&quot;-&quot;</span>;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">tryLock</span><span class="hljs-params">(<span class="hljs-type">long</span> timeoutSec)</span> &#123;<br>   <span class="hljs-comment">// è·å–çº¿ç¨‹æ ‡ç¤º</span><br>   <span class="hljs-type">String</span> <span class="hljs-variable">threadId</span> <span class="hljs-operator">=</span> ID_PREFIX + Thread.currentThread().getId();<br>   <span class="hljs-comment">// è·å–é”</span><br>   <span class="hljs-type">Boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue()<br>                .setIfAbsent(KEY_PREFIX + name, threadId, timeoutSec, TimeUnit.SECONDS);<br>   <span class="hljs-keyword">return</span> Boolean.TRUE.equals(success);<br>&#125;<br></code></pre></td></tr></table></figure><p>é‡Šæ”¾é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// è·å–çº¿ç¨‹æ ‡ç¤º</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">threadId</span> <span class="hljs-operator">=</span> ID_PREFIX + Thread.currentThread().getId();<br>    <span class="hljs-comment">// è·å–é”ä¸­çš„æ ‡ç¤º</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">id</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue().get(KEY_PREFIX + name);<br>    <span class="hljs-comment">// åˆ¤æ–­æ ‡ç¤ºæ˜¯å¦ä¸€è‡´</span><br>    <span class="hljs-keyword">if</span>(threadId.equals(id)) &#123;<br>        <span class="hljs-comment">// é‡Šæ”¾é”</span><br>        stringRedisTemplate.delete(KEY_PREFIX + name);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>æœ‰å…³ä»£ç å®æ“è¯´æ˜ï¼š</strong></p><p>åœ¨æˆ‘ä»¬ä¿®æ”¹å®Œæ­¤å¤„ä»£ç åï¼Œæˆ‘ä»¬é‡å¯å·¥ç¨‹ï¼Œç„¶åå¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹ï¼Œç¬¬ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”åï¼Œæ‰‹åŠ¨é‡Šæ”¾é”ï¼Œç¬¬äºŒä¸ªçº¿ç¨‹ æ­¤æ—¶è¿›å…¥åˆ°é”å†…éƒ¨ï¼Œå†æ”¾è¡Œç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªçº¿ç¨‹ç”±äºé”çš„valueå€¼å¹¶éæ˜¯è‡ªå·±ï¼Œæ‰€ä»¥ä¸èƒ½é‡Šæ”¾é”ï¼Œä¹Ÿå°±æ— æ³•åˆ é™¤åˆ«äººçš„é”ï¼Œæ­¤æ—¶ç¬¬äºŒä¸ªçº¿ç¨‹èƒ½å¤Ÿæ­£ç¡®é‡Šæ”¾é”ï¼Œé€šè¿‡è¿™ä¸ªæ¡ˆä¾‹åˆæ­¥è¯´æ˜æˆ‘ä»¬è§£å†³äº†é”è¯¯åˆ çš„é—®é¢˜ã€‚</p><h3 id="4-6-åˆ†å¸ƒå¼é”çš„åŸå­æ€§é—®é¢˜"><a href="#4-6-åˆ†å¸ƒå¼é”çš„åŸå­æ€§é—®é¢˜" class="headerlink" title="4.6 åˆ†å¸ƒå¼é”çš„åŸå­æ€§é—®é¢˜"></a>4.6 åˆ†å¸ƒå¼é”çš„åŸå­æ€§é—®é¢˜</h3><p>æ›´ä¸ºæç«¯çš„è¯¯åˆ é€»è¾‘è¯´æ˜ï¼š</p><p>çº¿ç¨‹1ç°åœ¨æŒæœ‰é”ä¹‹åï¼Œåœ¨æ‰§è¡Œä¸šåŠ¡é€»è¾‘è¿‡ç¨‹ä¸­ï¼Œä»–æ­£å‡†å¤‡åˆ é™¤é”ï¼Œè€Œä¸”å·²ç»èµ°åˆ°äº†æ¡ä»¶åˆ¤æ–­çš„è¿‡ç¨‹ä¸­ï¼Œæ¯”å¦‚ä»–å·²ç»æ‹¿åˆ°äº†å½“å‰è¿™æŠŠé”ç¡®å®æ˜¯å±äºä»–è‡ªå·±çš„ï¼Œæ­£å‡†å¤‡åˆ é™¤é”ï¼Œä½†æ˜¯æ­¤æ—¶ä»–çš„é”åˆ°æœŸäº†ï¼Œé‚£ä¹ˆæ­¤æ—¶çº¿ç¨‹2è¿›æ¥ï¼Œä½†æ˜¯çº¿ç¨‹1ä»–ä¼šæ¥ç€å¾€åæ‰§è¡Œï¼Œå½“ä»–å¡é¡¿ç»“æŸåï¼Œä»–ç›´æ¥å°±ä¼šæ‰§è¡Œåˆ é™¤é”é‚£è¡Œä»£ç ï¼Œç›¸å½“äºæ¡ä»¶åˆ¤æ–­å¹¶æ²¡æœ‰èµ·åˆ°ä½œç”¨ï¼Œè¿™å°±æ˜¯åˆ é”æ—¶çš„åŸå­æ€§é—®é¢˜ï¼Œä¹‹æ‰€ä»¥æœ‰è¿™ä¸ªé—®é¢˜ï¼Œæ˜¯å› ä¸ºçº¿ç¨‹1çš„æ‹¿é”ï¼Œæ¯”é”ï¼Œåˆ é”ï¼Œå®é™…ä¸Šå¹¶ä¸æ˜¯åŸå­æ€§çš„ï¼Œæˆ‘ä»¬è¦é˜²æ­¢åˆšæ‰çš„æƒ…å†µå‘ç”Ÿï¼Œ</p><p><img src="/20221205120000/1653387764938.png" alt="1653387764938"></p><h3 id="4-7-Luaè„šæœ¬è§£å†³å¤šæ¡å‘½ä»¤åŸå­æ€§é—®é¢˜"><a href="#4-7-Luaè„šæœ¬è§£å†³å¤šæ¡å‘½ä»¤åŸå­æ€§é—®é¢˜" class="headerlink" title="4.7 Luaè„šæœ¬è§£å†³å¤šæ¡å‘½ä»¤åŸå­æ€§é—®é¢˜"></a>4.7 Luaè„šæœ¬è§£å†³å¤šæ¡å‘½ä»¤åŸå­æ€§é—®é¢˜</h3><p>Redisæä¾›äº†Luaè„šæœ¬åŠŸèƒ½ï¼Œåœ¨ä¸€ä¸ªè„šæœ¬ä¸­ç¼–å†™å¤šæ¡Rediså‘½ä»¤ï¼Œç¡®ä¿å¤šæ¡å‘½ä»¤æ‰§è¡Œæ—¶çš„åŸå­æ€§ã€‚Luaæ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒçš„åŸºæœ¬è¯­æ³•å¤§å®¶å¯ä»¥å‚è€ƒç½‘ç«™ï¼š<a href="https://www.runoob.com/lua/lua-tutorial.html%EF%BC%8C%E8%BF%99%E9%87%8C%E9%87%8D%E7%82%B9%E4%BB%8B%E7%BB%8DRedis%E6%8F%90%E4%BE%9B%E7%9A%84%E8%B0%83%E7%94%A8%E5%87%BD%E6%95%B0%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8lua%E5%8E%BB%E6%93%8D%E4%BD%9Credis%EF%BC%8C%E5%8F%88%E8%83%BD%E4%BF%9D%E8%AF%81%E4%BB%96%E7%9A%84%E5%8E%9F%E5%AD%90%E6%80%A7%EF%BC%8C%E8%BF%99%E6%A0%B7%E5%B0%B1%E5%8F%AF%E4%BB%A5%E5%AE%9E%E7%8E%B0%E6%8B%BF%E9%94%81%E6%AF%94%E9%94%81%E5%88%A0%E9%94%81%E6%98%AF%E4%B8%80%E4%B8%AA%E5%8E%9F%E5%AD%90%E6%80%A7%E5%8A%A8%E4%BD%9C%E4%BA%86%EF%BC%8C%E4%BD%9C%E4%B8%BAJava%E7%A8%8B%E5%BA%8F%E5%91%98%E8%BF%99%E4%B8%80%E5%9D%97%E5%B9%B6%E4%B8%8D%E4%BD%9C%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E8%A6%81%E6%B1%82%EF%BC%8C%E5%B9%B6%E4%B8%8D%E9%9C%80%E8%A6%81%E5%A4%A7%E5%AE%B6%E8%BF%87%E4%BA%8E%E7%B2%BE%E9%80%9A%EF%BC%8C%E5%8F%AA%E9%9C%80%E8%A6%81%E7%9F%A5%E9%81%93%E4%BB%96%E6%9C%89%E4%BB%80%E4%B9%88%E4%BD%9C%E7%94%A8%E5%8D%B3%E5%8F%AF%E3%80%82">https://www.runoob.com/lua/lua-tutorial.htmlï¼Œè¿™é‡Œé‡ç‚¹ä»‹ç»Redisæä¾›çš„è°ƒç”¨å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨luaå»æ“ä½œredisï¼Œåˆèƒ½ä¿è¯ä»–çš„åŸå­æ€§ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°æ‹¿é”æ¯”é”åˆ é”æ˜¯ä¸€ä¸ªåŸå­æ€§åŠ¨ä½œäº†ï¼Œä½œä¸ºJavaç¨‹åºå‘˜è¿™ä¸€å—å¹¶ä¸ä½œä¸€ä¸ªç®€å•è¦æ±‚ï¼Œå¹¶ä¸éœ€è¦å¤§å®¶è¿‡äºç²¾é€šï¼Œåªéœ€è¦çŸ¥é“ä»–æœ‰ä»€ä¹ˆä½œç”¨å³å¯ã€‚</a></p><p>è¿™é‡Œé‡ç‚¹ä»‹ç»Redisæä¾›çš„è°ƒç”¨å‡½æ•°ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs lua">redis.call(<span class="hljs-string">&#x27;å‘½ä»¤åç§°&#x27;</span>, <span class="hljs-string">&#x27;key&#x27;</span>, <span class="hljs-string">&#x27;å…¶å®ƒå‚æ•°&#x27;</span>, ...)<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦æ‰§è¡Œset name jackï¼Œåˆ™è„šæœ¬æ˜¯è¿™æ ·ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs lua"># æ‰§è¡Œ set name jack<br>redis.call(<span class="hljs-string">&#x27;set&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;jack&#x27;</span>)<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦å…ˆæ‰§è¡Œset name Roseï¼Œå†æ‰§è¡Œget nameï¼Œåˆ™è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs lua"># å…ˆæ‰§è¡Œ set name jack<br>redis.call(<span class="hljs-string">&#x27;set&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;Rose&#x27;</span>)<br># å†æ‰§è¡Œ get name<br><span class="hljs-keyword">local</span> name = redis.call(<span class="hljs-string">&#x27;get&#x27;</span>, <span class="hljs-string">&#x27;name&#x27;</span>)<br># è¿”å›<br><span class="hljs-keyword">return</span> name<br></code></pre></td></tr></table></figure><p>å†™å¥½è„šæœ¬ä»¥åï¼Œéœ€è¦ç”¨Rediså‘½ä»¤æ¥è°ƒç”¨è„šæœ¬ï¼Œè°ƒç”¨è„šæœ¬çš„å¸¸è§å‘½ä»¤å¦‚ä¸‹ï¼š</p><p><img src="/20221205120000/1653392181413.png" alt="1653392181413"></p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦æ‰§è¡Œ redis.call(â€˜setâ€™, â€˜nameâ€™, â€˜jackâ€™) è¿™ä¸ªè„šæœ¬ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š</p><p><img src="/20221205120000/1653392218531.png" alt="1653392218531"></p><p>å¦‚æœè„šæœ¬ä¸­çš„keyã€valueä¸æƒ³å†™æ­»ï¼Œå¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ã€‚keyç±»å‹å‚æ•°ä¼šæ”¾å…¥KEYSæ•°ç»„ï¼Œå…¶å®ƒå‚æ•°ä¼šæ”¾å…¥ARGVæ•°ç»„ï¼Œåœ¨è„šæœ¬ä¸­å¯ä»¥ä»KEYSå’ŒARGVæ•°ç»„è·å–è¿™äº›å‚æ•°ï¼š</p><p><img src="/20221205120000/1653392438917.png" alt="1653392438917"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å›ä¸€ä¸‹æˆ‘ä»¬é‡Šæ”¾é”çš„é€»è¾‘ï¼š</p><p>é‡Šæ”¾é”çš„ä¸šåŠ¡æµç¨‹æ˜¯è¿™æ ·çš„</p><p>â€‹1ã€è·å–é”ä¸­çš„çº¿ç¨‹æ ‡ç¤º</p><p>â€‹2ã€åˆ¤æ–­æ˜¯å¦ä¸æŒ‡å®šçš„æ ‡ç¤ºï¼ˆå½“å‰çº¿ç¨‹æ ‡ç¤ºï¼‰ä¸€è‡´</p><p>â€‹3ã€å¦‚æœä¸€è‡´åˆ™é‡Šæ”¾é”ï¼ˆåˆ é™¤ï¼‰</p><p>â€‹4ã€å¦‚æœä¸ä¸€è‡´åˆ™ä»€ä¹ˆéƒ½ä¸åš</p><p>å¦‚æœç”¨Luaè„šæœ¬æ¥è¡¨ç¤ºåˆ™æ˜¯è¿™æ ·çš„ï¼š</p><p>æœ€ç»ˆæˆ‘ä»¬æ“ä½œredisçš„æ‹¿é”æ¯”é”åˆ é”çš„luaè„šæœ¬å°±ä¼šå˜æˆè¿™æ ·</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">-- è¿™é‡Œçš„ KEYS[1] å°±æ˜¯é”çš„keyï¼Œè¿™é‡Œçš„ARGV[1] å°±æ˜¯å½“å‰çº¿ç¨‹æ ‡ç¤º</span><br><span class="hljs-comment">-- è·å–é”ä¸­çš„æ ‡ç¤ºï¼Œåˆ¤æ–­æ˜¯å¦ä¸å½“å‰çº¿ç¨‹æ ‡ç¤ºä¸€è‡´</span><br><span class="hljs-keyword">if</span> (redis.call(<span class="hljs-string">&#x27;GET&#x27;</span>, KEYS[<span class="hljs-number">1</span>]) == ARGV[<span class="hljs-number">1</span>]) <span class="hljs-keyword">then</span><br>  <span class="hljs-comment">-- ä¸€è‡´ï¼Œåˆ™åˆ é™¤é”</span><br>  <span class="hljs-keyword">return</span> redis.call(<span class="hljs-string">&#x27;DEL&#x27;</span>, KEYS[<span class="hljs-number">1</span>])<br><span class="hljs-keyword">end</span><br><span class="hljs-comment">-- ä¸ä¸€è‡´ï¼Œåˆ™ç›´æ¥è¿”å›</span><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h3 id="4-8-åˆ©ç”¨Javaä»£ç è°ƒç”¨Luaè„šæœ¬æ”¹é€ åˆ†å¸ƒå¼é”"><a href="#4-8-åˆ©ç”¨Javaä»£ç è°ƒç”¨Luaè„šæœ¬æ”¹é€ åˆ†å¸ƒå¼é”" class="headerlink" title="4.8 åˆ©ç”¨Javaä»£ç è°ƒç”¨Luaè„šæœ¬æ”¹é€ åˆ†å¸ƒå¼é”"></a>4.8 åˆ©ç”¨Javaä»£ç è°ƒç”¨Luaè„šæœ¬æ”¹é€ åˆ†å¸ƒå¼é”</h3><p>luaè„šæœ¬æœ¬èº«å¹¶ä¸éœ€è¦å¤§å®¶èŠ±è´¹å¤ªå¤šæ—¶é—´å»ç ”ç©¶ï¼Œåªéœ€è¦çŸ¥é“å¦‚ä½•è°ƒç”¨ï¼Œå¤§è‡´æ˜¯ä»€ä¹ˆæ„æ€å³å¯ï¼Œæ‰€ä»¥åœ¨ç¬”è®°ä¸­å¹¶ä¸ä¼šè¯¦ç»†çš„å»è§£é‡Šè¿™äº›luaè¡¨è¾¾å¼çš„å«ä¹‰ã€‚</p><p>æˆ‘ä»¬çš„RedisTemplateä¸­ï¼Œå¯ä»¥åˆ©ç”¨executeæ–¹æ³•å»æ‰§è¡Œluaè„šæœ¬ï¼Œå‚æ•°å¯¹åº”å…³ç³»å°±å¦‚ä¸‹å›¾è‚¡</p><p><img src="/20221205120000/1653393304844.png" alt="1653393304844"></p><p><strong>Javaä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> DefaultRedisScript&lt;Long&gt; UNLOCK_SCRIPT;<br>    <span class="hljs-keyword">static</span> &#123;<br>        UNLOCK_SCRIPT = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRedisScript</span>&lt;&gt;();<br>        UNLOCK_SCRIPT.setLocation(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathResource</span>(<span class="hljs-string">&quot;unlock.lua&quot;</span>));<br>        UNLOCK_SCRIPT.setResultType(Long.class);<br>    &#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// è°ƒç”¨luaè„šæœ¬</span><br>    stringRedisTemplate.execute(<br>            UNLOCK_SCRIPT,<br>            Collections.singletonList(KEY_PREFIX + name),<br>            ID_PREFIX + Thread.currentThread().getId());<br>&#125;<br>ç»è¿‡ä»¥ä¸Šä»£ç æ”¹é€ åï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿå®ç° æ‹¿é”æ¯”é”åˆ é”çš„åŸå­æ€§åŠ¨ä½œäº†~<br></code></pre></td></tr></table></figure><p>å°æ€»ç»“ï¼š</p><p>åŸºäºRedisçš„åˆ†å¸ƒå¼é”å®ç°æ€è·¯ï¼š</p><ul><li>åˆ©ç”¨set nx exè·å–é”ï¼Œå¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä¿å­˜çº¿ç¨‹æ ‡ç¤º</li><li>é‡Šæ”¾é”æ—¶å…ˆåˆ¤æ–­çº¿ç¨‹æ ‡ç¤ºæ˜¯å¦ä¸è‡ªå·±ä¸€è‡´ï¼Œä¸€è‡´åˆ™åˆ é™¤é”<ul><li>ç‰¹æ€§ï¼š<ul><li>åˆ©ç”¨set nxæ»¡è¶³äº’æ–¥æ€§</li><li>åˆ©ç”¨set exä¿è¯æ•…éšœæ—¶é”ä¾ç„¶èƒ½é‡Šæ”¾ï¼Œé¿å…æ­»é”ï¼Œæé«˜å®‰å…¨æ€§</li><li>åˆ©ç”¨Redisé›†ç¾¤ä¿è¯é«˜å¯ç”¨å’Œé«˜å¹¶å‘ç‰¹æ€§</li></ul></li></ul></li></ul><p>ç¬”è€…æ€»ç»“ï¼šæˆ‘ä»¬ä¸€è·¯èµ°æ¥ï¼Œåˆ©ç”¨æ·»åŠ è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢æ­»é”é—®é¢˜çš„å‘ç”Ÿï¼Œä½†æ˜¯æœ‰äº†è¿‡æœŸæ—¶é—´ä¹‹åï¼Œå¯èƒ½å‡ºç°è¯¯åˆ åˆ«äººé”çš„é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜æˆ‘ä»¬å¼€å§‹æ˜¯åˆ©ç”¨åˆ ä¹‹å‰ é€šè¿‡æ‹¿é”ï¼Œæ¯”é”ï¼Œåˆ é”è¿™ä¸ªé€»è¾‘æ¥è§£å†³çš„ï¼Œä¹Ÿå°±æ˜¯åˆ ä¹‹å‰åˆ¤æ–­ä¸€ä¸‹å½“å‰è¿™æŠŠé”æ˜¯å¦æ˜¯å±äºè‡ªå·±çš„ï¼Œä½†æ˜¯ç°åœ¨è¿˜æœ‰åŸå­æ€§é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ²¡æ³•ä¿è¯æ‹¿é”æ¯”é”åˆ é”æ˜¯ä¸€ä¸ªåŸå­æ€§çš„åŠ¨ä½œï¼Œæœ€åé€šè¿‡luaè¡¨è¾¾å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜</p><p>ä½†æ˜¯ç›®å‰è¿˜å‰©ä¸‹ä¸€ä¸ªé—®é¢˜é”ä¸ä½ï¼Œä»€ä¹ˆæ˜¯é”ä¸ä½å‘¢ï¼Œä½ æƒ³ä¸€æƒ³ï¼Œå¦‚æœå½“è¿‡æœŸæ—¶é—´åˆ°äº†ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç»™ä»–ç»­æœŸä¸€ä¸‹ï¼Œæ¯”å¦‚ç»­ä¸ª30sï¼Œå°±å¥½åƒæ˜¯ç½‘å§ä¸Šç½‘ï¼Œ ç½‘è´¹åˆ°äº†ä¹‹åï¼Œç„¶åè¯´ï¼Œæ¥ï¼Œç½‘ç®¡ï¼Œå†ç»™æˆ‘æ¥10å—çš„ï¼Œæ˜¯ä¸æ˜¯åè¾¹çš„é—®é¢˜éƒ½ä¸ä¼šå‘ç”Ÿäº†ï¼Œé‚£ä¹ˆç»­æœŸé—®é¢˜æ€ä¹ˆè§£å†³å‘¢ï¼Œå¯ä»¥ä¾èµ–äºæˆ‘ä»¬æ¥ä¸‹æ¥è¦å­¦ä¹ redissionå•¦</p><p><strong>æµ‹è¯•é€»è¾‘ï¼š</strong></p><p>ç¬¬ä¸€ä¸ªçº¿ç¨‹è¿›æ¥ï¼Œå¾—åˆ°äº†é”ï¼Œæ‰‹åŠ¨åˆ é™¤é”ï¼Œæ¨¡æ‹Ÿé”è¶…æ—¶äº†ï¼Œå…¶ä»–çº¿ç¨‹ä¼šæ‰§è¡Œluaæ¥æŠ¢é”ï¼Œå½“ç¬¬ä¸€å¤©çº¿ç¨‹åˆ©ç”¨luaåˆ é™¤é”æ—¶ï¼Œluaèƒ½ä¿è¯ä»–ä¸èƒ½åˆ é™¤ä»–çš„é”ï¼Œç¬¬äºŒä¸ªçº¿ç¨‹åˆ é™¤é”æ—¶ï¼Œåˆ©ç”¨luaåŒæ ·å¯ä»¥ä¿è¯ä¸ä¼šåˆ é™¤åˆ«äººçš„é”ï¼ŒåŒæ—¶è¿˜èƒ½ä¿è¯åŸå­æ€§ã€‚</p><h2 id="5ã€åˆ†å¸ƒå¼é”-redission"><a href="#5ã€åˆ†å¸ƒå¼é”-redission" class="headerlink" title="5ã€åˆ†å¸ƒå¼é”-redission"></a>5ã€åˆ†å¸ƒå¼é”-redission</h2><h3 id="5-1-åˆ†å¸ƒå¼é”-redissionåŠŸèƒ½ä»‹ç»"><a href="#5-1-åˆ†å¸ƒå¼é”-redissionåŠŸèƒ½ä»‹ç»" class="headerlink" title="5.1 åˆ†å¸ƒå¼é”-redissionåŠŸèƒ½ä»‹ç»"></a>5.1 åˆ†å¸ƒå¼é”-redissionåŠŸèƒ½ä»‹ç»</h3><p>åŸºäºsetnxå®ç°çš„åˆ†å¸ƒå¼é”å­˜åœ¨ä¸‹é¢çš„é—®é¢˜ï¼š</p><p><strong>é‡å…¥é—®é¢˜</strong>ï¼šé‡å…¥é—®é¢˜æ˜¯æŒ‡ è·å¾—é”çš„çº¿ç¨‹å¯ä»¥å†æ¬¡è¿›å…¥åˆ°ç›¸åŒçš„é”çš„ä»£ç å—ä¸­ï¼Œå¯é‡å…¥é”çš„æ„ä¹‰åœ¨äºé˜²æ­¢æ­»é”ï¼Œæ¯”å¦‚HashTableè¿™æ ·çš„ä»£ç ä¸­ï¼Œä»–çš„æ–¹æ³•éƒ½æ˜¯ä½¿ç”¨synchronizedä¿®é¥°çš„ï¼Œå‡å¦‚ä»–åœ¨ä¸€ä¸ªæ–¹æ³•å†…ï¼Œè°ƒç”¨å¦ä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆæ­¤æ—¶å¦‚æœæ˜¯ä¸å¯é‡å…¥çš„ï¼Œä¸å°±æ­»é”äº†å—ï¼Ÿæ‰€ä»¥å¯é‡å…¥é”ä»–çš„ä¸»è¦æ„ä¹‰æ˜¯é˜²æ­¢æ­»é”ï¼Œæˆ‘ä»¬çš„synchronizedå’ŒLocké”éƒ½æ˜¯å¯é‡å…¥çš„ã€‚</p><p><strong>ä¸å¯é‡è¯•</strong>ï¼šæ˜¯æŒ‡ç›®å‰çš„åˆ†å¸ƒå¼åªèƒ½å°è¯•ä¸€æ¬¡ï¼Œæˆ‘ä»¬è®¤ä¸ºåˆç†çš„æƒ…å†µæ˜¯ï¼šå½“çº¿ç¨‹åœ¨è·å¾—é”å¤±è´¥åï¼Œä»–åº”è¯¥èƒ½å†æ¬¡å°è¯•è·å¾—é”ã€‚</p><p><strong>è¶…æ—¶é‡Šæ”¾ï¼š</strong>æˆ‘ä»¬åœ¨åŠ é”æ—¶å¢åŠ äº†è¿‡æœŸæ—¶é—´ï¼Œè¿™æ ·çš„æˆ‘ä»¬å¯ä»¥é˜²æ­¢æ­»é”ï¼Œä½†æ˜¯å¦‚æœå¡é¡¿çš„æ—¶é—´è¶…é•¿ï¼Œè™½ç„¶æˆ‘ä»¬é‡‡ç”¨äº†luaè¡¨è¾¾å¼é˜²æ­¢åˆ é”çš„æ—¶å€™ï¼Œè¯¯åˆ åˆ«äººçš„é”ï¼Œä½†æ˜¯æ¯•ç«Ÿæ²¡æœ‰é”ä½ï¼Œæœ‰å®‰å…¨éšæ‚£</p><p><strong>ä¸»ä»ä¸€è‡´æ€§ï¼š</strong> å¦‚æœRedisæä¾›äº†ä¸»ä»é›†ç¾¤ï¼Œå½“æˆ‘ä»¬å‘é›†ç¾¤å†™æ•°æ®æ—¶ï¼Œä¸»æœºéœ€è¦å¼‚æ­¥çš„å°†æ•°æ®åŒæ­¥ç»™ä»æœºï¼Œè€Œä¸‡ä¸€åœ¨åŒæ­¥è¿‡å»ä¹‹å‰ï¼Œä¸»æœºå®•æœºäº†ï¼Œå°±ä¼šå‡ºç°æ­»é”é—®é¢˜ã€‚</p><p><img src="/20221205120000/1653546070602.png" alt="1653546070602"></p><p>é‚£ä¹ˆä»€ä¹ˆæ˜¯Redissionå‘¢</p><p>Redissonæ˜¯ä¸€ä¸ªåœ¨Redisçš„åŸºç¡€ä¸Šå®ç°çš„Javaé©»å†…å­˜æ•°æ®ç½‘æ ¼ï¼ˆIn-Memory Data Gridï¼‰ã€‚å®ƒä¸ä»…æä¾›äº†ä¸€ç³»åˆ—çš„åˆ†å¸ƒå¼çš„Javaå¸¸ç”¨å¯¹è±¡ï¼Œè¿˜æä¾›äº†è®¸å¤šåˆ†å¸ƒå¼æœåŠ¡ï¼Œå…¶ä¸­å°±åŒ…å«äº†å„ç§åˆ†å¸ƒå¼é”çš„å®ç°ã€‚</p><p>Redissionæä¾›äº†åˆ†å¸ƒå¼é”çš„å¤šç§å¤šæ ·çš„åŠŸèƒ½</p><p><img src="/20221205120000/1653546736063.png" alt="1653546736063"></p><h3 id="5-2-åˆ†å¸ƒå¼é”-Redissionå¿«é€Ÿå…¥é—¨"><a href="#5-2-åˆ†å¸ƒå¼é”-Redissionå¿«é€Ÿå…¥é—¨" class="headerlink" title="5.2 åˆ†å¸ƒå¼é”-Redissionå¿«é€Ÿå…¥é—¨"></a>5.2 åˆ†å¸ƒå¼é”-Redissionå¿«é€Ÿå…¥é—¨</h3><p>å¼•å…¥ä¾èµ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>&lt;groupId&gt;org.redisson&lt;/groupId&gt;<br>&lt;artifactId&gt;redisson&lt;/artifactId&gt;<br>&lt;version&gt;<span class="hljs-number">3.13</span><span class="hljs-number">.6</span>&lt;/version&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><p>é…ç½®Redissonå®¢æˆ·ç«¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedissonConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> RedissonClient <span class="hljs-title function_">redissonClient</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">// é…ç½®</span><br>        <span class="hljs-type">Config</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Config</span>();<br>        config.useSingleServer().setAddress(<span class="hljs-string">&quot;redis://192.168.150.101:6379&quot;</span>)<br>            .setPassword(<span class="hljs-string">&quot;123321&quot;</span>);<br>        <span class="hljs-comment">// åˆ›å»ºRedissonClientå¯¹è±¡</span><br>        <span class="hljs-keyword">return</span> Redisson.create(config);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>å¦‚ä½•ä½¿ç”¨Redissionçš„åˆ†å¸ƒå¼é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Resource</span><br><span class="hljs-keyword">private</span> RedissionClient redissonClient;<br><br><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">testRedisson</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception&#123;<br>    <span class="hljs-comment">//è·å–é”(å¯é‡å…¥)ï¼ŒæŒ‡å®šé”çš„åç§°</span><br>    <span class="hljs-type">RLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redissonClient.getLock(<span class="hljs-string">&quot;anyLock&quot;</span>);<br>    <span class="hljs-comment">//å°è¯•è·å–é”ï¼Œå‚æ•°åˆ†åˆ«æ˜¯ï¼šè·å–é”çš„æœ€å¤§ç­‰å¾…æ—¶é—´(æœŸé—´ä¼šé‡è¯•)ï¼Œé”è‡ªåŠ¨é‡Šæ”¾æ—¶é—´ï¼Œæ—¶é—´å•ä½</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">isLock</span> <span class="hljs-operator">=</span> lock.tryLock(<span class="hljs-number">1</span>,<span class="hljs-number">10</span>,TimeUnit.SECONDS);<br>    <span class="hljs-comment">//åˆ¤æ–­è·å–é”æˆåŠŸ</span><br>    <span class="hljs-keyword">if</span>(isLock)&#123;<br>        <span class="hljs-keyword">try</span>&#123;<br>            System.out.println(<span class="hljs-string">&quot;æ‰§è¡Œä¸šåŠ¡&quot;</span>);          <br>        &#125;<span class="hljs-keyword">finally</span>&#123;<br>            <span class="hljs-comment">//é‡Šæ”¾é”</span><br>            lock.unlock();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ VoucherOrderServiceImpl</p><p>æ³¨å…¥RedissonClient</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Resource</span><br><span class="hljs-keyword">private</span> RedissonClient redissonClient;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">seckillVoucher</span><span class="hljs-params">(Long voucherId)</span> &#123;<br>        <span class="hljs-comment">// 1.æŸ¥è¯¢ä¼˜æƒ åˆ¸</span><br>        <span class="hljs-type">SeckillVoucher</span> <span class="hljs-variable">voucher</span> <span class="hljs-operator">=</span> seckillVoucherService.getById(voucherId);<br>        <span class="hljs-comment">// 2.åˆ¤æ–­ç§’æ€æ˜¯å¦å¼€å§‹</span><br>        <span class="hljs-keyword">if</span> (voucher.getBeginTime().isAfter(LocalDateTime.now())) &#123;<br>            <span class="hljs-comment">// å°šæœªå¼€å§‹</span><br>            <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;ç§’æ€å°šæœªå¼€å§‹ï¼&quot;</span>);<br>        &#125;<br>        <span class="hljs-comment">// 3.åˆ¤æ–­ç§’æ€æ˜¯å¦å·²ç»ç»“æŸ</span><br>        <span class="hljs-keyword">if</span> (voucher.getEndTime().isBefore(LocalDateTime.now())) &#123;<br>            <span class="hljs-comment">// å°šæœªå¼€å§‹</span><br>            <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;ç§’æ€å·²ç»ç»“æŸï¼&quot;</span>);<br>        &#125;<br>        <span class="hljs-comment">// 4.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³</span><br>        <span class="hljs-keyword">if</span> (voucher.getStock() &lt; <span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-comment">// åº“å­˜ä¸è¶³</span><br>            <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;åº“å­˜ä¸è¶³ï¼&quot;</span>);<br>        &#125;<br>        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>        <span class="hljs-comment">//åˆ›å»ºé”å¯¹è±¡ è¿™ä¸ªä»£ç ä¸ç”¨äº†ï¼Œå› ä¸ºæˆ‘ä»¬ç°åœ¨è¦ä½¿ç”¨åˆ†å¸ƒå¼é”</span><br>        <span class="hljs-comment">//SimpleRedisLock lock = new SimpleRedisLock(&quot;order:&quot; + userId, stringRedisTemplate);</span><br>        <span class="hljs-type">RLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redissonClient.getLock(<span class="hljs-string">&quot;lock:order:&quot;</span> + userId);<br>        <span class="hljs-comment">//è·å–é”å¯¹è±¡</span><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">isLock</span> <span class="hljs-operator">=</span> lock.tryLock();<br>       <br><span class="hljs-comment">//åŠ é”å¤±è´¥</span><br>        <span class="hljs-keyword">if</span> (!isLock) &#123;<br>            <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;ä¸å…è®¸é‡å¤ä¸‹å•&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//è·å–ä»£ç†å¯¹è±¡(äº‹åŠ¡)</span><br>            <span class="hljs-type">IVoucherOrderService</span> <span class="hljs-variable">proxy</span> <span class="hljs-operator">=</span> (IVoucherOrderService) AopContext.currentProxy();<br>            <span class="hljs-keyword">return</span> proxy.createVoucherOrder(voucherId);<br>        &#125; <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-comment">//é‡Šæ”¾é”</span><br>            lock.unlock();<br>        &#125;<br> &#125;<br></code></pre></td></tr></table></figure><h3 id="5-3-åˆ†å¸ƒå¼é”-redissionå¯é‡å…¥é”åŸç†"><a href="#5-3-åˆ†å¸ƒå¼é”-redissionå¯é‡å…¥é”åŸç†" class="headerlink" title="5.3 åˆ†å¸ƒå¼é”-redissionå¯é‡å…¥é”åŸç†"></a>5.3 åˆ†å¸ƒå¼é”-redissionå¯é‡å…¥é”åŸç†</h3><p>åœ¨Locké”ä¸­ï¼Œä»–æ˜¯å€ŸåŠ©äºåº•å±‚çš„ä¸€ä¸ªvoaltileçš„ä¸€ä¸ªstateå˜é‡æ¥è®°å½•é‡å…¥çš„çŠ¶æ€çš„ï¼Œæ¯”å¦‚å½“å‰æ²¡æœ‰äººæŒæœ‰è¿™æŠŠé”ï¼Œé‚£ä¹ˆstate&#x3D;0ï¼Œå‡å¦‚æœ‰äººæŒæœ‰è¿™æŠŠé”ï¼Œé‚£ä¹ˆstate&#x3D;1ï¼Œå¦‚æœæŒæœ‰è¿™æŠŠé”çš„äººå†æ¬¡æŒæœ‰è¿™æŠŠé”ï¼Œé‚£ä¹ˆstateå°±ä¼š+1 ï¼Œå¦‚æœæ˜¯å¯¹äºsynchronizedè€Œè¨€ï¼Œä»–åœ¨cè¯­è¨€ä»£ç ä¸­ä¼šæœ‰ä¸€ä¸ªcountï¼ŒåŸç†å’Œstateç±»ä¼¼ï¼Œä¹Ÿæ˜¯é‡å…¥ä¸€æ¬¡å°±åŠ ä¸€ï¼Œé‡Šæ”¾ä¸€æ¬¡å°±-1 ï¼Œç›´åˆ°å‡å°‘æˆ0 æ—¶ï¼Œè¡¨ç¤ºå½“å‰è¿™æŠŠé”æ²¡æœ‰è¢«äººæŒæœ‰ã€‚  </p><p>åœ¨redissionä¸­ï¼Œæˆ‘ä»¬çš„ä¹Ÿæ”¯æŒæ”¯æŒå¯é‡å…¥é”</p><p>åœ¨åˆ†å¸ƒå¼é”ä¸­ï¼Œä»–é‡‡ç”¨hashç»“æ„ç”¨æ¥å­˜å‚¨é”ï¼Œå…¶ä¸­å¤§keyè¡¨ç¤ºè¡¨ç¤ºè¿™æŠŠé”æ˜¯å¦å­˜åœ¨ï¼Œç”¨å°keyè¡¨ç¤ºå½“å‰è¿™æŠŠé”è¢«å“ªä¸ªçº¿ç¨‹æŒæœ‰ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·åˆ†æä¸€ä¸‹å½“å‰çš„è¿™ä¸ªluaè¡¨è¾¾å¼</p><p>è¿™ä¸ªåœ°æ–¹ä¸€å…±æœ‰3ä¸ªå‚æ•°</p><p><strong>KEYS[1] ï¼š é”åç§°</strong></p><p><strong>ARGV[1]ï¼š  é”å¤±æ•ˆæ—¶é—´</strong></p><p><strong>ARGV[2]ï¼š  id + â€œ:â€ + threadId; é”çš„å°key</strong></p><p>exists: åˆ¤æ–­æ•°æ®æ˜¯å¦å­˜åœ¨  nameï¼šæ˜¯lockæ˜¯å¦å­˜åœ¨,å¦‚æœ&#x3D;&#x3D;0ï¼Œå°±è¡¨ç¤ºå½“å‰è¿™æŠŠé”ä¸å­˜åœ¨</p><p>redis.call(â€˜hsetâ€™, KEYS[1], ARGV[2], 1);æ­¤æ—¶ä»–å°±å¼€å§‹å¾€redisé‡Œè¾¹å»å†™æ•°æ® ï¼Œå†™æˆä¸€ä¸ªhashç»“æ„</p><p>Lock{</p><p>â€‹    id + <strong>â€œ:â€</strong> + threadId :  1</p><p>}</p><p>å¦‚æœå½“å‰è¿™æŠŠé”å­˜åœ¨ï¼Œåˆ™ç¬¬ä¸€ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼Œå†åˆ¤æ–­</p><p>redis.call(â€˜hexistsâ€™, KEYS[1], ARGV[2]) &#x3D;&#x3D; 1</p><p>æ­¤æ—¶éœ€è¦é€šè¿‡å¤§key+å°keyåˆ¤æ–­å½“å‰è¿™æŠŠé”æ˜¯å¦æ˜¯å±äºè‡ªå·±çš„ï¼Œå¦‚æœæ˜¯è‡ªå·±çš„ï¼Œåˆ™è¿›è¡Œ</p><p>redis.call(â€˜hincrbyâ€™, KEYS[1], ARGV[2], 1)</p><p>å°†å½“å‰è¿™ä¸ªé”çš„valueè¿›è¡Œ+1 ï¼Œredis.call(â€˜pexpireâ€™, KEYS[1], ARGV[1]); ç„¶åå†å¯¹å…¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œåˆ™è¡¨ç¤ºå½“å‰è¿™æŠŠé”æŠ¢é”å¤±è´¥ï¼Œæœ€åè¿”å›pttlï¼Œå³ä¸ºå½“å‰è¿™æŠŠé”çš„å¤±æ•ˆæ—¶é—´</p><p>å¦‚æœå°ä¼™å¸®ä»¬çœ‹äº†å‰è¾¹çš„æºç ï¼Œ ä½ ä¼šå‘ç°ä»–ä¼šå»åˆ¤æ–­å½“å‰è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼æ˜¯å¦ä¸ºnullï¼Œå¦‚æœæ˜¯nullï¼Œåˆ™å¯¹åº”åˆ™å‰ä¸¤ä¸ªifå¯¹åº”çš„æ¡ä»¶ï¼Œé€€å‡ºæŠ¢é”é€»è¾‘ï¼Œå¦‚æœè¿”å›çš„ä¸æ˜¯nullï¼Œå³èµ°äº†ç¬¬ä¸‰ä¸ªåˆ†æ”¯ï¼Œåœ¨æºç å¤„ä¼šè¿›è¡Œwhile(true)çš„è‡ªæ—‹æŠ¢é”ã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-string">&quot;if (redis.call(&#x27;exists&#x27;, KEYS[1]) == 0) then &quot;</span> +<br>                  <span class="hljs-string">&quot;redis.call(&#x27;hset&#x27;, KEYS[1], ARGV[2], 1); &quot;</span> +<br>                  <span class="hljs-string">&quot;redis.call(&#x27;pexpire&#x27;, KEYS[1], ARGV[1]); &quot;</span> +<br>                  <span class="hljs-string">&quot;return nil; &quot;</span> +<br>              <span class="hljs-string">&quot;end; &quot;</span> +<br>              <span class="hljs-string">&quot;if (redis.call(&#x27;hexists&#x27;, KEYS[1], ARGV[2]) == 1) then &quot;</span> +<br>                  <span class="hljs-string">&quot;redis.call(&#x27;hincrby&#x27;, KEYS[1], ARGV[2], 1); &quot;</span> +<br>                  <span class="hljs-string">&quot;redis.call(&#x27;pexpire&#x27;, KEYS[1], ARGV[1]); &quot;</span> +<br>                  <span class="hljs-string">&quot;return nil; &quot;</span> +<br>              <span class="hljs-string">&quot;end; &quot;</span> +<br>              <span class="hljs-string">&quot;return redis.call(&#x27;pttl&#x27;, KEYS[1]);&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/20221205120000/1653548087334.png" alt="1653548087334"></p><h3 id="5-4-åˆ†å¸ƒå¼é”-redissioné”é‡è¯•å’ŒWatchDogæœºåˆ¶"><a href="#5-4-åˆ†å¸ƒå¼é”-redissioné”é‡è¯•å’ŒWatchDogæœºåˆ¶" class="headerlink" title="5.4 åˆ†å¸ƒå¼é”-redissioné”é‡è¯•å’ŒWatchDogæœºåˆ¶"></a>5.4 åˆ†å¸ƒå¼é”-redissioné”é‡è¯•å’ŒWatchDogæœºåˆ¶</h3><p><a href="https://www.bilibili.com/video/BV1cr4y1671t/?p=67&spm_id_from=pageDriver&vd_source=a07c282e889f7133403a50b521d35bc7">æŸ¥çœ‹è§†é¢‘è®²è§£ã€‚</a></p><p><img src="/20221205120000/image-20221216163521814.png" alt="Redissonåˆ†å¸ƒå¼é”åŸç†æµç¨‹å›¾"></p><p><img src="/20221205120000/image-20221216163803479.png" alt="Redissonåˆ†å¸ƒå¼é”å®ç°"></p><p><strong>è¯´æ˜</strong>ï¼šç”±äºè¯¾ç¨‹ä¸­å·²ç»è¯´æ˜äº†æœ‰å…³tryLockçš„æºç è§£æä»¥åŠå…¶çœ‹é—¨ç‹—åŸç†ï¼Œæ‰€ä»¥ç¬”è€…åœ¨è¿™é‡Œç»™å¤§å®¶åˆ†ælock()æ–¹æ³•çš„æºç è§£æï¼Œå¸Œæœ›å¤§å®¶åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œèƒ½å¤ŸæŒæ¡æ›´å¤šçš„çŸ¥è¯†</p><p>æŠ¢é”è¿‡ç¨‹ä¸­ï¼Œè·å¾—å½“å‰çº¿ç¨‹ï¼Œé€šè¿‡tryAcquireè¿›è¡ŒæŠ¢é”ï¼Œè¯¥æŠ¢é”é€»è¾‘å’Œä¹‹å‰é€»è¾‘ç›¸åŒ</p><p>1ã€å…ˆåˆ¤æ–­å½“å‰è¿™æŠŠé”æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œæ’å…¥ä¸€æŠŠé”ï¼Œè¿”å›null</p><p>2ã€åˆ¤æ–­å½“å‰è¿™æŠŠé”æ˜¯å¦æ˜¯å±äºå½“å‰çº¿ç¨‹ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å›null</p><p>æ‰€ä»¥å¦‚æœè¿”å›æ˜¯nullï¼Œåˆ™ä»£è¡¨ç€å½“å‰è¿™å“¥ä»¬å·²ç»æŠ¢é”å®Œæ¯•ï¼Œæˆ–è€…å¯é‡å…¥å®Œæ¯•ï¼Œä½†æ˜¯å¦‚æœä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œåˆ™è¿›å…¥åˆ°ç¬¬ä¸‰ä¸ªæ¡ä»¶ï¼Œè¿”å›çš„æ˜¯é”çš„å¤±æ•ˆæ—¶é—´ï¼ŒåŒå­¦ä»¬å¯ä»¥è‡ªè¡Œå¾€ä¸‹ç¿»ä¸€ç‚¹ç‚¹ï¼Œä½ èƒ½å‘ç°æœ‰ä¸ªwhile( true) å†æ¬¡è¿›è¡ŒtryAcquireè¿›è¡ŒæŠ¢é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">long</span> <span class="hljs-variable">threadId</span> <span class="hljs-operator">=</span> Thread.currentThread().getId();<br><span class="hljs-type">Long</span> <span class="hljs-variable">ttl</span> <span class="hljs-operator">=</span> tryAcquire(-<span class="hljs-number">1</span>, leaseTime, unit, threadId);<br><span class="hljs-comment">// lock acquired</span><br><span class="hljs-keyword">if</span> (ttl == <span class="hljs-literal">null</span>) &#123;<br>    <span class="hljs-keyword">return</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ä¼šæœ‰ä¸€ä¸ªæ¡ä»¶åˆ†æ”¯ï¼Œå› ä¸ºlockæ–¹æ³•æœ‰é‡è½½æ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯å¸¦å‚æ•°ï¼Œä¸€ä¸ªæ˜¯ä¸å¸¦å‚æ•°ï¼Œå¦‚æœå¸¦å¸¦å‚æ•°ä¼ å…¥çš„å€¼æ˜¯-1ï¼Œå¦‚æœä¼ å…¥å‚æ•°ï¼Œåˆ™leaseTimeæ˜¯ä»–æœ¬èº«ï¼Œæ‰€ä»¥å¦‚æœä¼ å…¥äº†å‚æ•°ï¼Œæ­¤æ—¶leaseTime !&#x3D; -1 åˆ™ä¼šè¿›å»æŠ¢é”ï¼ŒæŠ¢é”çš„é€»è¾‘å°±æ˜¯ä¹‹å‰è¯´çš„é‚£ä¸‰ä¸ªé€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (leaseTime != -<span class="hljs-number">1</span>) &#123;<br>    <span class="hljs-keyword">return</span> tryLockInnerAsync(waitTime, leaseTime, unit, threadId, RedisCommands.EVAL_LONG);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæ˜¯æ²¡æœ‰ä¼ å…¥æ—¶é—´ï¼Œåˆ™æ­¤æ—¶ä¹Ÿä¼šè¿›è¡ŒæŠ¢é”ï¼Œ è€Œä¸”æŠ¢é”æ—¶é—´æ˜¯é»˜è®¤çœ‹é—¨ç‹—æ—¶é—´ï¼ˆ<code>leaseTime == -1</code>æ—¶çœ‹é—¨ç‹—æ‰ä¼šå¯åŠ¨ï¼‰ commandExecutor.getConnectionManager().getCfg().getLockWatchdogTimeout()</p><p>ttlRemainingFuture.onComplete((ttlRemaining, e) è¿™å¥è¯ç›¸å½“äºå¯¹ä»¥ä¸ŠæŠ¢é”è¿›è¡Œäº†ç›‘å¬ï¼Œä¹Ÿå°±æ˜¯è¯´å½“ä¸Šè¾¹æŠ¢é”å®Œæ¯•åï¼Œæ­¤æ–¹æ³•ä¼šè¢«è°ƒç”¨ï¼Œå…·ä½“è°ƒç”¨çš„é€»è¾‘å°±æ˜¯å»åå°å¼€å¯ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿›è¡Œç»­çº¦é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯çœ‹é—¨ç‹—çº¿ç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">RFuture&lt;Long&gt; ttlRemainingFuture = tryLockInnerAsync(waitTime,<br>                                        commandExecutor.getConnectionManager().getCfg().getLockWatchdogTimeout(),<br>                                        TimeUnit.MILLISECONDS, threadId, RedisCommands.EVAL_LONG);<br>ttlRemainingFuture.onComplete((ttlRemaining, e) -&gt; &#123;<br>    <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br><br>    <span class="hljs-comment">// lock acquired</span><br>    <span class="hljs-keyword">if</span> (ttlRemaining == <span class="hljs-literal">null</span>) &#123;<br>        scheduleExpirationRenewal(threadId);<br>    &#125;<br>&#125;);<br><span class="hljs-keyword">return</span> ttlRemainingFuture;<br></code></pre></td></tr></table></figure><p>æ­¤é€»è¾‘å°±æ˜¯ç»­çº¦é€»è¾‘ï¼Œæ³¨æ„çœ‹commandExecutor.getConnectionManager().newTimeoutï¼ˆï¼‰ æ­¤æ–¹æ³•</p><p>Method(  <strong>new</strong> TimerTask() {},å‚æ•°2 ï¼Œå‚æ•°3  )</p><p>æŒ‡çš„æ˜¯ï¼šé€šè¿‡å‚æ•°2ï¼Œå‚æ•°3 å»æè¿°ä»€ä¹ˆæ—¶å€™å»åšå‚æ•°1çš„äº‹æƒ…ï¼Œç°åœ¨çš„æƒ…å†µæ˜¯ï¼š10sä¹‹åå»åšå‚æ•°ä¸€çš„äº‹æƒ…</p><p>å› ä¸ºé”çš„å¤±æ•ˆæ—¶é—´æ˜¯30sï¼Œå½“10sä¹‹åï¼Œæ­¤æ—¶è¿™ä¸ªtimeTask å°±è§¦å‘äº†ï¼Œä»–å°±å»è¿›è¡Œç»­çº¦ï¼ŒæŠŠå½“å‰è¿™æŠŠé”ç»­çº¦æˆ30sï¼Œå¦‚æœæ“ä½œæˆåŠŸï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šé€’å½’è°ƒç”¨è‡ªå·±ï¼Œå†é‡æ–°è®¾ç½®ä¸€ä¸ªtimeTask()ï¼Œäºæ˜¯å†è¿‡10sååˆå†è®¾ç½®ä¸€ä¸ªtimerTaskï¼Œå®Œæˆä¸åœçš„ç»­çº¦</p><p>é‚£ä¹ˆå¤§å®¶å¯ä»¥æƒ³ä¸€æƒ³ï¼Œå‡è®¾æˆ‘ä»¬çš„çº¿ç¨‹å‡ºç°äº†å®•æœºä»–è¿˜ä¼šç»­çº¦å—ï¼Ÿå½“ç„¶ä¸ä¼šï¼Œå› ä¸ºæ²¡æœ‰äººå†å»è°ƒç”¨renewExpirationè¿™ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥ç­‰åˆ°æ—¶é—´ä¹‹åè‡ªç„¶å°±é‡Šæ”¾äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">renewExpiration</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">ExpirationEntry</span> <span class="hljs-variable">ee</span> <span class="hljs-operator">=</span> EXPIRATION_RENEWAL_MAP.get(getEntryName());<br>    <span class="hljs-keyword">if</span> (ee == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <br>    <span class="hljs-type">Timeout</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> commandExecutor.getConnectionManager().newTimeout(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TimerTask</span>() &#123;<br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">(Timeout timeout)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>            <span class="hljs-type">ExpirationEntry</span> <span class="hljs-variable">ent</span> <span class="hljs-operator">=</span> EXPIRATION_RENEWAL_MAP.get(getEntryName());<br>            <span class="hljs-keyword">if</span> (ent == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>            <span class="hljs-type">Long</span> <span class="hljs-variable">threadId</span> <span class="hljs-operator">=</span> ent.getFirstThreadId();<br>            <span class="hljs-keyword">if</span> (threadId == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>            <br>            RFuture&lt;Boolean&gt; future = renewExpirationAsync(threadId);<br>            future.onComplete((res, e) -&gt; &#123;<br>                <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) &#123;<br>                    log.error(<span class="hljs-string">&quot;Can&#x27;t update lock &quot;</span> + getName() + <span class="hljs-string">&quot; expiration&quot;</span>, e);<br>                    <span class="hljs-keyword">return</span>;<br>                &#125;<br>                <br>                <span class="hljs-keyword">if</span> (res) &#123;<br>                    <span class="hljs-comment">// reschedule itself</span><br>                    renewExpiration();<br>                &#125;<br>            &#125;);<br>        &#125;<br>    &#125;, internalLockLeaseTime / <span class="hljs-number">3</span>, TimeUnit.MILLISECONDS);<br>    <br>    ee.setTimeout(task);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="5-5-åˆ†å¸ƒå¼é”-redissioné”çš„MutiLockåŸç†"><a href="#5-5-åˆ†å¸ƒå¼é”-redissioné”çš„MutiLockåŸç†" class="headerlink" title="5.5 åˆ†å¸ƒå¼é”-redissioné”çš„MutiLockåŸç†"></a>5.5 åˆ†å¸ƒå¼é”-redissioné”çš„MutiLockåŸç†</h3><p><a href="https://www.bilibili.com/video/BV1cr4y1671t/?p=68&spm_id_from=pageDriver&vd_source=a07c282e889f7133403a50b521d35bc7">æŸ¥çœ‹è§†é¢‘è®²è§£ã€‚</a></p><p>ä¸ºäº†æé«˜redisçš„å¯ç”¨æ€§ï¼Œæˆ‘ä»¬ä¼šæ­å»ºé›†ç¾¤æˆ–è€…ä¸»ä»ï¼Œç°åœ¨ä»¥ä¸»ä»ä¸ºä¾‹</p><p>æ­¤æ—¶æˆ‘ä»¬å»å†™å‘½ä»¤ï¼Œå†™åœ¨ä¸»æœºä¸Šï¼Œ ä¸»æœºä¼šå°†æ•°æ®åŒæ­¥ç»™ä»æœºï¼Œä½†æ˜¯å‡è®¾åœ¨ä¸»æœºè¿˜æ²¡æœ‰æ¥å¾—åŠæŠŠæ•°æ®å†™å…¥åˆ°ä»æœºå»çš„æ—¶å€™ï¼Œæ­¤æ—¶ä¸»æœºå®•æœºï¼Œå“¨å…µä¼šå‘ç°ä¸»æœºå®•æœºï¼Œå¹¶ä¸”é€‰ä¸¾ä¸€ä¸ªslaveå˜æˆmasterï¼Œè€Œæ­¤æ—¶æ–°çš„masterä¸­å®é™…ä¸Šå¹¶æ²¡æœ‰é”ä¿¡æ¯ï¼Œæ­¤æ—¶é”ä¿¡æ¯å°±å·²ç»ä¸¢æ‰äº†ã€‚</p><p><img src="/20221205120000/1653553998403.png" alt="1653553998403"></p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œredissionæå‡ºæ¥äº†MutiLocké”ï¼Œä½¿ç”¨è¿™æŠŠé”å’±ä»¬å°±ä¸ä½¿ç”¨ä¸»ä»äº†ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„åœ°ä½éƒ½æ˜¯ä¸€æ ·çš„ï¼Œ è¿™æŠŠé”åŠ é”çš„é€»è¾‘éœ€è¦å†™å…¥åˆ°æ¯ä¸€ä¸ªä¸»ä¸›èŠ‚ç‚¹ä¸Šï¼Œåªæœ‰æ‰€æœ‰çš„æœåŠ¡å™¨éƒ½å†™å…¥æˆåŠŸï¼Œæ­¤æ—¶æ‰æ˜¯åŠ é”æˆåŠŸï¼Œå‡è®¾ç°åœ¨æŸä¸ªèŠ‚ç‚¹æŒ‚äº†ï¼Œé‚£ä¹ˆä»–å»è·å¾—é”çš„æ—¶å€™ï¼Œåªè¦æœ‰ä¸€ä¸ªèŠ‚ç‚¹æ‹¿ä¸åˆ°ï¼Œéƒ½ä¸èƒ½ç®—æ˜¯åŠ é”æˆåŠŸï¼Œå°±ä¿è¯äº†åŠ é”çš„å¯é æ€§ã€‚</p><p><img src="/20221205120000/1653554055048.png" alt="1653554055048"></p><p>é‚£ä¹ˆMutiLock åŠ é”åŸç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç¬”è€…ç”»äº†ä¸€å¹…å›¾æ¥è¯´æ˜</p><p>å½“æˆ‘ä»¬å»è®¾ç½®äº†å¤šä¸ªé”æ—¶ï¼Œredissionä¼šå°†å¤šä¸ªé”æ·»åŠ åˆ°ä¸€ä¸ªé›†åˆä¸­ï¼Œç„¶åç”¨whileå¾ªç¯å»ä¸åœå»å°è¯•æ‹¿é”ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€ä¸ªæ€»å…±çš„åŠ é”æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´æ˜¯ç”¨éœ€è¦åŠ é”çš„ä¸ªæ•° * 1500ms ï¼Œå‡è®¾æœ‰3ä¸ªé”ï¼Œé‚£ä¹ˆæ—¶é—´å°±æ˜¯4500msï¼Œå‡è®¾åœ¨è¿™4500mså†…ï¼Œæ‰€æœ‰çš„é”éƒ½åŠ é”æˆåŠŸï¼Œ é‚£ä¹ˆæ­¤æ—¶æ‰ç®—æ˜¯åŠ é”æˆåŠŸï¼Œå¦‚æœåœ¨4500msæœ‰çº¿ç¨‹åŠ é”å¤±è´¥ï¼Œåˆ™ä¼šå†æ¬¡å»è¿›è¡Œé‡è¯•.</p><p><img src="/20221205120000/1653553093967.png" alt="1653553093967"></p><h2 id="6ã€ç§’æ€ä¼˜åŒ–"><a href="#6ã€ç§’æ€ä¼˜åŒ–" class="headerlink" title="6ã€ç§’æ€ä¼˜åŒ–"></a>6ã€ç§’æ€ä¼˜åŒ–</h2><h3 id="6-1-ç§’æ€ä¼˜åŒ–-å¼‚æ­¥ç§’æ€æ€è·¯"><a href="#6-1-ç§’æ€ä¼˜åŒ–-å¼‚æ­¥ç§’æ€æ€è·¯" class="headerlink" title="6.1 ç§’æ€ä¼˜åŒ–-å¼‚æ­¥ç§’æ€æ€è·¯"></a>6.1 ç§’æ€ä¼˜åŒ–-å¼‚æ­¥ç§’æ€æ€è·¯</h3><p>æˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹ä¸‹å•æµç¨‹</p><p>å½“ç”¨æˆ·å‘èµ·è¯·æ±‚ï¼Œæ­¤æ—¶ä¼šè¯·æ±‚nginxï¼Œnginxä¼šè®¿é—®åˆ°tomcatï¼Œè€Œtomcatä¸­çš„ç¨‹åºï¼Œä¼šè¿›è¡Œä¸²è¡Œæ“ä½œï¼Œåˆ†æˆå¦‚ä¸‹å‡ ä¸ªæ­¥éª¤</p><p>1ã€æŸ¥è¯¢ä¼˜æƒ åˆ¸</p><p>2ã€åˆ¤æ–­ç§’æ€åº“å­˜æ˜¯å¦è¶³å¤Ÿ</p><p>3ã€æŸ¥è¯¢è®¢å•</p><p>4ã€æ ¡éªŒæ˜¯å¦æ˜¯ä¸€äººä¸€å•</p><p>5ã€æ‰£å‡åº“å­˜</p><p>6ã€åˆ›å»ºè®¢å•</p><p>åœ¨è¿™å…­æ­¥æ“ä½œä¸­ï¼Œåˆæœ‰å¾ˆå¤šæ“ä½œæ˜¯è¦å»æ“ä½œæ•°æ®åº“çš„ï¼Œè€Œä¸”è¿˜æ˜¯ä¸€ä¸ªçº¿ç¨‹ä¸²è¡Œæ‰§è¡Œï¼Œ è¿™æ ·å°±ä¼šå¯¼è‡´æˆ‘ä»¬çš„ç¨‹åºæ‰§è¡Œçš„å¾ˆæ…¢ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¼‚æ­¥ç¨‹åºæ‰§è¡Œï¼Œé‚£ä¹ˆå¦‚ä½•åŠ é€Ÿå‘¢ï¼Ÿ</p><p>åœ¨è¿™é‡Œç¬”è€…æƒ³ç»™å¤§å®¶åˆ†äº«ä¸€ä¸‹è¯¾ç¨‹å†…æ²¡æœ‰çš„æ€è·¯ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å°ä¼™ä¼´è¿™ä¹ˆæƒ³ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä¸å¯ä»¥ä½¿ç”¨å¼‚æ­¥ç¼–æ’æ¥åšï¼Œæˆ–è€…è¯´æˆ‘å¼€å¯Nå¤šçº¿ç¨‹ï¼ŒNå¤šä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒæŸ¥è¯¢ä¼˜æƒ åˆ¸ï¼Œä¸€ä¸ªæ‰§è¡Œåˆ¤æ–­æ‰£å‡åº“å­˜ï¼Œä¸€ä¸ªå»åˆ›å»ºè®¢å•ç­‰ç­‰ï¼Œç„¶åå†ç»Ÿä¸€åšè¿”å›ï¼Œè¿™ç§åšæ³•å’Œè¯¾ç¨‹ä¸­æœ‰å“ªç§å¥½å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è¯¾ç¨‹ä¸­çš„å¥½ï¼Œå› ä¸ºå¦‚æœä½ é‡‡ç”¨æˆ‘åˆšè¯´çš„æ–¹å¼ï¼Œå¦‚æœè®¿é—®çš„äººå¾ˆå¤šï¼Œé‚£ä¹ˆçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹å¯èƒ½ä¸€ä¸‹å­å°±è¢«æ¶ˆè€—å®Œäº†ï¼Œè€Œä¸”ä½ ä½¿ç”¨ä¸Šè¿°æ–¹æ¡ˆï¼Œæœ€å¤§çš„ç‰¹ç‚¹åœ¨äºï¼Œä½ è§‰å¾—æ—¶æ•ˆæ€§ä¼šéå¸¸é‡è¦ï¼Œä½†æ˜¯ä½ æƒ³æƒ³æ˜¯å—ï¼Ÿå¹¶ä¸æ˜¯ï¼Œæ¯”å¦‚æˆ‘åªè¦ç¡®å®šä»–èƒ½åšè¿™ä»¶äº‹ï¼Œç„¶åæˆ‘åè¾¹æ…¢æ…¢åšå°±å¯ä»¥äº†ï¼Œæˆ‘å¹¶ä¸éœ€è¦ä»–ä¸€å£æ°”åšå®Œè¿™ä»¶äº‹ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”å½“é‡‡ç”¨çš„æ˜¯è¯¾ç¨‹ä¸­ï¼Œç±»ä¼¼æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼æ¥å®Œæˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œè€Œä¸æ˜¯ä½¿ç”¨çº¿ç¨‹æ± æˆ–è€…æ˜¯å¼‚æ­¥ç¼–æ’çš„æ–¹å¼æ¥å®Œæˆè¿™ä¸ªéœ€æ±‚</p><p><img src="/20221205120000/1653560986599.png" alt="1653560986599"></p><p>ä¼˜åŒ–æ–¹æ¡ˆï¼šæˆ‘ä»¬å°†è€—æ—¶æ¯”è¾ƒçŸ­çš„é€»è¾‘åˆ¤æ–­æ”¾å…¥åˆ°redisä¸­ï¼Œæ¯”å¦‚æ˜¯å¦åº“å­˜è¶³å¤Ÿï¼Œæ¯”å¦‚æ˜¯å¦ä¸€äººä¸€å•ï¼Œè¿™æ ·çš„æ“ä½œï¼Œåªè¦è¿™ç§é€»è¾‘å¯ä»¥å®Œæˆï¼Œå°±æ„å‘³ç€æˆ‘ä»¬æ˜¯ä¸€å®šå¯ä»¥ä¸‹å•å®Œæˆçš„ï¼Œæˆ‘ä»¬åªéœ€è¦è¿›è¡Œå¿«é€Ÿçš„é€»è¾‘åˆ¤æ–­ï¼Œæ ¹æœ¬å°±ä¸ç”¨ç­‰ä¸‹å•é€»è¾‘èµ°å®Œï¼Œæˆ‘ä»¬ç›´æ¥ç»™ç”¨æˆ·è¿”å›æˆåŠŸï¼Œ å†åœ¨åå°å¼€ä¸€ä¸ªçº¿ç¨‹ï¼Œåå°çº¿ç¨‹æ…¢æ…¢çš„å»æ‰§è¡Œqueueé‡Œè¾¹çš„æ¶ˆæ¯ï¼Œè¿™æ ·ç¨‹åºä¸å°±è¶…çº§å¿«äº†å—ï¼Ÿè€Œä¸”ä¹Ÿä¸ç”¨æ‹…å¿ƒçº¿ç¨‹æ± æ¶ˆè€—æ®†å°½çš„é—®é¢˜ï¼Œå› ä¸ºè¿™é‡Œæˆ‘ä»¬çš„ç¨‹åºä¸­å¹¶æ²¡æœ‰æ‰‹åŠ¨ä½¿ç”¨ä»»ä½•çº¿ç¨‹æ± ï¼Œå½“ç„¶è¿™é‡Œè¾¹æœ‰ä¸¤ä¸ªéš¾ç‚¹</p><p>ç¬¬ä¸€ä¸ªéš¾ç‚¹æ˜¯æˆ‘ä»¬æ€ä¹ˆåœ¨redisä¸­å»å¿«é€Ÿæ ¡éªŒä¸€äººä¸€å•ï¼Œè¿˜æœ‰åº“å­˜åˆ¤æ–­</p><p>ç¬¬äºŒä¸ªéš¾ç‚¹æ˜¯ç”±äºæˆ‘ä»¬æ ¡éªŒå’Œtomctä¸‹å•æ˜¯ä¸¤ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•çŸ¥é“åˆ°åº•å“ªä¸ªå•ä»–æœ€åæ˜¯å¦æˆåŠŸï¼Œæˆ–è€…æ˜¯ä¸‹å•å®Œæˆï¼Œä¸ºäº†å®Œæˆè¿™ä»¶äº‹æˆ‘ä»¬åœ¨redisæ“ä½œå®Œä¹‹åï¼Œæˆ‘ä»¬ä¼šå°†ä¸€äº›ä¿¡æ¯è¿”å›ç»™å‰ç«¯ï¼ŒåŒæ—¶ä¹Ÿä¼šæŠŠè¿™äº›ä¿¡æ¯ä¸¢åˆ°å¼‚æ­¥queueä¸­å»ï¼Œåç»­æ“ä½œä¸­ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªidæ¥æŸ¥è¯¢æˆ‘ä»¬tomcatä¸­çš„ä¸‹å•é€»è¾‘æ˜¯å¦å®Œæˆäº†ã€‚</p><p><img src="/20221205120000/1653561657295.png" alt="1653561657295"></p><p>æˆ‘ä»¬ç°åœ¨æ¥çœ‹çœ‹æ•´ä½“æ€è·¯ï¼šå½“ç”¨æˆ·ä¸‹å•ä¹‹åï¼Œåˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³åªéœ€è¦å¯¼redisä¸­å»æ ¹æ®keyæ‰¾å¯¹åº”çš„valueæ˜¯å¦å¤§äº0å³å¯ï¼Œå¦‚æœä¸å……è¶³ï¼Œåˆ™ç›´æ¥ç»“æŸï¼Œå¦‚æœå……è¶³ï¼Œç»§ç»­åœ¨redisä¸­åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å¯ä»¥ä¸‹å•ï¼Œå¦‚æœseté›†åˆä¸­æ²¡æœ‰è¿™æ¡æ•°æ®ï¼Œè¯´æ˜ä»–å¯ä»¥ä¸‹å•ï¼Œå¦‚æœseté›†åˆä¸­æ²¡æœ‰è¿™æ¡è®°å½•ï¼Œåˆ™å°†userIdå’Œä¼˜æƒ åˆ¸å­˜å…¥åˆ°redisä¸­ï¼Œå¹¶ä¸”è¿”å›0ï¼Œæ•´ä¸ªè¿‡ç¨‹éœ€è¦ä¿è¯æ˜¯åŸå­æ€§çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨luaæ¥æ“ä½œ</p><p>å½“ä»¥ä¸Šåˆ¤æ–­é€»è¾‘èµ°å®Œä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥åˆ¤æ–­å½“å‰redisä¸­è¿”å›çš„ç»“æœæ˜¯å¦æ˜¯0 ï¼Œå¦‚æœæ˜¯0ï¼Œåˆ™è¡¨ç¤ºå¯ä»¥ä¸‹å•ï¼Œåˆ™å°†ä¹‹å‰è¯´çš„ä¿¡æ¯å­˜å…¥åˆ°åˆ°queueä¸­å»ï¼Œç„¶åè¿”å›ï¼Œç„¶åå†æ¥ä¸ªçº¿ç¨‹å¼‚æ­¥çš„ä¸‹å•ï¼Œå‰ç«¯å¯ä»¥é€šè¿‡è¿”å›çš„è®¢å•idæ¥åˆ¤æ–­æ˜¯å¦ä¸‹å•æˆåŠŸã€‚</p><p><img src="/20221205120000/1653562234886.png" alt="1653562234886"></p><h3 id="6-2-ç§’æ€ä¼˜åŒ–-Rediså®Œæˆç§’æ€èµ„æ ¼åˆ¤æ–­"><a href="#6-2-ç§’æ€ä¼˜åŒ–-Rediså®Œæˆç§’æ€èµ„æ ¼åˆ¤æ–­" class="headerlink" title="6.2 ç§’æ€ä¼˜åŒ–-Rediså®Œæˆç§’æ€èµ„æ ¼åˆ¤æ–­"></a>6.2 ç§’æ€ä¼˜åŒ–-Rediså®Œæˆç§’æ€èµ„æ ¼åˆ¤æ–­</h3><p>éœ€æ±‚ï¼š</p><ul><li><p>æ–°å¢ç§’æ€ä¼˜æƒ åˆ¸çš„åŒæ—¶ï¼Œå°†ä¼˜æƒ åˆ¸ä¿¡æ¯ä¿å­˜åˆ°Redisä¸­</p></li><li><p>åŸºäºLuaè„šæœ¬ï¼Œåˆ¤æ–­ç§’æ€åº“å­˜ã€ä¸€äººä¸€å•ï¼Œå†³å®šç”¨æˆ·æ˜¯å¦æŠ¢è´­æˆåŠŸ</p></li><li><p>å¦‚æœæŠ¢è´­æˆåŠŸï¼Œå°†ä¼˜æƒ åˆ¸idå’Œç”¨æˆ·idå°è£…åå­˜å…¥é˜»å¡é˜Ÿåˆ—</p></li><li><p>å¼€å¯çº¿ç¨‹ä»»åŠ¡ï¼Œä¸æ–­ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä¿¡æ¯ï¼Œå®ç°å¼‚æ­¥ä¸‹å•åŠŸèƒ½</p><p><img src="/20221205120000/1656080546603.png" alt="1656080546603"></p></li></ul><p>VoucherServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-meta">@Transactional</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addSeckillVoucher</span><span class="hljs-params">(Voucher voucher)</span> &#123;<br>    <span class="hljs-comment">// ä¿å­˜ä¼˜æƒ åˆ¸</span><br>    save(voucher);<br>    <span class="hljs-comment">// ä¿å­˜ç§’æ€ä¿¡æ¯</span><br>    <span class="hljs-type">SeckillVoucher</span> <span class="hljs-variable">seckillVoucher</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SeckillVoucher</span>();<br>    seckillVoucher.setVoucherId(voucher.getId());<br>    seckillVoucher.setStock(voucher.getStock());<br>    seckillVoucher.setBeginTime(voucher.getBeginTime());<br>    seckillVoucher.setEndTime(voucher.getEndTime());<br>    seckillVoucherService.save(seckillVoucher);<br>    <span class="hljs-comment">// ä¿å­˜ç§’æ€åº“å­˜åˆ°Redisä¸­</span><br>    <span class="hljs-comment">//SECKILL_STOCK_KEY è¿™ä¸ªå˜é‡å®šä¹‰åœ¨RedisConstansä¸­</span><br>    <span class="hljs-comment">//private static final String SECKILL_STOCK_KEY =&quot;seckill:stock:&quot;</span><br>    stringRedisTemplate.opsForValue().set(SECKILL_STOCK_KEY + voucher.getId(), voucher.getStock().toString());<br>&#125;<br></code></pre></td></tr></table></figure><p>å®Œæ•´luaè¡¨è¾¾å¼</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-comment">-- 1.å‚æ•°åˆ—è¡¨</span><br><span class="hljs-comment">-- 1.1.ä¼˜æƒ åˆ¸id</span><br><span class="hljs-keyword">local</span> voucherId = ARGV[<span class="hljs-number">1</span>]<br><span class="hljs-comment">-- 1.2.ç”¨æˆ·id</span><br><span class="hljs-keyword">local</span> userId = ARGV[<span class="hljs-number">2</span>]<br><span class="hljs-comment">-- 1.3.è®¢å•id</span><br><span class="hljs-keyword">local</span> orderId = ARGV[<span class="hljs-number">3</span>]<br><br><span class="hljs-comment">-- 2.æ•°æ®key</span><br><span class="hljs-comment">-- 2.1.åº“å­˜key</span><br><span class="hljs-keyword">local</span> stockKey = <span class="hljs-string">&#x27;seckill:stock:&#x27;</span> .. voucherId<br><span class="hljs-comment">-- 2.2.è®¢å•key</span><br><span class="hljs-keyword">local</span> orderKey = <span class="hljs-string">&#x27;seckill:order:&#x27;</span> .. voucherId<br><br><span class="hljs-comment">-- 3.è„šæœ¬ä¸šåŠ¡</span><br><span class="hljs-comment">-- 3.1.åˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³ get stockKey</span><br><span class="hljs-keyword">if</span>(<span class="hljs-built_in">tonumber</span>(redis.call(<span class="hljs-string">&#x27;get&#x27;</span>, stockKey)) &lt;= <span class="hljs-number">0</span>) <span class="hljs-keyword">then</span><br>    <span class="hljs-comment">-- 3.2.åº“å­˜ä¸è¶³ï¼Œè¿”å›1</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br><span class="hljs-keyword">end</span><br><span class="hljs-comment">-- 3.2.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸‹å• SISMEMBER orderKey userId</span><br><span class="hljs-keyword">if</span>(redis.call(<span class="hljs-string">&#x27;sismember&#x27;</span>, orderKey, userId) == <span class="hljs-number">1</span>) <span class="hljs-keyword">then</span><br>    <span class="hljs-comment">-- 3.3.å­˜åœ¨ï¼Œè¯´æ˜æ˜¯é‡å¤ä¸‹å•ï¼Œè¿”å›2</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">2</span><br><span class="hljs-keyword">end</span><br><span class="hljs-comment">-- 3.4.æ‰£åº“å­˜ incrby stockKey -1</span><br>redis.call(<span class="hljs-string">&#x27;incrby&#x27;</span>, stockKey, <span class="hljs-number">-1</span>)<br><span class="hljs-comment">-- 3.5.ä¸‹å•ï¼ˆä¿å­˜ç”¨æˆ·ï¼‰sadd orderKey userId</span><br>redis.call(<span class="hljs-string">&#x27;sadd&#x27;</span>, orderKey, userId)<br><span class="hljs-comment">-- 3.6.å‘é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—ä¸­ï¼Œ XADD stream.orders * k1 v1 k2 v2 ...</span><br>redis.call(<span class="hljs-string">&#x27;xadd&#x27;</span>, <span class="hljs-string">&#x27;stream.orders&#x27;</span>, <span class="hljs-string">&#x27;*&#x27;</span>, <span class="hljs-string">&#x27;userId&#x27;</span>, userId, <span class="hljs-string">&#x27;voucherId&#x27;</span>, voucherId, <span class="hljs-string">&#x27;id&#x27;</span>, orderId)<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>å½“ä»¥ä¸Šluaè¡¨è¾¾å¼æ‰§è¡Œå®Œæ¯•åï¼Œå‰©ä¸‹çš„å°±æ˜¯æ ¹æ®æ­¥éª¤3,4æ¥æ‰§è¡Œæˆ‘ä»¬æ¥ä¸‹æ¥çš„ä»»åŠ¡äº†</p><p>VoucherOrderServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">seckillVoucher</span><span class="hljs-params">(Long voucherId)</span> &#123;<br>    <span class="hljs-comment">//è·å–ç”¨æˆ·</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>    <span class="hljs-type">long</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> redisIdWorker.nextId(<span class="hljs-string">&quot;order&quot;</span>);<br>    <span class="hljs-comment">// 1.æ‰§è¡Œluaè„šæœ¬</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> stringRedisTemplate.execute(<br>            SECKILL_SCRIPT,<br>            Collections.emptyList(),<br>            voucherId.toString(), userId.toString(), String.valueOf(orderId)<br>    );<br>    <span class="hljs-type">int</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> result.intValue();<br>    <span class="hljs-comment">// 2.åˆ¤æ–­ç»“æœæ˜¯å¦ä¸º0</span><br>    <span class="hljs-keyword">if</span> (r != <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-comment">// 2.1.ä¸ä¸º0 ï¼Œä»£è¡¨æ²¡æœ‰è´­ä¹°èµ„æ ¼</span><br>        <span class="hljs-keyword">return</span> Result.fail(r == <span class="hljs-number">1</span> ? <span class="hljs-string">&quot;åº“å­˜ä¸è¶³&quot;</span> : <span class="hljs-string">&quot;ä¸èƒ½é‡å¤ä¸‹å•&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">//TODO ä¿å­˜é˜»å¡é˜Ÿåˆ—</span><br>    <span class="hljs-comment">// 3.è¿”å›è®¢å•id</span><br>    <span class="hljs-keyword">return</span> Result.ok(orderId);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="6-3-ç§’æ€ä¼˜åŒ–-åŸºäºé˜»å¡é˜Ÿåˆ—å®ç°ç§’æ€ä¼˜åŒ–"><a href="#6-3-ç§’æ€ä¼˜åŒ–-åŸºäºé˜»å¡é˜Ÿåˆ—å®ç°ç§’æ€ä¼˜åŒ–" class="headerlink" title="6.3 ç§’æ€ä¼˜åŒ–-åŸºäºé˜»å¡é˜Ÿåˆ—å®ç°ç§’æ€ä¼˜åŒ–"></a>6.3 ç§’æ€ä¼˜åŒ–-åŸºäºé˜»å¡é˜Ÿåˆ—å®ç°ç§’æ€ä¼˜åŒ–</h3><p>VoucherOrderServiceImpl</p><p>ä¿®æ”¹ä¸‹å•åŠ¨ä½œï¼Œç°åœ¨æˆ‘ä»¬å»ä¸‹å•æ—¶ï¼Œæ˜¯é€šè¿‡luaè¡¨è¾¾å¼å»åŸå­æ‰§è¡Œåˆ¤æ–­é€»è¾‘ï¼Œå¦‚æœåˆ¤æ–­æˆ‘å‡ºæ¥ä¸ä¸º0 ï¼Œåˆ™è¦ä¹ˆæ˜¯åº“å­˜ä¸è¶³ï¼Œè¦ä¹ˆæ˜¯é‡å¤ä¸‹å•ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯ï¼Œå¦‚æœæ˜¯0ï¼Œåˆ™æŠŠä¸‹å•çš„é€»è¾‘ä¿å­˜åˆ°é˜Ÿåˆ—ä¸­å»ï¼Œç„¶åå¼‚æ­¥æ‰§è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å¼‚æ­¥å¤„ç†çº¿ç¨‹æ± </span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">SECKILL_ORDER_EXECUTOR</span> <span class="hljs-operator">=</span> Executors.newSingleThreadExecutor();<br><br><span class="hljs-comment">//åœ¨ç±»åˆå§‹åŒ–ä¹‹åæ‰§è¡Œï¼Œå› ä¸ºå½“è¿™ä¸ªç±»åˆå§‹åŒ–å¥½äº†ä¹‹åï¼Œéšæ—¶éƒ½æ˜¯æœ‰å¯èƒ½è¦æ‰§è¡Œçš„</span><br><span class="hljs-meta">@PostConstruct</span><br><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> &#123;<br>   SECKILL_ORDER_EXECUTOR.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">VoucherOrderHandler</span>());<br>&#125;<br><span class="hljs-comment">// ç”¨äºçº¿ç¨‹æ± å¤„ç†çš„ä»»åŠ¡</span><br><span class="hljs-comment">// å½“åˆå§‹åŒ–å®Œæ¯•åï¼Œå°±ä¼šå»ä»å¯¹åˆ—ä¸­å»æ‹¿ä¿¡æ¯</span><br> <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VoucherOrderHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span>&#123;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)&#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    <span class="hljs-comment">// 1.è·å–é˜Ÿåˆ—ä¸­çš„è®¢å•ä¿¡æ¯</span><br>                    <span class="hljs-type">VoucherOrder</span> <span class="hljs-variable">voucherOrder</span> <span class="hljs-operator">=</span> orderTasks.take();<br>                    <span class="hljs-comment">// 2.åˆ›å»ºè®¢å•</span><br>                    handleVoucherOrder(voucherOrder);<br>                &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                    log.error(<span class="hljs-string">&quot;å¤„ç†è®¢å•å¼‚å¸¸&quot;</span>, e);<br>                &#125;<br>           &#125;<br>        &#125;<br>     <br>       <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleVoucherOrder</span><span class="hljs-params">(VoucherOrder voucherOrder)</span> &#123;<br>            <span class="hljs-comment">//1.è·å–ç”¨æˆ·</span><br>            <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> voucherOrder.getUserId();<br>            <span class="hljs-comment">// 2.åˆ›å»ºé”å¯¹è±¡</span><br>            <span class="hljs-type">RLock</span> <span class="hljs-variable">redisLock</span> <span class="hljs-operator">=</span> redissonClient.getLock(<span class="hljs-string">&quot;lock:order:&quot;</span> + userId);<br>            <span class="hljs-comment">// 3.å°è¯•è·å–é”</span><br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">isLock</span> <span class="hljs-operator">=</span> redisLock.lock();<br>            <span class="hljs-comment">// 4.åˆ¤æ–­æ˜¯å¦è·å¾—é”æˆåŠŸ</span><br>            <span class="hljs-keyword">if</span> (!isLock) &#123;<br>                <span class="hljs-comment">// è·å–é”å¤±è´¥ï¼Œç›´æ¥è¿”å›å¤±è´¥æˆ–è€…é‡è¯•</span><br>                log.error(<span class="hljs-string">&quot;ä¸å…è®¸é‡å¤ä¸‹å•ï¼&quot;</span>);<br>                <span class="hljs-keyword">return</span>;<br>            &#125;<br>            <span class="hljs-keyword">try</span> &#123;<br><span class="hljs-comment">//æ³¨æ„ï¼šç”±äºæ˜¯springçš„äº‹åŠ¡æ˜¯æ”¾åœ¨threadLocalä¸­ï¼Œæ­¤æ—¶çš„æ˜¯å¤šçº¿ç¨‹ï¼Œäº‹åŠ¡ä¼šå¤±æ•ˆ</span><br>                proxy.createVoucherOrder(voucherOrder);<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                <span class="hljs-comment">// é‡Šæ”¾é”</span><br>                redisLock.unlock();<br>            &#125;<br>    &#125;<br>     <span class="hljs-comment">//a</span><br><span class="hljs-keyword">private</span> BlockingQueue&lt;VoucherOrder&gt; orderTasks =<span class="hljs-keyword">new</span>  <span class="hljs-title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>);<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">seckillVoucher</span><span class="hljs-params">(Long voucherId)</span> &#123;<br>        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>        <span class="hljs-type">long</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> redisIdWorker.nextId(<span class="hljs-string">&quot;order&quot;</span>);<br>        <span class="hljs-comment">// 1.æ‰§è¡Œluaè„šæœ¬</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> stringRedisTemplate.execute(<br>                SECKILL_SCRIPT,<br>                Collections.emptyList(),<br>                voucherId.toString(), userId.toString(), String.valueOf(orderId)<br>        );<br>        <span class="hljs-type">int</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> result.intValue();<br>        <span class="hljs-comment">// 2.åˆ¤æ–­ç»“æœæ˜¯å¦ä¸º0</span><br>        <span class="hljs-keyword">if</span> (r != <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// 2.1.ä¸ä¸º0 ï¼Œä»£è¡¨æ²¡æœ‰è´­ä¹°èµ„æ ¼</span><br>            <span class="hljs-keyword">return</span> Result.fail(r == <span class="hljs-number">1</span> ? <span class="hljs-string">&quot;åº“å­˜ä¸è¶³&quot;</span> : <span class="hljs-string">&quot;ä¸èƒ½é‡å¤ä¸‹å•&quot;</span>);<br>        &#125;<br>        <span class="hljs-type">VoucherOrder</span> <span class="hljs-variable">voucherOrder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">VoucherOrder</span>();<br>        <span class="hljs-comment">// 2.3.è®¢å•id</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> redisIdWorker.nextId(<span class="hljs-string">&quot;order&quot;</span>);<br>        voucherOrder.setId(orderId);<br>        <span class="hljs-comment">// 2.4.ç”¨æˆ·id</span><br>        voucherOrder.setUserId(userId);<br>        <span class="hljs-comment">// 2.5.ä»£é‡‘åˆ¸id</span><br>        voucherOrder.setVoucherId(voucherId);<br>        <span class="hljs-comment">// 2.6.æ”¾å…¥é˜»å¡é˜Ÿåˆ—</span><br>        orderTasks.add(voucherOrder);<br>        <span class="hljs-comment">//3.è·å–ä»£ç†å¯¹è±¡</span><br>         proxy = (IVoucherOrderService)AopContext.currentProxy();<br>        <span class="hljs-comment">//4.è¿”å›è®¢å•id</span><br>        <span class="hljs-keyword">return</span> Result.ok(orderId);<br>    &#125;<br>     <br>      <span class="hljs-meta">@Transactional</span><br>    <span class="hljs-keyword">public</span>  <span class="hljs-keyword">void</span> <span class="hljs-title function_">createVoucherOrder</span><span class="hljs-params">(VoucherOrder voucherOrder)</span> &#123;<br>        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> voucherOrder.getUserId();<br>        <span class="hljs-comment">// 5.1.æŸ¥è¯¢è®¢å•</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> query().eq(<span class="hljs-string">&quot;user_id&quot;</span>, userId).eq(<span class="hljs-string">&quot;voucher_id&quot;</span>, voucherOrder.getVoucherId()).count();<br>        <span class="hljs-comment">// 5.2.åˆ¤æ–­æ˜¯å¦å­˜åœ¨</span><br>        <span class="hljs-keyword">if</span> (count &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†</span><br>           log.error(<span class="hljs-string">&quot;ç”¨æˆ·å·²ç»è´­ä¹°è¿‡äº†&quot;</span>);<br>           <span class="hljs-keyword">return</span> ;<br>        &#125;<br><br>        <span class="hljs-comment">// 6.æ‰£å‡åº“å­˜</span><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> seckillVoucherService.update()<br>                .setSql(<span class="hljs-string">&quot;stock = stock - 1&quot;</span>) <span class="hljs-comment">// set stock = stock - 1</span><br>                .eq(<span class="hljs-string">&quot;voucher_id&quot;</span>, voucherOrder.getVoucherId()).gt(<span class="hljs-string">&quot;stock&quot;</span>, <span class="hljs-number">0</span>) <span class="hljs-comment">// where id = ? and stock &gt; 0</span><br>                .update();<br>        <span class="hljs-keyword">if</span> (!success) &#123;<br>            <span class="hljs-comment">// æ‰£å‡å¤±è´¥</span><br>            log.error(<span class="hljs-string">&quot;åº“å­˜ä¸è¶³&quot;</span>);<br>            <span class="hljs-keyword">return</span> ;<br>        &#125;<br>        save(voucherOrder);<br> <br>    &#125;<br><br></code></pre></td></tr></table></figure><p><strong>å°æ€»ç»“ï¼š</strong></p><p>ç§’æ€ä¸šåŠ¡çš„ä¼˜åŒ–æ€è·¯æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>å…ˆåˆ©ç”¨Rediså®Œæˆåº“å­˜ä½™é‡ã€ä¸€äººä¸€å•åˆ¤æ–­ï¼Œå®ŒæˆæŠ¢å•ä¸šåŠ¡</li><li>å†å°†ä¸‹å•ä¸šåŠ¡æ”¾å…¥é˜»å¡é˜Ÿåˆ—ï¼Œåˆ©ç”¨ç‹¬ç«‹çº¿ç¨‹å¼‚æ­¥ä¸‹å•</li><li>åŸºäºé˜»å¡é˜Ÿåˆ—çš„å¼‚æ­¥ç§’æ€å­˜åœ¨å“ªäº›é—®é¢˜ï¼Ÿ<ul><li>å†…å­˜é™åˆ¶é—®é¢˜</li><li>æ•°æ®å®‰å…¨é—®é¢˜</li></ul></li></ul><h2 id="7ã€Redisæ¶ˆæ¯é˜Ÿåˆ—"><a href="#7ã€Redisæ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="7ã€Redisæ¶ˆæ¯é˜Ÿåˆ—"></a>7ã€Redisæ¶ˆæ¯é˜Ÿåˆ—</h2><h3 id="7-1-Redisæ¶ˆæ¯é˜Ÿåˆ—-è®¤è¯†æ¶ˆæ¯é˜Ÿåˆ—"><a href="#7-1-Redisæ¶ˆæ¯é˜Ÿåˆ—-è®¤è¯†æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="7.1 Redisæ¶ˆæ¯é˜Ÿåˆ—-è®¤è¯†æ¶ˆæ¯é˜Ÿåˆ—"></a>7.1 Redisæ¶ˆæ¯é˜Ÿåˆ—-è®¤è¯†æ¶ˆæ¯é˜Ÿåˆ—</h3><p>ä»€ä¹ˆæ˜¯æ¶ˆæ¯é˜Ÿåˆ—ï¼šå­—é¢æ„æ€å°±æ˜¯å­˜æ”¾æ¶ˆæ¯çš„é˜Ÿåˆ—ã€‚æœ€ç®€å•çš„æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å‹åŒ…æ‹¬3ä¸ªè§’è‰²ï¼š</p><ul><li>æ¶ˆæ¯é˜Ÿåˆ—ï¼šå­˜å‚¨å’Œç®¡ç†æ¶ˆæ¯ï¼Œä¹Ÿè¢«ç§°ä¸ºæ¶ˆæ¯ä»£ç†ï¼ˆMessage Brokerï¼‰</li><li>ç”Ÿäº§è€…ï¼šå‘é€æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—</li><li>æ¶ˆè´¹è€…ï¼šä»æ¶ˆæ¯é˜Ÿåˆ—è·å–æ¶ˆæ¯å¹¶å¤„ç†æ¶ˆæ¯</li></ul><p><img src="/20221205120000/1653574849336.png" alt="1653574849336"></p><p>ä½¿ç”¨é˜Ÿåˆ—çš„å¥½å¤„åœ¨äº <strong>è§£è€¦ï¼š</strong>æ‰€è°“è§£è€¦ï¼Œä¸¾ä¸€ä¸ªç”Ÿæ´»ä¸­çš„ä¾‹å­å°±æ˜¯ï¼šå¿«é€’å‘˜(ç”Ÿäº§è€…)æŠŠå¿«é€’æ”¾åˆ°å¿«é€’æŸœé‡Œè¾¹(Message Queue)å»ï¼Œæˆ‘ä»¬(æ¶ˆè´¹è€…)ä»å¿«é€’æŸœé‡Œè¾¹å»æ‹¿ä¸œè¥¿ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå¼‚æ­¥ï¼Œå¦‚æœè€¦åˆï¼Œé‚£ä¹ˆè¿™ä¸ªå¿«é€’å‘˜ç›¸å½“äºç›´æ¥æŠŠå¿«é€’äº¤ç»™ä½ ï¼Œè¿™äº‹å›ºç„¶å¥½ï¼Œä½†æ˜¯ä¸‡ä¸€ä½ ä¸åœ¨å®¶ï¼Œé‚£ä¹ˆå¿«é€’å‘˜å°±ä¼šä¸€ç›´ç­‰ä½ ï¼Œè¿™å°±æµªè´¹äº†å¿«é€’å‘˜çš„æ—¶é—´ï¼Œæ‰€ä»¥è¿™ç§æ€æƒ³åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘ä¸­ï¼Œæ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚</p><p>è¿™ç§åœºæ™¯åœ¨æˆ‘ä»¬ç§’æ€ä¸­å°±å˜æˆäº†ï¼šæˆ‘ä»¬ä¸‹å•ä¹‹åï¼Œåˆ©ç”¨rediså»è¿›è¡Œæ ¡éªŒä¸‹å•æ¡ä»¶ï¼Œå†é€šè¿‡é˜Ÿåˆ—æŠŠæ¶ˆæ¯å‘é€å‡ºå»ï¼Œç„¶åå†å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹å»æ¶ˆè´¹è¿™ä¸ªæ¶ˆæ¯ï¼Œå®Œæˆè§£è€¦ï¼ŒåŒæ—¶ä¹ŸåŠ å¿«æˆ‘ä»¬çš„å“åº”é€Ÿåº¦ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›ç°æˆçš„mqï¼Œæ¯”å¦‚kafkaï¼Œrabbitmqç­‰ç­‰ï¼Œä½†æ˜¯å‘¢ï¼Œå¦‚æœæ²¡æœ‰å®‰è£…mqï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨redisæä¾›çš„mqæ–¹æ¡ˆï¼Œé™ä½æˆ‘ä»¬çš„éƒ¨ç½²å’Œå­¦ä¹ æˆæœ¬ã€‚</p><h3 id="7-2-Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºListå®ç°æ¶ˆæ¯é˜Ÿåˆ—"><a href="#7-2-Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºListå®ç°æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="7.2 Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºListå®ç°æ¶ˆæ¯é˜Ÿåˆ—"></a>7.2 Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºListå®ç°æ¶ˆæ¯é˜Ÿåˆ—</h3><p><strong>åŸºäºListç»“æ„æ¨¡æ‹Ÿæ¶ˆæ¯é˜Ÿåˆ—</strong></p><p>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼‰ï¼Œå­—é¢æ„æ€å°±æ˜¯å­˜æ”¾æ¶ˆæ¯çš„é˜Ÿåˆ—ã€‚è€ŒRedisçš„listæ•°æ®ç»“æ„æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œå¾ˆå®¹æ˜“æ¨¡æ‹Ÿå‡ºé˜Ÿåˆ—æ•ˆæœã€‚</p><p>é˜Ÿåˆ—æ˜¯å…¥å£å’Œå‡ºå£ä¸åœ¨ä¸€è¾¹ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ï¼šLPUSH ç»“åˆ RPOPã€æˆ–è€… RPUSH ç»“åˆ LPOPæ¥å®ç°ã€‚<br>ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œå½“é˜Ÿåˆ—ä¸­æ²¡æœ‰æ¶ˆæ¯æ—¶RPOPæˆ–LPOPæ“ä½œä¼šè¿”å›nullï¼Œå¹¶ä¸åƒJVMçš„é˜»å¡é˜Ÿåˆ—é‚£æ ·ä¼šé˜»å¡å¹¶ç­‰å¾…æ¶ˆæ¯ã€‚å› æ­¤è¿™é‡Œåº”è¯¥ä½¿ç”¨BRPOPæˆ–è€…BLPOPæ¥å®ç°é˜»å¡æ•ˆæœã€‚</p><p><img src="/20221205120000/1653575176451.png" alt="1653575176451"></p><p>åŸºäºListçš„æ¶ˆæ¯é˜Ÿåˆ—æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ<br>ä¼˜ç‚¹ï¼š</p><ul><li>åˆ©ç”¨Rediså­˜å‚¨ï¼Œä¸å—é™äºJVMå†…å­˜ä¸Šé™</li><li>åŸºäºRedisçš„æŒä¹…åŒ–æœºåˆ¶ï¼Œæ•°æ®å®‰å…¨æ€§æœ‰ä¿è¯</li><li>å¯ä»¥æ»¡è¶³æ¶ˆæ¯æœ‰åºæ€§</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>æ— æ³•é¿å…æ¶ˆæ¯ä¸¢å¤±</li><li>åªæ”¯æŒå•æ¶ˆè´¹è€…</li></ul><h3 id="7-3-Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºPubSubçš„æ¶ˆæ¯é˜Ÿåˆ—"><a href="#7-3-Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºPubSubçš„æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="7.3 Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºPubSubçš„æ¶ˆæ¯é˜Ÿåˆ—"></a>7.3 Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºPubSubçš„æ¶ˆæ¯é˜Ÿåˆ—</h3><p>PubSubï¼ˆå‘å¸ƒè®¢é˜…ï¼‰æ˜¯Redis2.0ç‰ˆæœ¬å¼•å…¥çš„æ¶ˆæ¯ä¼ é€’æ¨¡å‹ã€‚é¡¾åæ€ä¹‰ï¼Œæ¶ˆè´¹è€…å¯ä»¥è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªchannelï¼Œç”Ÿäº§è€…å‘å¯¹åº”channelå‘é€æ¶ˆæ¯åï¼Œæ‰€æœ‰è®¢é˜…è€…éƒ½èƒ½æ”¶åˆ°ç›¸å…³æ¶ˆæ¯ã€‚</p><p> SUBSCRIBE channel [channel] ï¼šè®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªé¢‘é“<br> PUBLISH channel msg ï¼šå‘ä¸€ä¸ªé¢‘é“å‘é€æ¶ˆæ¯<br> PSUBSCRIBE pattern[pattern] ï¼šè®¢é˜…ä¸patternæ ¼å¼åŒ¹é…çš„æ‰€æœ‰é¢‘é“</p><p><img src="/20221205120000/1653575506373.png" alt="1653575506373"></p><p>åŸºäºPubSubçš„æ¶ˆæ¯é˜Ÿåˆ—æœ‰å“ªäº›ä¼˜ç¼ºç‚¹ï¼Ÿ<br>ä¼˜ç‚¹ï¼š</p><ul><li>é‡‡ç”¨å‘å¸ƒè®¢é˜…æ¨¡å‹ï¼Œæ”¯æŒå¤šç”Ÿäº§ã€å¤šæ¶ˆè´¹</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>ä¸æ”¯æŒæ•°æ®æŒä¹…åŒ–</li><li>æ— æ³•é¿å…æ¶ˆæ¯ä¸¢å¤±</li><li>æ¶ˆæ¯å †ç§¯æœ‰ä¸Šé™ï¼Œè¶…å‡ºæ—¶æ•°æ®ä¸¢å¤±</li></ul><h3 id="7-4-Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—"><a href="#7-4-Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="7.4 Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—"></a>7.4 Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—</h3><p>Stream æ˜¯ Redis 5.0 å¼•å…¥çš„ä¸€ç§æ–°æ•°æ®ç±»å‹ï¼Œå¯ä»¥å®ç°ä¸€ä¸ªåŠŸèƒ½éå¸¸å®Œå–„çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p><p>å‘é€æ¶ˆæ¯çš„å‘½ä»¤ï¼š</p><p><img src="/20221205120000/1653577301737.png" alt="1653577301737"></p><p>ä¾‹å¦‚ï¼š</p><p><img src="/20221205120000/1653577349691.png" alt="1653577349691"></p><p>è¯»å–æ¶ˆæ¯çš„æ–¹å¼ä¹‹ä¸€ï¼šXREAD</p><p><img src="/20221205120000/1653577445413.png" alt="1653577445413"></p><p>ä¾‹å¦‚ï¼Œä½¿ç”¨XREADè¯»å–ç¬¬ä¸€ä¸ªæ¶ˆæ¯ï¼š</p><p><img src="/20221205120000/1653577643629.png" alt="1653577643629"></p><p>XREADé˜»å¡æ–¹å¼ï¼Œè¯»å–æœ€æ–°çš„æ¶ˆæ¯ï¼š</p><p><img src="/20221205120000/1653577659166.png" alt="1653577659166"></p><p>åœ¨ä¸šåŠ¡å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¾ªç¯çš„è°ƒç”¨XREADé˜»å¡æ–¹å¼æ¥æŸ¥è¯¢æœ€æ–°æ¶ˆæ¯ï¼Œä»è€Œå®ç°æŒç»­ç›‘å¬é˜Ÿåˆ—çš„æ•ˆæœï¼Œä¼ªä»£ç å¦‚ä¸‹</p><p><img src="/20221205120000/1653577689129.png" alt="1653577689129"></p><p>æ³¨æ„ï¼šå½“æˆ‘ä»¬æŒ‡å®šèµ·å§‹IDä¸º$æ—¶ï¼Œä»£è¡¨è¯»å–æœ€æ–°çš„æ¶ˆæ¯ï¼Œå¦‚æœæˆ‘ä»¬å¤„ç†ä¸€æ¡æ¶ˆæ¯çš„è¿‡ç¨‹ä¸­ï¼Œåˆæœ‰è¶…è¿‡1æ¡ä»¥ä¸Šçš„æ¶ˆæ¯åˆ°è¾¾é˜Ÿåˆ—ï¼Œåˆ™ä¸‹æ¬¡è·å–æ—¶ä¹Ÿåªèƒ½è·å–åˆ°æœ€æ–°çš„ä¸€æ¡ï¼Œä¼šå‡ºç°æ¼è¯»æ¶ˆæ¯çš„é—®é¢˜</p><p>STREAMç±»å‹æ¶ˆæ¯é˜Ÿåˆ—çš„XREADå‘½ä»¤ç‰¹ç‚¹ï¼š</p><ul><li>æ¶ˆæ¯å¯å›æº¯</li><li>ä¸€ä¸ªæ¶ˆæ¯å¯ä»¥è¢«å¤šä¸ªæ¶ˆè´¹è€…è¯»å–</li><li>å¯ä»¥é˜»å¡è¯»å–</li><li>æœ‰æ¶ˆæ¯æ¼è¯»çš„é£é™©</li></ul><h3 id="7-5-Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—-æ¶ˆè´¹è€…ç»„"><a href="#7-5-Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—-æ¶ˆè´¹è€…ç»„" class="headerlink" title="7.5 Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—-æ¶ˆè´¹è€…ç»„"></a>7.5 Redisæ¶ˆæ¯é˜Ÿåˆ—-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—-æ¶ˆè´¹è€…ç»„</h3><p>æ¶ˆè´¹è€…ç»„ï¼ˆConsumer Groupï¼‰ï¼šå°†å¤šä¸ªæ¶ˆè´¹è€…åˆ’åˆ†åˆ°ä¸€ä¸ªç»„ä¸­ï¼Œç›‘å¬åŒä¸€ä¸ªé˜Ÿåˆ—ã€‚å…·å¤‡ä¸‹åˆ—ç‰¹ç‚¹ï¼š</p><p><img src="/20221205120000/1653577801668.png" alt="1653577801668"></p><p>åˆ›å»ºæ¶ˆè´¹è€…ç»„ï¼š<br><img src="/20221205120000/1653577984924.png" alt="1653577984924"><br>keyï¼šé˜Ÿåˆ—åç§°<br>groupNameï¼šæ¶ˆè´¹è€…ç»„åç§°<br>IDï¼šèµ·å§‹IDæ ‡ç¤ºï¼Œ$ä»£è¡¨é˜Ÿåˆ—ä¸­æœ€åä¸€ä¸ªæ¶ˆæ¯ï¼Œ0åˆ™ä»£è¡¨é˜Ÿåˆ—ä¸­ç¬¬ä¸€ä¸ªæ¶ˆæ¯<br>MKSTREAMï¼šé˜Ÿåˆ—ä¸å­˜åœ¨æ—¶è‡ªåŠ¨åˆ›å»ºé˜Ÿåˆ—<br>å…¶å®ƒå¸¸è§å‘½ä»¤ï¼š</p><p> <strong>åˆ é™¤æŒ‡å®šçš„æ¶ˆè´¹è€…ç»„</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">XGROUP DESTORY key groupName<br></code></pre></td></tr></table></figure><p> <strong>ç»™æŒ‡å®šçš„æ¶ˆè´¹è€…ç»„æ·»åŠ æ¶ˆè´¹è€…</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">XGROUP CREATECONSUMER key groupname consumername<br></code></pre></td></tr></table></figure><p> <strong>åˆ é™¤æ¶ˆè´¹è€…ç»„ä¸­çš„æŒ‡å®šæ¶ˆè´¹è€…</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">XGROUP DELCONSUMER key groupname consumername<br></code></pre></td></tr></table></figure><p>ä»æ¶ˆè´¹è€…ç»„è¯»å–æ¶ˆæ¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">XREADGROUP GROUP group consumer [COUNT count] [BLOCK milliseconds] [NOACK] STREAMS key [key ...] ID [ID ...]<br></code></pre></td></tr></table></figure><ul><li>groupï¼šæ¶ˆè´¹ç»„åç§°</li><li>consumerï¼šæ¶ˆè´¹è€…åç§°ï¼Œå¦‚æœæ¶ˆè´¹è€…ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…</li><li>countï¼šæœ¬æ¬¡æŸ¥è¯¢çš„æœ€å¤§æ•°é‡</li><li>BLOCK millisecondsï¼šå½“æ²¡æœ‰æ¶ˆæ¯æ—¶æœ€é•¿ç­‰å¾…æ—¶é—´</li><li>NOACKï¼šæ— éœ€æ‰‹åŠ¨ACKï¼Œè·å–åˆ°æ¶ˆæ¯åè‡ªåŠ¨ç¡®è®¤</li><li>STREAMS keyï¼šæŒ‡å®šé˜Ÿåˆ—åç§°</li><li>IDï¼šè·å–æ¶ˆæ¯çš„èµ·å§‹IDï¼š</li></ul><p>â€œ&gt;â€ï¼šä»ä¸‹ä¸€ä¸ªæœªæ¶ˆè´¹çš„æ¶ˆæ¯å¼€å§‹<br>å…¶å®ƒï¼šæ ¹æ®æŒ‡å®šidä»pending-listä¸­è·å–å·²æ¶ˆè´¹ä½†æœªç¡®è®¤çš„æ¶ˆæ¯ï¼Œä¾‹å¦‚0ï¼Œæ˜¯ä»pending-listä¸­çš„ç¬¬ä¸€ä¸ªæ¶ˆæ¯å¼€å§‹</p><p>æ¶ˆè´¹è€…ç›‘å¬æ¶ˆæ¯çš„åŸºæœ¬æ€è·¯ï¼š</p><p><img src="/20221205120000/1653578211854.png" alt="1653578211854">STREAMç±»å‹æ¶ˆæ¯é˜Ÿåˆ—çš„XREADGROUPå‘½ä»¤ç‰¹ç‚¹ï¼š</p><ul><li>æ¶ˆæ¯å¯å›æº¯</li><li>å¯ä»¥å¤šæ¶ˆè´¹è€…äº‰æŠ¢æ¶ˆæ¯ï¼ŒåŠ å¿«æ¶ˆè´¹é€Ÿåº¦</li><li>å¯ä»¥é˜»å¡è¯»å–</li><li>æ²¡æœ‰æ¶ˆæ¯æ¼è¯»çš„é£é™©</li><li>æœ‰æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ï¼Œä¿è¯æ¶ˆæ¯è‡³å°‘è¢«æ¶ˆè´¹ä¸€æ¬¡</li></ul><p>æœ€åæˆ‘ä»¬æ¥ä¸ªå°å¯¹æ¯”</p><p><img src="/20221205120000/1653578560691.png" alt="1653578560691"></p><h3 id="7-6-åŸºäºRedisçš„Streamç»“æ„ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ç°å¼‚æ­¥ç§’æ€ä¸‹å•"><a href="#7-6-åŸºäºRedisçš„Streamç»“æ„ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ç°å¼‚æ­¥ç§’æ€ä¸‹å•" class="headerlink" title="7.6 åŸºäºRedisçš„Streamç»“æ„ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ç°å¼‚æ­¥ç§’æ€ä¸‹å•"></a>7.6 åŸºäºRedisçš„Streamç»“æ„ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ç°å¼‚æ­¥ç§’æ€ä¸‹å•</h3><p>éœ€æ±‚ï¼š</p><ul><li>åˆ›å»ºä¸€ä¸ªStreamç±»å‹çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œåä¸ºstream.orders</li><li>ä¿®æ”¹ä¹‹å‰çš„ç§’æ€ä¸‹å•Luaè„šæœ¬ï¼Œåœ¨è®¤å®šæœ‰æŠ¢è´­èµ„æ ¼åï¼Œç›´æ¥å‘stream.ordersä¸­æ·»åŠ æ¶ˆæ¯ï¼Œå†…å®¹åŒ…å«voucherIdã€userIdã€orderId</li><li>é¡¹ç›®å¯åŠ¨æ—¶ï¼Œå¼€å¯ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ï¼Œå°è¯•è·å–stream.ordersä¸­çš„æ¶ˆæ¯ï¼Œå®Œæˆä¸‹å•\</li></ul><p>ä¿®æ”¹luaè¡¨è¾¾å¼,æ–°å¢3.6 </p><p><img src="/20221205120000/1656082824939.png" alt="1656082824939"></p><p>VoucherOrderServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VoucherOrderHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> &#123;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// 1.è·å–æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„è®¢å•ä¿¡æ¯ XREADGROUP GROUP g1 c1 COUNT 1 BLOCK 2000 STREAMS s1 &gt;</span><br>                List&lt;MapRecord&lt;String, Object, Object&gt;&gt; list = stringRedisTemplate.opsForStream().read(<br>                    Consumer.from(<span class="hljs-string">&quot;g1&quot;</span>, <span class="hljs-string">&quot;c1&quot;</span>),<br>                    StreamReadOptions.empty().count(<span class="hljs-number">1</span>).block(Duration.ofSeconds(<span class="hljs-number">2</span>)),<br>                    StreamOffset.create(<span class="hljs-string">&quot;stream.orders&quot;</span>, ReadOffset.lastConsumed())<br>                );<br>                <span class="hljs-comment">// 2.åˆ¤æ–­è®¢å•ä¿¡æ¯æ˜¯å¦ä¸ºç©º</span><br>                <span class="hljs-keyword">if</span> (list == <span class="hljs-literal">null</span> || list.isEmpty()) &#123;<br>                    <span class="hljs-comment">// å¦‚æœä¸ºnullï¼Œè¯´æ˜æ²¡æœ‰æ¶ˆæ¯ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯</span><br>                    <span class="hljs-keyword">continue</span>;<br>                &#125;<br>                <span class="hljs-comment">// è§£ææ•°æ®</span><br>                MapRecord&lt;String, Object, Object&gt; record = list.get(<span class="hljs-number">0</span>);<br>                Map&lt;Object, Object&gt; value = record.getValue();<br>                <span class="hljs-type">VoucherOrder</span> <span class="hljs-variable">voucherOrder</span> <span class="hljs-operator">=</span> BeanUtil.fillBeanWithMap(value, <span class="hljs-keyword">new</span> <span class="hljs-title class_">VoucherOrder</span>(), <span class="hljs-literal">true</span>);<br>                <span class="hljs-comment">// 3.åˆ›å»ºè®¢å•</span><br>                createVoucherOrder(voucherOrder);<br>                <span class="hljs-comment">// 4.ç¡®è®¤æ¶ˆæ¯ XACK</span><br>                stringRedisTemplate.opsForStream().acknowledge(<span class="hljs-string">&quot;s1&quot;</span>, <span class="hljs-string">&quot;g1&quot;</span>, record.getId());<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                log.error(<span class="hljs-string">&quot;å¤„ç†è®¢å•å¼‚å¸¸&quot;</span>, e);<br>                <span class="hljs-comment">//å¤„ç†å¼‚å¸¸æ¶ˆæ¯</span><br>                handlePendingList();<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handlePendingList</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-comment">// 1.è·å–pending-listä¸­çš„è®¢å•ä¿¡æ¯ XREADGROUP GROUP g1 c1 COUNT 1 BLOCK 2000 STREAMS s1 0</span><br>                List&lt;MapRecord&lt;String, Object, Object&gt;&gt; list = stringRedisTemplate.opsForStream().read(<br>                    Consumer.from(<span class="hljs-string">&quot;g1&quot;</span>, <span class="hljs-string">&quot;c1&quot;</span>),<br>                    StreamReadOptions.empty().count(<span class="hljs-number">1</span>),<br>                    StreamOffset.create(<span class="hljs-string">&quot;stream.orders&quot;</span>, ReadOffset.from(<span class="hljs-string">&quot;0&quot;</span>))<br>                );<br>                <span class="hljs-comment">// 2.åˆ¤æ–­è®¢å•ä¿¡æ¯æ˜¯å¦ä¸ºç©º</span><br>                <span class="hljs-keyword">if</span> (list == <span class="hljs-literal">null</span> || list.isEmpty()) &#123;<br>                    <span class="hljs-comment">// å¦‚æœä¸ºnullï¼Œè¯´æ˜æ²¡æœ‰å¼‚å¸¸æ¶ˆæ¯ï¼Œç»“æŸå¾ªç¯</span><br>                    <span class="hljs-keyword">break</span>;<br>                &#125;<br>                <span class="hljs-comment">// è§£ææ•°æ®</span><br>                MapRecord&lt;String, Object, Object&gt; record = list.get(<span class="hljs-number">0</span>);<br>                Map&lt;Object, Object&gt; value = record.getValue();<br>                <span class="hljs-type">VoucherOrder</span> <span class="hljs-variable">voucherOrder</span> <span class="hljs-operator">=</span> BeanUtil.fillBeanWithMap(value, <span class="hljs-keyword">new</span> <span class="hljs-title class_">VoucherOrder</span>(), <span class="hljs-literal">true</span>);<br>                <span class="hljs-comment">// 3.åˆ›å»ºè®¢å•</span><br>                createVoucherOrder(voucherOrder);<br>                <span class="hljs-comment">// 4.ç¡®è®¤æ¶ˆæ¯ XACK</span><br>                stringRedisTemplate.opsForStream().acknowledge(<span class="hljs-string">&quot;s1&quot;</span>, <span class="hljs-string">&quot;g1&quot;</span>, record.getId());<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>                log.error(<span class="hljs-string">&quot;å¤„ç†penddingè®¢å•å¼‚å¸¸&quot;</span>, e);<br>                <span class="hljs-keyword">try</span>&#123;<br>                    Thread.sleep(<span class="hljs-number">20</span>);<br>                &#125;<span class="hljs-keyword">catch</span>(Exception e)&#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="8ã€è¾¾äººæ¢åº—"><a href="#8ã€è¾¾äººæ¢åº—" class="headerlink" title="8ã€è¾¾äººæ¢åº—"></a>8ã€è¾¾äººæ¢åº—</h2><h3 id="8-1ã€è¾¾äººæ¢åº—-å‘å¸ƒæ¢åº—ç¬”è®°"><a href="#8-1ã€è¾¾äººæ¢åº—-å‘å¸ƒæ¢åº—ç¬”è®°" class="headerlink" title="8.1ã€è¾¾äººæ¢åº—-å‘å¸ƒæ¢åº—ç¬”è®°"></a>8.1ã€è¾¾äººæ¢åº—-å‘å¸ƒæ¢åº—ç¬”è®°</h3><p>å‘å¸ƒæ¢åº—ç¬”è®°</p><p>æ¢åº—ç¬”è®°ç±»ä¼¼ç‚¹è¯„ç½‘ç«™çš„è¯„ä»·ï¼Œå¾€å¾€æ˜¯å›¾æ–‡ç»“åˆã€‚å¯¹åº”çš„è¡¨æœ‰ä¸¤ä¸ªï¼š<br>tb_blogï¼šæ¢åº—ç¬”è®°è¡¨ï¼ŒåŒ…å«ç¬”è®°ä¸­çš„æ ‡é¢˜ã€æ–‡å­—ã€å›¾ç‰‡ç­‰<br>tb_blog_commentsï¼šå…¶ä»–ç”¨æˆ·å¯¹æ¢åº—ç¬”è®°çš„è¯„ä»·</p><p><strong>å…·ä½“å‘å¸ƒæµç¨‹</strong></p><p><img src="/20221205120000/1653578992639.png" alt="1653578992639"></p><p>ä¸Šä¼ æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Slf4j</span><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;upload&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UploadController</span> &#123;<br><br>    <span class="hljs-meta">@PostMapping(&quot;blog&quot;)</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">uploadImage</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;file&quot;)</span> MultipartFile image)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// è·å–åŸå§‹æ–‡ä»¶åç§°</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">originalFilename</span> <span class="hljs-operator">=</span> image.getOriginalFilename();<br>            <span class="hljs-comment">// ç”Ÿæˆæ–°æ–‡ä»¶å</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> createNewFileName(originalFilename);<br>            <span class="hljs-comment">// ä¿å­˜æ–‡ä»¶</span><br>            image.transferTo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(SystemConstants.IMAGE_UPLOAD_DIR, fileName));<br>            <span class="hljs-comment">// è¿”å›ç»“æœ</span><br>            log.debug(<span class="hljs-string">&quot;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œ&#123;&#125;&quot;</span>, fileName);<br>            <span class="hljs-keyword">return</span> Result.ok(fileName);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;æ–‡ä»¶ä¸Šä¼ å¤±è´¥&quot;</span>, e);<br>        &#125;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šåŒå­¦ä»¬åœ¨æ“ä½œæ—¶ï¼Œéœ€è¦ä¿®æ”¹SystemConstants.IMAGE_UPLOAD_DIR è‡ªå·±å›¾ç‰‡æ‰€åœ¨çš„åœ°å€ï¼Œåœ¨å®é™…å¼€å‘ä¸­å›¾ç‰‡ä¸€èˆ¬ä¼šæ”¾åœ¨nginxä¸Šæˆ–è€…æ˜¯äº‘å­˜å‚¨ä¸Šã€‚</p><p>BlogController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/blog&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BlogController</span> &#123;<br><br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> IBlogService blogService;<br><br>    <span class="hljs-meta">@PostMapping</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">saveBlog</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Blog blog)</span> &#123;<br>        <span class="hljs-comment">//è·å–ç™»å½•ç”¨æˆ·</span><br>        <span class="hljs-type">UserDTO</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> UserHolder.getUser();<br>        blog.setUpdateTime(user.getId());<br>        <span class="hljs-comment">//ä¿å­˜æ¢åº—åšæ–‡</span><br>        blogService.saveBlog(blog);<br>        <span class="hljs-comment">//è¿”å›id</span><br>        <span class="hljs-keyword">return</span> Result.ok(blog.getId());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="8-2-è¾¾äººæ¢åº—-æŸ¥çœ‹æ¢åº—ç¬”è®°"><a href="#8-2-è¾¾äººæ¢åº—-æŸ¥çœ‹æ¢åº—ç¬”è®°" class="headerlink" title="8.2 è¾¾äººæ¢åº—-æŸ¥çœ‹æ¢åº—ç¬”è®°"></a>8.2 è¾¾äººæ¢åº—-æŸ¥çœ‹æ¢åº—ç¬”è®°</h3><p>å®ç°æŸ¥çœ‹å‘å¸ƒæ¢åº—ç¬”è®°çš„æ¥å£</p><p><img src="/20221205120000/1653579931626.png" alt="1653579931626"></p><p>å®ç°ä»£ç ï¼š</p><p>BlogServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryBlogById</span><span class="hljs-params">(Long id)</span> &#123;<br>    <span class="hljs-comment">// 1.æŸ¥è¯¢blog</span><br>    <span class="hljs-type">Blog</span> <span class="hljs-variable">blog</span> <span class="hljs-operator">=</span> getById(id);<br>    <span class="hljs-keyword">if</span> (blog == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;ç¬”è®°ä¸å­˜åœ¨ï¼&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">// 2.æŸ¥è¯¢blogæœ‰å…³çš„ç”¨æˆ·</span><br>    queryBlogUser(blog);<br>  <br>    <span class="hljs-keyword">return</span> Result.ok(blog);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="8-3-è¾¾äººæ¢åº—-ç‚¹èµåŠŸèƒ½"><a href="#8-3-è¾¾äººæ¢åº—-ç‚¹èµåŠŸèƒ½" class="headerlink" title="8.3 è¾¾äººæ¢åº—-ç‚¹èµåŠŸèƒ½"></a>8.3 è¾¾äººæ¢åº—-ç‚¹èµåŠŸèƒ½</h3><p>åˆå§‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/likes/&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryBlogLikes</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;<br>    <span class="hljs-comment">//ä¿®æ”¹ç‚¹èµæ•°é‡</span><br>    blogService.update().setSql(<span class="hljs-string">&quot;liked = liked +1 &quot;</span>).eq(<span class="hljs-string">&quot;id&quot;</span>,id).update();<br>    <span class="hljs-keyword">return</span> Result.ok();<br>&#125;<br></code></pre></td></tr></table></figure><p>é—®é¢˜åˆ†æï¼šè¿™ç§æ–¹å¼ä¼šå¯¼è‡´ä¸€ä¸ªç”¨æˆ·æ— é™ç‚¹èµï¼Œæ˜æ˜¾æ˜¯ä¸åˆç†çš„</p><p>é€ æˆè¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯ï¼Œæˆ‘ä»¬ç°åœ¨çš„é€»è¾‘ï¼Œå‘èµ·è¯·æ±‚åªæ˜¯ç»™æ•°æ®åº“+1ï¼Œæ‰€ä»¥æ‰ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜</p><p><img src="/20221205120000/1653581590453.png" alt="1653581590453"></p><p>å®Œå–„ç‚¹èµåŠŸèƒ½</p><p>éœ€æ±‚ï¼š</p><ul><li>åŒä¸€ä¸ªç”¨æˆ·åªèƒ½ç‚¹èµä¸€æ¬¡ï¼Œå†æ¬¡ç‚¹å‡»åˆ™å–æ¶ˆç‚¹èµ</li><li>å¦‚æœå½“å‰ç”¨æˆ·å·²ç»ç‚¹èµï¼Œåˆ™ç‚¹èµæŒ‰é’®é«˜äº®æ˜¾ç¤ºï¼ˆå‰ç«¯å·²å®ç°ï¼Œåˆ¤æ–­å­—æ®µBlogç±»çš„isLikeå±æ€§ï¼‰</li></ul><p>å®ç°æ­¥éª¤ï¼š</p><ul><li>ç»™Blogç±»ä¸­æ·»åŠ ä¸€ä¸ªisLikeå­—æ®µï¼Œæ ‡ç¤ºæ˜¯å¦è¢«å½“å‰ç”¨æˆ·ç‚¹èµ</li><li>ä¿®æ”¹ç‚¹èµåŠŸèƒ½ï¼Œåˆ©ç”¨Redisçš„seté›†åˆåˆ¤æ–­æ˜¯å¦ç‚¹èµè¿‡ï¼Œæœªç‚¹èµè¿‡åˆ™ç‚¹èµæ•°+1ï¼Œå·²ç‚¹èµè¿‡åˆ™ç‚¹èµæ•°-1</li><li>ä¿®æ”¹æ ¹æ®idæŸ¥è¯¢Blogçš„ä¸šåŠ¡ï¼Œåˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦ç‚¹èµè¿‡ï¼Œèµ‹å€¼ç»™isLikeå­—æ®µ</li><li>ä¿®æ”¹åˆ†é¡µæŸ¥è¯¢Blogä¸šåŠ¡ï¼Œåˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦ç‚¹èµè¿‡ï¼Œèµ‹å€¼ç»™isLikeå­—æ®µ</li></ul><p>ä¸ºä»€ä¹ˆé‡‡ç”¨seté›†åˆï¼š</p><p>å› ä¸ºæˆ‘ä»¬çš„æ•°æ®æ˜¯ä¸èƒ½é‡å¤çš„ï¼Œå½“ç”¨æˆ·æ“ä½œè¿‡ä¹‹åï¼Œæ— è®ºä»–æ€ä¹ˆæ“ä½œï¼Œéƒ½æ˜¯</p><p>å…·ä½“æ­¥éª¤ï¼š</p><p>1ã€åœ¨Blog æ·»åŠ ä¸€ä¸ªå­—æ®µ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@TableField(exist = false)</span><br><span class="hljs-keyword">private</span> Boolean isLike;<br></code></pre></td></tr></table></figure><p>2ã€ä¿®æ”¹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>   <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">likeBlog</span><span class="hljs-params">(Long id)</span>&#123;<br>       <span class="hljs-comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span><br>       <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>       <span class="hljs-comment">// 2.åˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦å·²ç»ç‚¹èµ</span><br>       <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> BLOG_LIKED_KEY + id;<br>       <span class="hljs-type">Boolean</span> <span class="hljs-variable">isMember</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForSet().isMember(key, userId.toString());<br>       <span class="hljs-keyword">if</span>(BooleanUtil.isFalse(isMember))&#123;<br>            <span class="hljs-comment">//3.å¦‚æœæœªç‚¹èµï¼Œå¯ä»¥ç‚¹èµ</span><br>           <span class="hljs-comment">//3.1 æ•°æ®åº“ç‚¹èµæ•°+1</span><br>           <span class="hljs-type">boolean</span> <span class="hljs-variable">isSuccess</span> <span class="hljs-operator">=</span> update().setSql(<span class="hljs-string">&quot;liked = liked + 1&quot;</span>).eq(<span class="hljs-string">&quot;id&quot;</span>, id).update();<br>           <span class="hljs-comment">//3.2 ä¿å­˜ç”¨æˆ·åˆ°Redisçš„seté›†åˆ</span><br>           <span class="hljs-keyword">if</span>(isSuccess)&#123;<br>               stringRedisTemplate.opsForSet().add(key,userId.toString());<br>           &#125;<br>       &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-comment">//4.å¦‚æœå·²ç‚¹èµï¼Œå–æ¶ˆç‚¹èµ</span><br>           <span class="hljs-comment">//4.1 æ•°æ®åº“ç‚¹èµæ•°-1</span><br>           <span class="hljs-type">boolean</span> <span class="hljs-variable">isSuccess</span> <span class="hljs-operator">=</span> update().setSql(<span class="hljs-string">&quot;liked = liked - 1&quot;</span>).eq(<span class="hljs-string">&quot;id&quot;</span>, id).update();<br>           <span class="hljs-comment">//4.2 æŠŠç”¨æˆ·ä»Redisçš„seté›†åˆç§»é™¤</span><br>           <span class="hljs-keyword">if</span>(isSuccess)&#123;<br>               stringRedisTemplate.opsForSet().remove(key,userId.toString());<br>           &#125;<br>       &#125;<br></code></pre></td></tr></table></figure><h3 id="8-4-è¾¾äººæ¢åº—-ç‚¹èµæ’è¡Œæ¦œ"><a href="#8-4-è¾¾äººæ¢åº—-ç‚¹èµæ’è¡Œæ¦œ" class="headerlink" title="8.4 è¾¾äººæ¢åº—-ç‚¹èµæ’è¡Œæ¦œ"></a>8.4 è¾¾äººæ¢åº—-ç‚¹èµæ’è¡Œæ¦œ</h3><p>åœ¨æ¢åº—ç¬”è®°çš„è¯¦æƒ…é¡µé¢ï¼Œåº”è¯¥æŠŠç»™è¯¥ç¬”è®°ç‚¹èµçš„äººæ˜¾ç¤ºå‡ºæ¥ï¼Œæ¯”å¦‚æœ€æ—©ç‚¹èµçš„TOP5ï¼Œå½¢æˆç‚¹èµæ’è¡Œæ¦œï¼š</p><p>ä¹‹å‰çš„ç‚¹èµæ˜¯æ”¾åˆ°seté›†åˆï¼Œä½†æ˜¯seté›†åˆæ˜¯ä¸èƒ½æ’åºçš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™ï¼Œå’±ä»¬å¯ä»¥é‡‡ç”¨ä¸€ä¸ªå¯ä»¥æ’åºçš„seté›†åˆï¼Œå°±æ˜¯å’±ä»¬çš„sortedSet</p><p><img src="/20221205120000/1653805077118.png" alt="1653805077118"></p><p>æˆ‘ä»¬æ¥ä¸‹æ¥æ¥å¯¹æ¯”ä¸€ä¸‹è¿™äº›é›†åˆçš„åŒºåˆ«æ˜¯ä»€ä¹ˆ</p><p>æ‰€æœ‰ç‚¹èµçš„äººï¼Œéœ€è¦æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”å½“ä½¿ç”¨setæˆ–è€…æ˜¯sortedSet</p><p>å…¶æ¬¡æˆ‘ä»¬éœ€è¦æ’åºï¼Œå°±å¯ä»¥ç›´æ¥é”å®šä½¿ç”¨sortedSetå•¦</p><p><img src="/20221205120000/1653805203758.png" alt="1653805203758"></p><p>ä¿®æ”¹ä»£ç </p><p>BlogServiceImpl</p><p>ç‚¹èµé€»è¾‘ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br> <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">likeBlog</span><span class="hljs-params">(Long id)</span> &#123;<br>     <span class="hljs-comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span><br>     <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>     <span class="hljs-comment">// 2.åˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦å·²ç»ç‚¹èµ</span><br>     <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> BLOG_LIKED_KEY + id;<br>     <span class="hljs-type">Double</span> <span class="hljs-variable">score</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForZSet().score(key, userId.toString());<br>     <span class="hljs-keyword">if</span> (score == <span class="hljs-literal">null</span>) &#123;<br>         <span class="hljs-comment">// 3.å¦‚æœæœªç‚¹èµï¼Œå¯ä»¥ç‚¹èµ</span><br>         <span class="hljs-comment">// 3.1.æ•°æ®åº“ç‚¹èµæ•° + 1</span><br>         <span class="hljs-type">boolean</span> <span class="hljs-variable">isSuccess</span> <span class="hljs-operator">=</span> update().setSql(<span class="hljs-string">&quot;liked = liked + 1&quot;</span>).eq(<span class="hljs-string">&quot;id&quot;</span>, id).update();<br>         <span class="hljs-comment">// 3.2.ä¿å­˜ç”¨æˆ·åˆ°Redisçš„seté›†åˆ  zadd key value score</span><br>         <span class="hljs-keyword">if</span> (isSuccess) &#123;<br>             stringRedisTemplate.opsForZSet().add(key, userId.toString(), System.currentTimeMillis());<br>         &#125;<br>     &#125; <span class="hljs-keyword">else</span> &#123;<br>         <span class="hljs-comment">// 4.å¦‚æœå·²ç‚¹èµï¼Œå–æ¶ˆç‚¹èµ</span><br>         <span class="hljs-comment">// 4.1.æ•°æ®åº“ç‚¹èµæ•° -1</span><br>         <span class="hljs-type">boolean</span> <span class="hljs-variable">isSuccess</span> <span class="hljs-operator">=</span> update().setSql(<span class="hljs-string">&quot;liked = liked - 1&quot;</span>).eq(<span class="hljs-string">&quot;id&quot;</span>, id).update();<br>         <span class="hljs-comment">// 4.2.æŠŠç”¨æˆ·ä»Redisçš„seté›†åˆç§»é™¤</span><br>         <span class="hljs-keyword">if</span> (isSuccess) &#123;<br>             stringRedisTemplate.opsForZSet().remove(key, userId.toString());<br>         &#125;<br>     &#125;<br>     <span class="hljs-keyword">return</span> Result.ok();<br> &#125;<br><br><br> <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">isBlogLiked</span><span class="hljs-params">(Blog blog)</span> &#123;<br>     <span class="hljs-comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span><br>     <span class="hljs-type">UserDTO</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> UserHolder.getUser();<br>     <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>) &#123;<br>         <span class="hljs-comment">// ç”¨æˆ·æœªç™»å½•ï¼Œæ— éœ€æŸ¥è¯¢æ˜¯å¦ç‚¹èµ</span><br>         <span class="hljs-keyword">return</span>;<br>     &#125;<br>     <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> user.getId();<br>     <span class="hljs-comment">// 2.åˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦å·²ç»ç‚¹èµ</span><br>     <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;blog:liked:&quot;</span> + blog.getId();<br>     <span class="hljs-type">Double</span> <span class="hljs-variable">score</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForZSet().score(key, userId.toString());<br>     blog.setIsLike(score != <span class="hljs-literal">null</span>);<br> &#125;<br></code></pre></td></tr></table></figure><p>ç‚¹èµåˆ—è¡¨æŸ¥è¯¢åˆ—è¡¨</p><p>BlogController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/likes/&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryBlogLikes</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long id)</span> &#123;<br><br>    <span class="hljs-keyword">return</span> blogService.queryBlogLikes(id);<br>&#125;<br></code></pre></td></tr></table></figure><p>BlogService</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryBlogLikes</span><span class="hljs-params">(Long id)</span> &#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> BLOG_LIKED_KEY + id;<br>    <span class="hljs-comment">// 1.æŸ¥è¯¢top5çš„ç‚¹èµç”¨æˆ· zrange key 0 4</span><br>    Set&lt;String&gt; top5 = stringRedisTemplate.opsForZSet().range(key, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>);<br>    <span class="hljs-keyword">if</span> (top5 == <span class="hljs-literal">null</span> || top5.isEmpty()) &#123;<br>        <span class="hljs-keyword">return</span> Result.ok(Collections.emptyList());<br>    &#125;<br>    <span class="hljs-comment">// 2.è§£æå‡ºå…¶ä¸­çš„ç”¨æˆ·id</span><br>    List&lt;Long&gt; ids = top5.stream().map(Long::valueOf).collect(Collectors.toList());<br>    <span class="hljs-type">String</span> <span class="hljs-variable">idStr</span> <span class="hljs-operator">=</span> StrUtil.join(<span class="hljs-string">&quot;,&quot;</span>, ids);<br>    <span class="hljs-comment">// 3.æ ¹æ®ç”¨æˆ·idæŸ¥è¯¢ç”¨æˆ· WHERE id IN ( 5 , 1 ) ORDER BY FIELD(id, 5, 1)</span><br>    List&lt;UserDTO&gt; userDTOS = userService.query()<br>            .in(<span class="hljs-string">&quot;id&quot;</span>, ids).last(<span class="hljs-string">&quot;ORDER BY FIELD(id,&quot;</span> + idStr + <span class="hljs-string">&quot;)&quot;</span>).list()<br>            .stream()<br>            .map(user -&gt; BeanUtil.copyProperties(user, UserDTO.class))<br>            .collect(Collectors.toList());<br>    <span class="hljs-comment">// 4.è¿”å›</span><br>    <span class="hljs-keyword">return</span> Result.ok(userDTOS);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="9ã€å¥½å‹å…³æ³¨"><a href="#9ã€å¥½å‹å…³æ³¨" class="headerlink" title="9ã€å¥½å‹å…³æ³¨"></a>9ã€å¥½å‹å…³æ³¨</h2><h3 id="9-1-å¥½å‹å…³æ³¨-å…³æ³¨å’Œå–æ¶ˆå…³æ³¨"><a href="#9-1-å¥½å‹å…³æ³¨-å…³æ³¨å’Œå–æ¶ˆå…³æ³¨" class="headerlink" title="9.1 å¥½å‹å…³æ³¨-å…³æ³¨å’Œå–æ¶ˆå…³æ³¨"></a>9.1 å¥½å‹å…³æ³¨-å…³æ³¨å’Œå–æ¶ˆå…³æ³¨</h3><p>é’ˆå¯¹ç”¨æˆ·çš„æ“ä½œï¼šå¯ä»¥å¯¹ç”¨æˆ·è¿›è¡Œå…³æ³¨å’Œå–æ¶ˆå…³æ³¨åŠŸèƒ½ã€‚</p><p><img src="/20221205120000/1653806140822.png" alt="1653806140822"></p><p>å®ç°æ€è·¯ï¼š</p><p>éœ€æ±‚ï¼šåŸºäºè¯¥è¡¨æ•°æ®ç»“æ„ï¼Œå®ç°ä¸¤ä¸ªæ¥å£ï¼š</p><ul><li>å…³æ³¨å’Œå–å…³æ¥å£</li><li>åˆ¤æ–­æ˜¯å¦å…³æ³¨çš„æ¥å£</li></ul><p>å…³æ³¨æ˜¯Userä¹‹é—´çš„å…³ç³»ï¼Œæ˜¯åšä¸»ä¸ç²‰ä¸çš„å…³ç³»ï¼Œæ•°æ®åº“ä¸­æœ‰ä¸€å¼ tb_followè¡¨æ¥æ ‡ç¤ºï¼š</p><p><img src="/20221205120000/1653806253817.png" alt="1653806253817"></p><p>æ³¨æ„: è¿™é‡Œéœ€è¦æŠŠä¸»é”®ä¿®æ”¹ä¸ºè‡ªå¢é•¿ï¼Œç®€åŒ–å¼€å‘ã€‚</p><p>FollowController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//å…³æ³¨</span><br><span class="hljs-meta">@PutMapping(&quot;/&#123;id&#125;/&#123;isFollow&#125;&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">follow</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long followUserId, <span class="hljs-meta">@PathVariable(&quot;isFollow&quot;)</span> Boolean isFollow)</span> &#123;<br>    <span class="hljs-keyword">return</span> followService.follow(followUserId, isFollow);<br>&#125;<br><span class="hljs-comment">//å–æ¶ˆå…³æ³¨</span><br><span class="hljs-meta">@GetMapping(&quot;/or/not/&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">isFollow</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long followUserId)</span> &#123;<br>      <span class="hljs-keyword">return</span> followService.isFollow(followUserId);<br>&#125;<br></code></pre></td></tr></table></figure><p>FollowService</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java">å–æ¶ˆå…³æ³¨service<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">isFollow</span><span class="hljs-params">(Long followUserId)</span> &#123;<br>        <span class="hljs-comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>        <span class="hljs-comment">// 2.æŸ¥è¯¢æ˜¯å¦å…³æ³¨ select count(*) from tb_follow where user_id = ? and follow_user_id = ?</span><br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> query().eq(<span class="hljs-string">&quot;user_id&quot;</span>, userId).eq(<span class="hljs-string">&quot;follow_user_id&quot;</span>, followUserId).count();<br>        <span class="hljs-comment">// 3.åˆ¤æ–­</span><br>        <span class="hljs-keyword">return</span> Result.ok(count &gt; <span class="hljs-number">0</span>);<br>    &#125;<br><br> å…³æ³¨service<br> <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">follow</span><span class="hljs-params">(Long followUserId, Boolean isFollow)</span> &#123;<br>        <span class="hljs-comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;follows:&quot;</span> + userId;<br>        <span class="hljs-comment">// 1.åˆ¤æ–­åˆ°åº•æ˜¯å…³æ³¨è¿˜æ˜¯å–å…³</span><br>        <span class="hljs-keyword">if</span> (isFollow) &#123;<br>            <span class="hljs-comment">// 2.å…³æ³¨ï¼Œæ–°å¢æ•°æ®</span><br>            <span class="hljs-type">Follow</span> <span class="hljs-variable">follow</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Follow</span>();<br>            follow.setUserId(userId);<br>            follow.setFollowUserId(followUserId);<br>            <span class="hljs-type">boolean</span> <span class="hljs-variable">isSuccess</span> <span class="hljs-operator">=</span> save(follow);<br><br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// 3.å–å…³ï¼Œåˆ é™¤ delete from tb_follow where user_id = ? and follow_user_id = ?</span><br>            remove(<span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;Follow&gt;()<br>                    .eq(<span class="hljs-string">&quot;user_id&quot;</span>, userId).eq(<span class="hljs-string">&quot;follow_user_id&quot;</span>, followUserId));<br><br>        &#125;<br>        <span class="hljs-keyword">return</span> Result.ok();<br>    &#125;<br></code></pre></td></tr></table></figure><h3 id="9-2-å¥½å‹å…³æ³¨-å…±åŒå…³æ³¨"><a href="#9-2-å¥½å‹å…³æ³¨-å…±åŒå…³æ³¨" class="headerlink" title="9.2 å¥½å‹å…³æ³¨-å…±åŒå…³æ³¨"></a>9.2 å¥½å‹å…³æ³¨-å…±åŒå…³æ³¨</h3><p>æƒ³è¦å»çœ‹å…±åŒå…³æ³¨çš„å¥½å‹ï¼Œéœ€è¦é¦–å…ˆè¿›å…¥åˆ°è¿™ä¸ªé¡µé¢ï¼Œè¿™ä¸ªé¡µé¢ä¼šå‘èµ·ä¸¤ä¸ªè¯·æ±‚</p><p>1ã€å»æŸ¥è¯¢ç”¨æˆ·çš„è¯¦æƒ…</p><p>2ã€å»æŸ¥è¯¢ç”¨æˆ·çš„ç¬”è®°</p><p>ä»¥ä¸Šä¸¤ä¸ªåŠŸèƒ½å’Œå…±åŒå…³æ³¨æ²¡æœ‰ä»€ä¹ˆå…³ç³»ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œå°†ç¬”è®°ä¸­çš„ä»£ç æ‹·è´åˆ°ideaä¸­å°±å¯ä»¥å®ç°è¿™ä¸¤ä¸ªåŠŸèƒ½äº†ï¼Œæˆ‘ä»¬çš„é‡ç‚¹åœ¨äºå…±åŒå…³æ³¨åŠŸèƒ½ã€‚</p><p><img src="/20221205120000/1653806706296.png" alt="1653806706296"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// UserController æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·</span><br><span class="hljs-meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryUserById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;id&quot;)</span> Long userId)</span>&#123;<br><span class="hljs-comment">// æŸ¥è¯¢è¯¦æƒ…</span><br><span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.getById(userId);<br><span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>) &#123;<br><span class="hljs-keyword">return</span> Result.ok();<br>&#125;<br><span class="hljs-type">UserDTO</span> <span class="hljs-variable">userDTO</span> <span class="hljs-operator">=</span> BeanUtil.copyProperties(user, UserDTO.class);<br><span class="hljs-comment">// è¿”å›</span><br><span class="hljs-keyword">return</span> Result.ok(userDTO);<br>&#125;<br><br><span class="hljs-comment">// BlogController  æ ¹æ®idæŸ¥è¯¢åšä¸»çš„æ¢åº—ç¬”è®°</span><br><span class="hljs-meta">@GetMapping(&quot;/of/user&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryBlogByUserId</span><span class="hljs-params">(</span><br><span class="hljs-params"><span class="hljs-meta">@RequestParam(value = &quot;current&quot;, defaultValue = &quot;1&quot;)</span> Integer current,</span><br><span class="hljs-params"><span class="hljs-meta">@RequestParam(&quot;id&quot;)</span> Long id)</span> &#123;<br><span class="hljs-comment">// æ ¹æ®ç”¨æˆ·æŸ¥è¯¢</span><br>Page&lt;Blog&gt; page = blogService.query()<br>.eq(<span class="hljs-string">&quot;user_id&quot;</span>, id).page(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(current, SystemConstants.MAX_PAGE_SIZE));<br><span class="hljs-comment">// è·å–å½“å‰é¡µæ•°æ®</span><br>List&lt;Blog&gt; records = page.getRecords();<br><span class="hljs-keyword">return</span> Result.ok(records);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹å…±åŒå…³æ³¨å¦‚ä½•å®ç°ï¼š</p><p>éœ€æ±‚ï¼šåˆ©ç”¨Redisä¸­æ°å½“çš„æ•°æ®ç»“æ„ï¼Œå®ç°å…±åŒå…³æ³¨åŠŸèƒ½ã€‚åœ¨åšä¸»ä¸ªäººé¡µé¢å±•ç¤ºå‡ºå½“å‰ç”¨æˆ·ä¸åšä¸»çš„å…±åŒå…³æ³¨å‘¢ã€‚</p><p>å½“ç„¶æ˜¯ä½¿ç”¨æˆ‘ä»¬ä¹‹å‰å­¦ä¹ è¿‡çš„seté›†åˆå’¯ï¼Œåœ¨seté›†åˆä¸­ï¼Œæœ‰äº¤é›†å¹¶é›†è¡¥é›†çš„apiï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸¤äººçš„å…³æ³¨çš„äººåˆ†åˆ«æ”¾å…¥åˆ°ä¸€ä¸ªseté›†åˆä¸­ï¼Œç„¶åå†é€šè¿‡apiå»æŸ¥çœ‹è¿™ä¸¤ä¸ªseté›†åˆä¸­çš„äº¤é›†æ•°æ®ã€‚</p><p><img src="/20221205120000/1653806973212.png" alt="1653806973212"></p><p>æˆ‘ä»¬å…ˆæ¥æ”¹é€ å½“å‰çš„å…³æ³¨åˆ—è¡¨</p><p>æ”¹é€ åŸå› æ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨ç”¨æˆ·å…³æ³¨äº†æŸä½ç”¨æˆ·åï¼Œéœ€è¦å°†æ•°æ®æ”¾å…¥åˆ°seté›†åˆä¸­ï¼Œæ–¹ä¾¿åç»­è¿›è¡Œå…±åŒå…³æ³¨ï¼ŒåŒæ—¶å½“å–æ¶ˆå…³æ³¨æ—¶ï¼Œä¹Ÿéœ€è¦ä»seté›†åˆä¸­è¿›è¡Œåˆ é™¤</p><p>FollowServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">follow</span><span class="hljs-params">(Long followUserId, Boolean isFollow)</span> &#123;<br>    <span class="hljs-comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;follows:&quot;</span> + userId;<br>    <span class="hljs-comment">// 1.åˆ¤æ–­åˆ°åº•æ˜¯å…³æ³¨è¿˜æ˜¯å–å…³</span><br>    <span class="hljs-keyword">if</span> (isFollow) &#123;<br>        <span class="hljs-comment">// 2.å…³æ³¨ï¼Œæ–°å¢æ•°æ®</span><br>        <span class="hljs-type">Follow</span> <span class="hljs-variable">follow</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Follow</span>();<br>        follow.setUserId(userId);<br>        follow.setFollowUserId(followUserId);<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">isSuccess</span> <span class="hljs-operator">=</span> save(follow);<br>        <span class="hljs-keyword">if</span> (isSuccess) &#123;<br>            <span class="hljs-comment">// æŠŠå…³æ³¨ç”¨æˆ·çš„idï¼Œæ”¾å…¥redisçš„seté›†åˆ sadd userId followerUserId</span><br>            stringRedisTemplate.opsForSet().add(key, followUserId.toString());<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-comment">// 3.å–å…³ï¼Œåˆ é™¤ delete from tb_follow where user_id = ? and follow_user_id = ?</span><br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">isSuccess</span> <span class="hljs-operator">=</span> remove(<span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;Follow&gt;()<br>                .eq(<span class="hljs-string">&quot;user_id&quot;</span>, userId).eq(<span class="hljs-string">&quot;follow_user_id&quot;</span>, followUserId));<br>        <span class="hljs-keyword">if</span> (isSuccess) &#123;<br>            <span class="hljs-comment">// æŠŠå…³æ³¨ç”¨æˆ·çš„idä»Redisé›†åˆä¸­ç§»é™¤</span><br>            stringRedisTemplate.opsForSet().remove(key, followUserId.toString());<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> Result.ok();<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>å…·ä½“çš„å…³æ³¨ä»£ç ï¼š</strong></p><p>FollowServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">followCommons</span><span class="hljs-params">(Long id)</span> &#123;<br>    <span class="hljs-comment">// 1.è·å–å½“å‰ç”¨æˆ·</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;follows:&quot;</span> + userId;<br>    <span class="hljs-comment">// 2.æ±‚äº¤é›†</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">key2</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;follows:&quot;</span> + id;<br>    Set&lt;String&gt; intersect = stringRedisTemplate.opsForSet().intersect(key, key2);<br>    <span class="hljs-keyword">if</span> (intersect == <span class="hljs-literal">null</span> || intersect.isEmpty()) &#123;<br>        <span class="hljs-comment">// æ— äº¤é›†</span><br>        <span class="hljs-keyword">return</span> Result.ok(Collections.emptyList());<br>    &#125;<br>    <span class="hljs-comment">// 3.è§£æidé›†åˆ</span><br>    List&lt;Long&gt; ids = intersect.stream().map(Long::valueOf).collect(Collectors.toList());<br>    <span class="hljs-comment">// 4.æŸ¥è¯¢ç”¨æˆ·</span><br>    List&lt;UserDTO&gt; users = userService.listByIds(ids)<br>            .stream()<br>            .map(user -&gt; BeanUtil.copyProperties(user, UserDTO.class))<br>            .collect(Collectors.toList());<br>    <span class="hljs-keyword">return</span> Result.ok(users);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="9-3-å¥½å‹å…³æ³¨-Feedæµå®ç°æ–¹æ¡ˆ"><a href="#9-3-å¥½å‹å…³æ³¨-Feedæµå®ç°æ–¹æ¡ˆ" class="headerlink" title="9.3 å¥½å‹å…³æ³¨-Feedæµå®ç°æ–¹æ¡ˆ"></a>9.3 å¥½å‹å…³æ³¨-Feedæµå®ç°æ–¹æ¡ˆ</h3><p>å½“æˆ‘ä»¬å…³æ³¨äº†ç”¨æˆ·åï¼Œè¿™ä¸ªç”¨æˆ·å‘äº†åŠ¨æ€ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥æŠŠè¿™äº›æ•°æ®æ¨é€ç»™ç”¨æˆ·ï¼Œè¿™ä¸ªéœ€æ±‚ï¼Œå…¶å®æˆ‘ä»¬åˆæŠŠä»–å«åšFeedæµï¼Œå…³æ³¨æ¨é€ä¹Ÿå«åšFeedæµï¼Œç›´è¯‘ä¸ºæŠ•å–‚ã€‚ä¸ºç”¨æˆ·æŒç»­çš„æä¾›â€œæ²‰æµ¸å¼â€çš„ä½“éªŒï¼Œé€šè¿‡æ— é™ä¸‹æ‹‰åˆ·æ–°è·å–æ–°çš„ä¿¡æ¯ã€‚</p><p>å¯¹äºä¼ ç»Ÿçš„æ¨¡å¼çš„å†…å®¹è§£é”ï¼šæˆ‘ä»¬æ˜¯éœ€è¦ç”¨æˆ·å»é€šè¿‡æœç´¢å¼•æ“æˆ–è€…æ˜¯å…¶ä»–çš„æ–¹å¼å»è§£é”æƒ³è¦çœ‹çš„å†…å®¹</p><p><img src="/20221205120000/1653808641260.png" alt="1653808641260"></p><p>å¯¹äºæ–°å‹çš„Feedæµçš„çš„æ•ˆæœï¼šä¸éœ€è¦æˆ‘ä»¬ç”¨æˆ·å†å»æ¨é€ä¿¡æ¯ï¼Œè€Œæ˜¯ç³»ç»Ÿåˆ†æç”¨æˆ·åˆ°åº•æƒ³è¦ä»€ä¹ˆï¼Œç„¶åç›´æ¥æŠŠå†…å®¹æ¨é€ç»™ç”¨æˆ·ï¼Œä»è€Œä½¿ç”¨æˆ·èƒ½å¤Ÿæ›´åŠ çš„èŠ‚çº¦æ—¶é—´ï¼Œä¸ç”¨ä¸»åŠ¨å»å¯»æ‰¾ã€‚</p><p><img src="/20221205120000/1653808993693.png" alt="1653808993693"></p><p>Feedæµçš„å®ç°æœ‰ä¸¤ç§æ¨¡å¼ï¼š</p><p>Feedæµäº§å“æœ‰ä¸¤ç§å¸¸è§æ¨¡å¼ï¼š<br>Timelineï¼šä¸åšå†…å®¹ç­›é€‰ï¼Œç®€å•çš„æŒ‰ç…§å†…å®¹å‘å¸ƒæ—¶é—´æ’åºï¼Œå¸¸ç”¨äºå¥½å‹æˆ–å…³æ³¨ã€‚ä¾‹å¦‚æœ‹å‹åœˆ</p><ul><li>ä¼˜ç‚¹ï¼šä¿¡æ¯å…¨é¢ï¼Œä¸ä¼šæœ‰ç¼ºå¤±ã€‚å¹¶ä¸”å®ç°ä¹Ÿç›¸å¯¹ç®€å•</li><li>ç¼ºç‚¹ï¼šä¿¡æ¯å™ªéŸ³è¾ƒå¤šï¼Œç”¨æˆ·ä¸ä¸€å®šæ„Ÿå…´è¶£ï¼Œå†…å®¹è·å–æ•ˆç‡ä½</li></ul><p>æ™ºèƒ½æ’åºï¼šåˆ©ç”¨æ™ºèƒ½ç®—æ³•å±è”½æ‰è¿è§„çš„ã€ç”¨æˆ·ä¸æ„Ÿå…´è¶£çš„å†…å®¹ã€‚æ¨é€ç”¨æˆ·æ„Ÿå…´è¶£ä¿¡æ¯æ¥å¸å¼•ç”¨æˆ·</p><ul><li>ä¼˜ç‚¹ï¼šæŠ•å–‚ç”¨æˆ·æ„Ÿå…´è¶£ä¿¡æ¯ï¼Œç”¨æˆ·ç²˜åº¦å¾ˆé«˜ï¼Œå®¹æ˜“æ²‰è¿·</li><li>ç¼ºç‚¹ï¼šå¦‚æœç®—æ³•ä¸ç²¾å‡†ï¼Œå¯èƒ½èµ·åˆ°åä½œç”¨<br>æœ¬ä¾‹ä¸­çš„ä¸ªäººé¡µé¢ï¼Œæ˜¯åŸºäºå…³æ³¨çš„å¥½å‹æ¥åšFeedæµï¼Œå› æ­¤é‡‡ç”¨Timelineçš„æ¨¡å¼ã€‚è¯¥æ¨¡å¼çš„å®ç°æ–¹æ¡ˆæœ‰ä¸‰ç§ï¼š</li></ul><p>æˆ‘ä»¬æœ¬æ¬¡é’ˆå¯¹å¥½å‹çš„æ“ä½œï¼Œé‡‡ç”¨çš„å°±æ˜¯Timelineçš„æ–¹å¼ï¼Œåªéœ€è¦æ‹¿åˆ°æˆ‘ä»¬å…³æ³¨ç”¨æˆ·çš„ä¿¡æ¯ï¼Œç„¶åæŒ‰ç…§æ—¶é—´æ’åºå³å¯</p><p>ï¼Œå› æ­¤é‡‡ç”¨Timelineçš„æ¨¡å¼ã€‚è¯¥æ¨¡å¼çš„å®ç°æ–¹æ¡ˆæœ‰ä¸‰ç§ï¼š</p><ul><li>æ‹‰æ¨¡å¼</li><li>æ¨æ¨¡å¼</li><li>æ¨æ‹‰ç»“åˆ</li></ul><p><strong>æ‹‰æ¨¡å¼</strong>ï¼šä¹Ÿå«åšè¯»æ‰©æ•£</p><p>è¯¥æ¨¡å¼çš„æ ¸å¿ƒå«ä¹‰å°±æ˜¯ï¼šå½“å¼ ä¸‰å’Œæå››å’Œç‹äº”å‘äº†æ¶ˆæ¯åï¼Œéƒ½ä¼šä¿å­˜åœ¨è‡ªå·±çš„é‚®ç®±ä¸­ï¼Œå‡è®¾èµµå…­è¦è¯»å–ä¿¡æ¯ï¼Œé‚£ä¹ˆä»–ä¼šä»è¯»å–ä»–è‡ªå·±çš„æ”¶ä»¶ç®±ï¼Œæ­¤æ—¶ç³»ç»Ÿä¼šä»ä»–å…³æ³¨çš„äººç¾¤ä¸­ï¼ŒæŠŠä»–å…³æ³¨äººçš„ä¿¡æ¯å…¨éƒ¨éƒ½è¿›è¡Œæ‹‰å–ï¼Œç„¶ååœ¨è¿›è¡Œæ’åº</p><p>ä¼˜ç‚¹ï¼šæ¯”è¾ƒèŠ‚çº¦ç©ºé—´ï¼Œå› ä¸ºèµµå…­åœ¨è¯»ä¿¡æ¯æ—¶ï¼Œå¹¶æ²¡æœ‰é‡å¤è¯»å–ï¼Œè€Œä¸”è¯»å–å®Œä¹‹åå¯ä»¥æŠŠä»–çš„æ”¶ä»¶ç®±è¿›è¡Œæ¸…æ¥šã€‚</p><p>ç¼ºç‚¹ï¼šæ¯”è¾ƒå»¶è¿Ÿï¼Œå½“ç”¨æˆ·è¯»å–æ•°æ®æ—¶æ‰å»å…³æ³¨çš„äººé‡Œè¾¹å»è¯»å–æ•°æ®ï¼Œå‡è®¾ç”¨æˆ·å…³æ³¨äº†å¤§é‡çš„ç”¨æˆ·ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±ä¼šæ‹‰å–æµ·é‡çš„å†…å®¹ï¼Œå¯¹æœåŠ¡å™¨å‹åŠ›å·¨å¤§ã€‚</p><p><img src="/20221205120000/1653809450816.png" alt="1653809450816"></p><p><strong>æ¨æ¨¡å¼</strong>ï¼šä¹Ÿå«åšå†™æ‰©æ•£ã€‚</p><p>æ¨æ¨¡å¼æ˜¯æ²¡æœ‰å†™é‚®ç®±çš„ï¼Œå½“å¼ ä¸‰å†™äº†ä¸€ä¸ªå†…å®¹ï¼Œæ­¤æ—¶ä¼šä¸»åŠ¨çš„æŠŠå¼ ä¸‰å†™çš„å†…å®¹å‘é€åˆ°ä»–çš„ç²‰ä¸æ”¶ä»¶ç®±ä¸­å»ï¼Œå‡è®¾æ­¤æ—¶æå››å†æ¥è¯»å–ï¼Œå°±ä¸ç”¨å†å»ä¸´æ—¶æ‹‰å–äº†</p><p>ä¼˜ç‚¹ï¼šæ—¶æ•ˆå¿«ï¼Œä¸ç”¨ä¸´æ—¶æ‹‰å–</p><p>ç¼ºç‚¹ï¼šå†…å­˜å‹åŠ›å¤§ï¼Œå‡è®¾ä¸€ä¸ªå¤§Vå†™ä¿¡æ¯ï¼Œå¾ˆå¤šäººå…³æ³¨ä»–ï¼Œ å°±ä¼šå†™å¾ˆå¤šåˆ†æ•°æ®åˆ°ç²‰ä¸é‚£è¾¹å»</p><p><img src="/20221205120000/1653809875208.png" alt="1653809875208"></p><p><strong>æ¨æ‹‰ç»“åˆæ¨¡å¼</strong>ï¼šä¹Ÿå«åšè¯»å†™æ··åˆï¼Œå…¼å…·æ¨å’Œæ‹‰ä¸¤ç§æ¨¡å¼çš„ä¼˜ç‚¹ã€‚</p><p>æ¨æ‹‰æ¨¡å¼æ˜¯ä¸€ä¸ªæŠ˜ä¸­çš„æ–¹æ¡ˆï¼Œç«™åœ¨å‘ä»¶äººè¿™ä¸€æ®µï¼Œå¦‚æœæ˜¯ä¸ªæ™®é€šçš„äººï¼Œé‚£ä¹ˆæˆ‘ä»¬é‡‡ç”¨å†™æ‰©æ•£çš„æ–¹å¼ï¼Œç›´æ¥æŠŠæ•°æ®å†™å…¥åˆ°ä»–çš„ç²‰ä¸ä¸­å»ï¼Œå› ä¸ºæ™®é€šçš„äººä»–çš„ç²‰ä¸å…³æ³¨é‡æ¯”è¾ƒå°ï¼Œæ‰€ä»¥è¿™æ ·åšæ²¡æœ‰å‹åŠ›ï¼Œå¦‚æœæ˜¯å¤§Vï¼Œé‚£ä¹ˆä»–æ˜¯ç›´æ¥å°†æ•°æ®å…ˆå†™å…¥åˆ°ä¸€ä»½åˆ°å‘ä»¶ç®±é‡Œè¾¹å»ï¼Œç„¶åå†ç›´æ¥å†™ä¸€ä»½åˆ°æ´»è·ƒç²‰ä¸æ”¶ä»¶ç®±é‡Œè¾¹å»ï¼Œç°åœ¨ç«™åœ¨æ”¶ä»¶äººè¿™ç«¯æ¥çœ‹ï¼Œå¦‚æœæ˜¯æ´»è·ƒç²‰ä¸ï¼Œé‚£ä¹ˆå¤§Vå’Œæ™®é€šçš„äººå‘çš„éƒ½ä¼šç›´æ¥å†™å…¥åˆ°è‡ªå·±æ”¶ä»¶ç®±é‡Œè¾¹æ¥ï¼Œè€Œå¦‚æœæ˜¯æ™®é€šçš„ç²‰ä¸ï¼Œç”±äºä»–ä»¬ä¸Šçº¿ä¸æ˜¯å¾ˆé¢‘ç¹ï¼Œæ‰€ä»¥ç­‰ä»–ä»¬ä¸Šçº¿æ—¶ï¼Œå†ä»å‘ä»¶ç®±é‡Œè¾¹å»æ‹‰ä¿¡æ¯ã€‚</p><p><img src="/20221205120000/1653812346852.png" alt="1653812346852"></p><h3 id="9-4-å¥½å‹å…³æ³¨-æ¨é€åˆ°ç²‰ä¸æ”¶ä»¶ç®±"><a href="#9-4-å¥½å‹å…³æ³¨-æ¨é€åˆ°ç²‰ä¸æ”¶ä»¶ç®±" class="headerlink" title="9.4 å¥½å‹å…³æ³¨-æ¨é€åˆ°ç²‰ä¸æ”¶ä»¶ç®±"></a>9.4 å¥½å‹å…³æ³¨-æ¨é€åˆ°ç²‰ä¸æ”¶ä»¶ç®±</h3><p>éœ€æ±‚ï¼š</p><ul><li>ä¿®æ”¹æ–°å¢æ¢åº—ç¬”è®°çš„ä¸šåŠ¡ï¼Œåœ¨ä¿å­˜blogåˆ°æ•°æ®åº“çš„åŒæ—¶ï¼Œæ¨é€åˆ°ç²‰ä¸çš„æ”¶ä»¶ç®±</li><li>æ”¶ä»¶ç®±æ»¡è¶³å¯ä»¥æ ¹æ®æ—¶é—´æˆ³æ’åºï¼Œå¿…é¡»ç”¨Redisçš„æ•°æ®ç»“æ„å®ç°</li><li>æŸ¥è¯¢æ”¶ä»¶ç®±æ•°æ®æ—¶ï¼Œå¯ä»¥å®ç°åˆ†é¡µæŸ¥è¯¢</li></ul><p>Feedæµä¸­çš„æ•°æ®ä¼šä¸æ–­æ›´æ–°ï¼Œæ‰€ä»¥æ•°æ®çš„è§’æ ‡ä¹Ÿåœ¨å˜åŒ–ï¼Œå› æ­¤ä¸èƒ½é‡‡ç”¨ä¼ ç»Ÿçš„åˆ†é¡µæ¨¡å¼ã€‚</p><p>ä¼ ç»Ÿäº†åˆ†é¡µåœ¨feedæµæ˜¯ä¸é€‚ç”¨çš„ï¼Œå› ä¸ºæˆ‘ä»¬çš„æ•°æ®ä¼šéšæ—¶å‘ç”Ÿå˜åŒ–</p><p>å‡è®¾åœ¨t1 æ—¶åˆ»ï¼Œæˆ‘ä»¬å»è¯»å–ç¬¬ä¸€é¡µï¼Œæ­¤æ—¶page &#x3D; 1 ï¼Œsize &#x3D; 5 ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ‹¿åˆ°çš„å°±æ˜¯10<del>6 è¿™å‡ æ¡è®°å½•ï¼Œå‡è®¾ç°åœ¨t2æ—¶å€™åˆå‘å¸ƒäº†ä¸€æ¡è®°å½•ï¼Œæ­¤æ—¶t3 æ—¶åˆ»ï¼Œæˆ‘ä»¬æ¥è¯»å–ç¬¬äºŒé¡µï¼Œè¯»å–ç¬¬äºŒé¡µä¼ å…¥çš„å‚æ•°æ˜¯page&#x3D;2 ï¼Œsize&#x3D;5 ï¼Œé‚£ä¹ˆæ­¤æ—¶è¯»å–åˆ°çš„ç¬¬äºŒé¡µå®é™…ä¸Šæ˜¯ä»6 å¼€å§‹ï¼Œç„¶åæ˜¯6</del>2 ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¯»å–åˆ°äº†é‡å¤çš„æ•°æ®ï¼Œæ‰€ä»¥feedæµçš„åˆ†é¡µï¼Œä¸èƒ½é‡‡ç”¨åŸå§‹æ–¹æ¡ˆæ¥åšã€‚</p><p><img src="/20221205120000/1653813047671.png" alt="1653813047671"></p><p>Feedæµçš„æ»šåŠ¨åˆ†é¡µ</p><p>æˆ‘ä»¬éœ€è¦è®°å½•æ¯æ¬¡æ“ä½œçš„æœ€åä¸€æ¡ï¼Œç„¶åä»è¿™ä¸ªä½ç½®å¼€å§‹å»è¯»å–æ•°æ®</p><p>ä¸¾ä¸ªä¾‹å­ï¼šæˆ‘ä»¬ä»t1æ—¶åˆ»å¼€å§‹ï¼Œæ‹¿ç¬¬ä¸€é¡µæ•°æ®ï¼Œæ‹¿åˆ°äº†10~6ï¼Œç„¶åè®°å½•ä¸‹å½“å‰æœ€åä¸€æ¬¡æ‹¿å–çš„è®°å½•ï¼Œå°±æ˜¯6ï¼Œt2æ—¶åˆ»å‘å¸ƒäº†æ–°çš„è®°å½•ï¼Œæ­¤æ—¶è¿™ä¸ª11æ”¾åˆ°æœ€é¡¶ä¸Šï¼Œä½†æ˜¯ä¸ä¼šå½±å“æˆ‘ä»¬ä¹‹å‰è®°å½•çš„6ï¼Œæ­¤æ—¶t3æ—¶åˆ»æ¥æ‹¿ç¬¬äºŒé¡µï¼Œç¬¬äºŒé¡µè¿™ä¸ªæ—¶å€™æ‹¿æ•°æ®ï¼Œè¿˜æ˜¯ä»6åä¸€ç‚¹çš„5å»æ‹¿ï¼Œå°±æ‹¿åˆ°äº†5-1çš„è®°å½•ã€‚æˆ‘ä»¬è¿™ä¸ªåœ°æ–¹å¯ä»¥é‡‡ç”¨sortedSetæ¥åšï¼Œå¯ä»¥è¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œå¹¶ä¸”è¿˜å¯ä»¥è®°å½•å½“å‰è·å–æ•°æ®æ—¶é—´æˆ³æœ€å°å€¼ï¼Œå°±å¯ä»¥å®ç°æ»šåŠ¨åˆ†é¡µäº†</p><p><img src="/20221205120000/1653813462834.png" alt="1653813462834"></p><p>æ ¸å¿ƒçš„æ„æ€ï¼šå°±æ˜¯æˆ‘ä»¬åœ¨ä¿å­˜å®Œæ¢åº—ç¬”è®°åï¼Œè·å¾—åˆ°å½“å‰ç¬”è®°çš„ç²‰ä¸ï¼Œç„¶åæŠŠæ•°æ®æ¨é€åˆ°ç²‰ä¸çš„redisä¸­å»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">saveBlog</span><span class="hljs-params">(Blog blog)</span> &#123;<br>    <span class="hljs-comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span><br>    <span class="hljs-type">UserDTO</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> UserHolder.getUser();<br>    blog.setUserId(user.getId());<br>    <span class="hljs-comment">// 2.ä¿å­˜æ¢åº—ç¬”è®°</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-variable">isSuccess</span> <span class="hljs-operator">=</span> save(blog);<br>    <span class="hljs-keyword">if</span>(!isSuccess)&#123;<br>        <span class="hljs-keyword">return</span> Result.fail(<span class="hljs-string">&quot;æ–°å¢ç¬”è®°å¤±è´¥!&quot;</span>);<br>    &#125;<br>    <span class="hljs-comment">// 3.æŸ¥è¯¢ç¬”è®°ä½œè€…çš„æ‰€æœ‰ç²‰ä¸ select * from tb_follow where follow_user_id = ?</span><br>    List&lt;Follow&gt; follows = followService.query().eq(<span class="hljs-string">&quot;follow_user_id&quot;</span>, user.getId()).list();<br>    <span class="hljs-comment">// 4.æ¨é€ç¬”è®°idç»™æ‰€æœ‰ç²‰ä¸</span><br>    <span class="hljs-keyword">for</span> (Follow follow : follows) &#123;<br>        <span class="hljs-comment">// 4.1.è·å–ç²‰ä¸id</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> follow.getUserId();<br>        <span class="hljs-comment">// 4.2.æ¨é€</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> FEED_KEY + userId;<br>        stringRedisTemplate.opsForZSet().add(key, blog.getId().toString(), System.currentTimeMillis());<br>    &#125;<br>    <span class="hljs-comment">// 5.è¿”å›id</span><br>    <span class="hljs-keyword">return</span> Result.ok(blog.getId());<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="9-5å¥½å‹å…³æ³¨-å®ç°åˆ†é¡µæŸ¥è¯¢æ”¶é‚®ç®±"><a href="#9-5å¥½å‹å…³æ³¨-å®ç°åˆ†é¡µæŸ¥è¯¢æ”¶é‚®ç®±" class="headerlink" title="9.5å¥½å‹å…³æ³¨-å®ç°åˆ†é¡µæŸ¥è¯¢æ”¶é‚®ç®±"></a>9.5å¥½å‹å…³æ³¨-å®ç°åˆ†é¡µæŸ¥è¯¢æ”¶é‚®ç®±</h3><p>éœ€æ±‚ï¼šåœ¨ä¸ªäººä¸»é¡µçš„â€œå…³æ³¨â€å¡ç‰‡ä¸­ï¼ŒæŸ¥è¯¢å¹¶å±•ç¤ºæ¨é€çš„Blogä¿¡æ¯ï¼š</p><p>å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</p><p>1ã€æ¯æ¬¡æŸ¥è¯¢å®Œæˆåï¼Œæˆ‘ä»¬è¦åˆ†æå‡ºæŸ¥è¯¢å‡ºæ•°æ®çš„æœ€å°æ—¶é—´æˆ³ï¼Œè¿™ä¸ªå€¼ä¼šä½œä¸ºä¸‹ä¸€æ¬¡æŸ¥è¯¢çš„æ¡ä»¶</p><p>2ã€æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸ä¸Šä¸€æ¬¡æŸ¥è¯¢ç›¸åŒçš„æŸ¥è¯¢ä¸ªæ•°ä½œä¸ºåç§»é‡ï¼Œä¸‹æ¬¡æŸ¥è¯¢æ—¶ï¼Œè·³è¿‡è¿™äº›æŸ¥è¯¢è¿‡çš„æ•°æ®ï¼Œæ‹¿åˆ°æˆ‘ä»¬éœ€è¦çš„æ•°æ®</p><p>ç»¼ä¸Šï¼šæˆ‘ä»¬çš„è¯·æ±‚å‚æ•°ä¸­å°±éœ€è¦æºå¸¦ lastIdï¼šä¸Šä¸€æ¬¡æŸ¥è¯¢çš„æœ€å°æ—¶é—´æˆ³ å’Œåç§»é‡è¿™ä¸¤ä¸ªå‚æ•°ã€‚</p><p>è¿™ä¸¤ä¸ªå‚æ•°ç¬¬ä¸€æ¬¡ä¼šç”±å‰ç«¯æ¥æŒ‡å®šï¼Œä»¥åçš„æŸ¥è¯¢å°±æ ¹æ®åå°ç»“æœä½œä¸ºæ¡ä»¶ï¼Œå†æ¬¡ä¼ é€’åˆ°åå°ã€‚</p><p><img src="/20221205120000/1653819821591.png" alt="1653819821591"></p><p>ä¸€ã€å®šä¹‰å‡ºæ¥å…·ä½“çš„è¿”å›å€¼å®ä½“ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ScrollResult</span> &#123;<br>    <span class="hljs-keyword">private</span> List&lt;?&gt; list;<br>    <span class="hljs-keyword">private</span> Long minTime;<br>    <span class="hljs-keyword">private</span> Integer offset;<br>&#125;<br></code></pre></td></tr></table></figure><p>BlogController</p><p>æ³¨æ„ï¼šRequestParam è¡¨ç¤ºæ¥å—urlåœ°å€æ ä¼ å‚çš„æ³¨è§£ï¼Œå½“æ–¹æ³•ä¸Šå‚æ•°çš„åç§°å’Œurlåœ°å€æ ä¸ç›¸åŒæ—¶ï¼Œå¯ä»¥é€šè¿‡RequestParam æ¥è¿›è¡ŒæŒ‡å®š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/of/follow&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryBlogOfFollow</span><span class="hljs-params">(</span><br><span class="hljs-params">    <span class="hljs-meta">@RequestParam(&quot;lastId&quot;)</span> Long max, <span class="hljs-meta">@RequestParam(value = &quot;offset&quot;, defaultValue = &quot;0&quot;)</span> Integer offset)</span>&#123;<br>    <span class="hljs-keyword">return</span> blogService.queryBlogOfFollow(max, offset);<br>&#125;<br></code></pre></td></tr></table></figure><p>BlogServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryBlogOfFollow</span><span class="hljs-params">(Long max, Integer offset)</span> &#123;<br>    <span class="hljs-comment">// 1.è·å–å½“å‰ç”¨æˆ·</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>    <span class="hljs-comment">// 2.æŸ¥è¯¢æ”¶ä»¶ç®± ZREVRANGEBYSCORE key Max Min LIMIT offset count</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> FEED_KEY + userId;<br>    Set&lt;ZSetOperations.TypedTuple&lt;String&gt;&gt; typedTuples = stringRedisTemplate.opsForZSet()<br>        .reverseRangeByScoreWithScores(key, <span class="hljs-number">0</span>, max, offset, <span class="hljs-number">2</span>);<br>    <span class="hljs-comment">// 3.éç©ºåˆ¤æ–­</span><br>    <span class="hljs-keyword">if</span> (typedTuples == <span class="hljs-literal">null</span> || typedTuples.isEmpty()) &#123;<br>        <span class="hljs-keyword">return</span> Result.ok();<br>    &#125;<br>    <span class="hljs-comment">// 4.è§£ææ•°æ®ï¼šblogIdã€minTimeï¼ˆæ—¶é—´æˆ³ï¼‰ã€offset</span><br>    List&lt;Long&gt; ids = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(typedTuples.size());<br>    <span class="hljs-type">long</span> <span class="hljs-variable">minTime</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-comment">// 2</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">os</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; <span class="hljs-comment">// 2</span><br>    <span class="hljs-keyword">for</span> (ZSetOperations.TypedTuple&lt;String&gt; tuple : typedTuples) &#123; <span class="hljs-comment">// 5 4 4 2 2</span><br>        <span class="hljs-comment">// 4.1.è·å–id</span><br>        ids.add(Long.valueOf(tuple.getValue()));<br>        <span class="hljs-comment">// 4.2.è·å–åˆ†æ•°(æ—¶é—´æˆ³ï¼‰</span><br>        <span class="hljs-type">long</span> <span class="hljs-variable">time</span> <span class="hljs-operator">=</span> tuple.getScore().longValue();<br>        <span class="hljs-keyword">if</span>(time == minTime)&#123;<br>            os++;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            minTime = time;<br>            os = <span class="hljs-number">1</span>;<br>        &#125;<br>    &#125;<br>os = minTime == max ? os : os + offset;<br>    <span class="hljs-comment">// 5.æ ¹æ®idæŸ¥è¯¢blog</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">idStr</span> <span class="hljs-operator">=</span> StrUtil.join(<span class="hljs-string">&quot;,&quot;</span>, ids);<br>    List&lt;Blog&gt; blogs = query().in(<span class="hljs-string">&quot;id&quot;</span>, ids).last(<span class="hljs-string">&quot;ORDER BY FIELD(id,&quot;</span> + idStr + <span class="hljs-string">&quot;)&quot;</span>).list();<br><br>    <span class="hljs-keyword">for</span> (Blog blog : blogs) &#123;<br>        <span class="hljs-comment">// 5.1.æŸ¥è¯¢blogæœ‰å…³çš„ç”¨æˆ·</span><br>        queryBlogUser(blog);<br>        <span class="hljs-comment">// 5.2.æŸ¥è¯¢blogæ˜¯å¦è¢«ç‚¹èµ</span><br>        isBlogLiked(blog);<br>    &#125;<br><br>    <span class="hljs-comment">// 6.å°è£…å¹¶è¿”å›</span><br>    <span class="hljs-type">ScrollResult</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScrollResult</span>();<br>    r.setList(blogs);<br>    r.setOffset(os);<br>    r.setMinTime(minTime);<br><br>    <span class="hljs-keyword">return</span> Result.ok(r);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="10ã€é™„è¿‘å•†æˆ·"><a href="#10ã€é™„è¿‘å•†æˆ·" class="headerlink" title="10ã€é™„è¿‘å•†æˆ·"></a>10ã€é™„è¿‘å•†æˆ·</h2><h3 id="10-1ã€é™„è¿‘å•†æˆ·-GEOæ•°æ®ç»“æ„çš„åŸºæœ¬ç”¨æ³•"><a href="#10-1ã€é™„è¿‘å•†æˆ·-GEOæ•°æ®ç»“æ„çš„åŸºæœ¬ç”¨æ³•" class="headerlink" title="10.1ã€é™„è¿‘å•†æˆ·-GEOæ•°æ®ç»“æ„çš„åŸºæœ¬ç”¨æ³•"></a>10.1ã€é™„è¿‘å•†æˆ·-GEOæ•°æ®ç»“æ„çš„åŸºæœ¬ç”¨æ³•</h3><p>GEOå°±æ˜¯Geolocationçš„ç®€å†™å½¢å¼ï¼Œä»£è¡¨åœ°ç†åæ ‡ã€‚Redisåœ¨3.2ç‰ˆæœ¬ä¸­åŠ å…¥äº†å¯¹GEOçš„æ”¯æŒï¼Œå…è®¸å­˜å‚¨åœ°ç†åæ ‡ä¿¡æ¯ï¼Œå¸®åŠ©æˆ‘ä»¬æ ¹æ®ç»çº¬åº¦æ¥æ£€ç´¢æ•°æ®ã€‚å¸¸è§çš„å‘½ä»¤æœ‰ï¼š</p><ul><li>GEOADDï¼šæ·»åŠ ä¸€ä¸ªåœ°ç†ç©ºé—´ä¿¡æ¯ï¼ŒåŒ…å«ï¼šç»åº¦ï¼ˆlongitudeï¼‰ã€çº¬åº¦ï¼ˆlatitudeï¼‰ã€å€¼ï¼ˆmemberï¼‰</li><li>GEODISTï¼šè®¡ç®—æŒ‡å®šçš„ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»å¹¶è¿”å›</li><li>GEOHASHï¼šå°†æŒ‡å®šmemberçš„åæ ‡è½¬ä¸ºhashå­—ç¬¦ä¸²å½¢å¼å¹¶è¿”å›</li><li>GEOPOSï¼šè¿”å›æŒ‡å®šmemberçš„åæ ‡</li><li>GEORADIUSï¼šæŒ‡å®šåœ†å¿ƒã€åŠå¾„ï¼Œæ‰¾åˆ°è¯¥åœ†å†…åŒ…å«çš„æ‰€æœ‰memberï¼Œå¹¶æŒ‰ç…§ä¸åœ†å¿ƒä¹‹é—´çš„è·ç¦»æ’åºåè¿”å›ã€‚6.ä»¥åå·²åºŸå¼ƒ</li><li>GEOSEARCHï¼šåœ¨æŒ‡å®šèŒƒå›´å†…æœç´¢memberï¼Œå¹¶æŒ‰ç…§ä¸æŒ‡å®šç‚¹ä¹‹é—´çš„è·ç¦»æ’åºåè¿”å›ã€‚èŒƒå›´å¯ä»¥æ˜¯åœ†å½¢æˆ–çŸ©å½¢ã€‚6.2.æ–°åŠŸèƒ½</li><li>GEOSEARCHSTOREï¼šä¸GEOSEARCHåŠŸèƒ½ä¸€è‡´ï¼Œä¸è¿‡å¯ä»¥æŠŠç»“æœå­˜å‚¨åˆ°ä¸€ä¸ªæŒ‡å®šçš„keyã€‚ 6.2.æ–°åŠŸèƒ½</li></ul><h3 id="10-2ã€-é™„è¿‘å•†æˆ·-å¯¼å…¥åº—é“ºæ•°æ®åˆ°GEO"><a href="#10-2ã€-é™„è¿‘å•†æˆ·-å¯¼å…¥åº—é“ºæ•°æ®åˆ°GEO" class="headerlink" title="10.2ã€ é™„è¿‘å•†æˆ·-å¯¼å…¥åº—é“ºæ•°æ®åˆ°GEO"></a>10.2ã€ é™„è¿‘å•†æˆ·-å¯¼å…¥åº—é“ºæ•°æ®åˆ°GEO</h3><p>å…·ä½“åœºæ™¯è¯´æ˜ï¼š</p><p><img src="/20221205120000/1653822036941.png" alt="1653822036941"></p><p>å½“æˆ‘ä»¬ç‚¹å‡»ç¾é£Ÿä¹‹åï¼Œä¼šå‡ºç°ä¸€ç³»åˆ—çš„å•†å®¶ï¼Œå•†å®¶ä¸­å¯ä»¥æŒ‰ç…§å¤šç§æ’åºæ–¹å¼ï¼Œæˆ‘ä»¬æ­¤æ—¶å…³æ³¨çš„æ˜¯è·ç¦»ï¼Œè¿™ä¸ªåœ°æ–¹å°±éœ€è¦ä½¿ç”¨åˆ°æˆ‘ä»¬çš„GEOï¼Œå‘åå°ä¼ å…¥å½“å‰appæ”¶é›†çš„åœ°å€(æˆ‘ä»¬æ­¤å¤„æ˜¯å†™æ­»çš„) ï¼Œä»¥å½“å‰åæ ‡ä½œä¸ºåœ†å¿ƒï¼ŒåŒæ—¶ç»‘å®šç›¸åŒçš„åº—å®¶ç±»å‹typeï¼Œä»¥åŠåˆ†é¡µä¿¡æ¯ï¼ŒæŠŠè¿™å‡ ä¸ªæ¡ä»¶ä¼ å…¥åå°ï¼Œåå°æŸ¥è¯¢å‡ºå¯¹åº”çš„æ•°æ®å†è¿”å›ã€‚</p><p><img src="/20221205120000/1653822021827.png" alt="1653822021827"></p><p>æˆ‘ä»¬è¦åšçš„äº‹æƒ…æ˜¯ï¼šå°†æ•°æ®åº“è¡¨ä¸­çš„æ•°æ®å¯¼å…¥åˆ°redisä¸­å»ï¼Œredisä¸­çš„GEOï¼ŒGEOåœ¨redisä¸­å°±ä¸€ä¸ªmenberå’Œä¸€ä¸ªç»çº¬åº¦ï¼Œæˆ‘ä»¬æŠŠxå’Œyè½´ä¼ å…¥åˆ°redisåšçš„ç»çº¬åº¦ä½ç½®å»ï¼Œä½†æˆ‘ä»¬ä¸èƒ½æŠŠæ‰€æœ‰çš„æ•°æ®éƒ½æ”¾å…¥åˆ°menberä¸­å»ï¼Œæ¯•ç«Ÿä½œä¸ºredisæ˜¯ä¸€ä¸ªå†…å­˜çº§æ•°æ®åº“ï¼Œå¦‚æœå­˜æµ·é‡æ•°æ®ï¼Œredisè¿˜æ˜¯åŠ›ä¸ä»å¿ƒï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™ä¸ªåœ°æ–¹å­˜å‚¨ä»–çš„idå³å¯ã€‚</p><p>ä½†æ˜¯è¿™ä¸ªæ—¶å€™è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨redisä¸­å¹¶æ²¡æœ‰å­˜å‚¨typeï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•æ ¹æ®typeæ¥å¯¹æ•°æ®è¿›è¡Œç­›é€‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŒ‰ç…§å•†æˆ·ç±»å‹åšåˆ†ç»„ï¼Œç±»å‹ç›¸åŒçš„å•†æˆ·ä½œä¸ºåŒä¸€ç»„ï¼Œä»¥typeIdä¸ºkeyå­˜å…¥åŒä¸€ä¸ªGEOé›†åˆä¸­å³å¯</p><p>ä»£ç </p><p>HmDianPingApplicationTests</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Test</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">loadShopData</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 1.æŸ¥è¯¢åº—é“ºä¿¡æ¯</span><br>    List&lt;Shop&gt; list = shopService.list();<br>    <span class="hljs-comment">// 2.æŠŠåº—é“ºåˆ†ç»„ï¼ŒæŒ‰ç…§typeIdåˆ†ç»„ï¼ŒtypeIdä¸€è‡´çš„æ”¾åˆ°ä¸€ä¸ªé›†åˆ</span><br>    Map&lt;Long, List&lt;Shop&gt;&gt; map = list.stream().collect(Collectors.groupingBy(Shop::getTypeId));<br>    <span class="hljs-comment">// 3.åˆ†æ‰¹å®Œæˆå†™å…¥Redis</span><br>    <span class="hljs-keyword">for</span> (Map.Entry&lt;Long, List&lt;Shop&gt;&gt; entry : map.entrySet()) &#123;<br>        <span class="hljs-comment">// 3.1.è·å–ç±»å‹id</span><br>        <span class="hljs-type">Long</span> <span class="hljs-variable">typeId</span> <span class="hljs-operator">=</span> entry.getKey();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> SHOP_GEO_KEY + typeId;<br>        <span class="hljs-comment">// 3.2.è·å–åŒç±»å‹çš„åº—é“ºçš„é›†åˆ</span><br>        List&lt;Shop&gt; value = entry.getValue();<br>        List&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt; locations = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(value.size());<br>        <span class="hljs-comment">// 3.3.å†™å…¥redis GEOADD key ç»åº¦ çº¬åº¦ member</span><br>        <span class="hljs-keyword">for</span> (Shop shop : value) &#123;<br>            <span class="hljs-comment">// stringRedisTemplate.opsForGeo().add(key, new Point(shop.getX(), shop.getY()), shop.getId().toString());</span><br>            locations.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisGeoCommands</span>.GeoLocation&lt;&gt;(<br>                    shop.getId().toString(),<br>                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Point</span>(shop.getX(), shop.getY())<br>            ));<br>        &#125;<br>        stringRedisTemplate.opsForGeo().add(key, locations);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="10-3-é™„è¿‘å•†æˆ·-å®ç°é™„è¿‘å•†æˆ·åŠŸèƒ½"><a href="#10-3-é™„è¿‘å•†æˆ·-å®ç°é™„è¿‘å•†æˆ·åŠŸèƒ½" class="headerlink" title="10.3 é™„è¿‘å•†æˆ·-å®ç°é™„è¿‘å•†æˆ·åŠŸèƒ½"></a>10.3 é™„è¿‘å•†æˆ·-å®ç°é™„è¿‘å•†æˆ·åŠŸèƒ½</h3><p>SpringDataRedisçš„2.3.9ç‰ˆæœ¬å¹¶ä¸æ”¯æŒRedis 6.2æä¾›çš„GEOSEARCHå‘½ä»¤ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æç¤ºå…¶ç‰ˆæœ¬ï¼Œä¿®æ”¹è‡ªå·±çš„POM</p><p>ç¬¬ä¸€æ­¥ï¼šå¯¼å…¥pom</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java">&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;<br>    &lt;exclusions&gt;<br>        &lt;exclusion&gt;<br>            &lt;artifactId&gt;spring-data-redis&lt;/artifactId&gt;<br>            &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;<br>        &lt;/exclusion&gt;<br>        &lt;exclusion&gt;<br>            &lt;artifactId&gt;lettuce-core&lt;/artifactId&gt;<br>            &lt;groupId&gt;io.lettuce&lt;/groupId&gt;<br>        &lt;/exclusion&gt;<br>    &lt;/exclusions&gt;<br>&lt;/dependency&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;org.springframework.data&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-data-redis&lt;/artifactId&gt;<br>    &lt;version&gt;<span class="hljs-number">2.6</span><span class="hljs-number">.2</span>&lt;/version&gt;<br>&lt;/dependency&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;io.lettuce&lt;/groupId&gt;<br>    &lt;artifactId&gt;lettuce-core&lt;/artifactId&gt;<br>    &lt;version&gt;<span class="hljs-number">6.1</span><span class="hljs-number">.6</span>.RELEASE&lt;/version&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼š</p><p>ShopController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/of/type&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryShopByType</span><span class="hljs-params">(</span><br><span class="hljs-params">        <span class="hljs-meta">@RequestParam(&quot;typeId&quot;)</span> Integer typeId,</span><br><span class="hljs-params">        <span class="hljs-meta">@RequestParam(value = &quot;current&quot;, defaultValue = &quot;1&quot;)</span> Integer current,</span><br><span class="hljs-params">        <span class="hljs-meta">@RequestParam(value = &quot;x&quot;, required = false)</span> Double x,</span><br><span class="hljs-params">        <span class="hljs-meta">@RequestParam(value = &quot;y&quot;, required = false)</span> Double y</span><br><span class="hljs-params">)</span> &#123;<br>   <span class="hljs-keyword">return</span> shopService.queryShopByType(typeId, current, x, y);<br>&#125;<br></code></pre></td></tr></table></figure><p>ShopServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Result <span class="hljs-title function_">queryShopByType</span><span class="hljs-params">(Integer typeId, Integer current, Double x, Double y)</span> &#123;<br>        <span class="hljs-comment">// 1.åˆ¤æ–­æ˜¯å¦éœ€è¦æ ¹æ®åæ ‡æŸ¥è¯¢</span><br>        <span class="hljs-keyword">if</span> (x == <span class="hljs-literal">null</span> || y == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-comment">// ä¸éœ€è¦åæ ‡æŸ¥è¯¢ï¼ŒæŒ‰æ•°æ®åº“æŸ¥è¯¢</span><br>            Page&lt;Shop&gt; page = query()<br>                    .eq(<span class="hljs-string">&quot;type_id&quot;</span>, typeId)<br>                    .page(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(current, SystemConstants.DEFAULT_PAGE_SIZE));<br>            <span class="hljs-comment">// è¿”å›æ•°æ®</span><br>            <span class="hljs-keyword">return</span> Result.ok(page.getRecords());<br>        &#125;<br><br>        <span class="hljs-comment">// 2.è®¡ç®—åˆ†é¡µå‚æ•°</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">from</span> <span class="hljs-operator">=</span> (current - <span class="hljs-number">1</span>) * SystemConstants.DEFAULT_PAGE_SIZE;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">end</span> <span class="hljs-operator">=</span> current * SystemConstants.DEFAULT_PAGE_SIZE;<br><br>        <span class="hljs-comment">// 3.æŸ¥è¯¢redisã€æŒ‰ç…§è·ç¦»æ’åºã€åˆ†é¡µã€‚ç»“æœï¼šshopIdã€distance</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> SHOP_GEO_KEY + typeId;<br>        GeoResults&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt; results = stringRedisTemplate.opsForGeo() <span class="hljs-comment">// GEOSEARCH key BYLONLAT x y BYRADIUS 10 WITHDISTANCE</span><br>                .search(<br>                        key,<br>                        GeoReference.fromCoordinate(x, y),<br>                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Distance</span>(<span class="hljs-number">5000</span>),<br>                        RedisGeoCommands.GeoSearchCommandArgs.newGeoSearchArgs().includeDistance().limit(end)<br>                );<br>        <span class="hljs-comment">// 4.è§£æå‡ºid</span><br>        <span class="hljs-keyword">if</span> (results == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> Result.ok(Collections.emptyList());<br>        &#125;<br>        List&lt;GeoResult&lt;RedisGeoCommands.GeoLocation&lt;String&gt;&gt;&gt; list = results.getContent();<br>        <span class="hljs-keyword">if</span> (list.size() &lt;= from) &#123;<br>            <span class="hljs-comment">// æ²¡æœ‰ä¸‹ä¸€é¡µäº†ï¼Œç»“æŸ</span><br>            <span class="hljs-keyword">return</span> Result.ok(Collections.emptyList());<br>        &#125;<br>        <span class="hljs-comment">// 4.1.æˆªå– from ~ endçš„éƒ¨åˆ†</span><br>        List&lt;Long&gt; ids = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(list.size());<br>        Map&lt;String, Distance&gt; distanceMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(list.size());<br>        list.stream().skip(from).forEach(result -&gt; &#123;<br>            <span class="hljs-comment">// 4.2.è·å–åº—é“ºid</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">shopIdStr</span> <span class="hljs-operator">=</span> result.getContent().getName();<br>            ids.add(Long.valueOf(shopIdStr));<br>            <span class="hljs-comment">// 4.3.è·å–è·ç¦»</span><br>            <span class="hljs-type">Distance</span> <span class="hljs-variable">distance</span> <span class="hljs-operator">=</span> result.getDistance();<br>            distanceMap.put(shopIdStr, distance);<br>        &#125;);<br>        <span class="hljs-comment">// 5.æ ¹æ®idæŸ¥è¯¢Shop</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">idStr</span> <span class="hljs-operator">=</span> StrUtil.join(<span class="hljs-string">&quot;,&quot;</span>, ids);<br>        List&lt;Shop&gt; shops = query().in(<span class="hljs-string">&quot;id&quot;</span>, ids).last(<span class="hljs-string">&quot;ORDER BY FIELD(id,&quot;</span> + idStr + <span class="hljs-string">&quot;)&quot;</span>).list();<br>        <span class="hljs-keyword">for</span> (Shop shop : shops) &#123;<br>            shop.setDistance(distanceMap.get(shop.getId().toString()).getValue());<br>        &#125;<br>        <span class="hljs-comment">// 6.è¿”å›</span><br>        <span class="hljs-keyword">return</span> Result.ok(shops);<br>    &#125;<br></code></pre></td></tr></table></figure><h2 id="11ã€ç”¨æˆ·ç­¾åˆ°"><a href="#11ã€ç”¨æˆ·ç­¾åˆ°" class="headerlink" title="11ã€ç”¨æˆ·ç­¾åˆ°"></a>11ã€ç”¨æˆ·ç­¾åˆ°</h2><h4 id="11-1ã€ç”¨æˆ·ç­¾åˆ°-BitMapåŠŸèƒ½æ¼”ç¤º"><a href="#11-1ã€ç”¨æˆ·ç­¾åˆ°-BitMapåŠŸèƒ½æ¼”ç¤º" class="headerlink" title="11.1ã€ç”¨æˆ·ç­¾åˆ°-BitMapåŠŸèƒ½æ¼”ç¤º"></a>11.1ã€ç”¨æˆ·ç­¾åˆ°-BitMapåŠŸèƒ½æ¼”ç¤º</h4><p>æˆ‘ä»¬é’ˆå¯¹ç­¾åˆ°åŠŸèƒ½å®Œå…¨å¯ä»¥é€šè¿‡mysqlæ¥å®Œæˆï¼Œæ¯”å¦‚è¯´ä»¥ä¸‹è¿™å¼ è¡¨</p><p><img src="/20221205120000/1653823145495.png" alt="1653823145495"></p><p>ç”¨æˆ·ä¸€æ¬¡ç­¾åˆ°ï¼Œå°±æ˜¯ä¸€æ¡è®°å½•ï¼Œå‡å¦‚æœ‰1000ä¸‡ç”¨æˆ·ï¼Œå¹³å‡æ¯äººæ¯å¹´ç­¾åˆ°æ¬¡æ•°ä¸º10æ¬¡ï¼Œåˆ™è¿™å¼ è¡¨ä¸€å¹´çš„æ•°æ®é‡ä¸º 1äº¿æ¡</p><p>æ¯ç­¾åˆ°ä¸€æ¬¡éœ€è¦ä½¿ç”¨ï¼ˆ8 + 8 + 1 + 1 + 3 + 1ï¼‰å…±22 å­—èŠ‚çš„å†…å­˜ï¼Œä¸€ä¸ªæœˆåˆ™æœ€å¤šéœ€è¦600å¤šå­—èŠ‚</p><p>æˆ‘ä»¬å¦‚ä½•èƒ½å¤Ÿç®€åŒ–ä¸€ç‚¹å‘¢ï¼Ÿå…¶å®å¯ä»¥è€ƒè™‘å°æ—¶å€™ä¸€ä¸ªæŒºå¸¸è§çš„æ–¹æ¡ˆï¼Œå°±æ˜¯å°æ—¶å€™ï¼Œå’±ä»¬å‡†å¤‡ä¸€å¼ å°å°çš„å¡ç‰‡ï¼Œä½ åªè¦ç­¾åˆ°å°±æ‰“ä¸Šä¸€ä¸ªå‹¾ï¼Œæˆ‘æœ€ååˆ¤æ–­ä½ æ˜¯å¦ç­¾åˆ°ï¼Œå…¶å®åªéœ€è¦åˆ°å°å¡ç‰‡ä¸Šçœ‹ä¸€çœ‹å°±çŸ¥é“äº†</p><p>æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ç±»ä¼¼è¿™æ ·çš„æ–¹æ¡ˆæ¥å®ç°æˆ‘ä»¬çš„ç­¾åˆ°éœ€æ±‚ã€‚</p><p>æˆ‘ä»¬æŒ‰æœˆæ¥ç»Ÿè®¡ç”¨æˆ·ç­¾åˆ°ä¿¡æ¯ï¼Œç­¾åˆ°è®°å½•ä¸º1ï¼Œæœªç­¾åˆ°åˆ™è®°å½•ä¸º0.</p><p>æŠŠæ¯ä¸€ä¸ªbitä½å¯¹åº”å½“æœˆçš„æ¯ä¸€å¤©ï¼Œå½¢æˆäº†æ˜ å°„å…³ç³»ã€‚ç”¨0å’Œ1æ ‡ç¤ºä¸šåŠ¡çŠ¶æ€ï¼Œè¿™ç§æ€è·¯å°±ç§°ä¸ºä½å›¾ï¼ˆBitMapï¼‰ã€‚è¿™æ ·æˆ‘ä»¬å°±ç”¨æå°çš„ç©ºé—´ï¼Œæ¥å®ç°äº†å¤§é‡æ•°æ®çš„è¡¨ç¤º</p><p>Redisä¸­æ˜¯åˆ©ç”¨stringç±»å‹æ•°æ®ç»“æ„å®ç°BitMapï¼Œå› æ­¤æœ€å¤§ä¸Šé™æ˜¯512Mï¼Œè½¬æ¢ä¸ºbitåˆ™æ˜¯ 2^32ä¸ªbitä½ã€‚</p><p><img src="/20221205120000/1653824498278.png" alt="1653824498278"></p><p>BitMapçš„æ“ä½œå‘½ä»¤æœ‰ï¼š</p><ul><li>SETBITï¼šå‘æŒ‡å®šä½ç½®ï¼ˆoffsetï¼‰å­˜å…¥ä¸€ä¸ª0æˆ–1</li><li>GETBIT ï¼šè·å–æŒ‡å®šä½ç½®ï¼ˆoffsetï¼‰çš„bitå€¼</li><li>BITCOUNT ï¼šç»Ÿè®¡BitMapä¸­å€¼ä¸º1çš„bitä½çš„æ•°é‡</li><li>BITFIELD ï¼šæ“ä½œï¼ˆæŸ¥è¯¢ã€ä¿®æ”¹ã€è‡ªå¢ï¼‰BitMapä¸­bitæ•°ç»„ä¸­çš„æŒ‡å®šä½ç½®ï¼ˆoffsetï¼‰çš„å€¼</li><li>BITFIELD_RO ï¼šè·å–BitMapä¸­bitæ•°ç»„ï¼Œå¹¶ä»¥åè¿›åˆ¶å½¢å¼è¿”å›</li><li>BITOP ï¼šå°†å¤šä¸ªBitMapçš„ç»“æœåšä½è¿ç®—ï¼ˆä¸ ã€æˆ–ã€å¼‚æˆ–ï¼‰</li><li>BITPOS ï¼šæŸ¥æ‰¾bitæ•°ç»„ä¸­æŒ‡å®šèŒƒå›´å†…ç¬¬ä¸€ä¸ª0æˆ–1å‡ºç°çš„ä½ç½®</li></ul><h4 id="11-2-ã€ç”¨æˆ·ç­¾åˆ°-å®ç°ç­¾åˆ°åŠŸèƒ½"><a href="#11-2-ã€ç”¨æˆ·ç­¾åˆ°-å®ç°ç­¾åˆ°åŠŸèƒ½" class="headerlink" title="11.2 ã€ç”¨æˆ·ç­¾åˆ°-å®ç°ç­¾åˆ°åŠŸèƒ½"></a>11.2 ã€ç”¨æˆ·ç­¾åˆ°-å®ç°ç­¾åˆ°åŠŸèƒ½</h4><p>éœ€æ±‚ï¼šå®ç°ç­¾åˆ°æ¥å£ï¼Œå°†å½“å‰ç”¨æˆ·å½“å¤©ç­¾åˆ°ä¿¡æ¯ä¿å­˜åˆ°Redisä¸­</p><p>æ€è·¯ï¼šæˆ‘ä»¬å¯ä»¥æŠŠå¹´å’Œæœˆä½œä¸ºbitMapçš„keyï¼Œç„¶åä¿å­˜åˆ°ä¸€ä¸ªbitMapä¸­ï¼Œæ¯æ¬¡ç­¾åˆ°å°±åˆ°å¯¹åº”çš„ä½ä¸ŠæŠŠæ•°å­—ä»0å˜æˆ1ï¼Œåªè¦å¯¹åº”æ˜¯1ï¼Œå°±è¡¨æ˜è¯´æ˜è¿™ä¸€å¤©å·²ç»ç­¾åˆ°äº†ï¼Œåä¹‹åˆ™æ²¡æœ‰ç­¾åˆ°ã€‚</p><p>æˆ‘ä»¬é€šè¿‡æ¥å£æ–‡æ¡£å‘ç°ï¼Œæ­¤æ¥å£å¹¶æ²¡æœ‰ä¼ é€’ä»»ä½•çš„å‚æ•°ï¼Œæ²¡æœ‰å‚æ•°æ€ä¹ˆç¡®å®æ˜¯å“ªä¸€å¤©ç­¾åˆ°å‘¢ï¼Ÿè¿™ä¸ªå¾ˆå®¹æ˜“ï¼Œå¯ä»¥é€šè¿‡åå°ä»£ç ç›´æ¥è·å–å³å¯ï¼Œç„¶ååˆ°å¯¹åº”çš„åœ°å€ä¸Šå»ä¿®æ”¹bitMapã€‚</p><p><img src="/20221205120000/1653833970361.png" alt="1653833970361"></p><p><strong>ä»£ç </strong></p><p>UserController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@PostMapping(&quot;/sign&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">sign</span><span class="hljs-params">()</span>&#123;<br>   <span class="hljs-keyword">return</span> userService.sign();<br>&#125;<br></code></pre></td></tr></table></figure><p>UserServiceImpl</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">sign</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 1.è·å–å½“å‰ç™»å½•ç”¨æˆ·</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>    <span class="hljs-comment">// 2.è·å–æ—¥æœŸ</span><br>    <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();<br>    <span class="hljs-comment">// 3.æ‹¼æ¥key</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">keySuffix</span> <span class="hljs-operator">=</span> now.format(DateTimeFormatter.ofPattern(<span class="hljs-string">&quot;:yyyyMM&quot;</span>));<br>    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> USER_SIGN_KEY + userId + keySuffix;<br>    <span class="hljs-comment">// 4.è·å–ä»Šå¤©æ˜¯æœ¬æœˆçš„ç¬¬å‡ å¤©</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">dayOfMonth</span> <span class="hljs-operator">=</span> now.getDayOfMonth();<br>    <span class="hljs-comment">// 5.å†™å…¥Redis SETBIT key offset 1</span><br>    stringRedisTemplate.opsForValue().setBit(key, dayOfMonth - <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>);<br>    <span class="hljs-keyword">return</span> Result.ok();<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="11-3-ç”¨æˆ·ç­¾åˆ°-ç­¾åˆ°ç»Ÿè®¡"><a href="#11-3-ç”¨æˆ·ç­¾åˆ°-ç­¾åˆ°ç»Ÿè®¡" class="headerlink" title="11.3 ç”¨æˆ·ç­¾åˆ°-ç­¾åˆ°ç»Ÿè®¡"></a>11.3 ç”¨æˆ·ç­¾åˆ°-ç­¾åˆ°ç»Ÿè®¡</h4><p><strong>é—®é¢˜1ï¼š</strong>ä»€ä¹ˆå«åšè¿ç»­ç­¾åˆ°å¤©æ•°ï¼Ÿ<br>ä»æœ€åä¸€æ¬¡ç­¾åˆ°å¼€å§‹å‘å‰ç»Ÿè®¡ï¼Œç›´åˆ°é‡åˆ°ç¬¬ä¸€æ¬¡æœªç­¾åˆ°ä¸ºæ­¢ï¼Œè®¡ç®—æ€»çš„ç­¾åˆ°æ¬¡æ•°ï¼Œå°±æ˜¯è¿ç»­ç­¾åˆ°å¤©æ•°ã€‚</p><p><img src="/20221205120000/1653834455899.png" alt="1653834455899"></p><p>Javaé€»è¾‘ä»£ç ï¼šè·å¾—å½“å‰è¿™ä¸ªæœˆçš„æœ€åä¸€æ¬¡ç­¾åˆ°æ•°æ®ï¼Œå®šä¹‰ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç„¶åä¸åœçš„å‘å‰ç»Ÿè®¡ï¼Œç›´åˆ°è·å¾—ç¬¬ä¸€ä¸ªé0çš„æ•°å­—å³å¯ï¼Œæ¯å¾—åˆ°ä¸€ä¸ªé0çš„æ•°å­—è®¡æ•°å™¨+1ï¼Œç›´åˆ°éå†å®Œæ‰€æœ‰çš„æ•°æ®ï¼Œå°±å¯ä»¥è·å¾—å½“å‰æœˆçš„ç­¾åˆ°æ€»å¤©æ•°äº†</p><p><strong>é—®é¢˜2ï¼š</strong>å¦‚ä½•å¾—åˆ°æœ¬æœˆåˆ°ä»Šå¤©ä¸ºæ­¢çš„æ‰€æœ‰ç­¾åˆ°æ•°æ®ï¼Ÿ</p><p>  BITFIELD key GET u[dayOfMonth] 0</p><p>å‡è®¾ä»Šå¤©æ˜¯10å·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä»å½“å‰æœˆçš„ç¬¬ä¸€å¤©å¼€å§‹ï¼Œè·å¾—åˆ°å½“å‰è¿™ä¸€å¤©çš„ä½æ•°ï¼Œæ˜¯10å·ï¼Œé‚£ä¹ˆå°±æ˜¯10ä½ï¼Œå»æ‹¿è¿™æ®µæ—¶é—´çš„æ•°æ®ï¼Œå°±èƒ½æ‹¿åˆ°æ‰€æœ‰çš„æ•°æ®äº†ï¼Œé‚£ä¹ˆè¿™10å¤©é‡Œè¾¹ç­¾åˆ°äº†å¤šå°‘æ¬¡å‘¢ï¼Ÿç»Ÿè®¡æœ‰å¤šå°‘ä¸ª1å³å¯ã€‚</p><p><strong>é—®é¢˜3ï¼šå¦‚ä½•ä»åå‘å‰éå†æ¯ä¸ªbitä½ï¼Ÿ</strong></p><p>æ³¨æ„ï¼šbitMapè¿”å›çš„æ•°æ®æ˜¯10è¿›åˆ¶ï¼Œå“ªå‡å¦‚è¯´è¿”å›ä¸€ä¸ªæ•°å­—8ï¼Œé‚£ä¹ˆæˆ‘å“ªå„¿çŸ¥é“åˆ°åº•å“ªäº›æ˜¯0ï¼Œå“ªäº›æ˜¯1å‘¢ï¼Ÿæˆ‘ä»¬åªéœ€è¦è®©å¾—åˆ°çš„10è¿›åˆ¶æ•°å­—å’Œ1åšä¸è¿ç®—å°±å¯ä»¥äº†ï¼Œå› ä¸º1åªæœ‰é‡è§1 æ‰æ˜¯1ï¼Œå…¶ä»–æ•°å­—éƒ½æ˜¯0 ï¼Œæˆ‘ä»¬æŠŠç­¾åˆ°ç»“æœå’Œ1è¿›è¡Œä¸æ“ä½œï¼Œæ¯ä¸ä¸€æ¬¡ï¼Œå°±æŠŠç­¾åˆ°ç»“æœå‘å³ç§»åŠ¨ä¸€ä½ï¼Œä¾æ¬¡å†…æ¨ï¼Œæˆ‘ä»¬å°±èƒ½å®Œæˆé€ä¸ªéå†çš„æ•ˆæœäº†ã€‚</p><p>éœ€æ±‚ï¼šå®ç°ä¸‹é¢æ¥å£ï¼Œç»Ÿè®¡å½“å‰ç”¨æˆ·æˆªæ­¢å½“å‰æ—¶é—´åœ¨æœ¬æœˆçš„è¿ç»­ç­¾åˆ°å¤©æ•°</p><p>æœ‰ç”¨æˆ·æœ‰æ—¶é—´æˆ‘ä»¬å°±å¯ä»¥ç»„ç»‡å‡ºå¯¹åº”çš„keyï¼Œæ­¤æ—¶å°±èƒ½æ‰¾åˆ°è¿™ä¸ªç”¨æˆ·æˆªæ­¢è¿™å¤©çš„æ‰€æœ‰ç­¾åˆ°è®°å½•ï¼Œå†æ ¹æ®è¿™å¥—ç®—æ³•ï¼Œå°±èƒ½ç»Ÿè®¡å‡ºæ¥ä»–è¿ç»­ç­¾åˆ°çš„æ¬¡æ•°äº†</p><p><img src="/20221205120000/1653835784444.png" alt="1653835784444"></p><p>ä»£ç </p><p><strong>UserController</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;/sign/count&quot;)</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">signCount</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-keyword">return</span> userService.signCount();<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>UserServiceImpl</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Result <span class="hljs-title function_">signCount</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 1.è·å–å½“å‰ç™»å½•ç”¨æˆ·</span><br>    <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> UserHolder.getUser().getId();<br>    <span class="hljs-comment">// 2.è·å–æ—¥æœŸ</span><br>    <span class="hljs-type">LocalDateTime</span> <span class="hljs-variable">now</span> <span class="hljs-operator">=</span> LocalDateTime.now();<br>    <span class="hljs-comment">// 3.æ‹¼æ¥key</span><br>    <span class="hljs-type">String</span> <span class="hljs-variable">keySuffix</span> <span class="hljs-operator">=</span> now.format(DateTimeFormatter.ofPattern(<span class="hljs-string">&quot;:yyyyMM&quot;</span>));<br>    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> USER_SIGN_KEY + userId + keySuffix;<br>    <span class="hljs-comment">// 4.è·å–ä»Šå¤©æ˜¯æœ¬æœˆçš„ç¬¬å‡ å¤©</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">dayOfMonth</span> <span class="hljs-operator">=</span> now.getDayOfMonth();<br>    <span class="hljs-comment">// 5.è·å–æœ¬æœˆæˆªæ­¢ä»Šå¤©ä¸ºæ­¢çš„æ‰€æœ‰çš„ç­¾åˆ°è®°å½•ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªåè¿›åˆ¶çš„æ•°å­— BITFIELD sign:5:202203 GET u14 0</span><br>    List&lt;Long&gt; result = stringRedisTemplate.opsForValue().bitField(<br>            key,<br>            BitFieldSubCommands.create()<br>                    .get(BitFieldSubCommands.BitFieldType.unsigned(dayOfMonth)).valueAt(<span class="hljs-number">0</span>)<br>    );<br>    <span class="hljs-keyword">if</span> (result == <span class="hljs-literal">null</span> || result.isEmpty()) &#123;<br>        <span class="hljs-comment">// æ²¡æœ‰ä»»ä½•ç­¾åˆ°ç»“æœ</span><br>        <span class="hljs-keyword">return</span> Result.ok(<span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-type">Long</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> result.get(<span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">if</span> (num == <span class="hljs-literal">null</span> || num == <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">return</span> Result.ok(<span class="hljs-number">0</span>);<br>    &#125;<br>    <span class="hljs-comment">// 6.å¾ªç¯éå†</span><br>    <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) &#123;<br>        <span class="hljs-comment">// 6.1.è®©è¿™ä¸ªæ•°å­—ä¸1åšä¸è¿ç®—ï¼Œå¾—åˆ°æ•°å­—çš„æœ€åä¸€ä¸ªbitä½  // åˆ¤æ–­è¿™ä¸ªbitä½æ˜¯å¦ä¸º0</span><br>        <span class="hljs-keyword">if</span> ((num &amp; <span class="hljs-number">1</span>) == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// å¦‚æœä¸º0ï¼Œè¯´æ˜æœªç­¾åˆ°ï¼Œç»“æŸ</span><br>            <span class="hljs-keyword">break</span>;<br>        &#125;<span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">// å¦‚æœä¸ä¸º0ï¼Œè¯´æ˜å·²ç­¾åˆ°ï¼Œè®¡æ•°å™¨+1</span><br>            count++;<br>        &#125;<br>        <span class="hljs-comment">// æŠŠæ•°å­—å³ç§»ä¸€ä½ï¼ŒæŠ›å¼ƒæœ€åä¸€ä¸ªbitä½ï¼Œç»§ç»­ä¸‹ä¸€ä¸ªbitä½</span><br>        num &gt;&gt;&gt;= <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> Result.ok(count);<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="11-4-é¢å¤–åŠ é¤-å…³äºä½¿ç”¨bitmapæ¥è§£å†³ç¼“å­˜ç©¿é€çš„æ–¹æ¡ˆ"><a href="#11-4-é¢å¤–åŠ é¤-å…³äºä½¿ç”¨bitmapæ¥è§£å†³ç¼“å­˜ç©¿é€çš„æ–¹æ¡ˆ" class="headerlink" title="11.4 é¢å¤–åŠ é¤-å…³äºä½¿ç”¨bitmapæ¥è§£å†³ç¼“å­˜ç©¿é€çš„æ–¹æ¡ˆ"></a>11.4 é¢å¤–åŠ é¤-å…³äºä½¿ç”¨bitmapæ¥è§£å†³ç¼“å­˜ç©¿é€çš„æ–¹æ¡ˆ</h4><p>å›é¡¾<strong>ç¼“å­˜ç©¿é€</strong>ï¼š</p><p>å‘èµ·äº†ä¸€ä¸ªæ•°æ®åº“ä¸å­˜åœ¨çš„ï¼Œredisé‡Œè¾¹ä¹Ÿä¸å­˜åœ¨çš„æ•°æ®ï¼Œé€šå¸¸ä½ å¯ä»¥æŠŠä»–çœ‹æˆä¸€ä¸ªæ”»å‡»</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li><p>åˆ¤æ–­id&lt;0</p></li><li><p>å¦‚æœæ•°æ®åº“æ˜¯ç©ºï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥å¾€redisé‡Œè¾¹æŠŠè¿™ä¸ªç©ºæ•°æ®ç¼“å­˜èµ·æ¥</p></li></ul><p>ç¬¬ä¸€ç§è§£å†³æ–¹æ¡ˆï¼šé‡åˆ°çš„é—®é¢˜æ˜¯å¦‚æœç”¨æˆ·è®¿é—®çš„æ˜¯idä¸å­˜åœ¨çš„æ•°æ®ï¼Œåˆ™æ­¤æ—¶å°±æ— æ³•ç”Ÿæ•ˆ</p><p>ç¬¬äºŒç§è§£å†³æ–¹æ¡ˆï¼šé‡åˆ°çš„é—®é¢˜æ˜¯ï¼šå¦‚æœæ˜¯ä¸åŒçš„idé‚£å°±å¯ä»¥é˜²æ­¢ä¸‹æ¬¡è¿‡æ¥ç›´å‡»æ•°æ®</p><p>æ‰€ä»¥æˆ‘ä»¬å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥å°†æ•°æ®åº“çš„æ•°æ®ï¼Œæ‰€å¯¹åº”çš„idå†™å…¥åˆ°ä¸€ä¸ªlisté›†åˆä¸­ï¼Œå½“ç”¨æˆ·è¿‡æ¥è®¿é—®çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç›´æ¥å»åˆ¤æ–­listä¸­æ˜¯å¦åŒ…å«å½“å‰çš„è¦æŸ¥è¯¢çš„æ•°æ®ï¼Œå¦‚æœè¯´ç”¨æˆ·è¦æŸ¥è¯¢çš„idæ•°æ®å¹¶ä¸åœ¨listé›†åˆä¸­ï¼Œåˆ™ç›´æ¥è¿”å›ï¼Œå¦‚æœlistä¸­åŒ…å«å¯¹åº”æŸ¥è¯¢çš„idæ•°æ®ï¼Œåˆ™è¯´æ˜ä¸æ˜¯ä¸€æ¬¡ç¼“å­˜ç©¿é€æ•°æ®ï¼Œåˆ™ç›´æ¥æ”¾è¡Œã€‚</p><p><img src="/20221205120000/1653836416586.png" alt="1653836416586"></p><p>ç°åœ¨çš„é—®é¢˜æ˜¯è¿™ä¸ªä¸»é”®å…¶å®å¹¶æ²¡æœ‰é‚£ä¹ˆçŸ­ï¼Œè€Œæ˜¯å¾ˆé•¿çš„ä¸€ä¸ª ä¸»é”®</p><p>å“ªæ€•ä½ å•ç‹¬å»æå–è¿™ä¸ªä¸»é”®ï¼Œä½†æ˜¯åœ¨11å¹´å·¦å³ï¼Œæ·˜å®çš„å•†å“æ€»é‡å°±å·²ç»è¶…è¿‡10äº¿ä¸ª</p><p>æ‰€ä»¥å¦‚æœé‡‡ç”¨ä»¥ä¸Šæ–¹æ¡ˆï¼Œè¿™ä¸ªlistä¹Ÿä¼šå¾ˆå¤§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨bitmapæ¥å‡å°‘listçš„å­˜å‚¨ç©ºé—´</p><p>æˆ‘ä»¬å¯ä»¥æŠŠlistæ•°æ®æŠ½è±¡æˆä¸€ä¸ªéå¸¸å¤§çš„bitmapï¼Œæˆ‘ä»¬ä¸å†ä½¿ç”¨listï¼Œè€Œæ˜¯å°†dbä¸­çš„idæ•°æ®åˆ©ç”¨å“ˆå¸Œæ€æƒ³ï¼Œæ¯”å¦‚ï¼š</p><p>id % bitmap.size  &#x3D; ç®—å‡ºå½“å‰è¿™ä¸ªidå¯¹åº”åº”è¯¥è½åœ¨bitmapçš„å“ªä¸ªç´¢å¼•ä¸Šï¼Œç„¶åå°†è¿™ä¸ªå€¼ä»0å˜æˆ1ï¼Œç„¶åå½“ç”¨æˆ·æ¥æŸ¥è¯¢æ•°æ®æ—¶ï¼Œæ­¤æ—¶å·²ç»æ²¡æœ‰äº†listï¼Œè®©ç”¨æˆ·ç”¨ä»–æŸ¥è¯¢çš„idå»ç”¨ç›¸åŒçš„å“ˆå¸Œç®—æ³•ï¼Œ ç®—å‡ºæ¥å½“å‰è¿™ä¸ªidåº”å½“è½åœ¨bitmapçš„å“ªä¸€ä½ï¼Œç„¶ååˆ¤æ–­è¿™ä¸€ä½æ˜¯0ï¼Œè¿˜æ˜¯1ï¼Œå¦‚æœæ˜¯0åˆ™è¡¨æ˜è¿™ä¸€ä½ä¸Šçš„æ•°æ®ä¸€å®šä¸å­˜åœ¨ï¼Œ  é‡‡ç”¨è¿™ç§æ–¹å¼æ¥å¤„ç†ï¼Œéœ€è¦é‡ç‚¹è€ƒè™‘ä¸€ä¸ªäº‹æƒ…ï¼Œå°±æ˜¯è¯¯å·®ç‡ï¼Œæ‰€è°“çš„è¯¯å·®ç‡å°±æ˜¯æŒ‡å½“å‘ç”Ÿå“ˆå¸Œå†²çªçš„æ—¶å€™ï¼Œäº§ç”Ÿçš„è¯¯å·®ã€‚</p><p><img src="/20221205120000/1653836578970.png" alt="1653836578970"></p><h2 id="12ã€UVç»Ÿè®¡"><a href="#12ã€UVç»Ÿè®¡" class="headerlink" title="12ã€UVç»Ÿè®¡"></a>12ã€UVç»Ÿè®¡</h2><h3 id="12-1-ã€UVç»Ÿè®¡-HyperLogLog"><a href="#12-1-ã€UVç»Ÿè®¡-HyperLogLog" class="headerlink" title="12.1 ã€UVç»Ÿè®¡-HyperLogLog"></a>12.1 ã€UVç»Ÿè®¡-HyperLogLog</h3><p>é¦–å…ˆæˆ‘ä»¬ææ‡‚ä¸¤ä¸ªæ¦‚å¿µï¼š</p><ul><li>UVï¼šå…¨ç§°Unique Visitorï¼Œä¹Ÿå«ç‹¬ç«‹è®¿å®¢é‡ï¼Œæ˜¯æŒ‡é€šè¿‡äº’è”ç½‘è®¿é—®ã€æµè§ˆè¿™ä¸ªç½‘é¡µçš„è‡ªç„¶äººã€‚1å¤©å†…åŒä¸€ä¸ªç”¨æˆ·å¤šæ¬¡è®¿é—®è¯¥ç½‘ç«™ï¼Œåªè®°å½•1æ¬¡ã€‚</li><li>PVï¼šå…¨ç§°Page Viewï¼Œä¹Ÿå«é¡µé¢è®¿é—®é‡æˆ–ç‚¹å‡»é‡ï¼Œç”¨æˆ·æ¯è®¿é—®ç½‘ç«™çš„ä¸€ä¸ªé¡µé¢ï¼Œè®°å½•1æ¬¡PVï¼Œç”¨æˆ·å¤šæ¬¡æ‰“å¼€é¡µé¢ï¼Œåˆ™è®°å½•å¤šæ¬¡PVã€‚å¾€å¾€ç”¨æ¥è¡¡é‡ç½‘ç«™çš„æµé‡ã€‚</li></ul><p>é€šå¸¸æ¥è¯´UVä¼šæ¯”PVå¤§å¾ˆå¤šï¼Œæ‰€ä»¥è¡¡é‡åŒä¸€ä¸ªç½‘ç«™çš„è®¿é—®é‡ï¼Œæˆ‘ä»¬éœ€è¦ç»¼åˆè€ƒè™‘å¾ˆå¤šå› ç´ ï¼Œæ‰€ä»¥æˆ‘ä»¬åªæ˜¯å•çº¯çš„æŠŠè¿™ä¸¤ä¸ªå€¼ä½œä¸ºä¸€ä¸ªå‚è€ƒå€¼</p><p>UVç»Ÿè®¡åœ¨æœåŠ¡ç«¯åšä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºè¦åˆ¤æ–­è¯¥ç”¨æˆ·æ˜¯å¦å·²ç»ç»Ÿè®¡è¿‡äº†ï¼Œéœ€è¦å°†ç»Ÿè®¡è¿‡çš„ç”¨æˆ·ä¿¡æ¯ä¿å­˜ã€‚ä½†æ˜¯å¦‚æœæ¯ä¸ªè®¿é—®çš„ç”¨æˆ·éƒ½ä¿å­˜åˆ°Redisä¸­ï¼Œæ•°æ®é‡ä¼šéå¸¸ææ€–ï¼Œé‚£æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ</p><p>Hyperloglog(HLL)æ˜¯ä»Loglogç®—æ³•æ´¾ç”Ÿçš„æ¦‚ç‡ç®—æ³•ï¼Œç”¨äºç¡®å®šéå¸¸å¤§çš„é›†åˆçš„åŸºæ•°ï¼Œè€Œä¸éœ€è¦å­˜å‚¨å…¶æ‰€æœ‰å€¼ã€‚ç›¸å…³ç®—æ³•åŸç†å¤§å®¶å¯ä»¥å‚è€ƒï¼š<a href="https://juejin.cn/post/6844903785744056333#heading-0">https://juejin.cn/post/6844903785744056333#heading-0</a><br>Redisä¸­çš„HLLæ˜¯åŸºäºstringç»“æ„å®ç°çš„ï¼Œå•ä¸ªHLLçš„å†…å­˜<strong>æ°¸è¿œå°äº16kb</strong>ï¼Œ<strong>å†…å­˜å ç”¨ä½</strong>çš„ä»¤äººå‘æŒ‡ï¼ä½œä¸ºä»£ä»·ï¼Œå…¶æµ‹é‡ç»“æœæ˜¯æ¦‚ç‡æ€§çš„ï¼Œ<strong>æœ‰å°äº0.81ï¼…çš„è¯¯å·®</strong>ã€‚ä¸è¿‡å¯¹äºUVç»Ÿè®¡æ¥è¯´ï¼Œè¿™å®Œå…¨å¯ä»¥å¿½ç•¥ã€‚</p><p><img src="/20221205120000/1653837988985.png" alt="1653837988985"></p><h3 id="12-2-UVç»Ÿè®¡-æµ‹è¯•ç™¾ä¸‡æ•°æ®çš„ç»Ÿè®¡"><a href="#12-2-UVç»Ÿè®¡-æµ‹è¯•ç™¾ä¸‡æ•°æ®çš„ç»Ÿè®¡" class="headerlink" title="12.2 UVç»Ÿè®¡-æµ‹è¯•ç™¾ä¸‡æ•°æ®çš„ç»Ÿè®¡"></a>12.2 UVç»Ÿè®¡-æµ‹è¯•ç™¾ä¸‡æ•°æ®çš„ç»Ÿè®¡</h3><p>æµ‹è¯•æ€è·¯ï¼šæˆ‘ä»¬ç›´æ¥åˆ©ç”¨å•å…ƒæµ‹è¯•ï¼Œå‘HyperLogLogä¸­æ·»åŠ 100ä¸‡æ¡æ•°æ®ï¼Œçœ‹çœ‹å†…å­˜å ç”¨å’Œç»Ÿè®¡æ•ˆæœå¦‚ä½•</p><p><img src="/20221205120000/1653838053608.png" alt="1653838053608"></p><p>ç»è¿‡æµ‹è¯•ï¼šæˆ‘ä»¬ä¼šå‘ç”Ÿä»–çš„è¯¯å·®æ˜¯åœ¨å…è®¸èŒƒå›´å†…ï¼Œå¹¶ä¸”å†…å­˜å ç”¨æå°</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>RedisåŸºç¡€ç¯‡ - æ•°æ®ç»“æ„ä¸å¸¸ç”¨å‘½ä»¤</title>
    <link href="/20221205000000/"/>
    <url>/20221205000000/</url>
    
    <content type="html"><![CDATA[<h1 id="1-Redisæ•°æ®ç»“æ„ä»‹ç»"><a href="#1-Redisæ•°æ®ç»“æ„ä»‹ç»" class="headerlink" title="1. Redisæ•°æ®ç»“æ„ä»‹ç»"></a>1. Redisæ•°æ®ç»“æ„ä»‹ç»</h1><p><img src="/20221205000000/image-20221205143031769.png" alt="Redisæ•°æ®ç»“æ„"></p><h1 id="2-æ“ä½œå‘½ä»¤"><a href="#2-æ“ä½œå‘½ä»¤" class="headerlink" title="2. æ“ä½œå‘½ä»¤"></a>2. æ“ä½œå‘½ä»¤</h1><ul><li><p><a href="https://redis.io/commands/">æ“ä½œå‘½ä»¤å®˜æ–¹æ–‡æ¡£</a>ã€‚</p></li><li><p>åœ¨å®¢æˆ·ç«¯å‘½ä»¤è¡Œçª—å£è¾“å…¥ï¼š</p><ul><li><p><code>help å‘½ä»¤åç§°</code>ï¼Œå¦‚ï¼š<code>help del</code>å°±æ˜¯æŸ¥çœ‹ <code>del</code> å‘½ä»¤çš„ä½¿ç”¨æ–‡æ¡£ã€‚</p><p><img src="/20221205000000/image-20221205145103409.png" alt="helpå‘½ä»¤ç¤ºä¾‹"></p></li><li><p><code>help @groupName</code>ï¼ŒæŸ¥çœ‹æŸä¸ªå‘½ä»¤åˆ†ç»„ä¸‹çš„å‘½ä»¤æ–‡æ¡£ï¼Œå¦‚ï¼š<code>help @list</code>å°±æ˜¯æŸ¥çœ‹ <code>list</code> å‘½ä»¤ç›¸å…³çš„æ–‡æ¡£ã€‚å‘½ä»¤åˆ†ç»„åœ¨å®˜æ–¹åœ¨çº¿æ–‡æ¡£ä¸­æœ‰è¯´æ˜ã€‚</p></li></ul></li></ul><h2 id="2-1-é€šç”¨å‘½ä»¤"><a href="#2-1-é€šç”¨å‘½ä»¤" class="headerlink" title="2.1. é€šç”¨å‘½ä»¤"></a>2.1. é€šç”¨å‘½ä»¤</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æ˜¾ç¤ºæ‰€æœ‰çš„key</span><br>keys *<br><span class="hljs-meta prompt_"># </span><span class="language-bash">aå¼€å¤´çš„keyï¼ˆæ¨¡ç³Šæœç´¢ï¼‰</span><br>keys a*<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ é™¤key</span><br>del keyName<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨</span><br>exists<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç»™keyè®¾ç½®ä¸€ä¸ªæœ‰æ•ˆæœŸï¼Œæœ‰æ•ˆæœŸåˆ°æœŸæ—¶keyä¼šè‡ªåŠ¨è¢«åˆ é™¤</span><br>expire<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ä¸€ä¸ªkeyçš„å‰©ä½™æœ‰æ•ˆæœŸï¼ˆ-1è¡¨ç¤ºæ°¸ä¹…æœ‰æ•ˆï¼Œ-2è¡¨ç¤ºè¿‡æœŸï¼‰</span><br>ttl<br><br></code></pre></td></tr></table></figure><h2 id="2-2-Stringç±»å‹"><a href="#2-2-Stringç±»å‹" class="headerlink" title="2.2. Stringç±»å‹"></a>2.2. Stringç±»å‹</h2><h3 id="Stringç±»å‹å¸¸è§å‘½ä»¤"><a href="#Stringç±»å‹å¸¸è§å‘½ä»¤" class="headerlink" title="Stringç±»å‹å¸¸è§å‘½ä»¤"></a>Stringç±»å‹å¸¸è§å‘½ä»¤</h3><p><img src="/20221205000000/image-20221205161637493.png" alt="Stringç±»å‹å¸¸ç”¨å‘½ä»¤"></p><h3 id="æœ‰å±‚çº§ç»“æ„çš„key"><a href="#æœ‰å±‚çº§ç»“æ„çš„key" class="headerlink" title="æœ‰å±‚çº§ç»“æ„çš„key"></a>æœ‰å±‚çº§ç»“æ„çš„key</h3><p><img src="/20221205000000/image-20221205163300077.png" alt="keyå±‚çº§ç»“æ„"></p><h2 id="2-3-Hashç±»å‹"><a href="#2-3-Hashç±»å‹" class="headerlink" title="2.3. Hashç±»å‹"></a>2.3. Hashç±»å‹</h2><p><img src="/20221205000000/image-20221205163912138.png" alt="Hashç±»å‹"></p><h3 id="Hashç±»å‹å¸¸è§å‘½ä»¤"><a href="#Hashç±»å‹å¸¸è§å‘½ä»¤" class="headerlink" title="Hashç±»å‹å¸¸è§å‘½ä»¤"></a>Hashç±»å‹å¸¸è§å‘½ä»¤</h3><p><img src="/20221205000000/image-20221205163949163.png" alt="Hashç±»å‹å¸¸è§å‘½ä»¤"></p><h2 id="2-4-Listç±»å‹"><a href="#2-4-Listç±»å‹" class="headerlink" title="2.4. Listç±»å‹"></a>2.4. Listç±»å‹</h2><h3 id="Listç±»å‹å¸¸ç”¨å‘½ä»¤"><a href="#Listç±»å‹å¸¸ç”¨å‘½ä»¤" class="headerlink" title="Listç±»å‹å¸¸ç”¨å‘½ä»¤"></a>Listç±»å‹å¸¸ç”¨å‘½ä»¤</h3><p><img src="/20221205000000/image-20221205165838811.png" alt="Listç±»å‹å¸¸ç”¨å‘½ä»¤"></p><h3 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h3><p><img src="/20221205000000/image-20221205170314931.png" alt="åº”ç”¨æ€è€ƒ"></p><blockquote><p>è¯´æ˜ï¼š</p><p>æ ˆçš„ç‰¹ç‚¹ï¼šåªæœ‰ä¸€ä¸ªè¿›å‡ºå£ï¼Œå…ˆè¿›åå‡ºï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨listçš„ç‰¹æ€§ï¼Œæ¯”å¦‚ï¼š<code>lpush</code>å’Œ<code>lpop</code>å³å¯ã€‚</p><p>é˜Ÿåˆ—ï¼šå…ˆè¿›çš„å¯ä»¥å…ˆå‡ºï¼Œä¸åŒè¿›å‡ºå£ï¼Œæ¯”å¦‚ï¼š<code>lpush</code>å’Œ<code>rpop</code>ã€‚</p><p>é˜»å¡é˜Ÿåˆ—ï¼š<code>blpop</code>æˆ–è€…<code>brpop</code>æ˜¯åœ¨æœ‰æ•°æ®çš„æƒ…å†µå°±å–å‡ºï¼Œæ²¡æœ‰æ•°æ®å°±ç­‰å¾…ã€‚</p></blockquote><h2 id="2-5-Setç±»å‹"><a href="#2-5-Setç±»å‹" class="headerlink" title="2.5. Setç±»å‹"></a>2.5. Setç±»å‹</h2><h3 id="Setç±»å‹ä»‹ç»"><a href="#Setç±»å‹ä»‹ç»" class="headerlink" title="Setç±»å‹ä»‹ç»"></a>Setç±»å‹ä»‹ç»</h3><p><img src="/20221205000000/image-20221205170949113.png" alt="Setç±»å‹ä»‹ç»"></p><h3 id="Setç±»å‹å¸¸è§å‘½ä»¤"><a href="#Setç±»å‹å¸¸è§å‘½ä»¤" class="headerlink" title="Setç±»å‹å¸¸è§å‘½ä»¤"></a>Setç±»å‹å¸¸è§å‘½ä»¤</h3><p><img src="/20221205000000/image-20221205171515423.png" alt="Setç±»å‹å¸¸è§å‘½ä»¤"></p><h2 id="2-6-SortedSet"><a href="#2-6-SortedSet" class="headerlink" title="2.6 SortedSet"></a>2.6 SortedSet</h2><h3 id="SortedSetç±»å‹"><a href="#SortedSetç±»å‹" class="headerlink" title="SortedSetç±»å‹"></a>SortedSetç±»å‹</h3><p><img src="/20221205000000/image-20221205171956067.png" alt="SortedSetç±»å‹ä»‹ç»"></p><h3 id="SortedSetç±»å‹å¸¸è§å‘½ä»¤"><a href="#SortedSetç±»å‹å¸¸è§å‘½ä»¤" class="headerlink" title="SortedSetç±»å‹å¸¸è§å‘½ä»¤"></a>SortedSetç±»å‹å¸¸è§å‘½ä»¤</h3><p><img src="/20221205000000/image-20221205172144278.png" alt="SortedSetç±»å‹å¸¸è§å‘½ä»¤"></p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Springbootä¸­ä½¿ç”¨redisçš„ä¹±ç é—®é¢˜</title>
    <link href="/20221103140000/"/>
    <url>/20221103140000/</url>
    
    <content type="html"><![CDATA[<h1 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h1><p>é¡¹ç›®ä¸­å¦‚æœç›´æ¥é€šè¿‡<code>RedisTemplate</code>è¿›è¡Œredisçš„æ“ä½œï¼Œæˆ‘ä»¬åœ¨redisæ•°æ®åº“å¯ä»¥çœ‹åˆ°ï¼Œäº§ç”Ÿäº†åƒä¹±ç ä¸€æ ·çš„ä¸œè¥¿ï¼š</p><p><img src="/20221103140000/image-20221209115920877.png" alt="ä¹±ç é—®é¢˜"></p><h1 id="é—®é¢˜åŸå› "><a href="#é—®é¢˜åŸå› " class="headerlink" title="é—®é¢˜åŸå› "></a>é—®é¢˜åŸå› </h1><p>ä¸¥æ ¼æ¥è¯´ä¸æ˜¯ä¹±ç ï¼Œè¿™æ˜¯å› ä¸ºé»˜è®¤åºåˆ—åŒ–å™¨çš„é—®é¢˜ï¼ŒRedisTemplateåŠ è½½æ—¶ä¼šåˆå§‹åŒ–ä¸€ä¸ªé»˜è®¤åºåˆ—åŒ–å™¨ï¼ˆJdkSerializationRedisSerializer ï¼‰ï¼Œç¨‹åºä¸­ä½¿ç”¨RedisTemplateå°†å¯¹è±¡åºåˆ—åŒ–åå­˜å‚¨åˆ° redis ä¸­å°±ä¼šæœ‰è¿™æ ·çš„é—®é¢˜ã€‚</p><p><img src="/20221103140000/image-20221209120830121.png" alt="RedisTemplateé»˜è®¤åºåˆ—åŒ–å™¨åŠ è½½"></p><p>æ–­ç‚¹è¿›<code>redisTemplate.opsForValue().set()</code>æ–¹æ³•æŸ¥çœ‹æºç ï¼š</p><p><img src="/20221103140000/image-20221209121159386.png" alt="åºåˆ—åŒ–æºç 1"></p><p>æŸ¥çœ‹<code>rawValue(value)</code>çš„å®ç°æºç ï¼š</p><p><img src="/20221103140000/image-20221209121410693.png" alt="åºåˆ—åŒ–æºç 2"></p><p>é€šè¿‡æŸ¥çœ‹å®ç°ç±»å¯ä»¥çœ‹åˆ°ï¼Œå®ç°<code>valueSerializer().serialize(value)</code>çš„åºåˆ—åŒ–å™¨æœ‰å¥½å‡ ä¸ªï¼Œå¦‚æœæ²¡æœ‰åˆå§‹åŒ–çš„è¯ï¼Œé»˜è®¤å°±æ˜¯ç”¨<code>JdkSerializationRedisSerializer</code>è¿™ä¸ªåºåˆ—åŒ–å™¨ã€‚</p><p>RedisSerializerå®ç°ç±»ï¼š</p><p><img src="/20221103140000/image-20221209123056917.png" alt="RedisSerializerå®ç°ç±»"></p><p>ç»§ç»­çœ‹<code>JdkSerializationRedisSerializer</code> åºåˆ—åŒ–å™¨çš„å®ç°ï¼š</p><p><img src="/20221103140000/image-20221209121723099.png" alt="JdkSerializationRedisSerializeråºåˆ—åŒ–å®ç°"></p><p><img src="/20221103140000/image-20221209122156630.png" alt="JdkSerializationRedisSerializeråºåˆ—åŒ–å®ç°2"></p><p><img src="/20221103140000/image-20221209122300378.png" alt="JdkSerializationRedisSerializeråºåˆ—åŒ–å®ç°3"></p><p>æœ€ç»ˆæ˜¯é€šè¿‡<code>ObjectOutputStream</code>æ¥åºåˆ—åŒ–çš„ã€‚</p><h1 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h1><p>è‡ªå®šä¹‰ RedisTemplate é…ç½®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.demo.redisdemo.config;<br><br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.cache.RedisCacheConfiguration;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.cache.RedisCacheManager;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.cache.RedisCacheWriter;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.serializer.RedisSerializer;<br><br><span class="hljs-keyword">import</span> java.time.Duration;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="hljs-title function_">redisTemplate</span><span class="hljs-params">(RedisConnectionFactory factory)</span> &#123;<br>        <span class="hljs-comment">// åˆ›å»º RedisTemplate å¯¹è±¡</span><br>        RedisTemplate&lt;String, Object&gt; template = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisTemplate</span>&lt;&gt;();<br>        <span class="hljs-comment">// è®¾ç½®è¿æ¥å·¥å‚</span><br>        template.setConnectionFactory(factory);<br>        <span class="hljs-comment">// è®¾ç½®keyåºåˆ—åŒ–å™¨</span><br>        template.setKeySerializer(RedisSerializer.string());<br>        template.setHashKeySerializer(RedisSerializer.json());<br>        <span class="hljs-comment">// è®¾ç½®valueåºåˆ—åŒ–å™¨</span><br>        template.setValueSerializer(RedisSerializer.json());<br>        template.setHashValueSerializer(RedisSerializer.json());<br><br>        <span class="hljs-comment">// è¿”å›</span><br>        <span class="hljs-keyword">return</span> template;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæœ‰æŠ¥é”™ï¼ˆjacksonç›¸å…³ï¼‰ï¼Œéœ€è¦æ·»åŠ  jackson ç›¸å…³çš„åŒ…ä¾èµ–ï¼Œå¦‚æœé¡¹ç›®æœ¬èº«æœ‰ä¾èµ–spring-mvcçš„è¯ä¸ä¼šæŠ¥é”™ã€‚</p><p>åŸºæœ¬å®ç°åŸç†å°±æ˜¯ä»¥ä¸Šè¿™æ ·çš„ï¼Œç½‘ä¸Šä¹Ÿå¯ä»¥æŸ¥æ‰¾ç›¸å…³ï¼š<code>springboot redistemplate é…ç½®</code>ï¼Œéƒ½å¤§åŒå°å¼‚ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>é—®é¢˜è®°å½•</category>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Springboot</tag>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaä¸­ä½¿ç”¨Redisï¼ˆJedisï¼‰</title>
    <link href="/20221103130000/"/>
    <url>/20221103130000/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨Javaä¸­é€šè¿‡Jedisä½¿ç”¨Redisã€‚</p></blockquote><h1 id="Jediså¿«é€Ÿå…¥é—¨"><a href="#Jediså¿«é€Ÿå…¥é—¨" class="headerlink" title="Jediså¿«é€Ÿå…¥é—¨"></a>Jediså¿«é€Ÿå…¥é—¨</h1><h2 id="å®˜æ–¹åœ°å€-Github"><a href="#å®˜æ–¹åœ°å€-Github" class="headerlink" title="å®˜æ–¹åœ°å€(Github)"></a><a href="https://github.com/redis/jedis">å®˜æ–¹åœ°å€(Github)</a></h2><h2 id="Javaçš„mavené¡¹ç›®ä¸­ä½¿ç”¨jedis"><a href="#Javaçš„mavené¡¹ç›®ä¸­ä½¿ç”¨jedis" class="headerlink" title="Javaçš„mavené¡¹ç›®ä¸­ä½¿ç”¨jedis"></a>Javaçš„mavené¡¹ç›®ä¸­ä½¿ç”¨jedis</h2><ul><li>ä½¿ç”¨IDEAåˆ›å»ºmavené¡¹ç›®</li></ul><p><img src="/20221103130000/image-20221205231229753.png" alt="IDEAä¸­åˆ›å»ºmavené¡¹ç›®1"></p><p><img src="/20221103130000/image-20221205231716161.png" alt="IDEAä¸­åˆ›å»ºmavené¡¹ç›®2"></p><ul><li><p>pomæ·»åŠ ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--jedis--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.3.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--junit--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.jupiter<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-jupiter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.7.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>æ–°å»ºæµ‹è¯•ç±»æ¥æµ‹è¯•jedis</p><p><img src="/20221103130000/image-20221205235141484.png" alt="image-20221205235141484"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.demo.jedis.test;<br><br><span class="hljs-keyword">import</span> org.junit.jupiter.api.AfterEach;<br><span class="hljs-keyword">import</span> org.junit.jupiter.api.BeforeEach;<br><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;<br><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * jediså•å…ƒæµ‹è¯•ç±»</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JedisTest</span> &#123;<br><br>    <span class="hljs-keyword">private</span> Jedis jedis;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å½“å‰å•å…ƒæµ‹è¯•ç±»ä¸­ï¼Œæ¯æ¬¡æ‰§è¡Œtestä¹‹å‰éƒ½ä¼šæ‰§è¡Œçš„æ–¹æ³•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@BeforeEach</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setup</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">// å»ºç«‹è¿æ¥</span><br>        jedis = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">&quot;192.168.200.123&quot;</span>, <span class="hljs-number">6379</span>);<br>        <span class="hljs-comment">// è¿æ¥å¯†ç </span><br>        jedis.auth(<span class="hljs-string">&quot;123321&quot;</span>);<br>        <span class="hljs-comment">// è¿æ¥åº“</span><br>        jedis.select(<span class="hljs-number">0</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * å½“å‰å•å…ƒæµ‹è¯•ç±»ä¸­ï¼Œæ¯æ¬¡æ‰§è¡Œtestä¹‹åéƒ½ä¼šæ‰§è¡Œçš„æ–¹æ³•</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@AfterEach</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">tearDown</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">if</span>(jedis != <span class="hljs-literal">null</span>)&#123;<br>            jedis.close();<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testString</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-comment">// å­˜å…¥æ•°æ®</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> jedis.set(<span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;Lisi&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;result: &quot;</span> + result);<br>        <span class="hljs-comment">// å–å‡ºæ•°æ®</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> jedis.get(<span class="hljs-string">&quot;name&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;name: &quot;</span> + name);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure></li></ul><h2 id="Jedisè¿æ¥æ± "><a href="#Jedisè¿æ¥æ± " class="headerlink" title="Jedisè¿æ¥æ± "></a>Jedisè¿æ¥æ± </h2><p>é€šè¿‡è¿æ¥æ± è·å–redisè¿æ¥ï¼ˆä¸ç”¨å†é€šè¿‡newçš„æ–¹å¼åˆ›å»ºè¿æ¥ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;<br><span class="hljs-keyword">import</span> redis.clients.jedis.JedisPool;<br><span class="hljs-keyword">import</span> redis.clients.jedis.JedisPoolConfig;<br><br><span class="hljs-keyword">import</span> java.time.Duration;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * jedisè¿æ¥æ± </span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JedisConnectionFactory</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> JedisPool jedisPool;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-comment">// é…ç½®è¿æ¥æ± </span><br>        <span class="hljs-type">JedisPoolConfig</span> <span class="hljs-variable">poolConfig</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPoolConfig</span>();<br>        <span class="hljs-comment">// æœ€å¤§è¿æ¥æ•°</span><br>        poolConfig.setMaxTotal(<span class="hljs-number">8</span>);<br>        <span class="hljs-comment">// æœ€å¤§ç©ºé—²è¿æ¥</span><br>        poolConfig.setMaxIdle(<span class="hljs-number">8</span>);<br>        <span class="hljs-comment">// æœ€å°ç©ºé—²è¿æ¥</span><br>        poolConfig.setMinIdle(<span class="hljs-number">0</span>);<br>        <span class="hljs-comment">// ç­‰å¾…æ—¶é—´</span><br>        poolConfig.setMaxWait(Duration.ofSeconds(<span class="hljs-number">10</span>));<br>        <span class="hljs-comment">// åˆ›å»ºè¿æ¥æ± å¯¹è±¡</span><br>        jedisPool = <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPool</span>(poolConfig, <span class="hljs-string">&quot;192.168.200.123&quot;</span>, <span class="hljs-number">6379</span>, <span class="hljs-number">1000</span>, <span class="hljs-string">&quot;123321&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * è·å–redisè¿æ¥</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Jedis <span class="hljs-title function_">getJedis</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> jedisPool.getResource();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="Springbooté¡¹ç›®ä¸redis"><a href="#Springbooté¡¹ç›®ä¸redis" class="headerlink" title="Springbooté¡¹ç›®ä¸redis"></a>Springbooté¡¹ç›®ä¸redis</h1><h2 id="SpringDataRedisä»‹ç»"><a href="#SpringDataRedisä»‹ç»" class="headerlink" title="SpringDataRedisä»‹ç»"></a>SpringDataRedisä»‹ç»</h2><p><img src="/20221103130000/image-20221206002810715.png" alt="SpringDataRedisä»‹ç»"></p><p><img src="/20221103130000/image-20221206003142014.png" alt="SpringDataRedisä»‹ç»2"></p><h2 id="Springbooté¡¹ç›®ä¸­ä½¿ç”¨redis"><a href="#Springbooté¡¹ç›®ä¸­ä½¿ç”¨redis" class="headerlink" title="Springbooté¡¹ç›®ä¸­ä½¿ç”¨redis"></a>Springbooté¡¹ç›®ä¸­ä½¿ç”¨redis</h2><ul><li>åˆ›å»ºSpringbooté¡¹ç›®</li></ul><p><img src="/20221103130000/image-20221206003800697.png" alt="åˆ›å»ºSpringbooté¡¹ç›®"></p><p><img src="/20221103130000/image-20221206003906129.png" alt="åˆ›å»ºSpringbooté¡¹ç›®2"></p><ul><li><p>å¼•å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--redis--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-comment">&lt;!--è¿æ¥æ± ä¾èµ–--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-pool2<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹é…ç½®æ–‡ä»¶</p><p>[å¯é€‰]ï¼šä¿®æ”¹<code>resources</code>æ–‡ä»¶å¤¹ä¸‹çš„<code>application.properties</code>æ–‡ä»¶ä¸º<code>application.yml</code></p><p><img src="/20221103130000/image-20221209115238567.png" alt="ä¿®æ”¹é…ç½®æ–‡ä»¶"></p><p>yml é…ç½®ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.18</span><span class="hljs-number">.123</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123321</span><br>    <span class="hljs-comment"># é»˜è®¤çš„ lettuce è¿æ¥æ± </span><br>    <span class="hljs-attr">lettuce:</span><br>      <span class="hljs-attr">pool:</span><br>        <span class="hljs-attr">max-active:</span> <span class="hljs-number">8</span><br>        <span class="hljs-comment"># æœ€å¤§ç©ºé—²è¿æ¥</span><br>        <span class="hljs-attr">max-idle:</span> <span class="hljs-number">8</span><br>        <span class="hljs-comment"># æœ€å°ç©ºé—²è¿æ¥</span><br>        <span class="hljs-attr">min-idle:</span> <span class="hljs-number">0</span><br>        <span class="hljs-attr">max-wait:</span> <span class="hljs-string">1000ms</span><br>    <span class="hljs-comment"># æ•°æ®åº“ç´¢å¼•</span><br>    <span class="hljs-attr">database:</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure></li><li><p>redisTemplate æ“ä½œredis</p></li></ul><p><img src="/20221103130000/image-20221209115613064.png" alt="redisTemplate æ“ä½œredis"></p><h3 id="â€ä¹±ç â€œé—®é¢˜"><a href="#â€ä¹±ç â€œé—®é¢˜" class="headerlink" title="â€ä¹±ç â€œé—®é¢˜"></a>â€ä¹±ç â€œé—®é¢˜</h3><p>å¦‚æœç›´æ¥è¿›è¡Œä¸Šæ–¹çš„æ“ä½œï¼Œæˆ‘ä»¬åœ¨redisæ•°æ®åº“å¯ä»¥çœ‹åˆ°ï¼Œäº§ç”Ÿäº†åƒä¹±ç ä¸€æ ·çš„ä¸œè¥¿</p><p><img src="/20221103130000/image-20221209115920877.png" alt="ä¹±ç é—®é¢˜"></p><p>è¿™æ˜¯å› ä¸ºé»˜è®¤åºåˆ—åŒ–å™¨çš„é—®é¢˜ï¼ŒRedisTemplateåŠ è½½æ—¶æœ‰åˆå§‹åŒ–ä¸€ä¸ªé»˜è®¤åºåˆ—åŒ–å™¨ï¼ˆJDKçš„åºåˆ—åŒ–å™¨ï¼‰ï¼š</p><p><img src="/20221103130000/image-20221209120830121.png" alt="RedisTemplateé»˜è®¤åºåˆ—åŒ–å™¨åŠ è½½"></p><p>æ–­ç‚¹è¿›<code>redisTemplate.opsForValue().set()</code>æ–¹æ³•æŸ¥çœ‹æºç ï¼š</p><p><img src="/20221103130000/image-20221209121159386.png" alt="åºåˆ—åŒ–æºç 1"></p><p>æŸ¥çœ‹<code>rawValue(value)</code>çš„å®ç°æºç ï¼š</p><p><img src="/20221103130000/image-20221209121410693.png" alt="åºåˆ—åŒ–æºç 2"></p><p>é€šè¿‡æŸ¥çœ‹å®ç°ç±»å¯ä»¥çœ‹åˆ°ï¼Œå®ç°<code>valueSerializer().serialize(value)</code>çš„åºåˆ—åŒ–å™¨æœ‰å¥½å‡ ä¸ªï¼Œå¦‚æœæ²¡æœ‰åˆå§‹åŒ–çš„è¯ï¼Œé»˜è®¤å°±æ˜¯ç”¨<code>JdkSerializationRedisSerializer</code>è¿™ä¸ªåºåˆ—åŒ–å™¨ã€‚</p><p>ç»§ç»­çœ‹<code>JdkSerializationRedisSerializer</code> åºåˆ—åŒ–å™¨çš„å®ç°ï¼š</p><p><img src="/20221103130000/image-20221209121723099.png" alt="JdkSerializationRedisSerializeråºåˆ—åŒ–å®ç°"></p><p><img src="/20221103130000/image-20221209122156630.png" alt="JdkSerializationRedisSerializeråºåˆ—åŒ–å®ç°2"></p><p><img src="/20221103130000/image-20221209122300378.png" alt="JdkSerializationRedisSerializeråºåˆ—åŒ–å®ç°3"></p><p>æœ€ç»ˆæ˜¯é€šè¿‡<code>ObjectOutputStream</code>æ¥åºåˆ—åŒ–çš„ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><p>è‡ªå®šä¹‰ RedisTemplate é…ç½®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.demo.redisdemo.config;<br><br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.cache.RedisCacheConfiguration;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.cache.RedisCacheManager;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.cache.RedisCacheWriter;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.serializer.RedisSerializer;<br><br><span class="hljs-keyword">import</span> java.time.Duration;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConfig</span> &#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="hljs-title function_">redisTemplate</span><span class="hljs-params">(RedisConnectionFactory factory)</span> &#123;<br>        <span class="hljs-comment">// åˆ›å»º RedisTemplate å¯¹è±¡</span><br>        RedisTemplate&lt;String, Object&gt; template = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisTemplate</span>&lt;&gt;();<br>        <span class="hljs-comment">// è®¾ç½®è¿æ¥å·¥å‚</span><br>        template.setConnectionFactory(factory);<br>        <span class="hljs-comment">// è®¾ç½®keyåºåˆ—åŒ–å™¨</span><br>        template.setKeySerializer(RedisSerializer.string());<br>        template.setHashKeySerializer(RedisSerializer.json());<br>        <span class="hljs-comment">// è®¾ç½®valueåºåˆ—åŒ–å™¨</span><br>        template.setValueSerializer(RedisSerializer.json());<br>        template.setHashValueSerializer(RedisSerializer.json());<br><br>        <span class="hljs-comment">// è¿”å›</span><br>        <span class="hljs-keyword">return</span> template;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœæœ‰æŠ¥é”™ï¼ˆjacksonç›¸å…³ï¼‰ï¼Œéœ€è¦æ·»åŠ  jackson ç›¸å…³çš„åŒ…ä¾èµ–ï¼Œå¦‚æœé¡¹ç›®æœ¬èº«æœ‰ä¾èµ–spring-mvcçš„è¯ä¸ä¼šæŠ¥é”™ã€‚</p><p>åŸºæœ¬å®ç°åŸç†å°±æ˜¯ä»¥ä¸Šè¿™æ ·çš„ï¼Œç½‘ä¸Šä¹Ÿå¯ä»¥æŸ¥æ‰¾ç›¸å…³ï¼š<code>springboot redistemplate é…ç½®</code>ï¼Œéƒ½å¤§åŒå°å¼‚ã€‚</p><h3 id="æ•°æ®å¯¹è±¡å­˜å‚¨é—®é¢˜"><a href="#æ•°æ®å¯¹è±¡å­˜å‚¨é—®é¢˜" class="headerlink" title="æ•°æ®å¯¹è±¡å­˜å‚¨é—®é¢˜"></a>æ•°æ®å¯¹è±¡å­˜å‚¨é—®é¢˜</h3><p>é€šè¿‡æŒ‡å®šçš„åºåˆ—åŒ–å™¨åºåˆ—åŒ–ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœå­˜å‚¨çš„æ˜¯å¯¹è±¡ï¼Œredisä¸­ä¼šå†™å…¥ç±»ä¿¡æ¯ï¼Œè¿™æ ·å°±å¤šå ç”¨äº†å¾ˆå¤§ä¸€éƒ¨åˆ†å­˜å‚¨ç©ºé—´ï¼š</p><p><img src="/20221103130000/image-20221209133827502.png" alt="æ•°æ®å¯¹è±¡å­˜å‚¨é—®é¢˜"></p><p>è§£å†³æ–¹æ¡ˆ1ï¼Œä½¿ç”¨StringRedisTemplateï¼Œå¹¶è¿›è¡Œæ‰‹åŠ¨ååºåˆ—åŒ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.demo.redisdemo;<br><br><span class="hljs-keyword">import</span> com.demo.redisdemo.pojo.User;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;<br><span class="hljs-keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;<br><span class="hljs-keyword">import</span> org.junit.jupiter.api.Test;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.boot.test.context.SpringBootTest;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;<br><br><span class="hljs-meta">@SpringBootTest</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisTemplateTests</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> StringRedisTemplate stringRedisTemplate;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">ObjectMapper</span> <span class="hljs-variable">objectMapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();<br><br>    <span class="hljs-meta">@Test</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">testJson</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> JsonProcessingException &#123;<br>        <span class="hljs-comment">// åˆ›å»ºå¯¹è±¡</span><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">&quot;ç‹äº”&quot;</span>, <span class="hljs-number">23</span>);<br>        <span class="hljs-comment">// æ‰‹åŠ¨åºåˆ—åŒ–</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">userStr1</span> <span class="hljs-operator">=</span> objectMapper.writeValueAsString(user1);<br>        <span class="hljs-comment">// å­˜å…¥stringç±»å‹çš„æ•°æ®</span><br>        stringRedisTemplate.opsForValue().set(<span class="hljs-string">&quot;user:100&quot;</span>, userStr1);<br><br>        <span class="hljs-comment">// å–å‡ºstringç±»å‹æ•°æ®</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">userStr2</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue().get(<span class="hljs-string">&quot;user:100&quot;</span>);<br>        <span class="hljs-comment">// æ‰‹åŠ¨ååºåˆ—åŒ–</span><br>        <span class="hljs-type">User</span> <span class="hljs-variable">user2</span> <span class="hljs-operator">=</span> objectMapper.readValue(userStr2, User.class);<br><br>        System.out.println(<span class="hljs-string">&quot;user=&quot;</span> + user2);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/20221103130000/image-20221209134904232.png" alt="æ‰‹åŠ¨åºåˆ—åŒ–ååºåˆ—åŒ–"></p><h3 id="RedisTemplateçš„ä¸¤ç§åºåˆ—åŒ–å®è·µæ–¹æ¡ˆ"><a href="#RedisTemplateçš„ä¸¤ç§åºåˆ—åŒ–å®è·µæ–¹æ¡ˆ" class="headerlink" title="RedisTemplateçš„ä¸¤ç§åºåˆ—åŒ–å®è·µæ–¹æ¡ˆ"></a>RedisTemplateçš„ä¸¤ç§åºåˆ—åŒ–å®è·µæ–¹æ¡ˆ</h3><p>æ–¹æ¡ˆä¸€ï¼š</p><ol><li>è‡ªå®šä¹‰<code>RedisTemplate</code>ã€‚</li><li>ä¿®æ”¹<code>RedisTemplate</code>çš„åºåˆ—åŒ–å™¨ä¸º<code>GenericJackson2JsonRedisSerializer</code></li></ol><p>æ–¹æ¡ˆäºŒï¼š</p><ol><li>ä½¿ç”¨<code>StringRedisTemplate</code>ã€‚</li><li>å†™å…¥Redisæ—¶ï¼Œæ‰‹åŠ¨æŠŠå¯¹è±¡åºåˆ—åŒ–ä¸ºJSONã€‚</li><li>è¯»å–Redisæ—¶ï¼Œæ‰‹åŠ¨æŠŠè¯»å–åˆ°çš„JSONæ•°æ®ååºåˆ—åŒ–ä¸ºå¯¹è±¡ã€‚</li></ol>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Redis</tag>
      
      <tag>Jedis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Rediså®‰è£…è¯´æ˜</title>
    <link href="/20221103120000/"/>
    <url>/20221103120000/</url>
    
    <content type="html"><![CDATA[<h1 id="Rediså®‰è£…è¯´æ˜"><a href="#Rediså®‰è£…è¯´æ˜" class="headerlink" title="Rediså®‰è£…è¯´æ˜"></a>Rediså®‰è£…è¯´æ˜</h1><blockquote><p>æ–‡ç« ä¸»è¦ä»‹ç»å¼€å‘æœ¬åœ°å¦‚ä½•å®‰è£…Redisã€‚</p><p><a href="https://redis.io/">Rediså®˜æ–¹ç½‘ç«™</a> æ²¡æœ‰æä¾›Windowsç‰ˆæœ¬çš„å®‰è£…åŒ…ï¼Œæœ¬æ–‡ä¼šåŸºäºLinuxç³»ç»Ÿæ¥å®‰è£…Redis.</p><p>æ­¤å¤„é€‰æ‹©çš„Linuxç‰ˆæœ¬ä¸º<em>CentOS 7</em>.</p></blockquote><h1 id="1-å•æœºå®‰è£…Redis"><a href="#1-å•æœºå®‰è£…Redis" class="headerlink" title="1. å•æœºå®‰è£…Redis"></a>1. å•æœºå®‰è£…Redis</h1><h2 id="1-1-å®‰è£…Redisä¾èµ–"><a href="#1-1-å®‰è£…Redisä¾èµ–" class="headerlink" title="1.1. å®‰è£…Redisä¾èµ–"></a>1.1. å®‰è£…Redisä¾èµ–</h2><p>Redisæ˜¯åŸºäºCè¯­è¨€ç¼–å†™çš„ï¼Œå› æ­¤é¦–å…ˆéœ€è¦å®‰è£…Redisæ‰€éœ€è¦çš„gccä¾èµ–ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">yum install -y gcc tcl<br></code></pre></td></tr></table></figure><h2 id="1-2-ä¸Šä¼ å®‰è£…åŒ…å¹¶è§£å‹"><a href="#1-2-ä¸Šä¼ å®‰è£…åŒ…å¹¶è§£å‹" class="headerlink" title="1.2. ä¸Šä¼ å®‰è£…åŒ…å¹¶è§£å‹"></a>1.2. ä¸Šä¼ å®‰è£…åŒ…å¹¶è§£å‹</h2><p>Rediså‹ç¼©åŒ…ä¸Šä¼ åˆ°è™šæ‹Ÿæœºçš„ä»»æ„ç›®å½•ï¼Œä¾‹å¦‚ï¼Œæˆ‘ä½¿ç”¨<em><strong>Mobaxterm</strong></em> å·¥å…·å°†æ–‡ä»¶æ”¾åˆ°äº†***&#x2F;usr&#x2F;local&#x2F;src*** ç›®å½•ï¼š</p><p><img src="/20221103120000/image-20211211080151539.png" alt="Mobaxtermçš„é¡µé¢"></p><p>æˆ–è€…åœ¨Linuxè¿›å…¥æŒ‡å®šæ–‡ä»¶å¤¹åï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç›´æ¥ä¸‹è½½åˆ°æ–‡ä»¶å¤¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">é€šè¿‡ä¸‹è½½é“¾æ¥ç›´æ¥ä¸‹è½½</span><br>wget https://download.redis.io/releases/redis-6.2.6.tar.gz<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">å¦‚æœæ²¡æœ‰wgetå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…</span><br>yum -y install wget<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç§»åŠ¨æ–‡ä»¶åˆ°æŒ‡å®šæ–‡ä»¶å¤¹ï¼ˆæŒ‰éœ€æ±‚æ¥ï¼Œå¯ä¸æ‰§è¡Œï¼‰</span><br>mv redis-6.2.6.tar.gz /usr/local/src/<br></code></pre></td></tr></table></figure><p>é“¾æ¥è·å–æ–¹å¼ï¼š</p><p><img src="/20221103120000/image-20221202004057636.png" alt="é“¾æ¥è·å–æ–¹å¼"></p><p>è§£å‹ç¼©ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">è§£å‹æ–‡ä»¶</span><br>tar -xzf redis-6.2.6.tar.gz<br><span class="hljs-meta prompt_"># </span><span class="language-bash">è§£å‹åè¿›å…¥æ–‡ä»¶å¤¹</span><br>cd redis-6.2.6<br><span class="hljs-meta prompt_"># </span><span class="language-bash">è¿è¡Œç¼–è¯‘å‘½ä»¤</span><br>make &amp;&amp; make install<br></code></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰å‡ºé”™ï¼Œåº”è¯¥å°±å®‰è£…æˆåŠŸäº†ã€‚</p><p>é»˜è®¤çš„å®‰è£…è·¯å¾„æ˜¯åœ¨ <code>/usr/local/bin</code>ç›®å½•ä¸‹ï¼š</p><p><img src="/20221103120000/image-20211211080603710.png" alt="é»˜è®¤å®‰è£…è·¯å¾„"></p><p>è¯¥ç›®å½•ä»¥åŠé»˜è®¤é…ç½®åˆ°ç¯å¢ƒå˜é‡ï¼Œå› æ­¤å¯ä»¥åœ¨ä»»æ„ç›®å½•ä¸‹è¿è¡Œè¿™äº›å‘½ä»¤ã€‚å…¶ä¸­ï¼š</p><ul><li>redis-cliï¼šæ˜¯redisæä¾›çš„å‘½ä»¤è¡Œå®¢æˆ·ç«¯</li><li>redis-serverï¼šæ˜¯redisçš„æœåŠ¡ç«¯å¯åŠ¨è„šæœ¬</li><li>redis-sentinelï¼šæ˜¯redisçš„å“¨å…µå¯åŠ¨è„šæœ¬</li></ul><h2 id="1-3-å¯åŠ¨"><a href="#1-3-å¯åŠ¨" class="headerlink" title="1.3. å¯åŠ¨"></a>1.3. å¯åŠ¨</h2><p>redisçš„å¯åŠ¨æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œä¾‹å¦‚ï¼š</p><ul><li>é»˜è®¤å¯åŠ¨</li><li>æŒ‡å®šé…ç½®å¯åŠ¨</li><li>å¼€æœºè‡ªå¯</li></ul><h3 id="1-3-1-é»˜è®¤å¯åŠ¨"><a href="#1-3-1-é»˜è®¤å¯åŠ¨" class="headerlink" title="1.3.1. é»˜è®¤å¯åŠ¨"></a>1.3.1. é»˜è®¤å¯åŠ¨</h3><p>å®‰è£…å®Œæˆåï¼Œåœ¨ä»»æ„ç›®å½•è¾“å…¥redis-serverå‘½ä»¤å³å¯å¯åŠ¨Redisï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">redis-server<br></code></pre></td></tr></table></figure><p>å¦‚å›¾ï¼š</p><p><img src="/20221103120000/image-20211211081716167.png" alt="å¯åŠ¨æˆåŠŸé¡µé¢"></p><p>è¿™ç§å¯åŠ¨å±äº<code>å‰å°å¯åŠ¨</code>ï¼Œä¼šé˜»å¡æ•´ä¸ªä¼šè¯çª—å£ï¼Œçª—å£å…³é—­æˆ–è€…æŒ‰ä¸‹<code>CTRL + C</code>åˆ™Redisåœæ­¢ã€‚ä¸æ¨èä½¿ç”¨ã€‚</p><h3 id="1-3-2-æŒ‡å®šé…ç½®å¯åŠ¨"><a href="#1-3-2-æŒ‡å®šé…ç½®å¯åŠ¨" class="headerlink" title="1.3.2. æŒ‡å®šé…ç½®å¯åŠ¨"></a>1.3.2. æŒ‡å®šé…ç½®å¯åŠ¨</h3><p>å¦‚æœè¦è®©Redisä»¥<code>åå°</code>æ–¹å¼å¯åŠ¨ï¼Œåˆ™å¿…é¡»ä¿®æ”¹Redisé…ç½®æ–‡ä»¶ï¼Œå°±åœ¨æˆ‘ä»¬ä¹‹å‰è§£å‹çš„rediså®‰è£…åŒ…ä¸‹ï¼ˆ<code>/usr/local/src/redis-6.2.6</code>ï¼‰ï¼Œåå­—å«redis.confï¼š</p><p><img src="/20221103120000/image-20211211082225509.png" alt="Redisé…ç½®æ–‡ä»¶"></p><p>æˆ‘ä»¬å…ˆå°†è¿™ä¸ªé…ç½®æ–‡ä»¶å¤‡ä»½ä¸€ä»½ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å¤‡ä»½é…ç½®æ–‡ä»¶</span><br>cp redis.conf redis.conf.bak<br></code></pre></td></tr></table></figure><p>ç„¶åä¿®æ”¹redis.confæ–‡ä»¶ä¸­çš„ä¸€äº›é…ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># å…è®¸è®¿é—®çš„åœ°å€ï¼Œé»˜è®¤æ˜¯127.0.0.1ï¼Œä¼šå¯¼è‡´åªèƒ½åœ¨æœ¬åœ°è®¿é—®ã€‚ä¿®æ”¹ä¸º0.0.0.0åˆ™å¯ä»¥åœ¨ä»»æ„IPè®¿é—®ï¼Œç”Ÿäº§ç¯å¢ƒä¸è¦è®¾ç½®ä¸º0.0.0.0</span><br><span class="hljs-attr">bind</span> <span class="hljs-string">0.0.0.0</span><br><span class="hljs-comment"># å®ˆæŠ¤è¿›ç¨‹ï¼Œä¿®æ”¹ä¸ºyesåå³å¯åå°è¿è¡Œ</span><br><span class="hljs-attr">daemonize</span> <span class="hljs-string">yes </span><br><span class="hljs-comment"># å¯†ç ï¼Œè®¾ç½®åè®¿é—®Rediså¿…é¡»è¾“å…¥å¯†ç </span><br><span class="hljs-attr">requirepass</span> <span class="hljs-string">123321</span><br></code></pre></td></tr></table></figure><blockquote><p>è¯´æ˜ï¼šviç¼–è¾‘å™¨çª—å£è¿›è¡Œå¿«æ·æœç´¢</p><p>è‹±æ–‡çŠ¶æ€ä¸‹ï¼ŒæŒ‰ <code>esc</code> å æŒ‰<code>/</code>ï¼Œå°±å¯ä»¥åœ¨åº•éƒ¨çš„è¾“å…¥æ¡†è¿›è¡Œæœç´¢ï¼Œæœç´¢çš„æ—¶å€™ï¼Œé€šè¿‡æŒ‰<code>n</code>ï¼ˆä¸‹ä¸€ä¸ªï¼‰ï¼Œ<code>N</code>ï¼ˆä¸Šä¸€ä¸ªï¼‰æ¥è¿›è¡Œå‰åæœç´¢ã€‚</p></blockquote><p>Redisçš„å…¶å®ƒå¸¸è§é…ç½®ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># ç›‘å¬çš„ç«¯å£</span><br><span class="hljs-attr">port</span> <span class="hljs-string">6379</span><br><span class="hljs-comment"># å·¥ä½œç›®å½•ï¼Œé»˜è®¤æ˜¯å½“å‰ç›®å½•ï¼Œä¹Ÿå°±æ˜¯è¿è¡Œredis-serveræ—¶çš„å‘½ä»¤ï¼Œæ—¥å¿—ã€æŒä¹…åŒ–ç­‰æ–‡ä»¶ä¼šä¿å­˜åœ¨è¿™ä¸ªç›®å½•</span><br><span class="hljs-attr">dir</span> <span class="hljs-string">.</span><br><span class="hljs-comment"># æ•°æ®åº“æ•°é‡ï¼Œè®¾ç½®ä¸º1ï¼Œä»£è¡¨åªä½¿ç”¨1ä¸ªåº“ï¼Œé»˜è®¤æœ‰16ä¸ªåº“ï¼Œç¼–å·0~15</span><br><span class="hljs-attr">databases</span> <span class="hljs-string">1</span><br><span class="hljs-comment"># è®¾ç½®redisèƒ½å¤Ÿä½¿ç”¨çš„æœ€å¤§å†…å­˜</span><br><span class="hljs-attr">maxmemory</span> <span class="hljs-string">512mb</span><br><span class="hljs-comment"># æ—¥å¿—æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºç©ºï¼Œä¸è®°å½•æ—¥å¿—ï¼Œå¯ä»¥æŒ‡å®šæ—¥å¿—æ–‡ä»¶å</span><br><span class="hljs-attr">logfile</span> <span class="hljs-string">&quot;redis.log&quot;</span><br></code></pre></td></tr></table></figure><p>å¯åŠ¨Redisï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">è¿›å…¥rediså®‰è£…ç›®å½•</span> <br>cd /usr/local/src/redis-6.2.6<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¯åŠ¨</span><br>redis-server redis.conf<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ˜¾ç¤ºè¿è¡Œæƒ…å†µ</span><br>ps -ef |grep redis<br></code></pre></td></tr></table></figure><p>é€šè¿‡ <code>redis-cli</code> è¿›å…¥å®¢æˆ·ç«¯å‘½ä»¤è¡Œçª—å£ï¼š</p><p><img src="/20221103120000/image-20221205143946384.png" alt="redis-cli"></p><p>åœæ­¢æœåŠ¡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ©ç”¨redis-cliæ¥æ‰§è¡Œ shutdown å‘½ä»¤ï¼Œå³å¯åœæ­¢ Redis æœåŠ¡ï¼Œ</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å› ä¸ºä¹‹å‰é…ç½®äº†å¯†ç ï¼Œå› æ­¤éœ€è¦é€šè¿‡ -u æ¥æŒ‡å®šå¯†ç </span><br>redis-cli -u 123321 shutdown<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¦‚æœæŠ¥é”™ï¼šInvalid URI schemeï¼Œå¯ä»¥å°è¯•ä»¥ä¸‹æ–¹å¼å…³é—­</span><br>redis-cli -a 123321 shutdown<br></code></pre></td></tr></table></figure><h3 id="1-3-3-å¼€æœºè‡ªå¯"><a href="#1-3-3-å¼€æœºè‡ªå¯" class="headerlink" title="1.3.3. å¼€æœºè‡ªå¯"></a>1.3.3. å¼€æœºè‡ªå¯</h3><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ¥å®ç°å¼€æœºè‡ªå¯ã€‚</p><p>é¦–å…ˆï¼Œæ–°å»ºä¸€ä¸ªç³»ç»ŸæœåŠ¡æ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">vi /etc/systemd/system/redis.service<br></code></pre></td></tr></table></figure><p>å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs conf">[Unit]<br>Description=redis-server<br>After=network.target<br><br>[Service]<br>Type=forking<br>ExecStart=/usr/local/bin/redis-server /usr/local/src/redis-6.2.6/redis.conf<br>PrivateTmp=true<br><br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure><p>ç„¶åé‡è½½ç³»ç»ŸæœåŠ¡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl daemon-reload<br></code></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢è¿™ç»„å‘½ä»¤æ¥æ“ä½œredisäº†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å¯åŠ¨</span><br>systemctl start redis<br><span class="hljs-meta prompt_"># </span><span class="language-bash">åœæ­¢</span><br>systemctl stop redis<br><span class="hljs-meta prompt_"># </span><span class="language-bash">é‡å¯</span><br>systemctl restart redis<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹çŠ¶æ€</span><br>systemctl status redis<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå¯ä»¥è®©rediså¼€æœºè‡ªå¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl enable redis<br></code></pre></td></tr></table></figure><h1 id="2-Rediså®¢æˆ·ç«¯"><a href="#2-Rediså®¢æˆ·ç«¯" class="headerlink" title="2. Rediså®¢æˆ·ç«¯"></a>2. Rediså®¢æˆ·ç«¯</h1><p>å®‰è£…å®ŒæˆRedisï¼Œæˆ‘ä»¬å°±å¯ä»¥æ“ä½œRedisï¼Œå®ç°æ•°æ®çš„CRUDäº†ã€‚è¿™éœ€è¦ç”¨åˆ°Rediså®¢æˆ·ç«¯ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>å‘½ä»¤è¡Œå®¢æˆ·ç«¯</li><li>å›¾å½¢åŒ–æ¡Œé¢å®¢æˆ·ç«¯</li><li>ç¼–ç¨‹å®¢æˆ·ç«¯</li></ul><h2 id="2-1-Rediså‘½ä»¤è¡Œå®¢æˆ·ç«¯"><a href="#2-1-Rediså‘½ä»¤è¡Œå®¢æˆ·ç«¯" class="headerlink" title="2.1. Rediså‘½ä»¤è¡Œå®¢æˆ·ç«¯"></a>2.1. Rediså‘½ä»¤è¡Œå®¢æˆ·ç«¯</h2><p>Rediså®‰è£…å®Œæˆåå°±è‡ªå¸¦äº†å‘½ä»¤è¡Œå®¢æˆ·ç«¯ï¼šredis-cliï¼Œä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">redis-cli [options] [commonds]<br></code></pre></td></tr></table></figure><p>å…¶ä¸­å¸¸è§çš„optionsæœ‰ï¼š</p><ul><li><code>-h 127.0.0.1</code>ï¼šæŒ‡å®šè¦è¿æ¥çš„redisèŠ‚ç‚¹çš„IPåœ°å€ï¼Œé»˜è®¤æ˜¯127.0.0.1</li><li><code>-p 6379</code>ï¼šæŒ‡å®šè¦è¿æ¥çš„redisèŠ‚ç‚¹çš„ç«¯å£ï¼Œé»˜è®¤æ˜¯6379</li><li><code>-a 123321</code>ï¼šæŒ‡å®šredisçš„è®¿é—®å¯†ç </li></ul><p>å…¶ä¸­çš„commondså°±æ˜¯Redisçš„æ“ä½œå‘½ä»¤ï¼Œä¾‹å¦‚ï¼š</p><ul><li><code>ping</code>ï¼šä¸redisæœåŠ¡ç«¯åšå¿ƒè·³æµ‹è¯•ï¼ŒæœåŠ¡ç«¯æ­£å¸¸ä¼šè¿”å›<code>pong</code></li></ul><p>ä¸æŒ‡å®šcommondæ—¶ï¼Œä¼šè¿›å…¥<code>redis-cli</code>çš„äº¤äº’æ§åˆ¶å°ï¼š</p><p><img src="/20221103120000/image-20211211110439353.png" alt="redis-cli"></p><h2 id="2-2-å›¾å½¢åŒ–æ¡Œé¢å®¢æˆ·ç«¯"><a href="#2-2-å›¾å½¢åŒ–æ¡Œé¢å®¢æˆ·ç«¯" class="headerlink" title="2.2. å›¾å½¢åŒ–æ¡Œé¢å®¢æˆ·ç«¯"></a>2.2. å›¾å½¢åŒ–æ¡Œé¢å®¢æˆ·ç«¯</h2><p>GitHubä¸Šçš„å¤§ç¥ç¼–å†™äº†Redisçš„å›¾å½¢åŒ–æ¡Œé¢å®¢æˆ·ç«¯ï¼ŒğŸ‘‰<a href="https://github.com/uglide/RedisDesktopManager">é¡¹ç›®åœ°å€</a>ã€‚</p><p>ä¸è¿‡è¯¥ä»“åº“æä¾›çš„æ˜¯RedisDesktopManagerçš„æºç ï¼Œå¹¶æœªæä¾›windowså®‰è£…åŒ…ã€‚</p><p>ä¸è¿‡å¯ä»¥åœ¨ğŸ‘‰<a href="https://github.com/lework/RedisDesktopManager-Windows/releases">è¿™ä¸ªä»“åº“</a>å¯ä»¥æ‰¾åˆ°å®‰è£…åŒ…ã€‚</p><p><img src="/20221103120000/image-20211211111351885.png" alt="Redisçš„å›¾å½¢åŒ–æ¡Œé¢å®¢æˆ·ç«¯ä¸‹è½½"></p><h3 id="2-2-1-å®‰è£…"><a href="#2-2-1-å®‰è£…" class="headerlink" title="2.2.1. å®‰è£…"></a>2.2.1. å®‰è£…</h3><p>ä¸‹è½½Redisçš„å›¾å½¢åŒ–æ¡Œé¢å®¢æˆ·ç«¯åï¼Œè§£å‹ç¼©ï¼Œè¿è¡Œå®‰è£…ç¨‹åºå³å¯å®‰è£…ï¼š</p><p><img src="/20221103120000/image-20211214154938770.png" alt="Redisçš„å›¾å½¢åŒ–æ¡Œé¢å®¢æˆ·ç«¯å‹ç¼©åŒ…"></p><p><img src="/20221103120000/image-20211214155123841.png" alt="å®¢æˆ·ç«¯å®‰è£…ç¨‹åº"></p><p>å®‰è£…å®Œæˆåï¼Œåœ¨å®‰è£…ç›®å½•ä¸‹æ‰¾åˆ°rdm.exeæ–‡ä»¶ï¼š</p><p><img src="/20221103120000/image-20211211110935819.png" alt="å®¢æˆ·ç«¯å¯åŠ¨ç¨‹åº"></p><p>åŒå‡»å³å¯è¿è¡Œï¼š</p><p><img src="/20221103120000/image-20211214155406692.png" alt="RDM-GUI"></p><h3 id="2-2-2-å»ºç«‹è¿æ¥"><a href="#2-2-2-å»ºç«‹è¿æ¥" class="headerlink" title="2.2.2. å»ºç«‹è¿æ¥"></a>2.2.2. å»ºç«‹è¿æ¥</h3><p>ç‚¹å‡»å·¦ä¸Šè§’çš„<code>è¿æ¥åˆ°RedisæœåŠ¡å™¨</code>æŒ‰é’®ï¼š</p><p><img src="/20221103120000/image-20211214155424842.png" alt="è¿æ¥redis"></p><p>åœ¨å¼¹å‡ºçš„çª—å£ä¸­å¡«å†™RedisæœåŠ¡ä¿¡æ¯ï¼š</p><p><img src="/20221103120000/image-20211211111614483.png" alt="è¿æ¥redis"></p><p>ç‚¹å‡»æµ‹è¯•è¿æ¥ï¼Œå¦‚æœæ— æ³•è¿æ¥ï¼Œéœ€è¦æ£€æŸ¥ï¼š</p><ul><li><p>redisçš„ipé…ç½®æ˜¯å¦æœ‰é™åˆ¶ï¼Œå³ï¼š<code>redis.conf</code> æ–‡ä»¶ä¸­çš„ <code>bind</code> é…ç½®ã€‚</p></li><li><p>è®¿é—®çš„è™šæ‹Ÿæœºipæ˜¯å¦æ­£ç¡®ï¼ˆå¦‚æœå‰é¢æ˜¯ç”¨è¿œç¨‹è¿æ¥å·¥å…·æ“ä½œçš„ï¼Œå¯ä»¥æ’é™¤è¯¥é¡¹ï¼‰</p></li><li><p>å¯èƒ½æ˜¯Linuxçš„é˜²ç«å¢™é™åˆ¶ï¼ˆæ–°å®‰è£…çš„ä¸€èˆ¬æ˜¯è¿™ä¸ªé—®é¢˜ï¼‰ï¼Œè¯·å‚è€ƒä»¥ä¸‹æ–¹å¼ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æ‰“å¼€é˜²ç«å¢™6379ç«¯å£å·</span><br>firewall-cmd --zone=public --permanent --add-port=6379/tcp<br><span class="hljs-meta prompt_"># </span><span class="language-bash">é˜²ç«å¢™é‡æ–°è½½å…¥</span><br>firewall-cmd --reload<br></code></pre></td></tr></table></figure></li></ul><p>ç‚¹å‡»ç¡®å®šåï¼Œåœ¨å·¦ä¾§èœå•ä¼šå‡ºç°è¿™ä¸ªé“¾æ¥ï¼š</p><p><img src="/20221103120000/image-20211214155804523.png" alt="è¿æ¥redis"></p><p>ç‚¹å‡»å³å¯å»ºç«‹è¿æ¥äº†ï¼š</p><p><img src="/20221103120000/image-20211214155849495.png" alt="è¿æ¥redis"></p><p>Redisé»˜è®¤æœ‰16ä¸ªä»“åº“ï¼Œç¼–å·ä»0è‡³15.  é€šè¿‡é…ç½®æ–‡ä»¶å¯ä»¥è®¾ç½®ä»“åº“æ•°é‡ï¼Œä½†æ˜¯ä¸è¶…è¿‡16ï¼Œå¹¶ä¸”ä¸èƒ½è‡ªå®šä¹‰ä»“åº“åç§°ã€‚</p><p>å¦‚æœæ˜¯åŸºäºredis-cliè¿æ¥RedisæœåŠ¡ï¼Œå¯ä»¥é€šè¿‡selectå‘½ä»¤æ¥é€‰æ‹©æ•°æ®åº“ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-comment"># é€‰æ‹© 0å·åº“</span><br>select 0<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Redis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Redis</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è™šæ‹Ÿæœºä¸­CentOS 7å¦‚ä½•å›ºå®šIPåœ°å€ä»¥åŠæ— æ³•è®¿é—®å¤–ç½‘é—®é¢˜</title>
    <link href="/20221102120000/"/>
    <url>/20221102120000/</url>
    
    <content type="html"><![CDATA[<h1 id="è™šæ‹Ÿæœºä¸­CentOS-7å¦‚ä½•å›ºå®šIPåœ°å€ä»¥åŠæ— æ³•è®¿é—®å¤–ç½‘é—®é¢˜"><a href="#è™šæ‹Ÿæœºä¸­CentOS-7å¦‚ä½•å›ºå®šIPåœ°å€ä»¥åŠæ— æ³•è®¿é—®å¤–ç½‘é—®é¢˜" class="headerlink" title="è™šæ‹Ÿæœºä¸­CentOS 7å¦‚ä½•å›ºå®šIPåœ°å€ä»¥åŠæ— æ³•è®¿é—®å¤–ç½‘é—®é¢˜"></a>è™šæ‹Ÿæœºä¸­CentOS 7å¦‚ä½•å›ºå®šIPåœ°å€ä»¥åŠæ— æ³•è®¿é—®å¤–ç½‘é—®é¢˜</h1><blockquote><p>æœ¬æ–‡ä¸»è¦ä»‹ç»ï¼š</p><p>åœ¨è™šæ‹Ÿæœºä¸­çš„CentOS 7å¦‚ä½•é…ç½®å›ºå®šIPåœ°å€ï¼ˆåŠ¨æ€ipæœ‰æ—¶å€™ä¼šæ¯”è¾ƒéº»çƒ¦ï¼‰ï¼Œ</p><p>ä»¥åŠ å‡ºç° ç™¾åº¦pingä¸é€šæ—¶é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">æµ‹è¯•å¤–ç½‘ç½‘ç»œè¿æ¥æƒ…å†µ</span><br>ping www.baidu.com<br></code></pre></td></tr></table></figure><p>å¦‚æœå‡ºç°<code>ping: www.baidu.com: Name or service not known </code> æˆ–è€… <code>ping: www.baidu.com: æœªçŸ¥çš„åç§°æˆ–æœåŠ¡</code> çš„æŠ¥é”™ï¼Œéœ€è¦ä¿®æ”¹ä¸€ä¸‹ç½‘ç»œé…ç½®ï¼š</p><p><em>ï¼ˆè¯´æ˜ï¼šè®¾ç½®å›ºå®šIPä¹Ÿæ˜¯åŒæ ·çš„æ–¹æ¡ˆï¼‰</em></p><h2 id="1-ä¿®æ”¹windowsçš„è™šæ‹Ÿæœºç½‘ç»œé…ç½®"><a href="#1-ä¿®æ”¹windowsçš„è™šæ‹Ÿæœºç½‘ç»œé…ç½®" class="headerlink" title="1. ä¿®æ”¹windowsçš„è™šæ‹Ÿæœºç½‘ç»œé…ç½®"></a>1. ä¿®æ”¹windowsçš„è™šæ‹Ÿæœºç½‘ç»œé…ç½®</h2><p>æ‰¾åˆ° <em><strong>æ§åˆ¶é¢æ¿ - ç½‘ç»œå’ŒInternet - ç½‘ç»œé“¾æ¥</strong></em> ä¸­çš„ <em><strong>VMnet8</strong></em>ï¼Œå³é”®æŸ¥çœ‹å±æ€§ï¼Œé€‰æ‹©<em><strong>IPv4</strong></em>åŒå‡»æŸ¥çœ‹ï¼Œä¿®æ”¹ä¸ºé™æ€çš„ã€‚</p><p>è¦æ³¨æ„çš„æ˜¯ï¼šè¿™è¾¹çš„IPåœ°å€éœ€è¦è·Ÿè™šæ‹Ÿæœºä¸­é…ç½®çš„ç½‘å…³åœ¨åŒä¸€ç½‘æ®µã€‚</p><p><img src="/20221102120000/image-20221202171537537.png" alt="windowsä¸‹çš„è™šæ‹Ÿæœºçš„ç½‘ç»œé…ç½®1"></p><p><img src="/20221102120000/image-20221202171637623.png" alt="windowsä¸‹çš„è™šæ‹Ÿæœºçš„ç½‘ç»œé…ç½®2"><img src="/20221102120000/image-20221202171745167.png" alt="windowsä¸‹çš„è™šæ‹Ÿæœºçš„ç½‘ç»œé…ç½®3"></p><p>é€šè¿‡ <em><strong>cmd</strong></em> å‘½ä»¤æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°VMnet8çš„é…ç½®æƒ…å†µï¼š</p><p><img src="/20221102120000/image-20221202174810342.png" alt="windowsä¸‹çš„è™šæ‹Ÿæœºçš„ç½‘ç»œé…ç½®4"></p><h2 id="2-ä¿®æ”¹ä¸€ä¸‹è™šæ‹Ÿæœºç½‘ç»œé…ç½®"><a href="#2-ä¿®æ”¹ä¸€ä¸‹è™šæ‹Ÿæœºç½‘ç»œé…ç½®" class="headerlink" title="2. ä¿®æ”¹ä¸€ä¸‹è™šæ‹Ÿæœºç½‘ç»œé…ç½®"></a>2. ä¿®æ”¹ä¸€ä¸‹è™šæ‹Ÿæœºç½‘ç»œé…ç½®</h2><p>é€‰æ‹©èœå•ï¼š<em><strong>ç¼–è¾‘ - è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨</strong></em></p><p><img src="/20221102120000/image-20221202170729796.png" alt="è™šæ‹Ÿæœºç½‘ç»œé…ç½®"></p><p><img src="/20221102120000/image-20221202170600947.png" alt="è™šæ‹Ÿæœºç½‘ç»œé…ç½®(è®°ä½4çš„å­ç½‘æ©ç å’Œç½‘å…³é…ç½®)"></p><h2 id="3-ä¿®æ”¹CentOSçš„ç½‘ç»œé…ç½®"><a href="#3-ä¿®æ”¹CentOSçš„ç½‘ç»œé…ç½®" class="headerlink" title="3. ä¿®æ”¹CentOSçš„ç½‘ç»œé…ç½®"></a>3. ä¿®æ”¹CentOSçš„ç½‘ç»œé…ç½®</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹CentOSçš„ç½‘ç»œé…ç½®ï¼ˆå¦‚æœæ–‡ä»¶å†…å®¹ä¸ºç©ºè¯·æ£€æŸ¥æ˜¯å¦å­˜åœ¨è¯¥æ–‡ä»¶ï¼‰</span><br>vi /etc/sysconfig/network-scripts/ifcfg-ens33<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä¿®æ”¹å†…å®¹</span><br>IPADDR=192.168.200.123 #centOSçš„ipåœ°å€<br>NETMASK=255.255.255.0 #è™šæ‹Ÿæœºä¸­é…ç½®çš„å­ç½‘æ©ç <br>GATEWAY=192.168.200.2 #è™šæ‹Ÿæœºä¸­é…ç½®çš„ç½‘å…³<br></code></pre></td></tr></table></figure><p><img src="/20221102120000/image-20221202171259344.png" alt="CentOS 7ç½‘ç»œé…ç½®"></p><p>ä¿®æ”¹åé‡å¯ç½‘ç»œæœåŠ¡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">é‡å¯ç½‘ç»œæœåŠ¡</span><br>service network restart<br></code></pre></td></tr></table></figure><p>å†æµ‹è¯•æ˜¯å¦èƒ½pingé€šç™¾åº¦æœåŠ¡å™¨ï¼Œåº”è¯¥æ˜¯å¯ä»¥äº†çš„ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>é—®é¢˜è®°å½•</category>
      
      <category>è™šæ‹Ÿæœº</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CentOS</tag>
      
      <tag>Linux</tag>
      
      <tag>è™šæ‹Ÿæœº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>IDEAæ¿€æ´»</title>
    <link href="/20221101120001/"/>
    <url>/20221101120001/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æ³¨ï¼šæœ‰èƒ½åŠ›è¯·æ”¯æŒæ­£ç‰ˆã€‚</p></blockquote><h1 id="æ ¹æ®å¯¹åº”ç‰ˆæœ¬è¿›è¡Œæ¿€æ´»"><a href="#æ ¹æ®å¯¹åº”ç‰ˆæœ¬è¿›è¡Œæ¿€æ´»" class="headerlink" title="æ ¹æ®å¯¹åº”ç‰ˆæœ¬è¿›è¡Œæ¿€æ´»"></a>æ ¹æ®å¯¹åº”ç‰ˆæœ¬è¿›è¡Œæ¿€æ´»</h1><h2 id="2021-1"><a href="#2021-1" class="headerlink" title="2021.1"></a>2021.1</h2><p>é€šè¿‡å¼€å‘è€…zhile.ioçš„æ’ä»¶*** eval-reset*** æ— é™é‡ç½®è¯•ç”¨æ—¶é—´çš„æ–¹å¼æ¿€æ´»ã€‚</p><h2 id="2019-04"><a href="#2019-04" class="headerlink" title="2019.04"></a>2019.04</h2><p>é€šç”¨ Activation codeï¼šï¼ˆåˆ°2089å¹´ï¼‰</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-number">3</span>AGXEJXFK9-eyJsaWNlbnNlSWQiOiIzQUdYRUpYRks5IiwibGljZW5zZWVOYW1lIjoiaHR0cHM6Ly96aGlsZS5pbyIsImFzc2lnbmVlTmFtZSI6IiIsImFzc2lnbmVlRW1haWwiOiIiLCJsaWNlbnNlUmVzdHJpY3Rpb24iOiIiLCJjaGVja0NvbmN1cnJlbnRVc2UiOmZhbHNlLCJwcm9kdWN0cyI6W3siY29kZSI6IklJIiwiZmFsbGJhY2tEYXRlIjoiMjA4OS0wNy0wNyIsInBhaWRVcFRvIjoiMjA4OS0wNy0wNyJ9LHsiY29kZSI6IkFDIiwiZmFsbGJhY2tEYXRlIjoiMjA4OS0wNy0wNyIsInBhaWRVcFRvIjoiMjA4OS0wNy0wNyJ9LHsiY29kZSI6IkRQTiIsImZhbGxiYWNrRGF0ZSI6IjIwODktMDctMDciLCJwYWlkVXBUbyI6IjIwODktMDctMDcifSx7ImNvZGUiOiJQUyIsImZhbGxiYWNrRGF0ZSI6IjIwODktMDctMDciLCJwYWlkVXBUbyI6IjIwODktMDctMDcifSx7ImNvZGUiOiJHTyIsImZhbGxiYWNrRGF0ZSI6IjIwODktMDctMDciLCJwYWlkVXBUbyI6IjIwODktMDctMDcifSx7ImNvZGUiOiJETSIsImZhbGxiYWNrRGF0ZSI6IjIwODktMDctMDciLCJwYWlkVXBUbyI6IjIwODktMDctMDcifSx7ImNvZGUiOiJDTCIsImZhbGxiYWNrRGF0ZSI6IjIwODktMDctMDciLCJwYWlkVXBUbyI6IjIwODktMDctMDcifSx7ImNvZGUiOiJSUzAiLCJmYWxsYmFja0RhdGUiOiIyMDg5LTA3LTA3IiwicGFpZFVwVG8iOiIyMDg5LTA3LTA3In0seyJjb2RlIjoiUkMiLCJmYWxsYmFja0RhdGUiOiIyMDg5LTA3LTA3IiwicGFpZFVwVG8iOiIyMDg5LTA3LTA3In0seyJjb2RlIjoiUkQiLCJmYWxsYmFja0RhdGUiOiIyMDg5LTA3LTA3IiwicGFpZFVwVG8iOiIyMDg5LTA3LTA3In0seyJjb2RlIjoiUEMiLCJmYWxsYmFja0RhdGUiOiIyMDg5LTA3LTA3IiwicGFpZFVwVG8iOiIyMDg5LTA3LTA3In0seyJjb2RlIjoiUk0iLCJmYWxsYmFja0RhdGUiOiIyMDg5LTA3LTA3IiwicGFpZFVwVG8iOiIyMDg5LTA3LTA3In0seyJjb2RlIjoiV1MiLCJmYWxsYmFja0RhdGUiOiIyMDg5LTA3LTA3IiwicGFpZFVwVG8iOiIyMDg5LTA3LTA3In0seyJjb2RlIjoiREIiLCJmYWxsYmFja0RhdGUiOiIyMDg5LTA3LTA3IiwicGFpZFVwVG8iOiIyMDg5LTA3LTA3In0seyJjb2RlIjoiREMiLCJmYWxsYmFja0RhdGUiOiIyMDg5LTA3LTA3IiwicGFpZFVwVG8iOiIyMDg5LTA3LTA3In0seyJjb2RlIjoiUlNVIiwiZmFsbGJhY2tEYXRlIjoiMjA4OS0wNy0wNyIsInBhaWRVcFRvIjoiMjA4OS0wNy0wNyJ9XSwiaGFzaCI6IjEyNzk2ODc3LzAiLCJncmFjZVBlcmlvZERheXMiOjcsImF1dG9Qcm9sb25nYXRlZCI6ZmFsc2UsImlzQXV0b1Byb2xvbmdhdGVkIjpmYWxzZX0=-WGTHs6XpDhr+uumvbwQPOdlxWnQwgnGaL4eRnlpGKApEEkJyYvNEuPWBSrQkPmVpim<span class="hljs-regexp">/8Sab6HV04Dw3IzkJT0yTc29sPEXBf69+7y6Jv718FaJu4MWfsAk/</span>ZGtNIUOczUQ0iGKKnSSsfQ<span class="hljs-regexp">/3UoMv0q/y</span>Jcfvj+me5Zd<span class="hljs-regexp">/gfaisCCMUaGjB/</span>lWIPpEPzblDtVJbRexB1MALrLCEoDv3ujcPAZ7xWb54DiZwjYhQvQ+CvpNNF2jeTku7lbm5v+BoDsdeRq7YBt9ANLUKPr2DahcaZ4gctpHZXhG96IyKx232jYq9jQrFDbQMtVr3E+GsCekMEWSD<span class="hljs-regexp">//</span>dLT+HuZdc1sAIYrw-MIIElTCCAn2gAwIBAgIBCTANBgkqhkiG9w0BAQsFADAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBMB4XDTE4MTEwMTEyMjk0NloXDTIwMTEwMjEyMjk0NlowaDELMAkGA1UEBhMCQ1oxDjAMBgNVBAgMBU51c2xlMQ8wDQYDVQQHDAZQcmFndWUxGTAXBgNVBAoMEEpldEJyYWlucyBzLnIuby4xHTAbBgNVBAMMFHByb2QzeS1mcm9tLTIwMTgxMTAxMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5ndaik1GD0nyTdqkZgURQZGW+RGxCdBITPXIwpjhhaD0SXGa4XSZBEBoiPdY6XV6pOfUJeyfi9dXsY4MmT0D+sKoST3rSw96xaf9FXPvOjn4prMTdj3Ji3CyQrGWeQU2nzYqFrp1QYNLAbaViHRKuJrYHI6GCvqCbJe0LQ8qqUiVMA9wG<span class="hljs-regexp">/PQwScpNmTF9Kp2Iej+Z5OUxF33zzm+vg/</span>nYV31HLF7fJUAplI<span class="hljs-regexp">/1nM+ZG8K+AXWgYKChtknl3sW9PCQa3a3imPL9GVToUNxc0wcuTil8mqveWcSQCHYxsIaUajWLpFzoO2AhK4mfYBSStAqEjoXRTuj17mo8Q6M2SHOcwIDAQABo4GZMIGWMAkGA1UdEwQCMAAwHQYDVR0OBBYEFGEpG9oZGcfLMGNBkY7SgHiMGgTcMEgGA1UdIwRBMD+AFKOetkhnQhI2Qb1t4Lm0oFKLl/</span>GzoRykGjAYMRYwFAYDVQQDDA1KZXRQcm9maWxlIENBggkA0myxg7KDeeEwEwYDVR0lBAwwCgYIKwYBBQUHAwEwCwYDVR0PBAQDAgWgMA0GCSqGSIb3DQEBCwUAA4ICAQBonMu8oa3vmNAa4RQP8gPGlX3SQaA3WCRUAj6Zrlk8AesKV1YSkh5D2l+yUk6njysgzfr1bIR5xF8eup5xXc4<span class="hljs-regexp">/G7NtVYRSMvrd6rfQcHOyK5UFJLm+8utmyMIDrZOzLQuTsT8NxFpbCVCfV5wNRu4rChrCuArYVGaKbmp9ymkw1PU6+HoO5i2wU3ikTmRv8IRjrlSStyNzXpnPTwt7bja19ousk56r40SmlmC04GdDHErr0ei2UbjUua5kw71Qn9g02tL9fERI2sSRjQrvPbn9INwRWl5+k05mlKekbtbu2ev2woJFZK4WEXAd/</span>GaAdeZZdumv8T2idDFL7cAirJwcrbfpawPeXr52oKTPnXfi0l5+g9Gnt<span class="hljs-regexp">/wfiXCrPElX6ycTR6iL3GC2VR4jTz6YatT4Ntz59/</span>THOT7NJQhr6AyLkhhJCdkzE2cob<span class="hljs-regexp">/KouVp4ivV7Q3Fc6HX7eepHAAF/</span>DpxwgOrg9smX6coXLgfp0b1RU2u<span class="hljs-regexp">/tUNID04rpNxTMueTtrT8WSskqvaJd3RH8r7cnRj6Y2hltkja82HlpDURDxDTRvv+krbwMr26SB/</span><span class="hljs-number">40</span>BjpMUrDRCeKuiBahC0DCoU<span class="hljs-regexp">/4+ze1l94wVUhdkCfL0GpJrMSCDEK+XEurU18Hb7WT+ThXbkdl6VpFdHsRvqAnhR2g4b+Qzgidmuky5NUZVfEaZqV/g</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>IDEA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>IDEA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>IDEAåˆå§‹åŒ–è®¾ç½®</title>
    <link href="/20221101120000/"/>
    <url>/20221101120000/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æ–‡ç« ä¸»è¦æ˜¯ä»‹ç»ä¸€äº›ä¸ªäººå¸¸ç”¨çš„ideaè®¾ç½®ï¼Œç”¨äºåç»­åˆå§‹åŒ–ideaåè¿›è¡Œä¸€äº›å¸¸è§„è®¾ç½®ã€‚</p><p>è¯´æ˜ï¼šæ–‡ç« ä¸­ä½¿ç”¨çš„ideaç‰ˆæœ¬ä¸ºï¼š<code>2021.3.3</code></p></blockquote><h1 id="1-å…¨å±€è®¾ç½®"><a href="#1-å…¨å±€è®¾ç½®" class="headerlink" title="1. å…¨å±€è®¾ç½®"></a>1. å…¨å±€è®¾ç½®</h1><p>å…¨å±€è®¾ç½®æ‰“å¼€æ–¹å¼ï¼šå¯åŠ¨é¡µ-Customize-All settingsâ€¦</p><p>ï¼ˆå¦‚æœæ˜¯æ‰“å¼€é¡¹ç›®åå†è¿›è¡Œè®¾ç½®çš„è¯æ˜¯ä»…å¯¹é¡¹ç›®æœ‰æ•ˆï¼‰</p><p><img src="/20221101120000/image-20221209111557607.png" alt="å…¨å±€è®¾ç½®"></p><h2 id="ç¼–ç è®¾ç½®"><a href="#ç¼–ç è®¾ç½®" class="headerlink" title="ç¼–ç è®¾ç½®"></a>ç¼–ç è®¾ç½®</h2><p>Editor&gt;File encoding</p><p><img src="/20221101120000/image-20221209110958561.png" alt="ç¼–ç è®¾ç½®"></p><h2 id="è‡ªåŠ¨å¯¼åŒ…è®¾ç½®"><a href="#è‡ªåŠ¨å¯¼åŒ…è®¾ç½®" class="headerlink" title="è‡ªåŠ¨å¯¼åŒ…è®¾ç½®"></a>è‡ªåŠ¨å¯¼åŒ…è®¾ç½®</h2><p>Editor&gt;Auto import</p><p><img src="/20221101120000/image-20221209111818715.png" alt="è‡ªåŠ¨å¯¼åŒ…è®¾ç½®"></p><h2 id="é¡¹ç›®æ–‡ä»¶çª—å£ä¸æ˜¾ç¤º-idea-å’Œ-iml-æ–‡ä»¶"><a href="#é¡¹ç›®æ–‡ä»¶çª—å£ä¸æ˜¾ç¤º-idea-å’Œ-iml-æ–‡ä»¶" class="headerlink" title="é¡¹ç›®æ–‡ä»¶çª—å£ä¸æ˜¾ç¤º .idea å’Œ *.iml æ–‡ä»¶"></a>é¡¹ç›®æ–‡ä»¶çª—å£ä¸æ˜¾ç¤º .idea å’Œ *.iml æ–‡ä»¶</h2><p>Editor&gt;File typesï¼Œåœ¨tabä¸­é€‰æ‹© <code>ignored files and folders</code></p><p><img src="/20221101120000/image-20221209112202384.png" alt="é¡¹ç›®æ–‡ä»¶çª—å£ä¸æ˜¾ç¤º .idea å’Œ *.iml æ–‡ä»¶"></p><h2 id="Maven-è®¾ç½®"><a href="#Maven-è®¾ç½®" class="headerlink" title="Maven è®¾ç½®"></a>Maven è®¾ç½®</h2><p><img src="/20221101120000/image-20221209112516304.png" alt="Maven è®¾ç½®"></p><h2 id="è‡ªåŠ¨ç¼–è¯‘"><a href="#è‡ªåŠ¨ç¼–è¯‘" class="headerlink" title="è‡ªåŠ¨ç¼–è¯‘"></a>è‡ªåŠ¨ç¼–è¯‘</h2><p><img src="/20221101120000/image-20221209112600157.png" alt="è‡ªåŠ¨ç¼–è¯‘"></p><h2 id="å¿½ç•¥å¤§å°å†™ï¼Œè¿›è¡Œæç¤º"><a href="#å¿½ç•¥å¤§å°å†™ï¼Œè¿›è¡Œæç¤º" class="headerlink" title="å¿½ç•¥å¤§å°å†™ï¼Œè¿›è¡Œæç¤º"></a>å¿½ç•¥å¤§å°å†™ï¼Œè¿›è¡Œæç¤º</h2><p>Editor&gt;General&gt;Code completion</p><p><img src="/20221101120000/image-20221209112724902.png" alt="å¿½ç•¥å¤§å°å†™ï¼Œè¿›è¡Œæç¤º"></p><h2 id="é¼ æ ‡æ§åˆ¶ç¼–è¾‘åŒºå­—ä½“å¤§å°"><a href="#é¼ æ ‡æ§åˆ¶ç¼–è¾‘åŒºå­—ä½“å¤§å°" class="headerlink" title="é¼ æ ‡æ§åˆ¶ç¼–è¾‘åŒºå­—ä½“å¤§å°"></a>é¼ æ ‡æ§åˆ¶ç¼–è¾‘åŒºå­—ä½“å¤§å°</h2><p>Editor&gt;Generalï¼ŒMouse Control</p><p><img src="/20221101120000/image-20221209113038919.png" alt="é¼ æ ‡æ§åˆ¶ç¼–è¾‘åŒºå­—ä½“å¤§å°"></p><h1 id="2-éå…¨å±€è®¾ç½®ï¼ˆé¡¹ç›®è®¾ç½®ï¼‰"><a href="#2-éå…¨å±€è®¾ç½®ï¼ˆé¡¹ç›®è®¾ç½®ï¼‰" class="headerlink" title="2. éå…¨å±€è®¾ç½®ï¼ˆé¡¹ç›®è®¾ç½®ï¼‰"></a>2. éå…¨å±€è®¾ç½®ï¼ˆé¡¹ç›®è®¾ç½®ï¼‰</h1><p>åœ¨é¡¹ç›®çª—å£ï¼ŒFile&gt;Settingsâ€¦</p><p><img src="/20221101120000/image-20221209113546160.png" alt="éå…¨å±€è®¾ç½®"></p><h1 id="3-å¸¸ç”¨æ’ä»¶"><a href="#3-å¸¸ç”¨æ’ä»¶" class="headerlink" title="3. å¸¸ç”¨æ’ä»¶"></a>3. å¸¸ç”¨æ’ä»¶</h1><ul><li><p>ide-eval-resetï¼Œå•†åº—æ— æ³•æœç´¢åˆ°ï¼Œå¯é€šè¿‡è®¾ç½®æ’ä»¶åº“åœ°å€ä¸º <a href="https://plugins.zhile.io/">https://plugins.zhile.io</a> è·å–ã€‚</p><p>æ³¨æ„ï¼š<em><strong>2021.3ä»¥åŠä¹‹å</strong></em> çš„ideaç‰ˆæœ¬å·²æ— æ³•ä½¿ç”¨ã€‚</p></li><li><p>MyBatis Logï¼Œå¯ä»¥å®Œæ•´è¾“å‡ºå¸¦å‚æ•°çš„sqlè¯­å¥ï¼Œç»“åˆide-eval-resetæ’ä»¶å¯ä»¥ä¸€ç›´è¯•ç”¨ã€‚</p></li><li><p>MyBatisCodeHelperPro (Marketplace Edition)ï¼Œç»“åˆide-eval-resetæ’ä»¶å¯ä»¥ä¸€ç›´è¯•ç”¨ã€‚</p></li><li><p>Alibaba Java Coding Guidelinesï¼Œé˜¿é‡Œå·´å·´ä»£ç æ£€æŸ¥å·¥å…·ã€‚</p></li><li><p>CamelCaseï¼Œä»£ç é©¼å³°è½¬æ¢å·¥å…·ã€‚</p></li><li><p>HighlightBracketPairï¼Œç”¨ä¸åŒé¢œè‰²æ ‡è®°å‰åæ‹¬å·ã€å¼•å·ç­‰æˆå¯¹ç¬¦å·ã€‚</p></li><li><p>Key Promoter Xï¼Œå¿«æ·é”®æç¤ºå·¥å…·ã€‚</p></li><li><p>Maven Helperï¼Œå¯ä»¥æŸ¥çœ‹mavenä¾èµ–ã€‚</p></li><li><p>Translationï¼Œç¿»è¯‘æ’ä»¶ã€‚</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>IDEA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>IDEAè®¾ç½®</tag>
      
      <tag>IDEA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åšå®¢ç½‘ç«™æ­å»ºï¼ˆHexo+Github Pageï¼‰</title>
    <link href="/20220101010101/"/>
    <url>/20220101010101/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æ–‡ç« ä¸»è¦ä»‹ç»å¦‚ä½•é€šè¿‡ Hexo å’Œ Github Page æ¥æ­å»ºåšå®¢ç½‘ç«™ã€‚</p></blockquote><h2 id="1-å®‰è£…NodeJS"><a href="#1-å®‰è£…NodeJS" class="headerlink" title="1. å®‰è£…NodeJS"></a>1. å®‰è£…NodeJS</h2><ul><li><p>ç”±äºHexoæ˜¯åŸºäºNode.jsé©±åŠ¨çš„ä¸€æ¬¾åšå®¢æ¡†æ¶ï¼Œæ‰€ä»¥éœ€è¦å®‰è£…NodeJSï¼Œ<a href="https://nodejs.org/zh-cn/">å®˜ç½‘ä¸‹è½½åœ°å€</a>ã€‚</p><p>å¦‚æœä¸‹è½½ä¸‹è½½è¾ƒæ…¢ï¼Œå¯ä»¥å°è¯•<a href="http://nodejs.cn/download/current/">è¿™ä¸ªé“¾æ¥</a>ã€‚</p></li><li><p>å®‰è£…å®Œæ‰§è¡Œå‘½ä»¤ <code>node -v</code> å’Œ <code>npm -v</code> æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸï¼ˆå‡ºç°ç‰ˆæœ¬å·å³ä¸ºå®‰è£…æˆåŠŸï¼‰ã€‚</p></li></ul><p><img src="/20220101010101/image-20221119000442361.png" alt="æŸ¥çœ‹NodeJSç‰ˆæœ¬ä¿¡æ¯"></p><h2 id="2-å®‰è£…Git"><a href="#2-å®‰è£…Git" class="headerlink" title="2. å®‰è£…Git"></a>2. å®‰è£…Git</h2><ul><li><p>ä¸‹è½½gitï¼Œ<a href="https://git-scm.com/">Gitä¸‹è½½åœ°å€</a>ã€‚</p></li><li><p>æ³¨å†Œgithubè´¦å·ã€‚</p></li><li><p>Gité…ç½®ï¼Œæ‰“å¼€git bashï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">å…¨å±€é…ç½®ç”¨æˆ·ä¿¡æ¯ï¼šç”¨æˆ·åå’Œé‚®ç®±ã€‚å°†ä¼šä¸ºgitæäº¤æ—¶çš„é»˜è®¤çš„ç”¨æˆ·ä¿¡æ¯ã€‚å¦‚æœä¸éœ€è¦å¯ä»¥æš‚æ—¶ä¸é…ç½®ã€‚</span><br>git config --global user.name &quot;åç§°&quot;<br>git config --global user.email &quot;githubé‚®ç®±&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹é…ç½®åˆ—è¡¨</span><br>git config --list<br></code></pre></td></tr></table></figure></li><li><p>å®‰è£…å®Œæ‰§è¡Œå‘½ä»¤ <code>git --version</code> ç¡®è®¤gitå®‰è£…æ˜¯å¦æˆåŠŸï¼ˆå‡ºç°ç‰ˆæœ¬å·å³ä¸ºå®‰è£…æˆåŠŸï¼‰ã€‚</p></li></ul><p><img src="/20220101010101/image-20221119001545371.png" alt="æŸ¥çœ‹Gitç‰ˆæœ¬ä¿¡æ¯"></p><h2 id="3-å®‰è£…Hexo"><a href="#3-å®‰è£…Hexo" class="headerlink" title="3. å®‰è£…Hexo"></a>3. å®‰è£…Hexo</h2><ul><li><p>ä»¥ä¸Šç¯å¢ƒå‡†å¤‡å¥½äº†ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨ npm å¼€å§‹å®‰è£… Hexo äº†ï¼Œåœ¨å‘½ä»¤è¡Œè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install -g hexo-cli<br></code></pre></td></tr></table></figure><p><img src="/20220101010101/image-20221119001332746.png" alt="å®‰è£…hexo-cli"></p></li><li><p>Hexoå®‰è£…å®Œæˆåï¼Œé€‰æ‹©ä¸€ä¸ªéœ€è¦æ”¾ç½®åšå®¢æ–‡ä»¶çš„æ–‡ä»¶å¤¹ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©Dç›˜çš„docæ–‡ä»¶å¤¹ï¼Œè¿›å…¥æ–‡ä»¶å¤¹ä¸­ï¼Œå³é”®åé€‰æ‹©â€œGit Bash Hereâ€æ‰“å¼€å‘½ä»¤è¡Œç»ˆç«¯ã€‚</p><p><img src="/20220101010101/image-20221119004605442.png" alt="image-20221119004605442"></p></li><li><p>è¾“å…¥å‘½ä»¤ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º <em>MyBlog</em> çš„æ–‡ä»¶å¤¹å¹¶åˆå§‹åŒ–ç›¸å…³ä¿¡æ¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo init MyBlog<br>cd MyBlog<br>npm install<br></code></pre></td></tr></table></figure></li><li><p>å¦‚æœä»¥ä¸Šå‘½ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­éƒ½æ²¡æœ‰æŠ¥é”™çš„è¯ï¼Œé‚£ä¹ˆå°±ç®—å®‰è£…æˆåŠŸäº†ï¼Œæ¥ç€è¿è¡Œ  <code>hexo s</code> å‘½ä»¤æ¥å¯åŠ¨é¡¹ç›®ï¼ˆå…¶ä¸­ s æ˜¯ server çš„ç¼©å†™ï¼Œæˆ‘è¿™é‡Œå°±è¾“å…¥å…¨æ‹¼ï¼‰ï¼Œå¯åŠ¨æˆåŠŸå°±èƒ½çœ‹åˆ°è®¿é—®çš„åœ°å€äº† <code>http://localhost:4000/</code> ï¼ˆæ³¨æ„ï¼šè¿™é‡Œä¸èƒ½é€šè¿‡ Ctrl+C æ¥å¤åˆ¶ï¼Œä»æç¤ºå¯ä»¥çœ‹å‡ºè¿™æ˜¯ç»ˆæ­¢æœåŠ¡çš„å¿«æ·é”®ï¼Œå¯ä»¥å³é”®Copyï¼‰</p><p><img src="/20220101010101/image-20221119005719242.png" alt="image-20221119005719242"></p><p><img src="/20220101010101/image-20221119010141249.png" alt="image-20221119010141249"></p></li></ul><h3 id="3-1-Hexo-ä¸»é¢˜ä¿®æ”¹ï¼ˆä»¥NexTä¸»é¢˜ä¸ºä¾‹ï¼‰"><a href="#3-1-Hexo-ä¸»é¢˜ä¿®æ”¹ï¼ˆä»¥NexTä¸»é¢˜ä¸ºä¾‹ï¼‰" class="headerlink" title="3.1 Hexo ä¸»é¢˜ä¿®æ”¹ï¼ˆä»¥NexTä¸»é¢˜ä¸ºä¾‹ï¼‰"></a>3.1 Hexo ä¸»é¢˜ä¿®æ”¹ï¼ˆä»¥NexTä¸»é¢˜ä¸ºä¾‹ï¼‰</h3><ul><li><p><a href="https://hexo.io/themes/">å®˜æ–¹ä¸»é¢˜é¡µ</a>ã€‚</p></li><li><p>è¿™é‡Œæˆ‘ä»¬ä»¥è¾ƒå¤šç”¨æˆ·ä½¿ç”¨çš„ <em>NexTä¸»é¢˜</em> é…ç½®ä¸ºä¾‹ï¼Œåœ¨ä¸»é¢˜é¡µæœç´¢ <em>next</em> ï¼Œé€‰æ‹© <em>NexT</em> ä¸»é¢˜ï¼Œå°±èƒ½è¿›å…¥ Github é¡µé¢ï¼Œå°±å¯ä»¥çœ‹åˆ°å…·ä½“çš„ä½¿ç”¨è¯´æ˜æ–‡æ¡£äº†ã€‚</p><p><img src="/20220101010101/image-20221119011310831.png" alt="ä¸»é¢˜æœç´¢"></p></li></ul><p><img src="/20220101010101/image-20221119011531221.png" alt="NexTä¸»é¢˜"></p><ul><li><p>è¿›å…¥å‰é¢åˆ›å»ºçš„ <em>MyBlog</em> æ–‡ä»¶å¤¹ï¼Œæ‰“å¼€ <em>git bash</em> å‘½ä»¤çª—å£ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…ä¸»é¢˜</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install hexo-theme-next<br></code></pre></td></tr></table></figure><p>æˆ–è€…ç›´æ¥å°†ä¸»é¢˜åŒ…å¤åˆ¶ä¸‹æ¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">git clone https://github.com/next-theme/hexo-theme-next themes/next<br></code></pre></td></tr></table></figure><p><em>ä¸¤ç§ä¸»é¢˜å®‰è£…æ–¹å¼ä»»é€‰ä¸€ç§å°±è¡Œï¼Œæˆ‘è¿™è¾¹é€‰æ‹©çš„æ˜¯ç¬¬äºŒç§ï¼Œç¬¬äºŒæ¡å‘½ä»¤æ˜¯å°†ä¸»é¢˜åŒ…ç›´æ¥å¤åˆ¶åˆ°  <strong>MyBlog</strong> çš„ <strong>themes&#x2F;next</strong> æ–‡ä»¶ç›®å½•ä¸­ï¼ˆæ¯”è¾ƒé€šç”¨çš„ä¸€ç§ä¸»é¢˜å®‰è£…æ–¹å¼ï¼‰ã€‚Hexoä¸­ï¼Œthemeså°±æ˜¯å­˜æ”¾ä¸»é¢˜é…ç½®çš„ç›®å½•ã€‚</em></p><p><img src="/20220101010101/image-20221119013012747.png" alt="image-20221119013012747"></p></li><li><p>ä¸»é¢˜ä¸‹è½½æˆåŠŸåï¼Œæ‰“å¼€ <em>MyBlog</em> ç›®å½•ä¸‹çš„ <em><strong>_config.yml</strong></em> æ–‡ä»¶ï¼ˆå¯ä»¥ä½¿ç”¨è®°äº‹æœ¬æ‰“å¼€ï¼‰ï¼Œæ‰¾åˆ° <em><strong>theme</strong></em> é…ç½®ï¼Œä¿®æ”¹ä¸ºæ–°çš„ä¸»é¢˜åç§°ï¼Œä¸»é¢˜åç§°åŒ <em>themes</em> ä¸‹çš„æ–‡ä»¶å¤¹åã€‚</p><p><strong>æ³¨æ„ï¼Œè¿™è¾¹çš„ymlçš„é…ç½®ï¼Œæ‰€ä»¥å†’å·åé¢ä¸€å®šè¦è®°å¾—åŠ ç©ºæ ¼ã€‚</strong></p><p><img src="/20220101010101/image-20221121161352813.png" alt="image-20221121161352813"></p></li><li><p>ä¿®æ”¹ä¹‹ååœ¨ <em>git bash</em> å‘½ä»¤è¡Œä¸­æ‰§è¡Œ <code>hexo g</code> å‘½ä»¤ï¼ˆg æ˜¯ generate çš„ç¼©å†™ï¼‰ï¼Œç„¶åå†ä½¿ç”¨å‘½ä»¤ <code>hexo s</code> å¯åŠ¨ï¼Œå†è®¿é—® <code>http://localhost:4000/</code> å°±èƒ½çœ‹åˆ°æ–°çš„ä¸»é¢˜äº†ã€‚</p></li></ul><h3 id="3-2-Hexo-ä¸»é¢˜é…ç½®æ–‡ä»¶"><a href="#3-2-Hexo-ä¸»é¢˜é…ç½®æ–‡ä»¶" class="headerlink" title="3.2 Hexo ä¸»é¢˜é…ç½®æ–‡ä»¶"></a>3.2 Hexo ä¸»é¢˜é…ç½®æ–‡ä»¶</h3><ul><li><p>é€šè¿‡ä¿®æ”¹ Hexo ä¸»é¢˜æˆ‘ä»¬çŸ¥é“äº†ï¼Œåœ¨ <em><strong>themes</strong></em> æ–‡ä»¶ç›®å½•ä¸­çš„æ–‡ä»¶å¤¹å°±æ˜¯å¯¹åº”çš„ä¸»é¢˜ï¼Œæ‰€ä»¥å¦‚æœè¦ä¿®æ”¹ä¸»é¢˜çš„ä¸€äº›é…ç½®ï¼Œæˆ‘ä»¬å°±è¦ä¿®æ”¹<strong>ä¸»é¢˜çš„æ–‡ä»¶å¤¹ä¸­</strong>çš„ <em><strong>_config.yml</strong></em> æ–‡ä»¶ã€‚</p><p><img src="/20220101010101/image-20221119015827992.png" alt="image-20221119015827992"></p></li></ul><h2 id="4-å°†åšå®¢éƒ¨ç½²åˆ°Githubä¸Š"><a href="#4-å°†åšå®¢éƒ¨ç½²åˆ°Githubä¸Š" class="headerlink" title="4. å°†åšå®¢éƒ¨ç½²åˆ°Githubä¸Š"></a>4. å°†åšå®¢éƒ¨ç½²åˆ°Githubä¸Š</h2><ul><li><p>è¿›å…¥<a href="https://github.com/">Githubå®˜ç½‘</a>è¿›è¡Œè´¦å·æ³¨å†Œã€‚</p></li><li><p>è´¦å·æ³¨å†ŒæˆåŠŸåï¼Œå»ºç«‹ä¸€ä¸ªæ–°çš„ä»“åº“ï¼Œgithubä»…èƒ½ä½¿ç”¨ä¸€ä¸ªåŒåä»“åº“çš„ä»£ç ä½œä¸ºä¸€ä¸ªé™æ€ç«™ç‚¹ï¼Œæ‰€ä»¥ä»“åº“åä¸€å®šè¦æ˜¯ï¼š <code>ç”¨æˆ·å.github.io</code></p><p><img src="/20220101010101/image-20221121104502552.png" alt="image-20221121104502552"></p></li><li><p>é…ç½®SSH keyï¼Œè¦ä½¿ç”¨gitå·¥å…·éœ€è¦å…ˆé…ç½®ä¸€ä¸‹SSH keyï¼Œä¸ºéƒ¨ç½²æœ¬åœ°åšå®¢åˆ°Githubåšå‡†å¤‡ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">éå…¨å±€é…ç½®ï¼Œä»…å½“å‰é¡¹ç›®ç”Ÿæ•ˆ</span><br>git config user.name &quot;ç”¨æˆ·å&quot;<br>git config user.email &quot;é‚®ç®±åœ°å€&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">ç”Ÿæˆssh keyï¼Œè¿™ä¸ªå¿…é¡»æ˜¯githubçš„æ³¨å†Œé‚®ç®±</span><br>ssh-keygen -t rsa -C &quot;gitæ³¨å†Œé‚®ç®±&quot;<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹ SSH key å…¬é’¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">cat ~/.ssh/id_rsa.pub<br></code></pre></td></tr></table></figure></li><li><p>Githubä¸Šé…ç½® SSH key </p><p>ç‚¹å‡»å¤´åƒ -&gt; settings -&gt; SSH and GPG keysï¼ŒNew SSH keyï¼Œå°†æŸ¥çœ‹åˆ°çš„  SSH key å…¬é’¥å†…å®¹å…¨éƒ¨å¤åˆ¶ç²˜è´´è¿›å»ã€‚</p></li><li><p>æµ‹è¯•è¿æ¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ssh -T git@github.com<br></code></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹ <em>MyBolg</em> çš„é…ç½®æ–‡ä»¶ <code>_config.yml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">deploy:</span><br>  <span class="hljs-attr">type:</span> <span class="hljs-string">git</span><br>  <span class="hljs-attr">repo:</span> <span class="hljs-string">https://github.com/binbiubiu/binbiubiu.github.io.git</span><br>  <span class="hljs-attr">branch:</span> <span class="hljs-string">main</span><br></code></pre></td></tr></table></figure></li><li><p>å®‰è£…å‘å¸ƒæ’ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">npm install hexo-deployer-git --save<br></code></pre></td></tr></table></figure></li><li><p>åšå®¢é¡¹ç›®éƒ¨ç½²åˆ°github</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æ¸…é™¤ç¼“å­˜æ•°æ®ï¼ˆå¯é€‰ï¼Œå»ºè®®å‘å¸ƒå‰æ¸…ä¸€ä¸‹ï¼‰</span><br>hexo clean<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å…ˆç”Ÿæˆé¡¹ç›®</span><br>hexo g<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å†éƒ¨ç½²åˆ°github</span><br>hexo d<br></code></pre></td></tr></table></figure></li><li><p>è®¿é—®ç½‘ç«™ <code>ç”¨æˆ·å.github.io</code></p></li></ul><h2 id="5-å†™æ–‡ç« "><a href="#5-å†™æ–‡ç« " class="headerlink" title="5. å†™æ–‡ç« "></a>5. å†™æ–‡ç« </h2><ul><li><p>åœ¨ <em>MyBlog</em> ä¸­é€šè¿‡å‘½ä»¤è¡Œåˆ›å»ºæ–‡ç« çš„ <em>.md</em> æ–‡ä»¶</p><p>å…¶ä»–çš„å‘½ä»¤å¯ä»¥å‚è€ƒ <a href="https://hexo.io/zh-cn/docs/writing">å®˜æ–¹æ–‡æ¡£</a> è¿›è¡Œæ“ä½œã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">hexo new æ–‡ç« æ ‡é¢˜<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œæˆåï¼Œä¼šåœ¨ <em>source&#x2F;_posts</em> ç›®å½•ä¸‹çœ‹åˆ°ä¸€ä¸ªåä¸º <em><strong>æ–‡ç« æ ‡é¢˜.md</strong></em> çš„æ–‡ç« æ–‡ä»¶å•¦ã€‚</p></li></ul><h2 id="6-å›¾ç‰‡æ— æ³•æ˜¾ç¤º-å›¾ç‰‡ä¸¢å¤±é—®é¢˜"><a href="#6-å›¾ç‰‡æ— æ³•æ˜¾ç¤º-å›¾ç‰‡ä¸¢å¤±é—®é¢˜" class="headerlink" title="6. å›¾ç‰‡æ— æ³•æ˜¾ç¤º - å›¾ç‰‡ä¸¢å¤±é—®é¢˜"></a>6. å›¾ç‰‡æ— æ³•æ˜¾ç¤º - å›¾ç‰‡ä¸¢å¤±é—®é¢˜</h2><p><img src="/20220101010101/image-20230310012750690.png" alt="å›¾ç‰‡ä¸¢å¤±"></p><blockquote><p>æˆ‘ä»¬åœ¨mdæ–‡ä»¶ä¸­æ’å…¥äº†å›¾ç‰‡ï¼ŒHexoç”Ÿæˆåæ‰“å¼€æœåŠ¡å´å‘ç°æ‰¾ä¸åˆ°å›¾ç‰‡ï¼Œéœ€è¦ä¿®æ”¹å›¾ç‰‡è®¾ç½®ã€‚</p></blockquote><h3 id="6-1-è§£å†³æ–¹æ¡ˆ-ä¿®æ”¹é…ç½®æ–‡ä»¶"><a href="#6-1-è§£å†³æ–¹æ¡ˆ-ä¿®æ”¹é…ç½®æ–‡ä»¶" class="headerlink" title="6.1 è§£å†³æ–¹æ¡ˆ - ä¿®æ”¹é…ç½®æ–‡ä»¶"></a>6.1 è§£å†³æ–¹æ¡ˆ - ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><ul><li><p>ä¿®æ”¹ Typora çš„è®¾ç½®ï¼šæ–‡ä»¶ -&gt; åå¥½è®¾ç½® -&gt; å›¾åƒï¼Œä¿®æ”¹ä¸ºâ€œæ’å…¥å›¾ç‰‡æ—¶<em><strong>å¤åˆ¶åˆ°æŒ‡å®šè·¯å¾„</strong></em>â€ï¼Œä¸‹æ–¹çš„é€‰é¡¹é€‰æ‹©â€œ***.&#x2F;${filename}***â€ï¼ˆå³ï¼šå½“å‰mdæ–‡ä»¶è·¯å¾„å¯¹åº”çš„åŒåæ–‡ä»¶å¤¹ä¸‹ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºï¼‰ã€‚</p><img src="/20220101010101/image-20221121165950895.png" alt="image-20221121165950895" style="zoom:80%;"></li></ul><img src="/20220101010101/image-20221121170352273.png" alt="image-20221121170352273" style="zoom: 80%;"><p><img src="/20220101010101/image-20221121170814999.png" alt="åŒåå›¾ç‰‡èµ„æºæ–‡ä»¶å¤¹"></p><ul><li><p>ä¿®æ”¹Hexoé…ç½®ã€‚</p><p>ä¿®æ”¹ <em><strong>MyBlog&#x2F;_config.yml</strong></em> æ–‡ä»¶ä¸­çš„ <em><strong>post_asset_folder</strong></em> çš„å€¼ä¸º <em><strong>true</strong></em>ã€‚</p><p><img src="/20220101010101/image-20221121172551535.png" alt="image-20221121172551535"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">å®‰è£…å›¾ç‰‡æ’ä»¶</span><br>npm install https://github.com/CodeFalling/hexo-asset-image --save<br></code></pre></td></tr></table></figure><p>åŒæ ·åœ°ï¼Œåœ¨ Hexo ç›®å½•çš„ <em><strong>source&#x2F;_posts</strong></em> ç›®å½•ä¸­ï¼Œåˆ›å»ºmdæ–‡ä»¶çš„åŒåæ–‡ä»¶å¤¹ï¼Œå°†å›¾ç‰‡èµ„æºæ”¾åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­å³å¯ï¼Œè¿™æ ·åœ¨ Hexo å‘å¸ƒæ—¶ï¼Œä¹ŸåŒæ ·ä¼šæŠŠå›¾ç‰‡èµ„æºè¿›è¡Œå‘å¸ƒã€‚</p></li></ul><p><img src="/20220101010101/image-20221121171140146.png" alt="åŒåå›¾ç‰‡èµ„æºæ–‡ä»¶å¤¹"></p><h3 id="6-2-è§£å†³æ–¹æ¡ˆ-é…ç½®å›¾åºŠ"><a href="#6-2-è§£å†³æ–¹æ¡ˆ-é…ç½®å›¾åºŠ" class="headerlink" title="6.2 è§£å†³æ–¹æ¡ˆ - é…ç½®å›¾åºŠ"></a>6.2 è§£å†³æ–¹æ¡ˆ - é…ç½®å›¾åºŠ</h3><ul><li><p>åˆ©ç”¨å›¾åºŠï¼Œåœ¨ä½¿ç”¨ Typora ç¼–è¾‘æ—¶ï¼Œå°†å›¾ç‰‡ä¸Šä¼ è‡³å›¾åºŠï¼Œmdä¸­å›¾ç‰‡ç›´æ¥è®¿é—®å›¾åºŠçš„å›¾ç‰‡é“¾æ¥ã€‚</p><p><a href="https://cjc34.gitee.io/2022/10/26/hexo%E9%85%8D%E5%90%88typora/">æ–¹æ¡ˆå‚è€ƒé“¾æ¥</a></p></li></ul><h2 id="7-å›¾ç‰‡æ— æ³•æ˜¾ç¤º-æ–‡ä»¶è§£æå¤±è´¥"><a href="#7-å›¾ç‰‡æ— æ³•æ˜¾ç¤º-æ–‡ä»¶è§£æå¤±è´¥" class="headerlink" title="7. å›¾ç‰‡æ— æ³•æ˜¾ç¤º - æ–‡ä»¶è§£æå¤±è´¥"></a>7. å›¾ç‰‡æ— æ³•æ˜¾ç¤º - æ–‡ä»¶è§£æå¤±è´¥</h2><p><img src="/20220101010101/image-20230309023012184.png" alt="æ–‡ä»¶è§£æå¤±è´¥å¯¼è‡´çš„å›¾ç‰‡æ— æ³•æ˜¾ç¤º"></p><p>å¯èƒ½åŸå› ï¼š</p><ol><li><p>å¯èƒ½æ˜¯.mdæ–‡ä»¶çš„å‘½ååŒ…å«ç‰¹æ®Šå­—ç¬¦å¯¼è‡´çš„ï¼ˆæ¯”å¦‚ <code>+</code>ã€<code>ï¼ˆï¼‰</code>ã€<code>-</code> ã€<code>ç©ºæ ¼</code> ç­‰ï¼Œhexoåœ¨è§£ææ—¶å¯èƒ½ä¼šå‡ºç°å¼‚å¸¸ï¼‰</p><p>è§£å†³æ–¹æ¡ˆï¼šé¿å…æ–‡ä»¶åä¸­ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ã€‚</p></li><li><p>å…¶ä»–çš„ .md æ–‡ä»¶ä¸­å‡ºç°äº†è¯­æ³•é”™è¯¯ï¼Œå¯¼è‡´hexoçš„æ•´ä¸ªè§£æéƒ½å‡ºç°äº†å¼‚å¸¸ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼šéœ€è¦é€ä¸ªæ–‡ä»¶ç¡®è®¤ï¼Œå°¤å…¶æ˜¯ç½‘ä¸Šå¤åˆ¶è¿‡æ¥çš„æ–‡ç« åŠå†…å®¹ã€‚</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>ç½‘ç«™æ­å»º</category>
      
    </categories>
    
    
    <tags>
      
      <tag>åšå®¢æ­å»º</tag>
      
      <tag>Hexo</tag>
      
      <tag>Github</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Oracleæ•°æ®åˆ†åŒºå¯¼è‡´çš„é—®é¢˜</title>
    <link href="/20211215120000/"/>
    <url>/20211215120000/</url>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>ç°åœºå‡ºç°çš„é—®é¢˜ï¼ŒåŸæœ‰ä¸šåŠ¡ä¸ä¼šæ¶‰åŠåˆ°æŸå­—æ®µçš„å˜æ›´ï¼Œäºæ˜¯å¯¹é’ˆå¯¹è¯¥å­—æ®µè¿›è¡Œäº†åˆ†åŒºã€‚</p><p>è¡¨å­—æ®µæœ‰åˆ†åŒºçš„æƒ…å†µä¸‹ï¼Œæ›´æ”¹è¡¨å­—æ®µçš„å€¼å¯èƒ½ä¼šå¼•å‘ ORA-14402 å¼‚å¸¸ã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>å¯ä»¥é€šè¿‡è¯¥å¼€å¯è¡Œè¿ç§»çš„æ–¹å¼è§£å†³ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">--å¼€å¯è¡Œè¿ç§»</span><br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> s_95598_wkst enable <span class="hljs-type">row</span> movement;<br><br><span class="hljs-comment">--å…³é—­è¡Œè¿ç§»</span><br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> s_95598_wkst disable <span class="hljs-type">row</span> movement;<br></code></pre></td></tr></table></figure><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><p>æŸ¥è¯¢æ•°æ®æ‰€åœ¨çš„åˆ†åŒºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">/*2ã€é€šè¿‡ object_id æŸ¥è¯¢å‡ºæ•°æ®æ‰€åœ¨åˆ†åŒº*/</span><br><span class="hljs-keyword">select</span> a.object_name,<br>       a.object_type,<br>       a.subobject_name,<br>       a.object_id,<br>       a.data_object_id<br>  <span class="hljs-keyword">from</span> dba_objects a<br><span class="hljs-keyword">where</span> object_id <span class="hljs-operator">=</span> (<br>                    <span class="hljs-comment">/*1ã€é€šè¿‡ rowid æŸ¥è¯¢æ•°æ®å¯¹åº”çš„ object_id*/</span><br>                    <span class="hljs-keyword">select</span> dbms_rowid.rowid_object(rowid) object_id<br>                      <span class="hljs-keyword">from</span> s_wkst t <span class="hljs-comment">/*ä»»æ„è¡¨åä¸æ¡ä»¶*/</span><br>                     <span class="hljs-keyword">where</span> t.app_no <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;2021121400280289&#x27;</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>é—®é¢˜è®°å½•</category>
      
      <category>Oracle</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Oracleæ•°æ®åˆ†åŒº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mybatisä¸­mapperæ¥å£çš„å‚æ•°ä¸åŠ @Paramæ³¨è§£çš„é—®é¢˜</title>
    <link href="/20210903120000/"/>
    <url>/20210903120000/</url>
    
    <content type="html"><![CDATA[<p>é—®é¢˜æè¿°ï¼šğŸ‘‰<a href="https://blog.csdn.net/u011821334/article/details/101763001">æŸ¥çœ‹</a></p><p>è§£å†³æ–¹æ¡ˆï¼šğŸ‘‰<a href="https://blog.csdn.net/weixin_39587246/article/details/112627261">æŸ¥çœ‹</a></p>]]></content>
    
    
    <categories>
      
      <category>é—®é¢˜è®°å½•</category>
      
      <category>Mybatis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Mybatis</tag>
      
      <tag>java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>OracleæŸ¥è¯¢æˆªè‡³åˆ°å½“å‰æ—¥æœŸæœˆä»½æ‰€åœ¨å¹´ä»½çš„æ‰€æœ‰æœˆä»½</title>
    <link href="/20210824120000/"/>
    <url>/20210824120000/</url>
    
    <content type="html"><![CDATA[<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> to_number(TO_CHAR(add_months(trunc(sysdate, <span class="hljs-string">&#x27;yy&#x27;</span>), ROWNUM <span class="hljs-operator">-</span> <span class="hljs-number">1</span>), <span class="hljs-string">&#x27;MM&#x27;</span>)) <span class="hljs-keyword">as</span> <span class="hljs-keyword">month</span><br><span class="hljs-keyword">FROM</span> DUAL<br><span class="hljs-keyword">CONNECT</span> <span class="hljs-keyword">BY</span> ROWNUM <span class="hljs-operator">&lt;=</span><br>(<span class="hljs-keyword">select</span> months_between(trunc(sysdate, <span class="hljs-string">&#x27;mm&#x27;</span>), trunc(sysdate, <span class="hljs-string">&#x27;yy&#x27;</span>)) <span class="hljs-operator">+</span> <span class="hljs-number">1</span><br><span class="hljs-keyword">from</span> dual);<br></code></pre></td></tr></table></figure><blockquote><p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…·ä½“çš„æ—¶é—´æ®µï¼Œåªè¦æŠŠmonths_betweené‡Œé¢çš„ä¸¤ä¸ªæ—¥æœŸæ”¹æˆå…·ä½“çš„æ—¥æœŸå°±è¡Œã€‚</p><p>å¦‚ä¸Šé¢çš„sqlä¸­ï¼Œtrunc(sysdate, â€˜mmâ€™)æ˜¯è¿”å›å½“æœˆçš„ç¬¬ä¸€å¤©ï¼Œtrunc(sysdate, â€˜yyâ€™)æ˜¯è¿”å›å½“å¹´çš„ç¬¬ä¸€å¤©ã€‚</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Oracle</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Oracle</tag>
      
      <tag>SQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ideaä¸­webå·¥ç¨‹å¼•å…¥jsæ–‡ä»¶ä¸ç”Ÿæ•ˆçš„é—®é¢˜</title>
    <link href="/20210823120000/"/>
    <url>/20210823120000/</url>
    
    <content type="html"><![CDATA[<p>ã€é—®é¢˜æè¿°ã€‘</p><p>ideaä¸­ï¼Œå› ä¸ºåœ¨é¡¹ç›®ä¸­æ–°å»ºäº†ä¸€ä¸ªæ–‡ä»¶å¤¹åˆ†ç±»jsæ–‡ä»¶ï¼Œä½†æ˜¯åœ¨æµè§ˆå™¨ä¸­ä¸€ç›´è®¿é—®ä¸åˆ°jsæ–‡ä»¶ï¼ˆ404ï¼Œä½†è·¯å¾„æ²¡æœ‰é”™ï¼‰ï¼Œæ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’Œé‡å¯é¡¹ç›®éƒ½æ²¡æœ‰ç”¨ï¼ˆBuild Moduleä¹Ÿæ²¡ç”¨ï¼‰ã€‚</p><p>ã€è§£å†³æ–¹æ¡ˆã€‘</p><p>éœ€è¦é‡æ–°æ„å»ºè¯¥ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼š</p><p>å³é”®æ–‡ä»¶å¤¹ï¼Œé€‰æ‹©â€œRebuild â€˜ä¸€çº§è·¯å¾„.äºŒçº§è·¯å¾„.æ–°æ–‡ä»¶å¤¹â€™ï¼ˆRun å’Œ Debug ä¸Šæ–¹çš„é€‰é¡¹ï¼‰</p><p><img src="/20210823120000/Image.png" alt="é‡æ–°ç¼–è¯‘"></p>]]></content>
    
    
    <categories>
      
      <category>é—®é¢˜è®°å½•</category>
      
      <category>IDEA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>IDEAç¼–è¯‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Oracle ADD_MONTHS()å‡½æ•°è¿›è¡Œæœˆä»½åŠ å‡è®¡ç®—</title>
    <link href="/20210818120000/"/>
    <url>/20210818120000/</url>
    
    <content type="html"><![CDATA[<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * è·å–ä¸ŠæœˆåŒæœŸï¼ˆä¸Šä¸ªæœˆåŒä¸€å¤©ï¼‰</span><br><span class="hljs-comment"> */</span><br><span class="hljs-keyword">SELECT</span> to_char(ADD_MONTHS(TO_DATE(<span class="hljs-string">&#x27;20210228&#x27;</span>,<span class="hljs-string">&#x27;YYYYMMDD&#x27;</span>), <span class="hljs-number">1</span>), <span class="hljs-string">&#x27;YYYYMMDD&#x27;</span>) stat_date <span class="hljs-keyword">FROM</span> dual;<br></code></pre></td></tr></table></figure><p><em>å…³äº ADD_MONTHS()å‡½æ•°é—®é¢˜ï¼š<strong>ä¸ç®¡åŠ å‡æœˆï¼Œå¦‚æœå½“å‰æ—¥æœŸæ˜¯å½“æœˆæœ€åä¸€å¤©ï¼Œé‚£ä¹ˆç»“æœä¹Ÿä¼šæ˜¯é‚£ä¸ªæœˆçš„æœ€åä¸€å¤©</strong>ã€‚</em></p><p><em>æ¯”å¦‚ï¼š0228 å‡1æœˆå°±æ˜¯ 0131ï¼ˆè€Œä¸æ˜¯0128ï¼‰ï¼ŒåŠ 1æœˆå°±æ˜¯ 0331</em></p><p><em>æ‰€ä»¥ï¼š0328 å‡1æœˆæ˜¯ 0228ï¼Œå†åŠ 1æœˆå°±æ˜¯ 0331ï¼Œä¼šä¸æœ€åˆå€¼ä¸ä¸€è‡´ï¼ŒæŸ¥è¯¢æ—¶è¦é¿å…åŒæ—¶æœ‰åŠ å‡æ“ä½œï¼Œä»¥å‡å°æ•°æ®åå·®ã€‚</em></p><p>æ¯”å¦‚ä»¥ä¸‹sqlï¼Œåšäº†åŠ ä¸€ä¸ªæœˆå†å‡ä¸€ä¸ªæœˆçš„æ“ä½œï¼Œç†è®ºä¸Šç»“æœæ•°æ®åº”è¯¥æ˜¯å’Œå…¥å‚æ—¥æœŸä¸€è‡´ï¼Œä½†å®é™…ä¸æ˜¯ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> to_char(ADD_MONTHS(ADD_MONTHS(TO_DATE(<span class="hljs-string">&#x27;20210328&#x27;</span>, <span class="hljs-string">&#x27;YYYYMMDD&#x27;</span>),  <span class="hljs-number">-1</span>), <span class="hljs-number">1</span>), <span class="hljs-string">&#x27;YYYYMMDD&#x27;</span>) stat_date <span class="hljs-keyword">FROM</span> dual;<br></code></pre></td></tr></table></figure><p>æ¯”å¦‚ä»¥ä¸‹çš„éœ€æ±‚sqlï¼š</p><p>æŸ¥è¯¢å½“æœˆå’Œä¸Šä¸ªæœˆçš„åŒæœŸå€¼ï¼šï¼ˆå…¥å‚æ˜¯å½“æœˆæ—¶é—´ï¼ŒæŸ¥è¯¢ä¸Šæœˆæ•°æ®æ—¶æ¡ä»¶è¿›è¡Œäº†ä¸€æ¬¡ ADD_MONTHS(-1) è®¡ç®—ï¼Œå½“æœˆæ•°æ®è¦å’Œä¸Šæœˆæ•°æ®é€šè¿‡æ—¶é—´å…³è”ï¼Œå¦‚æœåœ¨ä¸Šæœˆæ•°æ®çš„æŸ¥è¯¢ç»“æœä¸­å¯¹æ—¶é—´è¿›è¡Œ ADD_MONTHS(+1) è®¡ç®—ï¼Œç»“æœæ•°æ®è¯¯å·®å°±ä¼šå˜å¤§ã€‚æ‰€ä»¥éœ€è¦åšçš„åº”è¯¥æ˜¯å¯¹å½“æœˆæ•°æ®çš„æŸ¥è¯¢ç»“æœåš ADD_MONTHS(-1) è®¡ç®—ï¼Œæ•°æ®è¯¯å·®å°±ä¼šå°ä¸€ç‚¹ï¼‰</p><p><img src="/20210818120000/Image.png" alt="ADD_MONTHSå‡½æ•°ä½¿ç”¨"></p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Oracle</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Oracle</tag>
      
      <tag>SQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CentOS7æ‰¾ä¸åˆ°jarå‘½ä»¤</title>
    <link href="/20200810120000/"/>
    <url>/20200810120000/</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">è§£å†³æ‰¾ä¸åˆ°jarå‘½ä»¤</span><br>yum install java-devel<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>é—®é¢˜è®°å½•</category>
      
      <category>CentOS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CentOS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Unresolved compilation problemè§£å†³æ–¹æ¡ˆ</title>
    <link href="/20200810120000/"/>
    <url>/20200810120000/</url>
    
    <content type="html"><![CDATA[<p>å¼‚å¸¸ä¿¡æ¯ï¼š</p><p>java.lang.Error: Unresolved compilation problem</p><p>ã€é—®é¢˜åŸå› ã€‘</p><p>ç”±äºç”µè„‘ä¸Šé¢æœ‰å¤šä¸ªjdkç‰ˆæœ¬ï¼Œè€Œ <em><strong>Eclipse</strong></em> ä½¿ç”¨é»˜è®¤ç‰ˆæœ¬ï¼Œä½¿å¾— IDE çš„Compiler Compliance level ä¸ Installed JREs ç‰ˆæœ¬ä¸å¯¹åº”è€Œå¯¼è‡´é”™è¯¯ã€‚</p><p>ã€è§£å†³æ–¹æ¡ˆã€‘</p><p>å°† IDE çš„Compiler Compliance level ä¸ Installed JREs ç‰ˆæœ¬ä¿®æ”¹ä¸ºä¸€è‡´ï¼š</p><p>1ã€Preferences &gt; Java &gt; Compiler</p><p>2ã€Preferences &gt; Java &gt; Installed JREs</p><p>3ã€åœ¨é¡¹ç›®ä¸Šå³é”®ï¼Œé€‰æ‹© propertiesï¼Œé€‰æ‹© Java compilerï¼Œç¡®è®¤ç¼–è¯‘ç­‰çº§ä¿æŒä¸€è‡´ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>é—®é¢˜è®°å½•</category>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
      <tag>Javaå¼‚å¸¸</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>win10æŒ‰winé”®å¤±æ•ˆé—®é¢˜</title>
    <link href="/20200810120000/"/>
    <url>/20200810120000/</url>
    
    <content type="html"><![CDATA[<h2 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h2><p>win10æŒ‰winé”®æ— ååº”ï¼Œwin10ç‚¹å‡»å·¦ä¸‹è§’winå›¾æ ‡æ— ååº”ã€‚</p><h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>ä»»åŠ¡æ å³é”®ã€‹ä»»åŠ¡ç®¡ç†å™¨ã€‹æ‰¾åˆ°â€œæ¡Œé¢çª—å£ç®¡ç†å™¨â€ã€‹ç»“æŸè¯¥ä»»åŠ¡ã€‹æ–°å»ºä»»åŠ¡ã€‹dwnã€‹é‡å¯ç”µè„‘ã€‚</p><p><img src="/20200810120000/Image.png" alt="ä»»åŠ¡æ å³é”®æ‰“å¼€ä»»åŠ¡ç®¡ç†å™¨"></p><p><img src="/20200810120000/Image-1678416652735-221.png" alt="æ‰¾åˆ°æ¡Œé¢çª—å£ç®¡ç†å™¨å¹¶ç»“æŸè¿è¡Œ"></p><p><img src="/20200810120000/Image-1678416744457-223.png" alt="è¿è¡Œæ–°ä»»åŠ¡"></p><p><img src="/20200810120000/Image-1678416764812-225.png" alt="dwn"></p>]]></content>
    
    
    <categories>
      
      <category>é—®é¢˜è®°å½•</category>
      
      <category>Win10</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Win10</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Gitä½¿ç”¨æ‰‹å†Œ</title>
    <link href="/20200805120000/"/>
    <url>/20200805120000/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä¸»è¦ä»‹ç»gitçš„ä½¿ç”¨å…¥é—¨ï¼ŒåŒ…æ‹¬å®‰è£…ã€é…ç½®ã€å¸¸ç”¨å‘½ä»¤ã€‚</p></blockquote><h1 id="1-å®‰è£…"><a href="#1-å®‰è£…" class="headerlink" title="1. å®‰è£…"></a>1. å®‰è£…</h1><p>æœ¬æ–‡ä»¥ Linuxç¯å¢ƒå®‰è£…ä¸ºä¾‹ï¼Œwindowsç³»ç»Ÿå¤§åŒå°å¼‚ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">linuxå®‰è£…git</span><br>yum install git<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">é€šè¿‡æŸ¥çœ‹å®‰è£…ç‰ˆæœ¬ä¿¡æ¯çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</span><br>git --version<br></code></pre></td></tr></table></figure><h1 id="2-åŸºæœ¬é…ç½®"><a href="#2-åŸºæœ¬é…ç½®" class="headerlink" title="2. åŸºæœ¬é…ç½®"></a>2. åŸºæœ¬é…ç½®</h1><ol><li><p>åŸºæœ¬é…ç½®ï¼ˆå‘½ä»¤è¡Œæ–¹å¼é…ç½®ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">é…ç½®ç”¨æˆ·ä¿¡æ¯ï¼šï¼ˆæäº¤æ—¶çš„ç”¨æˆ·ä¿¡æ¯ï¼‰</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¸å»ºè®®è®¾ç½® global çš„ç”¨æˆ·å±æ€§ï¼Œå»ºè®®åªåœ¨æŸä¸€æœ¬åœ°ä»“åº“è¿›è¡Œè®¾ç½®</span><br>git config --global user.name &quot;test&quot;<br>git config --global user.email &quot;test@abc.com&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">é…ç½®æäº¤ä¿¡æ¯ç¼–ç (å€¼ä¸èƒ½æœ‰å¼•å·,å¦‚æœæœ‰çš„è¯åœ¨ideaé‡Œé¢ä¼šæŠ¥é”™)</span><br>git config --global gui.encoding utf-8<br>git config --global i18n.commitencoding utf-8<br>git config --global i18n.logoutputencoding utf-8<br>git config --global svn.pathnameencoding utf-8<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹é…ç½®ä¿¡æ¯</span><br>git config --global --list<br>git config --list<br></code></pre></td></tr></table></figure></li><li><p>æˆæƒé…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">ç”Ÿæˆæˆä¿¡è¯ä¹¦</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç¬¬ä¸€æ¬¡å›è½¦ï¼Œä¼šè®©è¾“å…¥ç”Ÿæˆçš„æ–‡ä»¶åï¼Œä¸ºç©ºå°±æ˜¯é»˜è®¤ã€‚</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç¬¬äºŒæ¬¡å›è½¦ï¼Œä¼šè®©è¾“å…¥ç”Ÿæˆçš„å¯†ç ï¼Œä¸ºç©ºå°±æ˜¯é»˜è®¤ã€‚</span><br>ssh-keygen -t rsa -C test@abc.com<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ°è¯ä¹¦ç›®å½•æŸ¥çœ‹ç”Ÿæˆçš„è¯ä¹¦ã€‚<span class="hljs-built_in">ls</span> å³å¯æŸ¥çœ‹åˆ°ç”Ÿæˆçš„æ–‡ä»¶ã€‚id_rsa å’Œ id_rsa.pubï¼Œ.pubæ–‡ä»¶æ˜¯å…¬é’¥ï¼Œå¦ä¸€ä¸ªæ˜¯ç§é’¥ã€‚</span><br>cd ~/.ssh/<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹å…¬é’¥å†…å®¹å¹¶å¤åˆ¶</span><br>cat id_rsa.pub<br></code></pre></td></tr></table></figure><p>ç„¶åå°†gitè¯ä¹¦é…ç½®åˆ°ä»£ç æ‰˜ç®¡å¹³å°ï¼ˆå¦‚ï¼šgithubæˆ–è€…gitlabï¼‰ï¼Œä½¿å¾—LinuxæœåŠ¡å™¨ä¸githubä¹‹é—´å¯ä»¥è¿é€šã€‚</p><ul><li><p>é…ç½®github</p><ol><li><p><a href="https://github.com/">ç™»é™†github</a>ã€‚</p></li><li><p>ç‚¹å‡»ç”¨æˆ·å¤´åƒ &gt; settings &gt; SSH and GPG keys &gt; é€‰æ‹© New SSH keyã€‚title è‡ªå®šä¹‰ï¼Œkey ä¸º id_rsa.pub ä¸­çš„å†…å®¹ï¼Œç„¶åå•å‡»addã€‚</p></li><li><p>æµ‹è¯•è¿æ¥ï¼Œå›åˆ°LinuxæœåŠ¡å™¨ï¼Œå‘½ä»¤è¡Œè¾“å…¥ï¼šssh -T <a href="mailto:&#103;&#105;&#116;&#64;&#x67;&#x69;&#x74;&#x68;&#x75;&#98;&#x2e;&#99;&#111;&#109;">&#103;&#105;&#116;&#64;&#x67;&#x69;&#x74;&#x68;&#x75;&#98;&#x2e;&#99;&#111;&#109;</a></p><p>è¿æ¥æˆåŠŸåä¼šæç¤º Hi xxx! Youâ€™ve successfully authenticatedâ€¦</p></li></ol></li><li><p>é…ç½®gitlab</p><ol><li><p>è¿›å…¥gitlabå¹³å°ã€‚</p><p><img src="/20200805120000/image-20230308234558076.png" alt="image-20230308234558076"></p><p><img src="/20200805120000/image-20230308234619650.png" alt="image-20230308234619650"></p></li><li><p>è¿æ¥æµ‹è¯•ï¼šssh -T <a href="mailto:&#x67;&#105;&#116;&#64;&#103;&#105;&#x74;&#x6c;&#x61;&#x62;&#46;&#x63;&#x6f;&#x6d;">&#x67;&#105;&#116;&#64;&#103;&#105;&#x74;&#x6c;&#x61;&#x62;&#46;&#x63;&#x6f;&#x6d;</a></p></li></ol></li></ul></li></ol><h1 id="3-ä¸¤ç§Gitè¿æ¥æ–¹å¼"><a href="#3-ä¸¤ç§Gitè¿æ¥æ–¹å¼" class="headerlink" title="3. ä¸¤ç§Gitè¿æ¥æ–¹å¼"></a>3. ä¸¤ç§Gitè¿æ¥æ–¹å¼</h1><ol><li><p>SSHé“¾æ¥å’ŒHTTPSé“¾æ¥ã€‚</p></li><li><p>SSHé“¾æ¥å’ŒHTTPSé“¾æ¥çš„ä¸åŒï¼š</p><ul><li><p>é€šè¿‡SSHè¿æ¥è·å–ä»£ç ã€æäº¤ä»£ç çš„æ—¶å€™ä¸éœ€è¦è¾“å…¥å¯†ç ï¼Œéœ€è¦äº‹å…ˆé…ç½®å…¬é’¥ã€‚</p></li><li><p>é€šè¿‡HTTPSè¿æ¥è·å–ä»£ç ã€æäº¤ä»£ç çš„æ—¶å€™éœ€è¦è¾“å…¥å¯†ç ã€‚å¹¶ä¸”ï¼šä½¿ç”¨è¯¥æ–¹å¼è¿›è¡Œæäº¤ä»£ç çš„æ—¶å€™ï¼Œç”¨æˆ·éœ€è¦é…æœ‰ç›¸å…³æƒé™ã€‚</p></li></ul></li></ol><h1 id="4-åŸºæœ¬ä½¿ç”¨å‘½ä»¤"><a href="#4-åŸºæœ¬ä½¿ç”¨å‘½ä»¤" class="headerlink" title="4. åŸºæœ¬ä½¿ç”¨å‘½ä»¤"></a>4. åŸºæœ¬ä½¿ç”¨å‘½ä»¤</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆå§‹åŒ–å½“å‰æ–‡ä»¶å¤¹ä¸ºgitç›®å½•</span><br>git init<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å…³è”è¿œç¨‹ä»“åº“</span><br>git remote add origin https://gitlab.com/RainbowRing/test.git<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ¨é€ä»¥å»ºç«‹è¿æ¥</span><br>git push -u origin master<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹gitçŠ¶æ€ï¼ˆæ–‡ä»¶æäº¤çŠ¶æ€ï¼‰</span><br>git status<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ·»åŠ æ–‡ä»¶åˆ°æš‚å­˜åŒº</span><br>git add æ–‡ä»¶è·¯å¾„<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æäº¤åˆ°æœ¬åœ°ä»“åº“</span><br>git commit -m &#x27;æäº¤ä¿¡æ¯&#x27;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æäº¤ä»£ç åˆ°è¿œç¨‹ä»“åº“</span><br>git push<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ‹‰å–è¿œç¨‹ä»£ç åˆ°æœ¬åœ°ï¼ˆæœ¬åœ°æ–°å»ºä¸€ä¸ªè¿œç¨‹ä»“åº“çš„å‰¯æœ¬ï¼‰</span><br>git clone git@gitlab.com:xxx/yyy.git<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æˆ–è€…</span><br>git clone https://gitlab.com/xxx/yyy.git<br><br></code></pre></td></tr></table></figure><h2 id="gitä¸­ä¸€äº›å‚æ•°é€‰é¡¹è§£é‡Š"><a href="#gitä¸­ä¸€äº›å‚æ•°é€‰é¡¹è§£é‡Š" class="headerlink" title="gitä¸­ä¸€äº›å‚æ•°é€‰é¡¹è§£é‡Š"></a>gitä¸­ä¸€äº›å‚æ•°é€‰é¡¹è§£é‡Š</h2><table><thead><tr><th align="center">å‚æ•°</th><th align="center">å‚æ•°å…¨å</th><th align="center">é‡Šæ„</th></tr></thead><tbody><tr><td align="center">-f</td><td align="center">â€“force</td><td align="center">å¼ºåˆ¶</td></tr><tr><td align="center">-d</td><td align="center">â€“delete</td><td align="center">åˆ é™¤</td></tr><tr><td align="center">-D</td><td align="center">â€“delete â€“force</td><td align="center">å¼ºåˆ¶åˆ é™¤</td></tr><tr><td align="center">-m</td><td align="center">â€“move</td><td align="center">ç§»åŠ¨æˆ–é‡å‘½å</td></tr><tr><td align="center">-M</td><td align="center">â€“move â€“force</td><td align="center">å¼ºåˆ¶ç§»åŠ¨æˆ–é‡å‘½å</td></tr><tr><td align="center">-r</td><td align="center">â€“remote</td><td align="center">è¿œç¨‹</td></tr><tr><td align="center">-a</td><td align="center">â€“all</td><td align="center">æ‰€æœ‰</td></tr></tbody></table><h1 id="5-ä»“åº“çš„å…³è”å‘½ä»¤"><a href="#5-ä»“åº“çš„å…³è”å‘½ä»¤" class="headerlink" title="5. ä»“åº“çš„å…³è”å‘½ä»¤"></a>5. ä»“åº“çš„å…³è”å‘½ä»¤</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æ”¹å˜åŸæœ‰å…³è”çš„è¿œç¨‹ä»“åº“åœ°å€</span><br>git remote set-url origin git@gitlab.com:RainbowRing/fromGithub.git<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ˜¾ç¤ºè¿œç¨‹originåœ°å€</span><br>git remote show origin<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¦‚æœé‡åˆ°â€œfatal: è¿œç¨‹ origin å·²ç»å­˜åœ¨ã€‚â€é—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆï¼šå°†è¿œç¨‹é…ç½®åˆ é™¤ï¼Œé‡æ–°æ·»åŠ å³å¯</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ é™¤è¿œç¨‹é…ç½®</span><br>git remote rm origin<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ·»åŠ è¿œç¨‹é…ç½®</span><br>git remote add origin https://github.com/xxx/xxx.git<br></code></pre></td></tr></table></figure><h1 id="6-åˆ†æ”¯çš„åŸºæœ¬æ“ä½œ"><a href="#6-åˆ†æ”¯çš„åŸºæœ¬æ“ä½œ" class="headerlink" title="6. åˆ†æ”¯çš„åŸºæœ¬æ“ä½œ"></a>6. åˆ†æ”¯çš„åŸºæœ¬æ“ä½œ</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æœ¬åœ°æ‰€æœ‰åˆ†æ”¯</span><br>git branch<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹è¿œç¨‹æ‰€æœ‰åˆ†æ”¯</span><br>git branch -r  <br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æœ¬åœ°å’Œè¿œç¨‹çš„æ‰€æœ‰åˆ†æ”¯</span><br>git branch -a<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ–°å»ºåˆ†æ”¯</span><br>git branch &lt;branchname&gt;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ é™¤æœ¬åœ°åˆ†æ”¯</span><br>git branch -d &lt;branchname&gt; // <br><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼Œåˆ é™¤åè¿˜éœ€æ¨é€åˆ°æœåŠ¡å™¨</span><br>git branch -d -r &lt;branchname&gt;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ é™¤åæ¨é€è‡³æœåŠ¡å™¨</span><br>git push origin:&lt;branchname&gt;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">é‡å‘½åæœ¬åœ°åˆ†æ”¯</span><br>git branch -m &lt;oldbranch&gt; &lt;newbranch&gt;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">é‡å‘½åè¿œç¨‹åˆ†æ”¯ï¼š</span> <br><span class="hljs-meta prompt_"># </span><span class="language-bash">1ã€åˆ é™¤è¿œç¨‹å¾…ä¿®æ”¹åˆ†æ”¯</span> <br><span class="hljs-meta prompt_"># </span><span class="language-bash">2ã€pushæœ¬åœ°æ–°åˆ†æ”¯åˆ°è¿œç¨‹æœåŠ¡å™¨</span><br></code></pre></td></tr></table></figure><h1 id="7-Gitå·¥ä½œæ¨¡å‹ä»‹ç»"><a href="#7-Gitå·¥ä½œæ¨¡å‹ä»‹ç»" class="headerlink" title="7. Gitå·¥ä½œæ¨¡å‹ä»‹ç»"></a>7. Gitå·¥ä½œæ¨¡å‹ä»‹ç»</h1><h2 id="7-1-å·¥ä½œæµæ¨¡å‹ï¼ˆç»“åˆå‘½ä»¤ï¼‰"><a href="#7-1-å·¥ä½œæµæ¨¡å‹ï¼ˆç»“åˆå‘½ä»¤ï¼‰" class="headerlink" title="7.1. å·¥ä½œæµæ¨¡å‹ï¼ˆç»“åˆå‘½ä»¤ï¼‰"></a>7.1. å·¥ä½œæµæ¨¡å‹ï¼ˆç»“åˆå‘½ä»¤ï¼‰</h2><p><img src="/20200805120000/image-20230309000444555.png" alt="Gitå·¥ä½œæµæ¨¡å‹"></p><p>Gitä¸­ä»£ç æœ‰ä¸‰ä¸ªå¤§ç¯èŠ‚ï¼šæš‚å­˜åŒº -&gt; æœ¬åœ°ä»“åº“ -&gt; è¿œç¨‹ä»“åº“</p><p>å¯¹åº”Gitå‘½ä»¤è¯´æ˜ï¼š</p><ol><li><p>git init</p><p>åˆ›å»ºä¸€ä¸ªæœ¬åœ°Repositoryï¼ˆä¹Ÿå¯ä»¥é€šè¿‡git cloneæ‹‰å–ä»£ç çš„æ–¹å¼åˆ›å»ºä¸€ä¸ªå·²ç»å…³è”è¿œç¨‹ä»“åº“çš„æœ¬åœ°ä»“åº“ï¼‰ã€‚</p></li><li><p>git remote add origin <a href="https://gitlab.com/xxx/yyy.git">https://gitlab.com/xxx/yyy.git</a></p><p>å…³è”è¿œç¨‹ä»“åº“ã€‚</p></li><li><p>git add</p><p>å°†æœ¬åœ° workspace å†…çš„ä»£ç æ·»åŠ è¿‘ç‰ˆæœ¬æ§åˆ¶ï¼ˆå³æ·»åŠ è¿›æš‚å­˜åŒºï¼‰ã€‚</p></li><li><p>git commit -m â€˜æäº¤ä¿¡æ¯â€™</p><p>æäº¤åˆ°æœ¬åœ°ä»“åº“ï¼ˆå›¾ä¸­Repositoryï¼‰ã€‚</p></li><li><p>git push</p><p>æäº¤ä»£ç åˆ°è¿œç¨‹ä»“åº“ï¼ˆå›¾ä¸­Remoteï¼‰ã€‚</p><p>è¿™ä¹Ÿå°±æ˜¯svnç”¨æˆ·åˆæ¬¡ä½¿ç”¨gitä¼šæœ‰â€ä¸ºä»€ä¹ˆè¦â€˜æäº¤â€™ä¸¤æ¬¡â€çš„ç–‘æƒ‘çš„åŸå› äº†ã€‚</p></li></ol><h2 id="7-2-ç‰ˆæœ¬æ§åˆ¶æ¨¡å‹"><a href="#7-2-ç‰ˆæœ¬æ§åˆ¶æ¨¡å‹" class="headerlink" title="7.2. ç‰ˆæœ¬æ§åˆ¶æ¨¡å‹"></a>7.2. ç‰ˆæœ¬æ§åˆ¶æ¨¡å‹</h2><p><img src="/20200805120000/image-20230309000842601.png" alt="Gitç‰ˆæœ¬æ§åˆ¶æ¨¡å‹"></p><h1 id="8-å…¶ä»–ä½¿ç”¨é—®é¢˜"><a href="#8-å…¶ä»–ä½¿ç”¨é—®é¢˜" class="headerlink" title="8. å…¶ä»–ä½¿ç”¨é—®é¢˜"></a>8. å…¶ä»–ä½¿ç”¨é—®é¢˜</h1><h2 id="gitä¸­å¦‚ä½•å°†å·²commitçš„ä»£ç commitåˆ°å…¶å®ƒåˆ†æ”¯"><a href="#gitä¸­å¦‚ä½•å°†å·²commitçš„ä»£ç commitåˆ°å…¶å®ƒåˆ†æ”¯" class="headerlink" title="gitä¸­å¦‚ä½•å°†å·²commitçš„ä»£ç commitåˆ°å…¶å®ƒåˆ†æ”¯"></a>gitä¸­å¦‚ä½•å°†å·²commitçš„ä»£ç commitåˆ°å…¶å®ƒåˆ†æ”¯</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æ˜¾ç¤ºå·²ç»æäº¤çš„æäº¤ç¼–ç </span><br>git log<br><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ‡æ¢åˆ†æ”¯</span><br>git checkout develop<br><span class="hljs-meta prompt_"># </span><span class="language-bash">é€šè¿‡ç‰ˆæœ¬ç¼–ç æ›´æ–°ä»£ç </span><br>git cherry-pick [commit id]<br></code></pre></td></tr></table></figure><h2 id="git-pushè¯¦è§£"><a href="#git-pushè¯¦è§£" class="headerlink" title="git pushè¯¦è§£"></a>git pushè¯¦è§£</h2><p>ğŸ‘‰<a href="https://www.cnblogs.com/guojuboke/p/12750842.html">å‚è€ƒé“¾æ¥</a></p><h2 id="IDEAä¸­è§£å†³-git-pull-å†²çª"><a href="#IDEAä¸­è§£å†³-git-pull-å†²çª" class="headerlink" title="IDEAä¸­è§£å†³ git pull å†²çª"></a>IDEAä¸­è§£å†³ git pull å†²çª</h2><p>ğŸ‘‰<a href="https://blog.csdn.net/qq_32118691/article/details/106015780">å‚è€ƒé“¾æ¥</a></p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Git</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Git</tag>
      
      <tag>Gitå‘½ä»¤</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythonç¬¬ä¸‰æ–¹æ¨¡å—ä½¿ç”¨ä¹‹xlwt</title>
    <link href="/20200729140000/"/>
    <url>/20200729140000/</url>
    
    <content type="html"><![CDATA[<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> xlwt<br><br><span class="hljs-comment">#æ ‡é¢˜æ ·å¼</span><br>titleStyle = xlwt.XFStyle()<br><span class="hljs-comment">#å•å…ƒæ ¼å­—ä½“è®¾ç½®</span><br>titleFont = xlwt.Font() <span class="hljs-comment">#å­—ä½“å¯¹è±¡</span><br>titleFont.name = <span class="hljs-string">&quot;å®‹ä½“&quot;</span> <span class="hljs-comment">#å­—ä½“åç§°</span><br>titleFont.bold = <span class="hljs-literal">True</span> <span class="hljs-comment">#åŠ ç²—</span><br>titleFont.height = <span class="hljs-number">11</span>*<span class="hljs-number">20</span> <span class="hljs-comment">#å­—å·ï¼Œ11è¡¨ç¤ºå­—ä½“å¤§å°ï¼Œ20æ˜¯ä¸€ä¸ªè¡¡é‡å•ä½</span><br>titleFont.colour_index = <span class="hljs-number">0x08</span> <span class="hljs-comment">#é¢œè‰²å¹¶ä¸æ˜¯rgbè¡¨ç¤ºæ³•ï¼Œå¯ä»¥ä»XFStyleå¯¹è±¡ä¸­æœç´¢_colour_map_textè·å–åˆ°</span><br>titleStyle.font = titleFont<br><span class="hljs-comment">#å•å…ƒæ ¼å¯¹é½æ–¹å¼</span><br>cellAlign = xlwt.Alignment()<br>cellAlign.horz = <span class="hljs-number">0x02</span><br>cellAlign.vert = <span class="hljs-number">0x01</span><br>titleStyle.alignment = cellAlign<br><br><br><span class="hljs-comment">#1.åˆ›å»ºå·¥ä½œç°¿</span><br>wb = xlwt.Workbook()<br><span class="hljs-comment">#2.åˆ›å»ºå·¥ä½œè¡¨</span><br>ws = wb.add_sheet(<span class="hljs-string">&quot;Sheet1&quot;</span>)<br><span class="hljs-comment">#3.å¡«å……æ•°æ®(åˆå¹¶å•å…ƒæ ¼)</span><br>ws.write_merge(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">5</span>,<span class="hljs-string">&quot;å¤§æ ‡é¢˜ï¼ˆå•å…ƒæ ¼åˆå¹¶æµ‹è¯•ï¼‰&quot;</span>,titleStyle)<br><span class="hljs-comment">#4.æ•°æ®å®šä¹‰</span><br>data = ((<span class="hljs-string">&quot;å°æ ‡é¢˜1&quot;</span>,<span class="hljs-string">&quot;å°æ ‡é¢˜2&quot;</span>,<span class="hljs-string">&quot;å°æ ‡é¢˜3&quot;</span>),<br>        (<span class="hljs-string">&quot;å€¼11&quot;</span>,<span class="hljs-string">&quot;å€¼12&quot;</span>,<span class="hljs-string">&quot;å€¼13&quot;</span>),<br>        (<span class="hljs-string">&quot;å€¼21&quot;</span>,<span class="hljs-string">&quot;å€¼22&quot;</span>,<span class="hljs-string">&quot;å€¼23&quot;</span>)<br>        )<br><span class="hljs-comment">#5.æ•°æ®å†™å…¥å•å…ƒæ ¼ã€‚ï¼ˆenumerateè¡¨ç¤ºåŒ…è£…ç±»ï¼Œæ·»åŠ äº†ç´¢å¼•ï¼‰</span><br><span class="hljs-keyword">for</span> row, item <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(data):<br>    <span class="hljs-keyword">for</span> col, val <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(item):<br>        ws.write(row + <span class="hljs-number">2</span>, col, val)<br><span class="hljs-comment">#6.ä¿å­˜ç”Ÿæˆæ–‡ä»¶(åªæ”¯æŒxlsæ ¼å¼)</span><br>wb.save(<span class="hljs-string">&quot;test.xls&quot;</span>)<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>Pythonç¬¬ä¸‰æ–¹æ¨¡å—</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythonç¬¬ä¸‰æ–¹æ¨¡å—ä½¿ç”¨ä¹‹xlrd</title>
    <link href="/20200729130000/"/>
    <url>/20200729130000/</url>
    
    <content type="html"><![CDATA[<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> xlrd<br><span class="hljs-keyword">import</span> xlwt<br><br><br><span class="hljs-comment">#åŠ è½½excelæ–‡ä»¶</span><br>data = xlrd.open_workbook(<span class="hljs-string">&quot;test.xlsx&quot;</span>)<br><br><br><span class="hljs-comment">#æ“ä½œsheet</span><br><span class="hljs-comment">#åˆ¤æ–­sheetæ˜¯å¦å·²åŠ è½½</span><br><span class="hljs-comment"># data.sheet_loaded(0)</span><br><span class="hljs-comment">#å…³é—­sheet</span><br><span class="hljs-comment"># data.unload_sheet(0)</span><br><br><br><span class="hljs-comment"># print(data.sheets())</span><br><span class="hljs-comment"># print(data.sheets()[0])</span><br><span class="hljs-comment"># print(data.sheet_by_index(0))</span><br><span class="hljs-comment"># print(data.sheet_by_name(&quot;Sheet1&quot;))</span><br><span class="hljs-comment"># print(data.sheet_names())</span><br><span class="hljs-comment"># print(data.nsheets)</span><br><br><br><span class="hljs-comment">#æ“ä½œè¡Œ</span><br>sheet = data.sheet_by_index(<span class="hljs-number">0</span>)<br><span class="hljs-comment">#è·å–æ€»æœ‰æ•ˆè¡Œæ•°</span><br>sheet.nrows<br><span class="hljs-comment">#è®¿é—®ç¬¬ä¸€è¡Œæ•°æ®</span><br>sheet.row(<span class="hljs-number">0</span>)<br><span class="hljs-comment">#è·å–è¡Œæ•°æ®ç±»å‹(0ï¼šç©ºï¼Œ1ï¼šå­—ç¬¦ä¸²ï¼Œ2ï¼šæ•°å€¼)</span><br>sheet.row_types(<span class="hljs-number">0</span>)<br><span class="hljs-comment">#è·å–å•å…ƒæ ¼value</span><br>sheet.row(<span class="hljs-number">0</span>)[<span class="hljs-number">0</span>].value<br><span class="hljs-comment">#è·å–æŒ‡å®šè¡Œçš„æ‰€æœ‰value</span><br>sheet.row_values(<span class="hljs-number">0</span>)<br><br><br><span class="hljs-comment">#æ“ä½œåˆ—(åŒè¡Œæ“ä½œ)</span><br>sheet.ncols<br>sheet.col(<span class="hljs-number">0</span>)<br>sheet.col_values(<span class="hljs-number">0</span>)<br><br><br><span class="hljs-comment">#æ“ä½œå•å…ƒæ ¼</span><br><span class="hljs-built_in">print</span>(sheet.cell(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>))<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>Pythonç¬¬ä¸‰æ–¹æ¨¡å—</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythonç¬¬ä¸‰æ–¹æ¨¡å—</title>
    <link href="/20200729120000/"/>
    <url>/20200729120000/</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹å·²å®‰è£…çš„æ¨¡å—</span><br>pip list<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å®‰è£…ç¬¬ä¸‰æ–¹æ¨¡å—</span><br>pip install æ¨¡å—å<br></code></pre></td></tr></table></figure><p>Pythonç¬¬ä¸‰æ–¹æ¨¡å—ï¼š</p><table><thead><tr><th align="center">æ¨¡å—å</th><th align="center">åŠŸèƒ½æè¿°</th></tr></thead><tbody><tr><td align="center">xlrd</td><td align="center">è¯»å–excelè¡¨æ ¼æ•°æ®</td></tr><tr><td align="center">xlwt</td><td align="center">å†™å…¥excelè¡¨æ ¼æ•°æ®ï¼ˆä»…æ”¯æŒxlsæ ¼å¼ï¼‰</td></tr><tr><td align="center">xlsxwriter</td><td align="center">å†™å…¥excelè¡¨æ ¼æ•°æ®ï¼ˆæ”¯æŒxlsxæ ¼å¼ï¼Œæ¨èï¼‰</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>Pythonç¬¬ä¸‰æ–¹æ¨¡å—</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Python2å®‰è£…pip</title>
    <link href="/20200729110000/"/>
    <url>/20200729110000/</url>
    
    <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">python2 å®‰è£…pip</span><br>wget https://bootstrap.pypa.io/get-pip.py  <br>python get-pip.py  <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>pip</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pythonè¿›é˜¶</title>
    <link href="/20200727140000/"/>
    <url>/20200727140000/</url>
    
    <content type="html"><![CDATA[<h1 id="å‡½æ•°ä½¿ç”¨"><a href="#å‡½æ•°ä½¿ç”¨" class="headerlink" title="å‡½æ•°ä½¿ç”¨"></a>å‡½æ•°ä½¿ç”¨</h1><h2 id="æŠŠå‡½æ•°ä½œä¸ºå‚æ•°"><a href="#æŠŠå‡½æ•°ä½œä¸ºå‚æ•°" class="headerlink" title="æŠŠå‡½æ•°ä½œä¸ºå‚æ•°"></a>æŠŠå‡½æ•°ä½œä¸ºå‚æ•°</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æŠŠå‡½æ•°ä½œä¸ºå‚æ•°</span><br><span class="hljs-keyword">import</span> math<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_sqrt</span>(<span class="hljs-params">x, y, f</span>):<br>    <span class="hljs-keyword">return</span> f(x) + f(y)<br><span class="hljs-built_in">print</span> add(<span class="hljs-number">25</span>, <span class="hljs-number">9</span>, math.sqrt)<br></code></pre></td></tr></table></figure><h2 id="pythonå†…ç½®é«˜çº§å‡½æ•°"><a href="#pythonå†…ç½®é«˜çº§å‡½æ•°" class="headerlink" title="pythonå†…ç½®é«˜çº§å‡½æ•°"></a>pythonå†…ç½®é«˜çº§å‡½æ•°</h2><h3 id="map-å‡½æ•°"><a href="#map-å‡½æ•°" class="headerlink" title="map()å‡½æ•°"></a>map()å‡½æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># map()å‡½æ•°ï¼šå®ƒæ¥æ”¶ä¸€ä¸ªå‡½æ•° f å’Œä¸€ä¸ª listï¼Œå¹¶é€šè¿‡æŠŠå‡½æ•° f ä¾æ¬¡ä½œç”¨åœ¨ list çš„æ¯ä¸ªå…ƒç´ ä¸Šï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„ list å¹¶è¿”å›ã€‚</span><br><br><span class="hljs-comment"># ä¾‹1ã€é€šè¿‡map()å‡½æ•°å°†ä¸è§„èŒƒçš„è‹±æ–‡åå­—åˆ—è¡¨è½¬è§„èŒƒ</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">format_name</span>(<span class="hljs-params">s</span>):<br>    <span class="hljs-keyword">return</span> s[<span class="hljs-number">0</span>].upper() + s[<span class="hljs-number">1</span>:].lower()<br><br><span class="hljs-built_in">print</span> <span class="hljs-built_in">map</span>(format_name, [<span class="hljs-string">&#x27;adam&#x27;</span>, <span class="hljs-string">&#x27;LISA&#x27;</span>, <span class="hljs-string">&#x27;barT&#x27;</span>])<br><br><span class="hljs-comment"># ä¾‹2ã€æŠŠlistçš„æ¯ä¸ªå…ƒç´ éƒ½ä½œå¹³æ–¹</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">return</span> x*x<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">map</span>(fn, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>])<br><span class="hljs-comment"># ç»“æœï¼š[1, 4, 9, 10, 25, 36, 49, 64, 81]</span><br></code></pre></td></tr></table></figure><h3 id="reduce-å‡½æ•°"><a href="#reduce-å‡½æ•°" class="headerlink" title="reduce()å‡½æ•°"></a>reduce()å‡½æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># reduce()å‡½æ•°ï¼šæ¥æ”¶å‚æ•°ä¸ºä¸€ä¸ªå‡½æ•° fï¼Œä¸€ä¸ªlistã€‚reduce()å¯¹listçš„æ¯ä¸ªå…ƒç´ åå¤è°ƒç”¨å‡½æ•°fï¼Œå¹¶è¿”å›æœ€ç»ˆç»“æœå€¼ã€‚</span><br><span class="hljs-comment"># ä¾‹1ï¼š</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">f</span>(<span class="hljs-params">x, y</span>):<br>    <span class="hljs-keyword">return</span> x + y<br><span class="hljs-built_in">print</span> reduce(f, [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>])<br><span class="hljs-comment"># è®¡ç®—è¿‡ç¨‹ï¼š</span><br><span class="hljs-comment"># å…ˆè®¡ç®—å¤´ä¸¤ä¸ªå…ƒç´ ï¼šf(1, 3)ï¼Œç»“æœä¸º4ï¼›</span><br><span class="hljs-comment"># å†æŠŠç»“æœå’Œç¬¬3ä¸ªå…ƒç´ è®¡ç®—ï¼šf(4, 5)ï¼Œç»“æœä¸º9ï¼›</span><br><span class="hljs-comment"># å†æŠŠç»“æœå’Œç¬¬4ä¸ªå…ƒç´ è®¡ç®—ï¼šf(9, 7)ï¼Œç»“æœä¸º16ï¼›</span><br><span class="hljs-comment"># å†æŠŠç»“æœå’Œç¬¬5ä¸ªå…ƒç´ è®¡ç®—ï¼šf(16, 9)ï¼Œç»“æœä¸º25ï¼›</span><br><span class="hljs-comment"># ç”±äºæ²¡æœ‰æ›´å¤šçš„å…ƒç´ äº†ï¼Œè®¡ç®—ç»“æŸï¼Œè¿”å›ç»“æœ25ã€‚</span><br><br><span class="hljs-comment"># reduce()è¿˜å¯ä»¥æ¥æ”¶ç¬¬3ä¸ªå¯é€‰å‚æ•°ï¼Œä½œä¸ºè®¡ç®—çš„åˆå§‹å€¼ã€‚</span><br>reduce(f, [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>], <span class="hljs-number">100</span>)<br><span class="hljs-comment"># ç¬¬ä¸€è½®è®¡ç®—å°±æ˜¯ï¼šf(100, 1)</span><br></code></pre></td></tr></table></figure><h3 id="filter-å‡½æ•°"><a href="#filter-å‡½æ•°" class="headerlink" title="filter()å‡½æ•°"></a>filter()å‡½æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># filter()å‡½æ•°ï¼šæ¥æ”¶ä¸€ä¸ªå‡½æ•° f å’Œä¸€ä¸ªlistï¼Œè¿™ä¸ªå‡½æ•° f çš„ä½œç”¨æ˜¯å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œåˆ¤æ–­ï¼Œè¿”å› Trueæˆ– Falseï¼Œfilter()æ ¹æ®åˆ¤æ–­ç»“æœè‡ªåŠ¨è¿‡æ»¤æ‰ä¸ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼Œè¿”å›ç”±ç¬¦åˆæ¡ä»¶å…ƒç´ ç»„æˆçš„æ–°listã€‚</span><br><span class="hljs-comment"># ä¾‹1ï¼Œè¦ä»ä¸€ä¸ªlist [1, 4, 6, 7, 9, 12, 17]ä¸­åˆ é™¤å¶æ•°ï¼Œä¿ç•™å¥‡æ•°ï¼Œé¦–å…ˆï¼Œè¦ç¼–å†™ä¸€ä¸ªåˆ¤æ–­å¥‡æ•°çš„å‡½æ•°ï¼š</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_odd</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">return</span> x % <span class="hljs-number">2</span> == <span class="hljs-number">1</span><br><span class="hljs-built_in">print</span> <span class="hljs-built_in">filter</span>(is_odd, [<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">9</span>, <span class="hljs-number">12</span>, <span class="hljs-number">17</span>])<br><span class="hljs-comment"># ç»“æœï¼š[1, 7, 9, 17]</span><br><br><br><span class="hljs-comment"># ä¾‹2ï¼Œåˆ é™¤ None æˆ–è€…ç©ºå­—ç¬¦ä¸²ï¼š s.strip(rm) åˆ é™¤ s å­—ç¬¦ä¸²ä¸­å¼€å¤´ã€ç»“å°¾å¤„çš„ rm åºåˆ—çš„å­—ç¬¦ã€‚å½“rmä¸ºç©ºæ—¶ï¼Œé»˜è®¤åˆ é™¤ç©ºç™½ç¬¦ï¼ˆåŒ…æ‹¬&#x27;\n&#x27;, &#x27;\r&#x27;, &#x27;\t&#x27;, &#x27; &#x27;)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_not_empty</span>(<span class="hljs-params">s</span>):<br>    <span class="hljs-keyword">return</span> s <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(s.strip()) &gt; <span class="hljs-number">0</span><br><span class="hljs-built_in">print</span> <span class="hljs-built_in">filter</span>(is_not_empty, [<span class="hljs-string">&#x27;test&#x27;</span>, <span class="hljs-literal">None</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;str&#x27;</span>, <span class="hljs-string">&#x27;  &#x27;</span>, <span class="hljs-string">&#x27;END&#x27;</span>])<br><span class="hljs-comment"># ç»“æœï¼š[&#x27;test&#x27;, &#x27;str&#x27;, &#x27;END&#x27;]</span><br><br><br><span class="hljs-comment"># ç”¨filter()è¿‡æ»¤å‡º1~100ä¸­å¹³æ–¹æ ¹æ˜¯æ•´æ•°çš„æ•°</span><br><span class="hljs-keyword">import</span> math<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_sqr</span>(<span class="hljs-params">x</span>):<br>    r = <span class="hljs-built_in">int</span>(math.sqrt(x))<br>    <span class="hljs-keyword">return</span> r*r==x<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">filter</span>(is_sqr, <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">101</span>))<br></code></pre></td></tr></table></figure><h3 id="sorted-å‡½æ•°"><a href="#sorted-å‡½æ•°" class="headerlink" title="sorted()å‡½æ•°"></a>sorted()å‡½æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># sorted()å‡½æ•°:å¯ä»¥æ¥æ”¶ä¸€ä¸ªlistå’Œä¸€ä¸ªè‡ªå®šä¹‰çš„æ’åºå‡½æ•°</span><br><span class="hljs-built_in">sorted</span>([<span class="hljs-number">36</span>, <span class="hljs-number">5</span>, <span class="hljs-number">12</span>, <span class="hljs-number">9</span>, <span class="hljs-number">21</span>])<br><br><span class="hljs-comment"># è‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°ï¼šä¼ å…¥ä¸¤ä¸ªå¾…æ¯”è¾ƒçš„å…ƒç´  x, yï¼Œå¦‚æœ x åº”è¯¥æ’åœ¨ y çš„å‰é¢ï¼Œè¿”å› -1ï¼Œå¦‚æœ x åº”è¯¥æ’åœ¨ y çš„åé¢ï¼Œè¿”å› 1ã€‚å¦‚æœ x å’Œ y ç›¸ç­‰ï¼Œè¿”å› 0ã€‚</span><br><span class="hljs-comment"># æ³¨æ„ï¼šå­—ç¬¦ä¸²é»˜è®¤æŒ‰ç…§ASCIIç å¤§å°æ¥æ¯”è¾ƒï¼Œ&#x27;Z&#x27;çš„ASCIIç æ¯”&#x27;a&#x27;å°ï¼Œå³å¤§å†™çš„å­—æ¯ä¼šæ’åœ¨å‰é¢ã€‚</span><br><span class="hljs-comment"># å€’åºæ’åº</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">reversed_cmp</span>(<span class="hljs-params">x, y</span>):<br>    <span class="hljs-keyword">if</span> x &gt; y:<br>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br>    <span class="hljs-keyword">if</span> x &lt; y:<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br><br><span class="hljs-built_in">sorted</span>([<span class="hljs-number">36</span>, <span class="hljs-number">5</span>, <span class="hljs-number">12</span>, <span class="hljs-number">9</span>, <span class="hljs-number">21</span>], reversed_cmp)<br><br><span class="hljs-comment"># è¿”å›å‡½æ•°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">calc_prod</span>(<span class="hljs-params">lst</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">lazy_prod</span>():<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">f</span>(<span class="hljs-params">x,y</span>):<br>            <span class="hljs-keyword">return</span> x * y<br>        <span class="hljs-keyword">return</span> reduce(f, lst, <span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">return</span> lazy_prod<br><br>f = calc_prod([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>])<br><span class="hljs-built_in">print</span> f()<br></code></pre></td></tr></table></figure><h3 id="python-ä¸­çš„é—­åŒ…"><a href="#python-ä¸­çš„é—­åŒ…" class="headerlink" title="python ä¸­çš„é—­åŒ…"></a>python ä¸­çš„é—­åŒ…</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># python ä¸­çš„é—­åŒ…</span><br><span class="hljs-comment"># å¸Œæœ›ä¸€æ¬¡è¿”å›3ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«è®¡ç®—1x1,2x2,3x3ã€‚ä½†å®é™…ç»“æœï¼šå…¨éƒ¨éƒ½æ˜¯ 9ï¼ŒåŸå› å°±æ˜¯å½“count()å‡½æ•°è¿”å›äº†3ä¸ªå‡½æ•°æ—¶ï¼Œè¿™3ä¸ªå‡½æ•°æ‰€å¼•ç”¨çš„å˜é‡ i çš„å€¼å·²ç»å˜æˆäº†3ã€‚ç”±äºf1ã€f2ã€f3å¹¶æ²¡æœ‰è¢«è°ƒç”¨ï¼Œæ‰€ä»¥ï¼Œæ­¤æ—¶ä»–ä»¬å¹¶æœªè®¡ç®— i*i</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">count</span>():<br>    fs = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>):<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">f</span>():<br>             <span class="hljs-keyword">return</span> i*i<br>        fs.append(f)<br>    <span class="hljs-keyword">return</span> fs<br>f1, f2, f3 = count()<br><span class="hljs-comment"># ä¿®æ”¹åï¼šfå‡½æ•°å¯ä»¥æ­£ç¡®åœ°è¿”å›ä¸€ä¸ªé—­åŒ…gï¼Œgæ‰€å¼•ç”¨çš„å˜é‡jä¸æ˜¯å¾ªç¯å˜é‡ï¼Œå› æ­¤å°†æ­£å¸¸æ‰§è¡Œã€‚</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">count</span>():<br>    fs = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>):<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">f</span>(<span class="hljs-params">j</span>):<br>            <span class="hljs-keyword">def</span> <span class="hljs-title function_">g</span>():<br>                <span class="hljs-keyword">return</span> j*j<br>            <span class="hljs-keyword">return</span> g<br>        r = f(i)<br>        fs.append(r)<br>    <span class="hljs-keyword">return</span> fs<br>f1, f2, f3 = count()<br><span class="hljs-built_in">print</span> f1(), f2(), f3()<br></code></pre></td></tr></table></figure><h3 id="python-ä¸­çš„åŒ¿åå‡½æ•°-lambda-è¡¨è¾¾å¼"><a href="#python-ä¸­çš„åŒ¿åå‡½æ•°-lambda-è¡¨è¾¾å¼" class="headerlink" title="python ä¸­çš„åŒ¿åå‡½æ•° lambda è¡¨è¾¾å¼"></a>python ä¸­çš„åŒ¿åå‡½æ•° lambda è¡¨è¾¾å¼</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># python ä¸­çš„åŒ¿åå‡½æ•° lambda è¡¨è¾¾å¼</span><br><span class="hljs-comment"># åŒ¿åå‡½æ•°æœ‰ä¸ªé™åˆ¶ï¼Œå°±æ˜¯åªèƒ½æœ‰ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œä¸å†™returnï¼Œè¿”å›å€¼å°±æ˜¯è¯¥è¡¨è¾¾å¼çš„ç»“æœã€‚</span><br><span class="hljs-comment"># ä»¥map()å‡½æ•°ä¸ºä¾‹ï¼šlambda x: x * x  å®é™…ä¸Šä»£æ›¿äº†ä¸€ä¸ªè®¡ç®— x*x çš„å‡½æ•°</span><br><span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x: x * x, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>])<br></code></pre></td></tr></table></figure><h3 id="æ— å‚æ•°decorator"><a href="#æ— å‚æ•°decorator" class="headerlink" title="æ— å‚æ•°decorator"></a>æ— å‚æ•°decorator</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ— å‚æ•°decorator</span><br><span class="hljs-comment"># decorator æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œç„¶åï¼Œè¿”å›ä¸€ä¸ªæ–°å‡½æ•°ã€‚ä½¿ç”¨ decorator ç”¨Pythonæä¾›çš„ @ è¯­æ³•</span><br><span class="hljs-comment"># å³ï¼šå¯¹äºåŠ äº†@xxx çš„å‡½æ•°æœ¬èº«è¿›è¡ŒåŠŸèƒ½æ‰©å±•</span><br><br><span class="hljs-comment"># ä¾‹å­1</span><br><span class="hljs-comment"># å®šä¹‰ä¸€ä¸ª @logCallMethodName æ¥è®°å½•è¢«è°ƒç”¨çš„å‡½æ•°å</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">logCallMethodName</span>(<span class="hljs-params">f</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params">x</span>):<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;call &#x27;</span> + f.__name__ + <span class="hljs-string">&#x27;()...&#x27;</span><br>        <span class="hljs-keyword">return</span> f(x)<br>    <span class="hljs-keyword">return</span> fn<br><br><span class="hljs-comment"># å¯¹ä¸€ä¸ªå®ç°é˜¶ä¹˜çš„å‡½æ•°æ·»åŠ  @logCallMethodName</span><br><span class="hljs-meta">@logCallMethodName</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">factorial</span>(<span class="hljs-params">n</span>):<br>    <span class="hljs-keyword">return</span> reduce(<span class="hljs-keyword">lambda</span> x,y: x*y, <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n+<span class="hljs-number">1</span>))<br><br><span class="hljs-comment"># è°ƒç”¨å‡½æ•°</span><br><span class="hljs-built_in">print</span> factorial(<span class="hljs-number">10</span>)<br><br><span class="hljs-comment"># è¾“å‡ºå†…å®¹</span><br>call factorial()...<br><span class="hljs-number">3628800</span><br><br><span class="hljs-comment"># ä½†æ˜¯è¢«åŠ @logCallMethodName çš„å‡½æ•°å¿…é¡»æ˜¯åªèƒ½æœ‰ä¸€ä¸ªå‚æ•°ï¼Œä»¥ä¸‹çš„ä»£ç å°±ä¼šæŠ¥é”™</span><br><span class="hljs-meta">@logCallMethodName</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">x, y</span>):<br>    <span class="hljs-keyword">return</span> x + y<br><span class="hljs-built_in">print</span> add(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)<br><br><span class="hljs-comment"># å¦‚æœè¦è‡ªé€‚åº”ä»»ä½•å‚æ•°å®šä¹‰çš„å‡½æ•°ï¼Œå¯ä»¥åˆ©ç”¨Pythonçš„ *args å’Œ **kwï¼Œä¿è¯ä»»æ„ä¸ªæ•°çš„å‚æ•°æ€»æ˜¯èƒ½æ­£å¸¸è°ƒç”¨ï¼š</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">log</span>(<span class="hljs-params">f</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params">*args, **kw</span>):<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;call &#x27;</span> + f.__name__ + <span class="hljs-string">&#x27;()...&#x27;</span><br>        <span class="hljs-keyword">return</span> f(*args, **kw)<br>    <span class="hljs-keyword">return</span> fn<br><br><br><span class="hljs-comment"># ä¾‹å­2</span><br><span class="hljs-comment"># @performanceï¼Œå®ƒå¯ä»¥æ‰“å°å‡ºå‡½æ•°è°ƒç”¨çš„æ—¶é—´ã€‚</span><br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-comment"># å£°æ˜@</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">performance</span>(<span class="hljs-params">f</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params">*args, **kw</span>):<br>        startTime = time.time()<br>        r = f(*args, **kw)<br>        endTime = time.time()<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;call %s() in %fs&#x27;</span> %(f.__name__, (endTime - startTime))<br>        <span class="hljs-keyword">return</span> r<br>    <span class="hljs-keyword">return</span> fn<br><br><span class="hljs-comment"># ç»™å‡½æ•°æ·»åŠ  @</span><br><span class="hljs-meta">@performance</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">factorial</span>(<span class="hljs-params">n</span>):<br>    <span class="hljs-keyword">return</span> reduce(<span class="hljs-keyword">lambda</span> x,y: x*y, <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n+<span class="hljs-number">1</span>))<br><span class="hljs-comment"># å‡½æ•°è°ƒç”¨</span><br><span class="hljs-built_in">print</span> factorial(<span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure><h3 id="å¸¦å‚æ•°decorator"><a href="#å¸¦å‚æ•°decorator" class="headerlink" title="å¸¦å‚æ•°decorator"></a>å¸¦å‚æ•°decorator</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å¸¦å‚æ•°decorator</span><br><span class="hljs-comment"># å¯¹äºä»¥ä¸‹çš„è£…é¥°å‡½æ•°ï¼Œå¯ä»¥å‘ç°ï¼Œå¯¹äºè¢«è£…é¥°çš„å‡½æ•°ï¼Œlogæ‰“å°çš„è¯­å¥æ˜¯ä¸èƒ½å˜çš„ï¼ˆé™¤äº†å‡½æ•°åï¼‰ã€‚</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">log</span>(<span class="hljs-params">f</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params">x</span>):<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;call &#x27;</span> + f.__name__ + <span class="hljs-string">&#x27;()...&#x27;</span><br>        <span class="hljs-keyword">return</span> f(x)<br>    <span class="hljs-keyword">return</span> fn<br><span class="hljs-comment"># å¸Œæœ›æ‰“å°å‡º&#x27;[INFO] call xxx()...&#x27;ï¼Œæœ‰çš„å‡½æ•°ä¸å¤ªé‡è¦ï¼Œå¸Œæœ›æ‰“å°å‡º&#x27;[DEBUG] call xxx()...&#x27;ï¼Œè¿™æ—¶ï¼Œlogå‡½æ•°æœ¬èº«å°±éœ€è¦ä¼ å…¥&#x27;INFO&#x27;æˆ–&#x27;DEBUG&#x27;è¿™æ ·çš„å‚æ•°</span><br><span class="hljs-comment"># ç±»ä¼¼äºï¼š</span><br><span class="hljs-meta">@log(<span class="hljs-params"><span class="hljs-string">&#x27;DEBUG&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_func</span>():<br>    ...<br><br>ä¸Šé¢çš„å†™æ³•ç®€å•ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼š<br>log_decorator = log(<span class="hljs-string">&#x27;DEBUG&#x27;</span>)<br>my_func = log_decorator(my_func)<br>åˆç›¸å½“äºï¼š<br>log_decorator = log(<span class="hljs-string">&#x27;DEBUG&#x27;</span>)<br><span class="hljs-meta">@log_decorator</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_func</span>():<br>    ...<br><br><span class="hljs-comment"># äºæ˜¯æœ‰äº†å¦‚ä¸‹çš„ä¸‰å±‚åµŒå¥—çš„ä»£ç </span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">log</span>(<span class="hljs-params">prefix</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">log_decorator</span>(<span class="hljs-params">f</span>):<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kw</span>):<br>            <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;[%s] %s()...&#x27;</span> % (prefix, f.__name__)<br>            <span class="hljs-keyword">return</span> f(*args, **kw)<br>        <span class="hljs-keyword">return</span> wrapper<br>    <span class="hljs-keyword">return</span> log_decorator<br><br><span class="hljs-meta">@log(<span class="hljs-params"><span class="hljs-string">&#x27;DEBUG&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test</span>():<br>    <span class="hljs-keyword">pass</span><br><span class="hljs-built_in">print</span> test()<br><br><span class="hljs-comment"># æ‹†åˆ†å¼€å°±æ˜¯ï¼š</span><br><span class="hljs-comment"># æ ‡å‡†decorator:</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">log_decorator</span>(<span class="hljs-params">f</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kw</span>):<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;[%s] %s()...&#x27;</span> % (prefix, f.__name__)<br>        <span class="hljs-keyword">return</span> f(*args, **kw)<br>    <span class="hljs-keyword">return</span> wrapper<br><span class="hljs-keyword">return</span> log_decorator<br><span class="hljs-comment"># è¿”å›decorator:</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">log</span>(<span class="hljs-params">prefix</span>):<br>    <span class="hljs-keyword">return</span> log_decorator(f)<br><span class="hljs-comment"># æ‹†å¼€ä¹‹åè°ƒç”¨ä¼šå¤±è´¥ï¼Œå› ä¸ºåœ¨3å±‚åµŒå¥—çš„decoratorå®šä¹‰ä¸­ï¼Œæœ€å†…å±‚çš„wrapperå¼•ç”¨äº†æœ€å¤–å±‚çš„å‚æ•°prefixï¼Œæ‰€ä»¥ï¼ŒæŠŠä¸€ä¸ªé—­åŒ…æ‹†æˆæ™®é€šçš„å‡½æ•°è°ƒç”¨ä¼šæ¯”è¾ƒå›°éš¾ã€‚</span><br><br><span class="hljs-comment"># ä¾‹å­2</span><br><span class="hljs-comment"># å°† æ— å‚æ•°decorator ä¸­ä¾‹å­2ä¿®æ”¹ä¸ºå‚æ•°è¾“å…¥ &#x27;s&#x27;æˆ–&#x27;ms&#x27; æ¥æ§åˆ¶è¾“å‡ºçš„è°ƒç”¨æ—¶é—´å•ä½ã€‚</span><br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">performance</span>(<span class="hljs-params">unit</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">perf_decorator</span>(<span class="hljs-params">f</span>):<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kw</span>):<br>            startTime = time.time()<br>            r = f(*args, **kw)<br>            endTime = time.time()<br>            costTime = (endTime - startTime) * <span class="hljs-number">1000</span> <span class="hljs-keyword">if</span> unit == <span class="hljs-string">&#x27;ms&#x27;</span> <span class="hljs-keyword">else</span> endTime - startTime<br>            <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;call %s() in %f %s&#x27;</span> % (f.__name__, costTime, unit)<br>            <span class="hljs-keyword">return</span> r<br>        <span class="hljs-keyword">return</span> wrapper<br>    <span class="hljs-keyword">return</span> perf_decorator<br><br><span class="hljs-meta">@performance(<span class="hljs-params"><span class="hljs-string">&#x27;ms&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">factorial</span>(<span class="hljs-params">n</span>):<br>    <span class="hljs-keyword">return</span> reduce(<span class="hljs-keyword">lambda</span> x,y: x*y, <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, n+<span class="hljs-number">1</span>))<br><br><span class="hljs-built_in">print</span> factorial(<span class="hljs-number">10</span>)<br><br><span class="hljs-comment"># éœ€è¦æ³¨æ„çš„æ˜¯ï¼šdecorator è£…é¥°å‡½æ•°è¿”å›çš„å‡½æ•°æ˜¯ä¸åŒäºåŸæœ‰å‡½æ•°çš„ï¼Œ</span><br><span class="hljs-comment"># æˆ‘ä»¬å¯ä»¥åœ¨ä¸Šé¢æœ€ç»ˆè°ƒç”¨çš„åœ°æ–¹è¾“å‡ºå‡½æ•°åï¼š</span><br><span class="hljs-built_in">print</span> factorial.__name__<br><span class="hljs-comment"># ä¼šå‘ç°ï¼Œå®é™…è¾“å‡ºçš„æ˜¯ wrapperï¼Œå³ï¼šæˆ‘ä»¬åœ¨è£…é¥°å‡½æ•°å†…æ‰€è¿”å›çš„å‡½æ•°åã€‚</span><br><span class="hljs-comment"># è¿™æ—¶Pythonå†…ç½®çš„ functools å¯ä»¥æŠŠåŸå‡½æ•°çš„ä¸€äº›å±æ€§å¤åˆ¶åˆ°æ–°å‡½æ•°ä¸­ï¼ˆ@functools.wrapsåº”è¯¥ä½œç”¨åœ¨è¿”å›çš„æ–°å‡½æ•°ä¸Šã€‚ï¼‰</span><br><span class="hljs-keyword">import</span> time, functools<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">performance</span>(<span class="hljs-params">unit</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">perf_decorator</span>(<span class="hljs-params">f</span>):<br><span class="hljs-meta">        @functools.wraps(<span class="hljs-params">f</span>)</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kw</span>):<br>            ...<br></code></pre></td></tr></table></figure><h3 id="åå‡½æ•°functools-partial"><a href="#åå‡½æ•°functools-partial" class="headerlink" title="åå‡½æ•°functools.partial"></a>åå‡½æ•°functools.partial</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åå‡½æ•°functools.partial</span><br><span class="hljs-comment"># å½“ä¸€ä¸ªå‡½æ•°æœ‰å¾ˆå¤šå‚æ•°æ—¶ï¼Œè°ƒç”¨è€…å°±éœ€è¦æä¾›å¤šä¸ªå‚æ•°ã€‚å¦‚æœå‡å°‘å‚æ•°ä¸ªæ•°ï¼Œå°±å¯ä»¥ç®€åŒ–è°ƒç”¨è€…çš„è´Ÿæ‹…ã€‚</span><br><span class="hljs-comment"># æ¯”å¦‚ï¼Œint()å‡½æ•°å¯ä»¥æŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°ï¼Œå½“ä»…ä¼ å…¥å­—ç¬¦ä¸²æ—¶ï¼Œint()å‡½æ•°é»˜è®¤æŒ‰åè¿›åˆ¶è½¬æ¢ï¼š</span><br><span class="hljs-built_in">print</span> <span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;12345&#x27;</span>)<br><span class="hljs-comment"># ä½†int()å‡½æ•°è¿˜æä¾›é¢å¤–çš„baseå‚æ•°ï¼Œé»˜è®¤å€¼ä¸º10ã€‚å¦‚æœä¼ å…¥baseå‚æ•°ï¼Œå°±å¯ä»¥åš N è¿›åˆ¶çš„è½¬æ¢ï¼š</span><br><span class="hljs-built_in">print</span> <span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;12345&#x27;</span>, base=<span class="hljs-number">8</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">int</span>(<span class="hljs-string">&#x27;12345&#x27;</span>, <span class="hljs-number">16</span>)<br><span class="hljs-comment"># å‡è®¾è¦è½¬æ¢å¤§é‡çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œæ¯æ¬¡éƒ½ä¼ å…¥int(x, base=2)éå¸¸éº»çƒ¦ï¼Œäºæ˜¯ï¼Œæˆ‘ä»¬æƒ³åˆ°ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªint2()çš„å‡½æ•°ï¼Œé»˜è®¤æŠŠbase=2ä¼ è¿›å»ï¼š</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">int2</span>(<span class="hljs-params">x, base=<span class="hljs-number">2</span></span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">int</span>(x, base)<br><span class="hljs-built_in">print</span> int2(<span class="hljs-string">&#x27;1000000&#x27;</span>)<br><span class="hljs-comment"># functools.partialå°±æ˜¯å¸®åŠ©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåå‡½æ•°çš„ï¼Œä¸éœ€è¦æˆ‘ä»¬è‡ªå·±å®šä¹‰int2()ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ä¸‹é¢çš„ä»£ç åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°int2ï¼š</span><br><span class="hljs-keyword">import</span> functools<br>int2 = functools.partial(<span class="hljs-built_in">int</span>, base=<span class="hljs-number">2</span>)<br>int2(<span class="hljs-string">&#x27;1000000&#x27;</span>)<br></code></pre></td></tr></table></figure><h1 id="æ¨¡å—"><a href="#æ¨¡å—" class="headerlink" title="æ¨¡å—"></a>æ¨¡å—</h1><h2 id="åŒºåˆ†åŒ…å’Œæ™®é€šç›®å½•"><a href="#åŒºåˆ†åŒ…å’Œæ™®é€šç›®å½•" class="headerlink" title="åŒºåˆ†åŒ…å’Œæ™®é€šç›®å½•"></a>åŒºåˆ†åŒ…å’Œæ™®é€šç›®å½•</h2><p>åŒ…ä¸‹é¢ä¸€å®šè¦æœ‰ä¸€ä¸ª__init__.pyæ–‡ä»¶ï¼ˆä¸”æ¯ä¸€å±‚éƒ½è¦æœ‰ï¼‰,å“ªæ€•æ˜¯ä¸€ä¸ªç©ºæ–‡ä»¶ã€‚</p><p><img src="/20200727140000/Image.png" alt="Image"></p><h2 id="å¯¼å…¥æ¨¡å—"><a href="#å¯¼å…¥æ¨¡å—" class="headerlink" title="å¯¼å…¥æ¨¡å—"></a>å¯¼å…¥æ¨¡å—</h2><p>è¦ä½¿ç”¨ä¸€ä¸ªæ¨¡å—ï¼Œæˆ‘ä»¬å¿…é¡»é¦–å…ˆå¯¼å…¥è¯¥æ¨¡å—ã€‚Pythonä½¿ç”¨importè¯­å¥å¯¼å…¥ä¸€ä¸ªæ¨¡å—ã€‚ä¾‹å¦‚ï¼Œå¯¼å…¥ç³»ç»Ÿè‡ªå¸¦çš„æ¨¡å— mathï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> math<br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬åªå¸Œæœ›å¯¼å…¥ç”¨åˆ°çš„mathæ¨¡å—çš„æŸå‡ ä¸ªå‡½æ•°ï¼Œè€Œä¸æ˜¯æ‰€æœ‰å‡½æ•°ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„è¯­å¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> <span class="hljs-built_in">pow</span>, sin, log<br></code></pre></td></tr></table></figure><p>å¦‚æœé‡åˆ°åå­—å†²çªæ€ä¹ˆåŠï¼Ÿæ¯”å¦‚mathæ¨¡å—æœ‰ä¸€ä¸ªlogå‡½æ•°ï¼Œloggingæ¨¡å—ä¹Ÿæœ‰ä¸€ä¸ªlogå‡½æ•°ï¼Œå¦‚æœåŒæ—¶ä½¿ç”¨ï¼Œå¦‚ä½•è§£å†³åå­—å†²çªï¼Ÿ</p><p>å¦‚æœä½¿ç”¨importå¯¼å…¥æ¨¡å—åï¼Œç”±äºå¿…é¡»é€šè¿‡æ¨¡å—åå¼•ç”¨å‡½æ•°åï¼Œå› æ­¤ä¸å­˜åœ¨å†²çªï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> math, logging<br><span class="hljs-built_in">print</span> math.log(<span class="hljs-number">10</span>)   <span class="hljs-comment"># è°ƒç”¨çš„æ˜¯mathçš„logå‡½æ•°</span><br>logging.log(<span class="hljs-number">10</span>, <span class="hljs-string">&#x27;something&#x27;</span>)   <span class="hljs-comment"># è°ƒç”¨çš„æ˜¯loggingçš„logå‡½æ•°</span><br></code></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨ fromâ€¦import å¯¼å…¥ log å‡½æ•°ï¼ŒåŠ¿å¿…å¼•èµ·å†²çªã€‚è¿™æ—¶ï¼Œå¯ä»¥ç»™å‡½æ•°èµ·ä¸ªâ€œåˆ«åâ€æ¥é¿å…å†²çªï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> math <span class="hljs-keyword">import</span> log<br><span class="hljs-keyword">from</span> logging <span class="hljs-keyword">import</span> log <span class="hljs-keyword">as</span> logger   <span class="hljs-comment"># loggingçš„logç°åœ¨å˜æˆäº†logger</span><br><span class="hljs-built_in">print</span> log(<span class="hljs-number">10</span>)   <span class="hljs-comment"># è°ƒç”¨çš„æ˜¯mathçš„log</span><br>logger(<span class="hljs-number">10</span>, <span class="hljs-string">&#x27;import from logging&#x27;</span>)   <span class="hljs-comment"># è°ƒç”¨çš„æ˜¯loggingçš„log</span><br></code></pre></td></tr></table></figure><p>æ‰€ä»¥å¯¼å…¥æ¨¡å—çš„æ–¹å¼å¯æ€»ç»“å¦‚ä¸‹å››ç§ï¼ˆä»¥å¯¼å…¥Pythonçš„os.pathæ¨¡å—ä¸ºä¾‹ï¼Œè¯¥æ¨¡å—æä¾›äº† isdir() å’Œ isfile()å‡½æ•°ï¼Œåˆ¤æ–­æŒ‡å®šçš„ç›®å½•å’Œæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> os.path<br><span class="hljs-keyword">from</span> os <span class="hljs-keyword">import</span> path<br><span class="hljs-keyword">from</span> os.path <span class="hljs-keyword">import</span> isdir, isfile<br></code></pre></td></tr></table></figure><p>pythonä¸­åŠ¨æ€å¯¼å…¥æ¨¡å—ï¼ˆå¯¼å…¥æ¨¡å—æ—¶å‡ºç°å¼‚å¸¸çš„å¤„ç†ï¼‰</p><p>å¦‚æœå¯¼å…¥çš„æ¨¡å—ä¸å­˜åœ¨ï¼ŒPythonè§£é‡Šå™¨ä¼šæŠ¥ ImportError é”™è¯¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>ImportError: No module named something<br></code></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼šPython 2.6&#x2F;2.7æä¾›äº†json æ¨¡å—ï¼Œä½†Python 2.5ä»¥åŠæ›´æ—©ç‰ˆæœ¬æ²¡æœ‰jsonæ¨¡å—ï¼Œä¸è¿‡å¯ä»¥å®‰è£…ä¸€ä¸ªsimplejsonæ¨¡å—ï¼Œè¿™ä¸¤ä¸ªæ¨¡å—æä¾›çš„å‡½æ•°ç­¾åå’ŒåŠŸèƒ½éƒ½ä¸€æ¨¡ä¸€æ ·ã€‚</p><p>æ‰€ä»¥å¯¼å…¥æ–¹å¼å¯ä»¥ä»¥å¦‚ä¸‹çš„æ–¹å¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">try</span>:<br>    <span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">except</span> ImportError:<br>    <span class="hljs-keyword">import</span> simplejson <span class="hljs-keyword">as</span> json<br></code></pre></td></tr></table></figure><h3 id="å®‰è£…ç¬¬ä¸‰æ–¹æ¨¡å—"><a href="#å®‰è£…ç¬¬ä¸‰æ–¹æ¨¡å—" class="headerlink" title="å®‰è£…ç¬¬ä¸‰æ–¹æ¨¡å—"></a>å®‰è£…ç¬¬ä¸‰æ–¹æ¨¡å—</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æ–¹å¼1</span><br>easy_install<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æ–¹å¼2(æ¨è,å·²å†…ç½®åˆ°2.7+)</span><br>pip install<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ–¹æ¨¡å—å¯ä»¥ä»ä»¥ä¸‹åœ°å€è·å–åˆ°ï¼š</p><p><a href="https://pypi.org/">https://pypi.org/</a></p><h1 id="ç±»ä¸å®ä¾‹"><a href="#ç±»ä¸å®ä¾‹" class="headerlink" title="ç±»ä¸å®ä¾‹"></a>ç±»ä¸å®ä¾‹</h1><h2 id="å®šä¹‰ç±»å¹¶åˆ›å»ºå®ä¾‹"><a href="#å®šä¹‰ç±»å¹¶åˆ›å»ºå®ä¾‹" class="headerlink" title="å®šä¹‰ç±»å¹¶åˆ›å»ºå®ä¾‹"></a>å®šä¹‰ç±»å¹¶åˆ›å»ºå®ä¾‹</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><p>æŒ‰ç…§ Python çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œç±»åä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼Œç´§æ¥ç€æ˜¯(object)ï¼Œè¡¨ç¤ºè¯¥ç±»æ˜¯ä»å“ªä¸ªç±»ç»§æ‰¿ä¸‹æ¥çš„ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">pass</span><br>xiaoming = Person()<br>xiaohong = Person()<br><span class="hljs-built_in">print</span> xiaoming<br><span class="hljs-built_in">print</span> xiaohong<br><span class="hljs-built_in">print</span> xiaoming == xiaohong<br></code></pre></td></tr></table></figure><p>å®ä¾‹èµ‹å€¼ï¼šï¼ˆä¸¤ä¸ª Person ç±»çš„å®ä¾‹çš„ listï¼Œå¹¶ç»™ä¸¤ä¸ªå®ä¾‹çš„ name èµ‹å€¼ï¼Œç„¶åæŒ‰ç…§ name è¿›è¡Œæ’åºã€‚ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">pass</span><br><br>p1 = Person()<br>p1.name = <span class="hljs-string">&#x27;Bart&#x27;</span><br><br>p2 = Person()<br>p2.name = <span class="hljs-string">&#x27;Adam&#x27;</span><br><br>p3 = Person()<br>p3.name = <span class="hljs-string">&#x27;Lisa&#x27;</span><br><br>L1 = [p1, p2, p3]<br>L2 = <span class="hljs-built_in">sorted</span>(L1, <span class="hljs-keyword">lambda</span> p1, p2: cmp(p1.name, p2.name))<br><br><span class="hljs-built_in">print</span> L2[<span class="hljs-number">0</span>].name<br><span class="hljs-built_in">print</span> L2[<span class="hljs-number">1</span>].name<br><span class="hljs-built_in">print</span> L2[<span class="hljs-number">2</span>].name<br></code></pre></td></tr></table></figure><h2 id="åˆå§‹åŒ–å®ä¾‹å±æ€§ï¼ˆç±»ä¼¼ä¸Javaçš„æ„é€ å‡½æ•°ï¼‰"><a href="#åˆå§‹åŒ–å®ä¾‹å±æ€§ï¼ˆç±»ä¼¼ä¸Javaçš„æ„é€ å‡½æ•°ï¼‰" class="headerlink" title="åˆå§‹åŒ–å®ä¾‹å±æ€§ï¼ˆç±»ä¼¼ä¸Javaçš„æ„é€ å‡½æ•°ï¼‰"></a>åˆå§‹åŒ–å®ä¾‹å±æ€§ï¼ˆç±»ä¼¼ä¸Javaçš„æ„é€ å‡½æ•°ï¼‰</h2><p>åœ¨å®šä¹‰ Person ç±»æ—¶ï¼Œå¯ä»¥ä¸ºPersonç±»æ·»åŠ ä¸€ä¸ªç‰¹æ®Šçš„__init__()æ–¹æ³•ï¼Œå½“åˆ›å»ºå®ä¾‹æ—¶ï¼Œ<strong>init</strong>()æ–¹æ³•è¢«è‡ªåŠ¨è°ƒç”¨ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨æ­¤ä¸ºæ¯ä¸ªå®ä¾‹éƒ½ç»Ÿä¸€åŠ ä¸Šä»¥ä¸‹å±æ€§ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, gender, birth</span>):<br>        self.name = name<br>        self.gender = gender<br>        self.birth = birth<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼š<strong>init</strong>() æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯ selfï¼ˆä¹Ÿå¯ä»¥ç”¨åˆ«çš„åå­—ï¼Œä½†å»ºè®®ä½¿ç”¨ä¹ æƒ¯ç”¨æ³•ï¼‰ï¼Œåç»­å‚æ•°åˆ™å¯ä»¥è‡ªç”±æŒ‡å®šï¼Œå’Œå®šä¹‰å‡½æ•°æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚ç›¸åº”åœ°ï¼Œåˆ›å»ºå®ä¾‹æ—¶ï¼Œå°±å¿…é¡»è¦æä¾›é™¤ self ä»¥å¤–çš„å‚æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">xiaoming = Person(<span class="hljs-string">&#x27;Xiao Ming&#x27;</span>, <span class="hljs-string">&#x27;Male&#x27;</span>, <span class="hljs-string">&#x27;1991-1-1&#x27;</span>)<br>xiaohong = Person(<span class="hljs-string">&#x27;Xiao Hong&#x27;</span>, <span class="hljs-string">&#x27;Female&#x27;</span>, <span class="hljs-string">&#x27;1992-2-2&#x27;</span>)<br></code></pre></td></tr></table></figure><p>è®¿é—®å±æ€§ä½¿ç”¨ <code>.</code> æ“ä½œç¬¦ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span> xiaoming.name<br><span class="hljs-comment"># è¾“å‡º &#x27;Xiao Ming&#x27;</span><br><span class="hljs-built_in">print</span> xiaohong.birth<br><span class="hljs-comment"># è¾“å‡º &#x27;1992-2-2&#x27;</span><br></code></pre></td></tr></table></figure><p>å®šä¹‰Personç±»çš„__init__æ–¹æ³•ï¼Œé™¤äº†æ¥å— nameã€gender å’Œ birth å¤–ï¼Œè¿˜å¯æ¥å—ä»»æ„å…³é”®å­—å‚æ•°ï¼Œå¹¶æŠŠä»–ä»¬éƒ½ä½œä¸ºå±æ€§èµ‹å€¼ç»™å®ä¾‹ï¼š</p><p>(è¿˜å¯ä»¥é€šè¿‡ setattr(self, â€˜nameâ€™, â€˜xxxâ€™) è®¾ç½®å±æ€§ã€‚)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, gender, birth, **kw</span>):<br>        self.name = name<br>        self.gender = gender<br>        self.birth = birth<br>        <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> kw.iteritems():<br>            <span class="hljs-built_in">setattr</span>(self, k, v)<br>xiaoming = Person(<span class="hljs-string">&#x27;Xiao Ming&#x27;</span>, <span class="hljs-string">&#x27;Male&#x27;</span>, <span class="hljs-string">&#x27;1990-1-1&#x27;</span>, job=<span class="hljs-string">&#x27;Student&#x27;</span>)<br><span class="hljs-built_in">print</span> xiaoming.name<br><span class="hljs-built_in">print</span> xiaoming.job<br></code></pre></td></tr></table></figure><h2 id="å¯¹è±¡å±æ€§è®¿é—®æ§åˆ¶"><a href="#å¯¹è±¡å±æ€§è®¿é—®æ§åˆ¶" class="headerlink" title="å¯¹è±¡å±æ€§è®¿é—®æ§åˆ¶"></a>å¯¹è±¡å±æ€§è®¿é—®æ§åˆ¶</h2><p>Pythonå¯¹å±æ€§æƒé™çš„æ§åˆ¶æ˜¯é€šè¿‡å±æ€§åæ¥å®ç°çš„ï¼Œå¦‚æœä¸€ä¸ªå±æ€§ç”±åŒä¸‹åˆ’çº¿å¼€å¤´(__)ï¼Œè¯¥å±æ€§å°±æ— æ³•è¢«å¤–éƒ¨è®¿é—®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, score</span>):<br>        self.name = name<br>        self.__score = score<br><br>p = Person(<span class="hljs-string">&#x27;Bob&#x27;</span>, <span class="hljs-number">59</span>)<br><br><span class="hljs-built_in">print</span> p.name<br><span class="hljs-built_in">print</span> p.__score<br></code></pre></td></tr></table></figure><h2 id="pythonä¸­åˆ›å»ºç±»å±æ€§ï¼ˆç±»ä¼¼äºJavaä¸­çš„é™æ€å˜é‡ï¼‰"><a href="#pythonä¸­åˆ›å»ºç±»å±æ€§ï¼ˆç±»ä¼¼äºJavaä¸­çš„é™æ€å˜é‡ï¼‰" class="headerlink" title="pythonä¸­åˆ›å»ºç±»å±æ€§ï¼ˆç±»ä¼¼äºJavaä¸­çš„é™æ€å˜é‡ï¼‰"></a>pythonä¸­åˆ›å»ºç±»å±æ€§ï¼ˆç±»ä¼¼äºJavaä¸­çš„é™æ€å˜é‡ï¼‰</h2><p>ç±»æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¦‚æœåœ¨ç±»ä¸Šç»‘å®šä¸€ä¸ªå±æ€§ï¼Œåˆ™æ‰€æœ‰å®ä¾‹éƒ½å¯ä»¥è®¿é—®ç±»çš„å±æ€§ï¼Œå¹¶ä¸”ï¼Œæ‰€æœ‰å®ä¾‹è®¿é—®çš„ç±»å±æ€§éƒ½æ˜¯åŒä¸€ä¸ªï¼ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ä¾‹å±æ€§æ¯ä¸ªå®ä¾‹å„è‡ªæ‹¥æœ‰ï¼Œäº’ç›¸ç‹¬ç«‹ï¼Œè€Œç±»å±æ€§æœ‰ä¸”åªæœ‰ä¸€ä»½ã€‚</p><p>å®šä¹‰ç±»å±æ€§å¯ä»¥ç›´æ¥åœ¨ class ä¸­å®šä¹‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    address = <span class="hljs-string">&#x27;Earth&#x27;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name</span>):<br>        self.name = name<br></code></pre></td></tr></table></figure><p>è·å–ç±»å±æ€§ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span> Person.address<br><span class="hljs-comment"># =&gt; Earth</span><br></code></pre></td></tr></table></figure><p>å¯¹ä¸€ä¸ªå®ä¾‹è°ƒç”¨ç±»çš„å±æ€§ä¹Ÿæ˜¯å¯ä»¥è®¿é—®çš„ï¼Œæ‰€æœ‰å®ä¾‹éƒ½å¯ä»¥è®¿é—®åˆ°å®ƒæ‰€å±çš„ç±»çš„å±æ€§ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">p1 = Person(<span class="hljs-string">&#x27;Bob&#x27;</span>)<br>p2 = Person(<span class="hljs-string">&#x27;Alice&#x27;</span>)<br><span class="hljs-built_in">print</span> p1.address<br><span class="hljs-comment"># =&gt; Earth</span><br><span class="hljs-built_in">print</span> p2.address<br><span class="hljs-comment"># =&gt; Earth</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">Person.address = <span class="hljs-string">&#x27;China&#x27;</span><br><span class="hljs-built_in">print</span> p1.address<br><span class="hljs-comment"># =&gt; &#x27;China&#x27;</span><br><span class="hljs-built_in">print</span> p2.address<br><span class="hljs-comment"># =&gt; &#x27;China&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="pythonä¸­ç±»å±æ€§å’Œå®ä¾‹å±æ€§åå­—å†²çª"><a href="#pythonä¸­ç±»å±æ€§å’Œå®ä¾‹å±æ€§åå­—å†²çª" class="headerlink" title="pythonä¸­ç±»å±æ€§å’Œå®ä¾‹å±æ€§åå­—å†²çª"></a>pythonä¸­ç±»å±æ€§å’Œå®ä¾‹å±æ€§åå­—å†²çª</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    address = <span class="hljs-string">&#x27;Earth&#x27;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name</span>):<br>        self.name = name<br><br>p1 = Person(<span class="hljs-string">&#x27;Bob&#x27;</span>)<br>p2 = Person(<span class="hljs-string">&#x27;Alice&#x27;</span>)<br><br><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;Person.address = &#x27;</span> + Person.address<br><br>p1.address = <span class="hljs-string">&#x27;China&#x27;</span><br><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;p1.address = &#x27;</span> + p1.address<br><br><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;Person.address = &#x27;</span> + Person.address<br><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;p2.address = &#x27;</span> + p2.address<br></code></pre></td></tr></table></figure><p>ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">Person.address = Earth<br>p1.address = China<br>Person.address = Earth<br>p2.address = Earth<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç°ï¼Œåœ¨è®¾ç½®äº† p1.address &#x3D; â€˜Chinaâ€™ åï¼Œp1è®¿é—® address ç¡®å®å˜æˆäº† â€˜Chinaâ€™ï¼Œä½†æ˜¯ï¼ŒPerson.addresså’Œp2.addressä»ç„¶æ˜¯â€™Earchâ€™ï¼Œæ€ä¹ˆå›äº‹ï¼Ÿ</p><p>åŸå› æ˜¯ p1.address &#x3D; â€˜Chinaâ€™å¹¶æ²¡æœ‰æ”¹å˜ Person çš„ addressï¼Œè€Œæ˜¯ç»™ p1è¿™ä¸ªå®ä¾‹ç»‘å®šäº†å®ä¾‹å±æ€§address ï¼Œå¯¹p1æ¥è¯´ï¼Œå®ƒæœ‰ä¸€ä¸ªå®ä¾‹å±æ€§addressï¼ˆå€¼æ˜¯â€™Chinaâ€™ï¼‰ï¼Œè€Œå®ƒæ‰€å±çš„ç±»Personä¹Ÿæœ‰ä¸€ä¸ªç±»å±æ€§addressï¼Œæ‰€ä»¥:</p><p>è®¿é—® p1.address æ—¶ï¼Œä¼˜å…ˆæŸ¥æ‰¾å®ä¾‹å±æ€§ï¼Œè¿”å›â€™Chinaâ€™ã€‚</p><p>è®¿é—® p2.address æ—¶ï¼Œp2æ²¡æœ‰å®ä¾‹å±æ€§addressï¼Œä½†æ˜¯æœ‰ç±»å±æ€§addressï¼Œå› æ­¤è¿”å›â€™Earthâ€™ã€‚</p><p>å¯è§ï¼Œå½“å®ä¾‹å±æ€§å’Œç±»å±æ€§é‡åæ—¶ï¼Œå®ä¾‹å±æ€§ä¼˜å…ˆçº§é«˜ï¼Œå®ƒå°†å±è”½æ‰å¯¹ç±»å±æ€§çš„è®¿é—®ã€‚</p><p>å½“æˆ‘ä»¬æŠŠ p1 çš„ address å®ä¾‹å±æ€§åˆ é™¤åï¼Œè®¿é—® p1.address å°±åˆè¿”å›ç±»å±æ€§çš„å€¼ â€˜Earthâ€™äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">del</span> p1.address<br><span class="hljs-built_in">print</span> p1.address<br><span class="hljs-comment"># =&gt; Earth</span><br></code></pre></td></tr></table></figure><p><em><strong>å¯è§ï¼Œåƒä¸‡ä¸è¦åœ¨å®ä¾‹ä¸Šä¿®æ”¹ç±»å±æ€§ï¼Œå®ƒå®é™…ä¸Šå¹¶æ²¡æœ‰ä¿®æ”¹ç±»å±æ€§ï¼Œè€Œæ˜¯ç»™å®ä¾‹ç»‘å®šäº†ä¸€ä¸ªå®ä¾‹å±æ€§ã€‚</strong></em></p><h2 id="pythonä¸­å®šä¹‰å®ä¾‹æ–¹æ³•-ç±»ä¼¼Javaä¸­çš„-getter-x2F-setter-æ–¹æ³•"><a href="#pythonä¸­å®šä¹‰å®ä¾‹æ–¹æ³•-ç±»ä¼¼Javaä¸­çš„-getter-x2F-setter-æ–¹æ³•" class="headerlink" title="pythonä¸­å®šä¹‰å®ä¾‹æ–¹æ³•(ç±»ä¼¼Javaä¸­çš„ getter&#x2F;setter æ–¹æ³•)"></a>pythonä¸­å®šä¹‰å®ä¾‹æ–¹æ³•(ç±»ä¼¼Javaä¸­çš„ getter&#x2F;setter æ–¹æ³•)</h2><p>ä¸€ä¸ªå®ä¾‹çš„ç§æœ‰å±æ€§å°±æ˜¯ä»¥__å¼€å¤´çš„å±æ€§ï¼Œæ— æ³•è¢«å¤–éƒ¨è®¿é—®ï¼Œé‚£è¿™äº›å±æ€§å®šä¹‰æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p><p>è™½ç„¶ç§æœ‰å±æ€§æ— æ³•ä»å¤–éƒ¨è®¿é—®ï¼Œä½†æ˜¯ï¼Œä»ç±»çš„å†…éƒ¨æ˜¯å¯ä»¥è®¿é—®çš„ã€‚é™¤äº†å¯ä»¥å®šä¹‰å®ä¾‹çš„å±æ€§å¤–ï¼Œè¿˜å¯ä»¥å®šä¹‰å®ä¾‹çš„æ–¹æ³•ã€‚</p><p>å®ä¾‹çš„æ–¹æ³•å°±æ˜¯åœ¨ç±»ä¸­å®šä¹‰çš„å‡½æ•°ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ°¸è¿œæ˜¯ selfï¼ŒæŒ‡å‘è°ƒç”¨è¯¥æ–¹æ³•çš„å®ä¾‹æœ¬èº«ï¼Œå…¶ä»–å‚æ•°å’Œä¸€ä¸ªæ™®é€šå‡½æ•°æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name</span>):<br>        self.__name = name<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_name</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self.__name<br><br>p1 = Person(<span class="hljs-string">&#x27;Bob&#x27;</span>)<br><span class="hljs-built_in">print</span> p1.get_name()  <span class="hljs-comment"># selfä¸éœ€è¦æ˜¾å¼ä¼ å…¥</span><br><span class="hljs-comment"># =&gt; Bob</span><br></code></pre></td></tr></table></figure><p>ä¾‹2ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, score</span>):<br>        self.name = name<br>        self.__score = score<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_grade</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">if</span> self.__score &gt;= <span class="hljs-number">80</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;A&#x27;</span><br>        <span class="hljs-keyword">if</span> self.__score &gt;= <span class="hljs-number">60</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;B&#x27;</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;C&#x27;</span><br><br>p1 = Person(<span class="hljs-string">&#x27;Bob&#x27;</span>, <span class="hljs-number">90</span>)<br>p2 = Person(<span class="hljs-string">&#x27;Alice&#x27;</span>, <span class="hljs-number">65</span>)<br>p3 = Person(<span class="hljs-string">&#x27;Tim&#x27;</span>, <span class="hljs-number">48</span>)<br><br><span class="hljs-built_in">print</span> p1.get_grade()<br><span class="hljs-built_in">print</span> p2.get_grade()<br><span class="hljs-built_in">print</span> p3.get_grade()<br></code></pre></td></tr></table></figure><h2 id="pythonä¸­å®šä¹‰ç±»æ–¹æ³•ï¼ˆç±»ä¼¼Javaä¸­çš„é™æ€æ–¹æ³•ï¼‰"><a href="#pythonä¸­å®šä¹‰ç±»æ–¹æ³•ï¼ˆç±»ä¼¼Javaä¸­çš„é™æ€æ–¹æ³•ï¼‰" class="headerlink" title="pythonä¸­å®šä¹‰ç±»æ–¹æ³•ï¼ˆç±»ä¼¼Javaä¸­çš„é™æ€æ–¹æ³•ï¼‰"></a>pythonä¸­å®šä¹‰ç±»æ–¹æ³•ï¼ˆç±»ä¼¼Javaä¸­çš„é™æ€æ–¹æ³•ï¼‰</h2><p>é€šè¿‡æ ‡è®°ä¸€ä¸ª @classmethodï¼Œè¯¥æ–¹æ³•å°†ç»‘å®šåˆ° Person ç±»ä¸Šï¼Œè€Œéç±»çš„å®ä¾‹ã€‚ç±»æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å°†ä¼ å…¥ç±»æœ¬èº«ï¼Œé€šå¸¸å°†å‚æ•°åå‘½åä¸º cls</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    __count = <span class="hljs-number">0</span><br><br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">how_many</span>(<span class="hljs-params">cls</span>):<br>        <span class="hljs-keyword">return</span> cls.__count<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name</span>):<br>        self.name = name<br>        Person.__count = Person.__count + <span class="hljs-number">1</span><br><br><span class="hljs-built_in">print</span> Person.how_many()<br>p1 = Person(<span class="hljs-string">&#x27;Bob&#x27;</span>)<br><span class="hljs-built_in">print</span> Person.how_many()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>Pythonå‡½æ•°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PythonåŸºç¡€</title>
    <link href="/20200727120000/"/>
    <url>/20200727120000/</url>
    
    <content type="html"><![CDATA[<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># coding=utf-8</span><br><span class="hljs-comment"># è®¾ç½®ç¼–ç </span><br></code></pre></td></tr></table></figure><h2 id="è¾“å‡º"><a href="#è¾“å‡º" class="headerlink" title="è¾“å‡º"></a>è¾“å‡º</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è¾“å‡ºå¤šä¸ªå˜é‡(ç”¨, éš”å¼€)ï¼šå­—ç¬¦ä¸², è¡¨è¾¾å¼  =  &#x27;å­—ç¬¦ä¸²+è¡¨è¾¾å¼çš„å€¼&#x27;</span><br><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;100 + 200 =&#x27;</span>, <span class="hljs-number">100</span> + <span class="hljs-number">200</span><br><br>a = <span class="hljs-string">&#x27;A&#x27;</span><br>b = <span class="hljs-string">&#x27;B&#x27;</span><br><span class="hljs-built_in">print</span> a, <span class="hljs-string">&#x27;--&gt;&#x27;</span>, b<br></code></pre></td></tr></table></figure><h2 id="åˆ¤æ–­åˆ†æ”¯"><a href="#åˆ¤æ–­åˆ†æ”¯" class="headerlink" title="åˆ¤æ–­åˆ†æ”¯"></a>åˆ¤æ–­åˆ†æ”¯</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># if-elif-else </span><br>score = <span class="hljs-number">85</span><br><span class="hljs-keyword">if</span> score &gt;= <span class="hljs-number">90</span>:<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;excellent&#x27;</span><br><span class="hljs-keyword">elif</span> score &gt;= <span class="hljs-number">80</span>:<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;good&#x27;</span><br><span class="hljs-keyword">elif</span> score &gt;= <span class="hljs-number">60</span>:<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;passed&#x27;</span><br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;failed&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="list"><a href="#list" class="headerlink" title="list"></a>list</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># list å£°æ˜</span><br>L = [<span class="hljs-string">&#x27;Adam&#x27;</span>, <span class="hljs-string">&#x27;Lisa&#x27;</span>, <span class="hljs-string">&#x27;Bart&#x27;</span>]<br><br><span class="hljs-comment"># list æ·»åŠ å…ƒç´  æ–¹å¼1</span><br>L.append(<span class="hljs-string">&#x27;Paul&#x27;</span>)<br><br><span class="hljs-comment"># list æ·»åŠ å…ƒç´  æ–¹å¼2</span><br>L.insert(<span class="hljs-number">0</span>, <span class="hljs-string">&#x27;Paul&#x27;</span>)<br><br><span class="hljs-comment"># list åˆ é™¤å…ƒç´ </span><br>L.pop()  <span class="hljs-comment"># åˆ é™¤æœ€åä¸€ä¸ª</span><br>L.pop(<span class="hljs-number">2</span>)  <span class="hljs-comment"># åˆ é™¤ç¬¬ä¸‰ä¸ª</span><br><br><span class="hljs-comment"># list æ›¿æ¢å…ƒç´ </span><br>L[<span class="hljs-number">2</span>] = <span class="hljs-string">&#x27;Paul&#x27;</span><br><br><span class="hljs-comment"># tuple ä¸­å«â€œå¯å˜å…ƒç´ â€ï¼šlist</span><br>t = (<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, [<span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-string">&#x27;B&#x27;</span>])<br>L = t[<span class="hljs-number">2</span>]<br>L[<span class="hljs-number">0</span>] = <span class="hljs-string">&#x27;X&#x27;</span><br>L[<span class="hljs-number">1</span>] = <span class="hljs-string">&#x27;Y&#x27;</span><br><span class="hljs-built_in">print</span> t  <span class="hljs-comment"># å¯ä»¥çœ‹åˆ°listä¸­çš„å…ƒç´ è¢«æ”¹å˜äº†</span><br></code></pre></td></tr></table></figure><h2 id="tuple"><a href="#tuple" class="headerlink" title="tuple"></a>tuple</h2><p>tupleï¼štupleæ˜¯å¦ä¸€ç§æœ‰åºçš„åˆ—è¡¨ï¼Œä¸­æ–‡ç¿»è¯‘ä¸ºâ€œ å…ƒç»„ â€ã€‚tuple å’Œ list éå¸¸ç±»ä¼¼ï¼Œä½†æ˜¯ï¼Œtupleä¸€æ—¦åˆ›å»ºå®Œæ¯•ï¼Œå°±ä¸èƒ½ä¿®æ”¹äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># tupleæ˜¯å¦ä¸€ç§æœ‰åºçš„åˆ—è¡¨ï¼Œä¸­æ–‡ç¿»è¯‘ä¸ºâ€œ å…ƒç»„ â€ã€‚tuple å’Œ list éå¸¸ç±»ä¼¼ï¼Œä½†æ˜¯ï¼Œtupleä¸€æ—¦åˆ›å»ºå®Œæ¯•ï¼Œå°±ä¸èƒ½ä¿®æ”¹äº†ã€‚</span><br><span class="hljs-comment"># tuple å£°æ˜</span><br>t = (<span class="hljs-string">&#x27;Adam&#x27;</span>, <span class="hljs-string">&#x27;Lisa&#x27;</span>, <span class="hljs-string">&#x27;Bart&#x27;</span>)<br><span class="hljs-comment"># tuple åˆ›å»ºå•å…ƒç´ (éœ€è¦æ·»åŠ ä¸€ä¸ª,)</span><br>t = (<span class="hljs-number">1</span>,)<br></code></pre></td></tr></table></figure><h2 id="dict"><a href="#dict" class="headerlink" title="dict"></a>dict</h2><p>dictå­˜å‚¨çš„æ˜¯é”®å€¼å¯¹å½¢å¼çš„æ•°æ®ï¼ˆæ— åºï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># dict çš„å£°æ˜</span><br>d = &#123;<br>    <span class="hljs-string">&#x27;Adam&#x27;</span>: <span class="hljs-number">95</span>,<br>    <span class="hljs-string">&#x27;Lisa&#x27;</span>: <span class="hljs-number">85</span>,<br>    <span class="hljs-string">&#x27;Bart&#x27;</span>: <span class="hljs-number">59</span><br>&#125;<br><span class="hljs-comment"># æ³¨æ„ï¼šä¸€ä¸ª key-value ç®—ä¸€ä¸ªé•¿åº¦ã€‚æ‰€ä»¥  len(d) è¿”å›çš„æ˜¯å«æœ‰çš„é”®å€¼å¯¹æ•°</span><br><span class="hljs-comment"># å¯ä»¥ä½¿ç”¨d[key] çš„å½¢å¼æ¥æŸ¥æ‰¾å¯¹åº”çš„ valueã€‚</span><br><span class="hljs-comment"># æ³¨æ„: é€šè¿‡ key è®¿é—® dict çš„valueï¼Œåªè¦ key å­˜åœ¨ï¼Œdictå°±è¿”å›å¯¹åº”çš„valueã€‚å¦‚æœkeyä¸å­˜åœ¨ï¼Œä¼šç›´æ¥æŠ¥é”™ï¼šKeyErrorã€‚</span><br><span class="hljs-comment"># è¦é¿å… KeyError å‘ç”Ÿï¼Œæœ‰ä¸¤ä¸ªåŠæ³•ï¼š</span><br><span class="hljs-comment"># ä¸€æ˜¯å…ˆåˆ¤æ–­ä¸€ä¸‹ key æ˜¯å¦å­˜åœ¨ï¼Œç”¨ in æ“ä½œç¬¦ï¼š</span><br><span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;Paul&#x27;</span> <span class="hljs-keyword">in</span> d:<br>    <span class="hljs-built_in">print</span> d[<span class="hljs-string">&#x27;Paul&#x27;</span>]<br><span class="hljs-comment"># äºŒæ˜¯ä½¿ç”¨dictæœ¬èº«æä¾›çš„ä¸€ä¸ª get æ–¹æ³•ï¼Œåœ¨Keyä¸å­˜åœ¨çš„æ—¶å€™ï¼Œè¿”å›Noneï¼š</span><br><span class="hljs-built_in">print</span> d.get(<span class="hljs-string">&#x27;Paul&#x27;</span>)<br><br><span class="hljs-comment"># dictä½œä¸º key çš„å…ƒç´ å¿…é¡»ä¸å¯å˜ï¼ŒPythonçš„åŸºæœ¬ç±»å‹å¦‚å­—ç¬¦ä¸²ã€æ•´æ•°ã€æµ®ç‚¹æ•°éƒ½æ˜¯ä¸å¯å˜çš„ï¼Œéƒ½å¯ä»¥ä½œä¸º keyã€‚ä½†æ˜¯listæ˜¯å¯å˜çš„ï¼Œå°±ä¸èƒ½ä½œä¸º keyã€‚</span><br><br><span class="hljs-comment"># dict æ›´æ–°å€¼</span><br>d[<span class="hljs-string">&#x27;Paul&#x27;</span>] = <span class="hljs-number">72</span><br><br><span class="hljs-comment"># dict éå†</span><br>d = &#123; <span class="hljs-string">&#x27;Adam&#x27;</span>: <span class="hljs-number">95</span>, <span class="hljs-string">&#x27;Lisa&#x27;</span>: <span class="hljs-number">85</span>, <span class="hljs-string">&#x27;Bart&#x27;</span>: <span class="hljs-number">59</span> &#125;<br><span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> d:<br>    <span class="hljs-built_in">print</span> key<br></code></pre></td></tr></table></figure><h2 id="set"><a href="#set" class="headerlink" title="set"></a>set</h2><p>setå­˜å‚¨çš„æ˜¯ä¸€ç»„ä¸é‡å¤çš„æ— åºå…ƒç´ ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># set å£°æ˜</span><br>s = <span class="hljs-built_in">set</span>([<span class="hljs-string">&#x27;Adam&#x27;</span>, <span class="hljs-string">&#x27;Lisa&#x27;</span>, <span class="hljs-string">&#x27;Bart&#x27;</span>])<br><br><br><span class="hljs-comment"># åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨ set ä¸­</span><br>s = <span class="hljs-built_in">set</span>([<span class="hljs-string">&#x27;Adam&#x27;</span>,<span class="hljs-string">&#x27;Lisa&#x27;</span>,<span class="hljs-string">&#x27;Bart&#x27;</span>])<br>name = <span class="hljs-string">&#x27;Lisa&#x27;</span><br><span class="hljs-keyword">if</span> name <span class="hljs-keyword">in</span> s:<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;exists&#x27;</span><br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;not exists&#x27;</span><br><br><br><span class="hljs-comment"># set éå†</span><br>s = <span class="hljs-built_in">set</span>([<span class="hljs-string">&#x27;Adam&#x27;</span>,<span class="hljs-string">&#x27;Lisa&#x27;</span>,<span class="hljs-string">&#x27;Bart&#x27;</span>])<br><span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> s:<br>    <span class="hljs-built_in">print</span> name<br><br><br><span class="hljs-comment"># å«å¤æ‚å…ƒç´ çš„set</span><br>s = <span class="hljs-built_in">set</span>([(<span class="hljs-string">&#x27;Adam&#x27;</span>, <span class="hljs-number">95</span>), (<span class="hljs-string">&#x27;Lisa&#x27;</span>, <span class="hljs-number">85</span>), (<span class="hljs-string">&#x27;Bart&#x27;</span>, <span class="hljs-number">59</span>)])<br><span class="hljs-keyword">for</span> obj <span class="hljs-keyword">in</span> s:<br>    <span class="hljs-built_in">print</span> obj[<span class="hljs-number">0</span>] + <span class="hljs-string">&#x27;:&#x27;</span>, obj[<span class="hljs-number">1</span>]<br><br><br><span class="hljs-comment"># set æ›´æ–°: s.add() æ·»åŠ å…ƒç´ ,  s.remove() åˆ é™¤å…ƒç´ </span><br><span class="hljs-comment"># æ³¨æ„ï¼šå¦‚æœæ·»åŠ çš„å…ƒç´ å·²å­˜åœ¨, ä¸ä¼šæŠ¥é”™ã€‚å¦‚æœè¦ç§»é™¤çš„å…ƒç´ ä¸å­˜åœ¨, å°±ä¼šæŠ¥é”™, æ‰€ä»¥ç§»é™¤å‰éœ€è¦åšåˆ¤æ–­</span><br>s = <span class="hljs-built_in">set</span>([<span class="hljs-string">&#x27;Adam&#x27;</span>, <span class="hljs-string">&#x27;Lisa&#x27;</span>, <span class="hljs-string">&#x27;Paul&#x27;</span>])<br>L = [<span class="hljs-string">&#x27;Adam&#x27;</span>, <span class="hljs-string">&#x27;Lisa&#x27;</span>, <span class="hljs-string">&#x27;Bart&#x27;</span>, <span class="hljs-string">&#x27;Paul&#x27;</span>]<br><span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> L:<br>    <span class="hljs-keyword">if</span> name <span class="hljs-keyword">in</span> s:<br>        s.remove(name)<br>    <span class="hljs-keyword">else</span>:<br>        s.add(name)<br><span class="hljs-built_in">print</span> s<br></code></pre></td></tr></table></figure><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å®˜æ–¹å‡½æ•°æ–‡æ¡£ï¼š http://docs.python.org/2/library/functions.html</span><br><span class="hljs-comment"># å‘½ä»¤è¡Œé€šè¿‡ help(abs) å¯æŸ¥çœ‹abså‡½æ•°çš„å¸®åŠ©ä¿¡æ¯</span><br><span class="hljs-comment"># åœ¨Pythonä¸­ï¼Œå®šä¹‰ä¸€ä¸ªå‡½æ•°è¦ä½¿ç”¨ def è¯­å¥ï¼Œä¾æ¬¡å†™å‡ºå‡½æ•°åã€æ‹¬å·ã€æ‹¬å·ä¸­çš„å‚æ•°å’Œå†’å·:ï¼Œç„¶åï¼Œåœ¨ç¼©è¿›å—ä¸­ç¼–å†™å‡½æ•°ä½“ï¼Œå‡½æ•°çš„è¿”å›å€¼ç”¨ return è¯­å¥è¿”å›ã€‚å¦‚æœæ²¡æœ‰returnè¯­å¥ï¼Œå‡½æ•°æ‰§è¡Œå®Œæ¯•åä¹Ÿä¼šè¿”å›ç»“æœï¼Œåªæ˜¯ç»“æœä¸º Noneã€‚æ•…return Noneå¯ä»¥ç®€å†™ä¸ºreturnã€‚å¦å¤–ï¼Œå¯ä»¥æœ‰ä¸€ä¸ªè¿”å›å€¼ï¼Œä¹Ÿå¯ä»¥æœ‰å¤šä¸ªè¿”å›å€¼ï¼ˆå…¶å®å°±æ˜¯è¿”å›ä¸€ä¸ªtupleï¼‰ã€‚</span><br><br><span class="hljs-comment"># å®šä¹‰å‡½æ•°ï¼šå‡½æ•°æ¥å—ä¸€ä¸ªlist, è¿”å›listä¸­æ¯ä¸ªå…ƒç´ å¹³æ–¹çš„å’Œ</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">square_of_sum</span>(<span class="hljs-params">L</span>):<br>    <span class="hljs-built_in">sum</span> = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> L:<br>        <span class="hljs-built_in">sum</span> += x * x<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span><br><br><span class="hljs-built_in">print</span> square_of_sum([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>])<br><br><br><span class="hljs-comment"># å®šä¹‰å‡½æ•°ï¼šæ±‚ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹çš„ä¸¤ä¸ªè§£ã€‚æ±‚æ ¹å…¬å¼ï¼šx = (-bÂ±âˆš(bÂ²-4ac)) / 2a</span><br><span class="hljs-keyword">import</span> math<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">quadratic_equation</span>(<span class="hljs-params">a, b, c</span>):<br>    t = math.sqrt(b * b - <span class="hljs-number">4</span> * a * c)<br>    <span class="hljs-keyword">return</span> (-b + t) / (<span class="hljs-number">2</span> * a), ( -b - t )/ (<span class="hljs-number">2</span> * a)<br><br><span class="hljs-built_in">print</span> quadratic_equation(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">0</span>)<br><br><br><span class="hljs-comment"># æ±‰è¯ºå¡”(é€’å½’å‡½æ•°çš„åº”ç”¨)</span><br><span class="hljs-comment"># æˆ‘ä»¬å¯¹æŸ±å­ç¼–å·ä¸ºa, b, cï¼Œå°†æ‰€æœ‰åœ†ç›˜ä»aç§»åˆ°cå¯ä»¥æè¿°ä¸ºï¼šå¦‚æœaåªæœ‰ä¸€ä¸ªåœ†ç›˜ï¼Œå¯ä»¥ç›´æ¥ç§»åŠ¨åˆ°cï¼›å¦‚æœaæœ‰Nä¸ªåœ†ç›˜ï¼Œå¯ä»¥çœ‹æˆaæœ‰1ä¸ªåœ†ç›˜ï¼ˆåº•ç›˜ï¼‰ + (N-1)ä¸ªåœ†ç›˜ï¼Œé¦–å…ˆéœ€è¦æŠŠ (N-1) ä¸ªåœ†ç›˜ç§»åŠ¨åˆ° bï¼Œç„¶åï¼Œå°† açš„æœ€åä¸€ä¸ªåœ†ç›˜ç§»åŠ¨åˆ°cï¼Œå†å°†bçš„(N-1)ä¸ªåœ†ç›˜ç§»åŠ¨åˆ°cã€‚</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">move</span>(<span class="hljs-params">n, a, b, c</span>):<br>    <span class="hljs-keyword">if</span> n ==<span class="hljs-number">1</span>:<br>        <span class="hljs-built_in">print</span> a, <span class="hljs-string">&#x27;--&gt;&#x27;</span>, c<br>        <span class="hljs-keyword">return</span><br>    move(n-<span class="hljs-number">1</span>, a, c, b)<br>    <span class="hljs-built_in">print</span> a, <span class="hljs-string">&#x27;--&gt;&#x27;</span>, c<br>    move(n-<span class="hljs-number">1</span>, b, a, c)<br><br>move(<span class="hljs-number">4</span>, <span class="hljs-string">&#x27;A&#x27;</span>, <span class="hljs-string">&#x27;B&#x27;</span>, <span class="hljs-string">&#x27;C&#x27;</span>)<br><br><br><span class="hljs-comment"># å‡½æ•°å®šä¹‰é»˜è®¤å‚æ•°ã€‚å®šä¹‰ä¸€ä¸ªè®¡ç®— x çš„ n æ¬¡æ–¹çš„å‡½æ•°(é»˜è®¤ä¸ºå¹³æ–¹)ï¼š</span><br><span class="hljs-comment"># æ³¨æ„ï¼šå› ä¸ºå‡½æ•°çš„å‚æ•°æŒ‰ä»å·¦åˆ°å³çš„é¡ºåºåŒ¹é…ï¼Œæ‰€ä»¥é»˜è®¤å‚æ•°åªèƒ½å®šä¹‰åœ¨å¿…éœ€å‚æ•°çš„åé¢ã€‚</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">power</span>(<span class="hljs-params">x, n=<span class="hljs-number">2</span></span>):<br>    s = <span class="hljs-number">1</span><br>    <span class="hljs-keyword">while</span> n &gt; <span class="hljs-number">0</span>:<br>        n = n - <span class="hljs-number">1</span><br>        s = s * x<br>    <span class="hljs-keyword">return</span> s<br><br>power(<span class="hljs-number">5</span>)<br>power(<span class="hljs-number">5</span>,<span class="hljs-number">3</span>)<br><br><br><span class="hljs-comment"># å‡½æ•°å®šä¹‰å¯å˜å‚æ•°ï¼šå‚æ•°çš„åå­—å‰é¢åŠ ä¸ª * å·ã€‚</span><br><span class="hljs-comment"># å®šä¹‰ä¸€ä¸ªæ±‚å¹³å‡æ•°çš„å‡½æ•°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">average</span>(<span class="hljs-params">*args</span>):<br>    <span class="hljs-built_in">sum</span> = <span class="hljs-number">0.0</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(args) == <span class="hljs-number">0</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span><br>    <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> args:<br>        <span class="hljs-built_in">sum</span> += x<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span> / <span class="hljs-built_in">len</span>(args)<br><br><span class="hljs-built_in">print</span> average()<br><span class="hljs-built_in">print</span> average(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)<br><span class="hljs-built_in">print</span> average(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>)<br></code></pre></td></tr></table></figure><h2 id="liståˆ‡ç‰‡"><a href="#liståˆ‡ç‰‡" class="headerlink" title="liståˆ‡ç‰‡"></a>liståˆ‡ç‰‡</h2><p>å–listä¸­æŒ‡å®šèŒƒå›´ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># L[0:3]è¡¨ç¤ºï¼Œä»ç´¢å¼•0å¼€å§‹å–ï¼Œç›´åˆ°ç´¢å¼•3ä¸ºæ­¢ï¼Œä½†ä¸åŒ…æ‹¬ç´¢å¼•3ã€‚å¦‚æœç¬¬ä¸€ä¸ªç´¢å¼•æ˜¯0ï¼Œè¿˜å¯ä»¥çœç•¥ï¼šL[:3]</span><br><span class="hljs-comment"># åªç”¨ä¸€ä¸ª : ï¼Œè¡¨ç¤ºä»å¤´åˆ°å°¾ï¼šL[:]</span><br><span class="hljs-comment"># åˆ‡ç‰‡æ“ä½œè¿˜å¯ä»¥æŒ‡å®šç¬¬ä¸‰ä¸ªå‚æ•°ï¼šç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤ºæ¯Nä¸ªå–ä¸€ä¸ªï¼Œä¸Šé¢çš„ L[::2] ä¼šæ¯ä¸¤ä¸ªå…ƒç´ å–å‡ºä¸€ä¸ªæ¥ï¼Œä¹Ÿå°±æ˜¯éš”ä¸€ä¸ªå–ä¸€ä¸ªã€‚</span><br><span class="hljs-comment"># ç¬¬ä¸€ä¸ªå‚æ•°çœç•¥ï¼šä»0å¼€å§‹å–ã€‚ ç¬¬äºŒä¸ªå‚æ•°çœç•¥ï¼šåˆ°æœ€åä¸€ä¸ªã€‚</span><br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªæ•°åˆ—ï¼š[1, 2, 3, ..., 100]</span><br>L = <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">101</span>)<br><span class="hljs-comment"># 1. å‰10ä¸ªæ•°ï¼›2. 3çš„å€æ•°ï¼›3. ä¸å¤§äº50çš„5çš„å€æ•°ã€‚</span><br><span class="hljs-built_in">print</span> L[<span class="hljs-number">0</span>:<span class="hljs-number">10</span>]<br><span class="hljs-built_in">print</span> L[<span class="hljs-number">2</span>::<span class="hljs-number">3</span>]<br><span class="hljs-built_in">print</span> L[<span class="hljs-number">4</span>:<span class="hljs-number">50</span>:<span class="hljs-number">5</span>]<br><br><br><span class="hljs-comment"># å­—ç¬¦ä¸²åˆ‡ç‰‡</span><br><span class="hljs-comment"># å­—ç¬¦ä¸²å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªlist</span><br><span class="hljs-comment"># å°†é¦–å­—æ¯è½¬å¤§å†™çš„å‡½æ•°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">firstCharUpper</span>(<span class="hljs-params">s</span>):<br>    <span class="hljs-keyword">return</span> s[<span class="hljs-number">0</span>].upper() + s[<span class="hljs-number">1</span>:]<br><br><span class="hljs-built_in">print</span> firstCharUpper(<span class="hljs-string">&#x27;hello&#x27;</span>)<br><span class="hljs-built_in">print</span> firstCharUpper(<span class="hljs-string">&#x27;sunday&#x27;</span>)<br><span class="hljs-built_in">print</span> firstCharUpper(<span class="hljs-string">&#x27;september&#x27;</span>)<br><br></code></pre></td></tr></table></figure><h2 id="é›†åˆè¿­ä»£"><a href="#é›†åˆè¿­ä»£" class="headerlink" title="é›†åˆè¿­ä»£"></a>é›†åˆè¿­ä»£</h2><p>é›†åˆæ˜¯æŒ‡åŒ…å«ä¸€ç»„å…ƒç´ çš„æ•°æ®ç»“æ„ï¼Œå·²ç»ä»‹ç»çš„åŒ…æ‹¬ï¼š</p><ol><li>æœ‰åºé›†åˆï¼šlistï¼Œtupleï¼Œstrå’Œunicodeï¼›</li><li>æ— åºé›†åˆï¼šset</li><li>æ— åºé›†åˆå¹¶ä¸”å…·æœ‰ key-value å¯¹ï¼šdict</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># éå†æ·»åŠ ç´¢å¼•ï¼š enumerate(L)å‡½æ•°ã€‚ç´¢å¼•ä»0å¼€å§‹</span><br>L = [<span class="hljs-string">&#x27;Adam&#x27;</span>, <span class="hljs-string">&#x27;Lisa&#x27;</span>, <span class="hljs-string">&#x27;Bart&#x27;</span>, <span class="hljs-string">&#x27;Paul&#x27;</span>]<br><span class="hljs-keyword">for</span> index, name <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(L):<br>    <span class="hljs-built_in">print</span> index, <span class="hljs-string">&#x27;-&#x27;</span>, name<br><br><br><span class="hljs-comment"># zip()å‡½æ•°å¯ä»¥æŠŠä¸¤ä¸ª list å˜æˆä¸€ä¸ª list</span><br>L = [<span class="hljs-string">&#x27;Adam&#x27;</span>, <span class="hljs-string">&#x27;Lisa&#x27;</span>, <span class="hljs-string">&#x27;Bart&#x27;</span>, <span class="hljs-string">&#x27;Paul&#x27;</span>]<br><span class="hljs-keyword">for</span> index, name <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(L)+<span class="hljs-number">1</span>), L):<br>    <span class="hljs-built_in">print</span> index, <span class="hljs-string">&#x27;-&#x27;</span>, name<br><br><br><span class="hljs-comment"># dict è¿­ä»£</span><br><span class="hljs-comment"># è¿­ä»£å€¼ values() å’Œ itervalues()ã€‚ values() æ–¹æ³•å®é™…ä¸ŠæŠŠä¸€ä¸ª dict è½¬æ¢æˆäº†åŒ…å« value çš„listã€‚ä½†æ˜¯ itervalues() æ–¹æ³•ä¸ä¼šè½¬æ¢ï¼Œå®ƒä¼šåœ¨è¿­ä»£è¿‡ç¨‹ä¸­ä¾æ¬¡ä» dict ä¸­å–å‡º valueï¼Œæ‰€ä»¥ itervalues() æ–¹æ³•æ¯” values() æ–¹æ³•èŠ‚çœäº†ç”Ÿæˆ list æ‰€éœ€çš„å†…å­˜ã€‚</span><br><br>d = &#123; <span class="hljs-string">&#x27;Adam&#x27;</span>: <span class="hljs-number">95</span>, <span class="hljs-string">&#x27;Lisa&#x27;</span>: <span class="hljs-number">85</span>, <span class="hljs-string">&#x27;Bart&#x27;</span>: <span class="hljs-number">59</span> &#125;<br><br><span class="hljs-comment"># è¿­ä»£ key</span><br><span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> d:<br>    <span class="hljs-built_in">print</span> k<br><br><span class="hljs-comment"># è¿­ä»£ value æ–¹æ³•1</span><br><span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> d.values():<br>    <span class="hljs-built_in">print</span> v<br><br><span class="hljs-comment"># è¿­ä»£ value æ–¹æ³•2</span><br><span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> d.itervalues():<br>    <span class="hljs-built_in">print</span> v<br><br><span class="hljs-comment"># è¿­ä»£dictçš„ key å’Œ valueã€‚d.items() å’Œ  iteritems()ã€‚iteritems() ä¸æŠŠdictè½¬æ¢æˆlistï¼Œè€Œæ˜¯åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ä¸æ–­ç»™å‡º tupleï¼Œæ‰€ä»¥ï¼Œ iteritems() ä¸å ç”¨é¢å¤–çš„å†…å­˜ã€‚</span><br><span class="hljs-comment"># ç»™å®š dictï¼Œæ‰“å°å‡º name : scoreï¼Œæœ€åå†æ‰“å°å‡ºå¹³å‡åˆ† average : scoreã€‚</span><br>d = &#123; <span class="hljs-string">&#x27;Adam&#x27;</span>: <span class="hljs-number">95</span>, <span class="hljs-string">&#x27;Lisa&#x27;</span>: <span class="hljs-number">85</span>, <span class="hljs-string">&#x27;Bart&#x27;</span>: <span class="hljs-number">59</span>, <span class="hljs-string">&#x27;Paul&#x27;</span>: <span class="hljs-number">74</span> &#125;<br><span class="hljs-built_in">sum</span> = <span class="hljs-number">0.0</span><br><span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> d.iteritems():<br>    <span class="hljs-built_in">sum</span> = <span class="hljs-built_in">sum</span> + v<br>    <span class="hljs-built_in">print</span> k, <span class="hljs-string">&#x27;:&#x27;</span>, v<br><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;average&#x27;</span>, <span class="hljs-string">&#x27;:&#x27;</span>, <span class="hljs-built_in">sum</span> / <span class="hljs-built_in">len</span>(d)<br></code></pre></td></tr></table></figure><h2 id="ç”Ÿæˆåˆ—è¡¨"><a href="#ç”Ÿæˆåˆ—è¡¨" class="headerlink" title="ç”Ÿæˆåˆ—è¡¨"></a>ç”Ÿæˆåˆ—è¡¨</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ä¾‹1ã€ç”Ÿæˆlist [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</span><br><span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>)<br><br><span class="hljs-comment"># ä¾‹2ã€ç”Ÿæˆ[1x1, 2x2, 3x3, ..., 10x10]</span><br><span class="hljs-comment"># æ–¹å¼1</span><br>L = []<br><span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>):<br>    L.append(x * x)<br><span class="hljs-comment"># æ–¹å¼2(åˆ—è¡¨ç”Ÿæˆå¼)</span><br><span class="hljs-built_in">print</span> [x * x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>)]<br><br><span class="hljs-comment"># ä¾‹3ã€ç”Ÿæˆåˆ—è¡¨ [1x2, 3x4, 5x6, 7x8, ..., 99x100]</span><br><span class="hljs-built_in">print</span> [x * (x + <span class="hljs-number">1</span>) <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>, <span class="hljs-number">2</span>)]<br></code></pre></td></tr></table></figure><h2 id="å¤æ‚è¡¨è¾¾å¼"><a href="#å¤æ‚è¡¨è¾¾å¼" class="headerlink" title="å¤æ‚è¡¨è¾¾å¼"></a>å¤æ‚è¡¨è¾¾å¼</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç”¨ç»™å®šæ•°æ®ç”Ÿæˆè¡¨æ ¼ï¼Œå¯¹äºæ²¡æœ‰åŠæ ¼çš„åŒå­¦ï¼Œè¯·æŠŠåˆ†æ•°æ ‡è®°ä¸ºçº¢è‰²ã€‚</span><br>d = &#123; <span class="hljs-string">&#x27;Adam&#x27;</span>: <span class="hljs-number">95</span>, <span class="hljs-string">&#x27;Lisa&#x27;</span>: <span class="hljs-number">85</span>, <span class="hljs-string">&#x27;Bart&#x27;</span>: <span class="hljs-number">59</span> &#125;<br><span class="hljs-comment"># 1ã€é¦–å…ˆï¼Œå®šä¹‰ç”Ÿæˆè¡Œå…ƒç´ çš„æ–¹æ³•</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_tr</span>(<span class="hljs-params">name, score</span>):<br>    <span class="hljs-keyword">if</span> score &lt; <span class="hljs-number">60</span>:<br>        <span class="hljs-comment"># å­—ç¬¦ä¸²å¯ä»¥é€šè¿‡ % è¿›è¡Œæ ¼å¼åŒ–ï¼Œç”¨æŒ‡å®šçš„å‚æ•°æ›¿ä»£ %sã€‚</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td style=&quot;color:red&quot;&gt;%s&lt;/td&gt;&lt;/tr&gt;&#x27;</span> % (name, score)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;&#x27;</span> % (name, score)<br><span class="hljs-comment"># 2ã€ç”¨è¡¨è¾¾å¼ç”Ÿæˆè¡¨æ ¼(è¡Œæ•°æ®)</span><br>tds = [generate_tr(name, score) <span class="hljs-keyword">for</span> name, score <span class="hljs-keyword">in</span> d.iteritems()]<br><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;&lt;table border=&quot;1&quot;&gt;&#x27;</span><br><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;&lt;tr&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Score&lt;/th&gt;&lt;tr&gt;&#x27;</span><br><span class="hljs-comment"># å­—ç¬¦ä¸²çš„join()æ–¹æ³•å¯ä»¥æŠŠä¸€ä¸ª list æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚</span><br><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;\n&#x27;</span>.join(tds)<br><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;&lt;/table&gt;&#x27;</span><br><br><br><br><span class="hljs-comment"># è¡¨è¾¾å¼è¿½åŠ æ·»åŠ æ¡ä»¶ï¼šåœ¨forå¾ªç¯ä¹‹åæ·»åŠ </span><br><span class="hljs-comment"># ä¾‹1ã€æŒ‡å®šèŒƒå›´å†…å¶æ•°çš„å¹³æ–¹</span><br>[x * x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>) <span class="hljs-keyword">if</span> x % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>]<br><br><span class="hljs-comment"># ä¾‹2ã€ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ª listï¼Œç„¶åæŠŠlistä¸­çš„æ‰€æœ‰å­—ç¬¦ä¸²å˜æˆå¤§å†™åè¿”å›ï¼Œéå­—ç¬¦ä¸²å…ƒç´ å°†è¢«å¿½ç•¥ã€‚isinstance(x, str) å¯ä»¥åˆ¤æ–­å˜é‡ x æ˜¯å¦æ˜¯å­—ç¬¦ä¸²ã€‚å­—ç¬¦ä¸²çš„ upper() æ–¹æ³•å¯ä»¥è¿”å›å¤§å†™çš„å­—æ¯ã€‚</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">toUppers</span>(<span class="hljs-params">L</span>):<br>    <span class="hljs-keyword">return</span> [x.upper() <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> L <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(x, <span class="hljs-built_in">str</span>)]<br><span class="hljs-built_in">print</span> toUppers([<span class="hljs-string">&#x27;Hello&#x27;</span>, <span class="hljs-string">&#x27;world&#x27;</span>, <span class="hljs-number">101</span>])<br><br><span class="hljs-comment"># åˆ—è¡¨ç”Ÿæˆå¼åµŒå¥—</span><br><span class="hljs-comment"># ä¾‹3ã€åˆ©ç”¨3å±‚forå¾ªç¯çš„åˆ—è¡¨ç”Ÿæˆå¼ï¼Œæ‰¾å‡ºå¯¹ç§°çš„ 3 ä½æ•°ã€‚ä¾‹å¦‚ï¼Œ121 å°±æ˜¯å¯¹ç§°æ•°ï¼Œå› ä¸ºä»å³åˆ°å·¦å€’è¿‡æ¥è¿˜æ˜¯ 121ã€‚</span><br><span class="hljs-built_in">print</span> [<span class="hljs-number">100</span> * n1 + <span class="hljs-number">10</span> * n2 + n3 <span class="hljs-keyword">for</span> n1 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>) <span class="hljs-keyword">for</span> n2 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">for</span> n3 <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">if</span> n1==n3]<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Python</tag>
      
      <tag>Pythonå‡½æ•°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PyCharmä½¿ç”¨</title>
    <link href="/20200727110000/"/>
    <url>/20200727110000/</url>
    
    <content type="html"><![CDATA[<h2 id="å¯¼åŒ…-x2F-ä¿®æ”¹ç¼–è¯‘å™¨ç‰ˆæœ¬"><a href="#å¯¼åŒ…-x2F-ä¿®æ”¹ç¼–è¯‘å™¨ç‰ˆæœ¬" class="headerlink" title="å¯¼åŒ…&#x2F;ä¿®æ”¹ç¼–è¯‘å™¨ç‰ˆæœ¬"></a>å¯¼åŒ…&#x2F;ä¿®æ”¹ç¼–è¯‘å™¨ç‰ˆæœ¬</h2><p><img src="/20200727110000/Image.png" alt="å¯¼åŒ…å’Œä¿®æ”¹ç¼–è¯‘å™¨ç‰ˆæœ¬"></p><h2 id="PyCharmå¸¸ç”¨å¿«æ·é”®"><a href="#PyCharmå¸¸ç”¨å¿«æ·é”®" class="headerlink" title="PyCharmå¸¸ç”¨å¿«æ·é”®"></a>PyCharmå¸¸ç”¨å¿«æ·é”®</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">ç¼–ç /å¼€å‘ç±»ï¼š<br><span class="hljs-built_in">shift</span> + enter å¼€å¯æ–°çš„ä¸€è¡Œ<br>ctrl + / æ³¨é‡Š<br>ctrl + alt + i è‡ªåŠ¨ç¼©è¿›<br>ctrl + q å¿«é€ŸæŸ¥æ‰¾æ–‡æ¡£<br>ctrl + <span class="hljs-built_in">shift</span> + +/- å±•å¼€/æŠ˜å ä»£ç å—<br>ctrl + alt + space å¿«é€Ÿå¯¼å…¥<br><br>æŸ¥æ‰¾/æ›¿æ¢ç±»ï¼š<br>ctrl + f å½“å‰æ–‡ä»¶æŸ¥æ‰¾<br>ctrl + r å½“å‰æ–‡ä»¶æŸ¥æ‰¾æ›¿æ¢<br>ctrl + <span class="hljs-built_in">shift</span> + f å…¨å±€æŸ¥æ‰¾<br>ctrl + <span class="hljs-built_in">shift</span> + f å…¨å±€æ›¿æ¢<br>ctrl + n æŸ¥æ‰¾ç±»çš„åç§°<br><br>è¿è¡Œ/è°ƒè¯•ç±»ï¼š<br><span class="hljs-built_in">shift</span> + F10 è¿è¡Œ<br><span class="hljs-built_in">shift</span> + F9 è°ƒè¯•<br>alt + <span class="hljs-built_in">shift</span> + F10 è¿è¡Œæ¨¡å¼é…ç½®<br>alt + <span class="hljs-built_in">shift</span> + F9 è°ƒè¯•æ¨¡å¼é…ç½®<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>PyCharm</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PyCharm</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Jenkinsè‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬</title>
    <link href="/20200723130000/"/>
    <url>/20200723130000/</url>
    
    <content type="html"><![CDATA[<blockquote><p>è®°å½•å­¦ä¹ Jenkinsæ—¶ï¼Œè‡ªåŠ¨åŒ–éƒ¨ç½²tomcaté¡¹ç›®çš„è„šæœ¬ã€‚</p></blockquote><p>æ–°å»º <code>deploy.sh</code> è„šæœ¬æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs sh"><span class="hljs-meta">#!/usr/bin/env bash</span><br><br>: &lt;&lt; !<br><span class="hljs-comment"># è¯¥æ³¨é‡Šå†…å®¹ä¸º Jenkins ä¸­çš„shellè„šæœ¬</span><br><span class="hljs-comment"># è¡¨ç¤ºéƒ¨ç½²å®Œä¸killè¿›ç¨‹ï¼Œjenkinsè¿›ç¨‹æ‰§è¡Œå®Œä¼šè‡ªåŠ¨å…³é—­ï¼Œå¦åˆ™ä¼šæŠŠå¯åŠ¨çš„serverä¹Ÿå…³é—­æ‰ï¼Œ</span><br>BUILD_ID=DONTKILLME<br><span class="hljs-comment"># åŠ è½½é…ç½®æ–‡ä»¶</span><br>. /etc/profile<br><br><span class="hljs-comment"># æ‰§è¡Œ.shå‰éœ€è¦é…ç½®(å£°æ˜)å¦‚ä¸‹å‚æ•°</span><br><span class="hljs-comment"># 1.æœåŠ¡å™¨ä¸Šé¡¹ç›®è·¯å¾„(ä¸å«é¡¹ç›®å)</span><br><span class="hljs-built_in">export</span> PROJECT_PATH=/root/projects/java<br><br><span class="hljs-comment"># 2.é¡¹ç›®å,åŒxxx.git</span><br><span class="hljs-built_in">export</span> PROJECT_NAME=LoginDemo<br><br><span class="hljs-comment"># 3.tomcatåœ¨æœåŠ¡æœºå™¨ä¸Šçš„å…¨è·¯å¾„</span><br><span class="hljs-built_in">export</span> TOMCAT_PATH=/root/apache-tomcat-9.0.37<br><br><span class="hljs-comment"># 4.è¿è¡Œéƒ¨ç½²è„šæœ¬ï¼ˆé¡¹ç›®ç›®å½•ä¸‹çš„deploy.shè„šæœ¬ï¼‰</span><br>sh <span class="hljs-variable">$PROJECT_PATH</span>/<span class="hljs-variable">$PROJECT_NAME</span>/deploy.sh<br>!<br><br><br><span class="hljs-comment"># ä»¥ä¸‹ä¸ºè„šæœ¬æ­£æ–‡ï¼š</span><br><span class="hljs-comment"># è‡ªåŠ¨éƒ¨ç½²æ­¥éª¤ï¼šgitåŒæ­¥æœ€æ–°ä»£ç  &gt; maven æ‰“åŒ… &gt; åœæ­¢tomcat &gt; éƒ¨ç½²åº”ç”¨ &gt; å¯åŠ¨tomcat</span><br><br><span class="hljs-comment">### å‡½æ•°:å…³é—­tomcat(ä¹Ÿå¯ä»¥é€šè¿‡ Tomcat çš„ shutdown.sh åœæ­¢æœåŠ¡å™¨)</span><br><span class="hljs-function"><span class="hljs-title">killTomcat</span></span>()<br>&#123;<br>    pid=`ps -ef|grep tomcat|grep java|awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span>`<br>    <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;tomcat Id list :<span class="hljs-variable">$pid</span>&quot;</span><br>    <span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$pid</span>&quot;</span> = <span class="hljs-string">&quot;&quot;</span> ]<br>    <span class="hljs-keyword">then</span><br>      <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;no tomcat pid alive&quot;</span><br>    <span class="hljs-keyword">else</span><br>      <span class="hljs-built_in">kill</span> -9 <span class="hljs-variable">$pid</span><br>    <span class="hljs-keyword">fi</span><br>&#125;<br><br><span class="hljs-comment"># åˆ é™¤æœ¬åœ°æ—§ä»£ç (æ–‡ä»¶å¤¹)</span><br><span class="hljs-built_in">rm</span> -rf <span class="hljs-variable">$PROJECT_PATH</span>/<span class="hljs-variable">$PROJECT_NAME</span><br><span class="hljs-comment"># æ‹‰å–æ–°ä»£ç </span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$PROJECT_PATH</span><br>git <span class="hljs-built_in">clone</span> git@gitlab.com:RainbowRing/LoginDemo.git<br><br><span class="hljs-comment"># æ„å»ºé¡¹ç›®</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$PROJECT_PATH</span>/<span class="hljs-variable">$PROJECT_NAME</span><br>mvn clean install<br><br><span class="hljs-comment"># åœæ­¢tomcat</span><br>killTomcat<br><br><span class="hljs-comment"># åˆ é™¤åŸæœ‰å·¥ç¨‹</span><br><span class="hljs-built_in">rm</span> -f <span class="hljs-variable">$TOMCAT_PATH</span>/webapps/<span class="hljs-variable">$PROJECT_NAME</span>.war<br><br><span class="hljs-comment"># å¤åˆ¶mavenæ‰“åŒ…åçš„å·¥ç¨‹åˆ°tomcatçš„webappsç›®å½•ä¸‹</span><br><span class="hljs-built_in">cp</span> <span class="hljs-variable">$PROJECT_PATH</span>/<span class="hljs-variable">$PROJECT_NAME</span>/target/<span class="hljs-variable">$PROJECT_NAME</span>.war <span class="hljs-variable">$TOMCAT_PATH</span>/webapps/<br><br><span class="hljs-comment"># é‡å‘½åå·¥ç¨‹(å¦‚æœéœ€è¦çš„è¯)</span><br><span class="hljs-comment">#cd $TOMCAT_PATH/webapps/</span><br><span class="hljs-comment">#mv LoginDemo loginDemo</span><br><br><span class="hljs-comment"># å¯åŠ¨Tomcat</span><br><span class="hljs-built_in">cd</span> <span class="hljs-variable">$TOMCAT_PATH</span>/<br>sh bin/startup.sh<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Jenkins</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Jenkins</tag>
      
      <tag>Jenkinsè„šæœ¬</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Jenkinsä½¿ç”¨æ‰‹å†Œ</title>
    <link href="/20200723120000/"/>
    <url>/20200723120000/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä»‹ç»Jenkinsçš„å®‰è£…ä¸ä½¿ç”¨ã€‚</p></blockquote><h1 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h1><p>ğŸ‘‰<a href="https://www.jenkins.io/">Jenkinså®˜ç½‘</a> çš„ <a href="https://www.jenkins.io/zh/download/">ä¸‹è½½é¡µé¢</a>ã€‚</p><p>windowså°±ä¸‹è½½for windowsç‰ˆæœ¬çš„ï¼ˆè¿™é‡Œä»¥windowsç¯å¢ƒå®‰è£…ä¸ºä¾‹ï¼‰ã€‚</p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><p><img src="/20200723120000/image-20230309002331438.png" alt="Jenkinså®‰è£…"></p><p>å®‰è£…å®Œæ¯•åä¼šè‡ªåŠ¨è¿›å…¥ç™»é™†é¡µé¢ï¼š</p><p><img src="/20200723120000/image-20230309002401085.png" alt="Jenkinsç™»é™†é¡µé¢"></p><h1 id="é…ç½®ä¸ä½¿ç”¨"><a href="#é…ç½®ä¸ä½¿ç”¨" class="headerlink" title="é…ç½®ä¸ä½¿ç”¨"></a>é…ç½®ä¸ä½¿ç”¨</h1><p>ç¬¬ä¸€æ¬¡å¯åŠ¨ä½ å¯èƒ½ä¼šæœ‰è¿™æ ·çš„é—®é¢˜ï¼šå®ƒä¼šä¸€ç›´åœ¨è¿™ä¸ªç™»å½•é¡µé¢è‡ªåŠ¨åˆ·æ–°ã€‚</p><p>ä¸»è¦åŸå› æ˜¯Jenkinsåœ¨å¯åŠ¨çš„æ—¶å€™ä¼šå»åŠ è½½ç›¸å…³é•œåƒæ–‡ä»¶ï¼Œé»˜è®¤çš„é•œåƒæ–‡ä»¶é…ç½®åœ°å€å¯¹æˆ‘ä»¬æ¯”è¾ƒä¸å‹å¥½ï¼ˆä½ æ‡‚çš„ï¼‰ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶ã€‚</p><h2 id="é•œåƒé…ç½®"><a href="#é•œåƒé…ç½®" class="headerlink" title="é•œåƒé…ç½®"></a>é•œåƒé…ç½®</h2><p>åœ¨Jenkinså®‰è£…ç›®å½•ä¸‹ï¼Œæ‰¾åˆ° <code>hudson.model.UpdateCenter.xml</code> æ–‡ä»¶ï¼Œæ‰“å¼€å¹¶ä¿®æ”¹urlä¸ºï¼š<code>https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</code></p><p><img src="/20200723120000/image-20230309002900344.png" alt="é•œåƒé…ç½®"></p><p><img src="/20200723120000/image-20230309002914803.png" alt="é•œåƒé…ç½®"></p><p>ä¿®æ”¹åéœ€è¦é‡å¯JenkinsæœåŠ¡ã€‚</p><p>å½“ç„¶ä½ ä¹Ÿæœ‰å¯èƒ½é‡åˆ°ç«¯å£å†²çªçš„é—®é¢˜ï¼Œé‚£ä¹ˆæ¥ä¿®æ”¹ä¸€ä¸‹ç«¯å£å§ã€‚</p><h2 id="ä¿®æ”¹ç«¯å£"><a href="#ä¿®æ”¹ç«¯å£" class="headerlink" title="ä¿®æ”¹ç«¯å£"></a>ä¿®æ”¹ç«¯å£</h2><p>åœ¨å®‰è£…ç›®å½•ä¸‹æ‰¾åˆ° <code>Jenkins.xml</code> æ–‡ä»¶ï¼Œè¿™ä¸ªå°±æ˜¯ç«¯å£é…ç½®çš„æ–‡ä»¶äº†ã€‚</p><h2 id="å¯åŠ¨JenkinsæœåŠ¡"><a href="#å¯åŠ¨JenkinsæœåŠ¡" class="headerlink" title="å¯åŠ¨JenkinsæœåŠ¡"></a>å¯åŠ¨JenkinsæœåŠ¡</h2><p>å¦‚æœæ˜¯é€šè¿‡msiæ–¹å¼å®‰è£…Jenkinsçš„è¯ï¼ˆæ¯”å¦‚æœ¬å®‰è£…æ•™ç¨‹ï¼‰ï¼Œéœ€è¦åœ¨ç³»ç»Ÿçš„â€œæœåŠ¡â€ä¸­æ‰¾åˆ°JenkinsæœåŠ¡ï¼Œç‚¹å‡»é‡å¯å³å¯ï¼ˆå¯è‡ªè¡Œç™¾åº¦æ€ä¹ˆè¿›å…¥æœåŠ¡ç®¡ç†é¡µé¢ï¼Œè¿™é‡Œç›´æ¥ç”¨æœç´¢å·¥å…·è¿›å…¥ï¼‰</p><p><img src="/20200723120000/image-20230309003131885.png" alt="windowså¯åŠ¨JenkinsæœåŠ¡"></p><p><img src="/20200723120000/image-20230309003139392.png" alt="windowså¯åŠ¨JenkinsæœåŠ¡"></p><p>é‡å¯åå†è¿›å…¥ç™»é™†é¡µé¢å°±å¯ä»¥æ­£å¸¸è¿›å…¥äº†ï¼š</p><p><img src="/20200723120000/image-20230309003155681.png" alt="Jenkinsé¦–æ¬¡ç™»å½•é¡µé¢"></p><h2 id="ç™»é™†"><a href="#ç™»é™†" class="headerlink" title="ç™»é™†"></a>ç™»é™†</h2><p>ç¬¬ä¸€æ¬¡ç™»é™†æ—¶éœ€è¦ä¿®æ”¹å¯†ç ï¼Œå¯†ç åœ¨é¡µé¢ä¸Šæœ‰æç¤ºå…¶æ–‡ä»¶åœ°å€ï¼ˆåœ¨å®‰è£…ç›®å½•ä¸‹ <code>\secrets\initialAdminPassword</code> æ–‡ä»¶ä¸­ï¼‰ï¼Œæ‰“å¼€è¿™ä¸ªæ–‡ä»¶å°±èƒ½çœ‹åˆ°åˆå§‹åŒ–å¯†ç äº†ã€‚</p><p><img src="/20200723120000/image-20230309003243071.png" alt="åˆå§‹åŒ–å¯†ç "></p><p>å°†å…¶å¤åˆ¶è¿›é¡µé¢çš„è¾“å…¥æ¡†å³å¯è¿›å…¥è‡ªå®šä¹‰Jenkinsé¡µé¢ï¼Œè¿™é‡Œé€‰æ‹©ç¬¬ä¸€ä¸ªâ€œå®‰è£…æ¨èçš„æ’ä»¶â€ã€‚</p><p><img src="/20200723120000/image-20230309003304652.png" alt="é¦–æ¬¡æ’ä»¶å®‰è£…"></p><p><img src="/20200723120000/image-20230309003313434.png" alt="é¦–æ¬¡æ’ä»¶å®‰è£…"></p><p>è‹¥æœ‰éƒ¨åˆ†æ’ä»¶å®‰è£…å¤±è´¥ï¼Œå¯ä»¥ç‚¹â€œé‡è¯•â€ï¼Œæˆ–è€…ç‚¹å‡»â€œç»§ç»­â€ä»¥åå†å®‰è£…ã€‚</p><p><img src="/20200723120000/image-20230309003337074.png" alt="é¦–æ¬¡æ’ä»¶å®‰è£…"></p><p>ç‚¹å‡»ç»§ç»­åå°±è¿›å…¥äº†åˆå§‹åŒ–è´¦æˆ·çš„é¡µé¢ï¼š</p><p><img src="/20200723120000/image-20230309003350745.png" alt="åˆå§‹åŒ–è´¦æˆ·"></p><p>æœ€åä¸€æ­¥å¯èƒ½ä¼šæç¤ºä½ éƒ¨åˆ†æ’ä»¶é‡å¯ï¼Œé‚£æˆ‘ä»¬å°±ç‚¹å‡»é‡å¯ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨é‡å¯æœåŠ¡ã€‚</p><p>é‡å¯åçš„ç™»é™†é¡µé¢å°±å˜äº†ï¼š</p><p><img src="/20200723120000/image-20230309003406451.png" alt="ç™»å½•é¡µé¢"></p><p>è¾“å…¥åˆšæ‰é…ç½®çš„è´¦æˆ·å¯†ç å³å¯è¿›å…¥åŠŸèƒ½é¡µé¢äº†ï¼š</p><p><img src="/20200723120000/image-20230309003425900.png" alt="å·¥ä½œå°"></p><h2 id="æ·»åŠ æ’ä»¶ï¼ˆè‡ªé€‰ï¼‰"><a href="#æ·»åŠ æ’ä»¶ï¼ˆè‡ªé€‰ï¼‰" class="headerlink" title="æ·»åŠ æ’ä»¶ï¼ˆè‡ªé€‰ï¼‰"></a>æ·»åŠ æ’ä»¶ï¼ˆè‡ªé€‰ï¼‰</h2><p>ç®¡ç†Jenkins &gt; æ’ä»¶ç®¡ç† &gt; å¯é€‰æ’ä»¶ &gt; æœç´¢æ¡†</p><p><img src="/20200723120000/image-20230309003444965.png" alt="æ’ä»¶å®‰è£…"></p><p><img src="/20200723120000/image-20230309003449283.png" alt="æ’ä»¶å®‰è£…"></p><p><img src="/20200723120000/image-20230309003453813-1678293294326-1.png" alt="æ’ä»¶å®‰è£…"></p><p><img src="/20200723120000/image-20230309003503103.png" alt="æ’ä»¶å®‰è£…"></p><p>è¿™é‡Œæˆ‘å®‰è£…äº†ï¼š</p><ul><li>å¸¸ç”¨æ’ä»¶ï¼šRebuilderã€safe restart</li><li>Gitç›¸å…³æ’ä»¶ï¼šGitLabã€GitLab API  </li><li>SSHç›¸å…³æ’ä»¶ï¼šSSH Agentã€SSH</li></ul><h2 id="ç”¨æˆ·åŠæƒé™é…ç½®"><a href="#ç”¨æˆ·åŠæƒé™é…ç½®" class="headerlink" title="ç”¨æˆ·åŠæƒé™é…ç½®"></a>ç”¨æˆ·åŠæƒé™é…ç½®</h2><h3 id="æ·»åŠ è‡ªå®šä¹‰ç”¨æˆ·"><a href="#æ·»åŠ è‡ªå®šä¹‰ç”¨æˆ·" class="headerlink" title="æ·»åŠ è‡ªå®šä¹‰ç”¨æˆ·"></a>æ·»åŠ è‡ªå®šä¹‰ç”¨æˆ·</h3><p>ç®¡ç†Jenkins &gt; Security &gt; ç”¨æˆ·ç®¡ç† &gt; æ–°å»ºç”¨æˆ·</p><p>æ–°å»ºç”¨æˆ·åéœ€è¦ç»™è¯¥ç”¨æˆ·æˆæƒã€‚</p><p>ï¼ˆè¿™é‡Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªtest01ç”¨æˆ·ï¼‰</p><h3 id="é…ç½®å…¨å±€å®‰å…¨å±æ€§ï¼ˆæˆæƒï¼‰"><a href="#é…ç½®å…¨å±€å®‰å…¨å±æ€§ï¼ˆæˆæƒï¼‰" class="headerlink" title="é…ç½®å…¨å±€å®‰å…¨å±æ€§ï¼ˆæˆæƒï¼‰"></a>é…ç½®å…¨å±€å®‰å…¨å±æ€§ï¼ˆæˆæƒï¼‰</h3><p>ç®¡ç†Jenkins &gt; Security &gt; Configure Global Security</p><p>åœ¨â€œæˆæƒç­–ç•¥â€ä¸­é€‰æ‹©â€œå®‰å…¨çŸ©é˜µâ€ &gt; æ·»åŠ ç”¨æˆ·&#x2F;ç»„ï¼Œæ·»åŠ ç”¨æˆ·åï¼Œå¯ä»¥åœ¨è¡¨æ ¼ä¸­è¿›è¡Œå‹¾é€‰ï¼Œå‹¾é€‰åç‚¹å‡»ä¿å­˜ï¼ˆè¡¨æ ¼æœ€åé¢æœ‰ä¸ªå…¨é€‰æŒ‰é’®ï¼‰ã€‚ä¾‹å¦‚ï¼šå¦‚æœä¸æƒ³è¦ç»™äºˆç”¨æˆ·è®¿é—®ç³»ç»Ÿç®¡ç†çš„æƒé™ï¼Œå…¨å‹¾é€‰åå»æ‰ç¬¬ä¸€é¡¹ã€‚</p><p><img src="/20200723120000/image-20230309003701457.png" alt="é…ç½®å…¨å±€å®‰å…¨å±æ€§ï¼ˆæˆæƒï¼‰"></p><h2 id="å°†Linuxæ³¨å†Œåˆ°Jenkinsä¸Š"><a href="#å°†Linuxæ³¨å†Œåˆ°Jenkinsä¸Š" class="headerlink" title="å°†Linuxæ³¨å†Œåˆ°Jenkinsä¸Š"></a>å°†Linuxæ³¨å†Œåˆ°Jenkinsä¸Š</h2><h3 id="æ–°å»ºèŠ‚ç‚¹"><a href="#æ–°å»ºèŠ‚ç‚¹" class="headerlink" title="æ–°å»ºèŠ‚ç‚¹"></a>æ–°å»ºèŠ‚ç‚¹</h3><p>è¿›å…¥Jenkinsï¼Œç®¡ç†Jenkins &gt; ç®¡ç†èŠ‚ç‚¹ &gt; æ–°å»ºèŠ‚ç‚¹</p><p>è¾“å…¥name</p><p>è¿œç¨‹å·¥ä½œç›®å½•ï¼š&#x2F;root&#x2F;.jenkins</p><p>â€‹    å¯åŠ¨æ–¹æ³•ï¼šlaunch slave agents via SSH</p><p>â€‹    ä¸»æœºï¼šlinux çš„ipåœ°å€ï¼Œ</p><p>ç‚¹å‡» credentials ä¸‹çš„ add æŒ‰é’®ï¼Œæ·»åŠ ç”¨æˆ·åå’Œå¯†ç ï¼ˆlinuxçš„è´¦æˆ·å¯†ç ï¼‰ï¼Œæ·»åŠ å®Œæˆåé€šè¿‡ä¸‹æ‹‰æ¡†é€‰æ‹©</p><p>â€‹    ä¿å­˜</p><p><img src="/20200723120000/image-20230309003740927.png" alt="ç®¡ç†èŠ‚ç‚¹"></p><p><img src="/20200723120000/image-20230309003748084.png" alt="æ–°å»ºèŠ‚ç‚¹"></p><p>ï¼ˆæ–°ç‰ˆæœ¬çš„å¯åŠ¨æ–¹å¼æ˜¯ launch agents via SSHï¼Œéœ€è¦å°† Host Key Verification Strategy ä¿®æ”¹ä¸º Non verifying Verification Strategyï¼‰</p><h3 id="æµ‹è¯•èŠ‚ç‚¹"><a href="#æµ‹è¯•èŠ‚ç‚¹" class="headerlink" title="æµ‹è¯•èŠ‚ç‚¹"></a>æµ‹è¯•èŠ‚ç‚¹</h3><p>åœ¨jenkinsçš„èŠ‚ç‚¹é¡µé¢ï¼Œé€‰æ‹©ä¸Šä¸€æ­¥æ–°å¢çš„èŠ‚ç‚¹ï¼Œç‚¹å‡»èŠ‚ç‚¹åï¼Œè¿›å…¥é¡µé¢åç‚¹å‡» launch agent æŒ‰é’®(æˆ–è€…å¯åŠ¨ä»£ç†)å³å¯è¿æ¥ã€‚</p><p><img src="/20200723120000/image-20230309003820212.png" alt="æµ‹è¯•èŠ‚ç‚¹"></p><p><img src="/20200723120000/image-20230309003825982.png" alt="æµ‹è¯•èŠ‚ç‚¹"></p><p>èŠ‚ç‚¹é…ç½®å¥½äº†ï¼Œç°åœ¨å¼€å§‹æ–°å»ºä¸€ä¸ªä»»åŠ¡å§ï¼</p><h2 id="ä»»åŠ¡åˆ›å»ºä¸æ„å»º"><a href="#ä»»åŠ¡åˆ›å»ºä¸æ„å»º" class="headerlink" title="ä»»åŠ¡åˆ›å»ºä¸æ„å»º"></a>ä»»åŠ¡åˆ›å»ºä¸æ„å»º</h2><ol><li><p>åœ¨Jenkinsä¸»é¡µï¼Œæ–°å»ºä¸€ä¸ªä»»åŠ¡ &gt; æ„å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›® &gt; OKã€‚</p></li><li><p>åœ¨Generalæ ‡ç­¾é¡µï¼Œå‹¾é€‰ Restrict where this project can be runï¼Œåœ¨ Label Expressionä¸­è¾“å…¥åˆšæ‰åˆ›å»ºçš„Linuxç¯å¢ƒçš„åç§°ï¼ˆåªå…è®¸åœ¨æŒ‡å®šç¯å¢ƒä¸Šè¿è¡Œï¼‰ã€‚</p></li><li><p>åœ¨æ„å»ºæ ‡ç­¾é¡µï¼Œå¢åŠ æ„å»ºæ­¥éª¤ï¼Œexcute shellï¼Œè¾“å…¥è¦æ‰§è¡Œçš„å‘½ä»¤ï¼ˆå¦‚ ifconfigï¼‰ã€‚</p></li><li><p>ä¿å­˜ã€‚</p></li><li><p>å›åˆ°Jenkinsä¸»é¡µï¼Œç‚¹å‡»ç«‹å³æ„å»ºã€‚</p></li><li><p>æ‰§è¡Œå®Œæ¯•åï¼Œç‚¹å‡»ä¸‹æ–¹çš„æ‰§è¡Œè®°å½•çš„ä»»åŠ¡åï¼ˆå¦‚#1ï¼‰ï¼Œè¿›å…¥ä»»åŠ¡è¯¦æƒ…é¡µï¼Œç‚¹å‡» console output ï¼Œå°±å¯ä»¥çœ‹åˆ°åˆšæ‰çš„å‘½ä»¤ï¼ˆifconfigï¼‰è¾“å‡ºäº†ã€‚</p></li></ol><p><img src="/20200723120000/image-20230309003907541.png" alt="ä»»åŠ¡åˆ›å»ºä¸æ„å»º"></p><p><img src="/20200723120000/image-20230309003913189.png" alt="ä»»åŠ¡åˆ›å»ºä¸æ„å»º"></p><p><img src="/20200723120000/image-20230309003921720.png" alt="ä»»åŠ¡åˆ›å»ºä¸æ„å»º"></p><p><img src="/20200723120000/image-20230309003928911.png" alt="ä»»åŠ¡åˆ›å»ºä¸æ„å»º"></p><p><img src="/20200723120000/image-20230309003935299.png" alt="ä»»åŠ¡åˆ›å»ºä¸æ„å»º"></p><p><img src="/20200723120000/image-20230309004004086.png" alt="ä»»åŠ¡åˆ›å»ºä¸æ„å»º"></p><p><img src="/20200723120000/image-20230309004014886.png" alt="ä»»åŠ¡åˆ›å»ºä¸æ„å»º"></p><p><img src="/20200723120000/image-20230309004026782.png" alt="ä»»åŠ¡åˆ›å»ºä¸æ„å»º"></p><p><img src="/20200723120000/image-20230309004040680.png" alt="ä»»åŠ¡åˆ›å»ºä¸æ„å»º"></p><h2 id="æœ¬æ¬¡åˆ†äº«ä¸­çš„æ„å»ºè„šæœ¬ç¤ºä¾‹"><a href="#æœ¬æ¬¡åˆ†äº«ä¸­çš„æ„å»ºè„šæœ¬ç¤ºä¾‹" class="headerlink" title="æœ¬æ¬¡åˆ†äº«ä¸­çš„æ„å»ºè„šæœ¬ç¤ºä¾‹"></a>æœ¬æ¬¡åˆ†äº«ä¸­çš„æ„å»ºè„šæœ¬ç¤ºä¾‹</h2><p><img src="/20200723120000/image-20230309004059676.png" alt="æ„å»ºè„šæœ¬ç¤ºä¾‹"></p><p>å¦å¤–ï¼ŒJenkinsä¹Ÿå¯ä»¥å®ç°å®šæ—¶ä»»åŠ¡è‡ªåŠ¨æ„å»ºï¼ˆå·²æ¼”ç¤ºï¼‰ã€‚</p><p><img src="/20200723120000/image-20230309004138691.png" alt="æ„å»ºè§¦å‘å™¨"></p><h2 id="å†™åœ¨æœ€å"><a href="#å†™åœ¨æœ€å" class="headerlink" title="å†™åœ¨æœ€å"></a>å†™åœ¨æœ€å</h2><p>æœ¬æ¬¡åˆ†äº«ä¸­æœªæ¶‰åŠJenkinsä¸gitæŒç»­é›†æˆï¼Œå¦‚æœæœ‰ç±»ä¼¼â€œåœ¨æäº¤ä»£ç åˆ°æœåŠ¡å™¨åèƒ½å¤Ÿè‡ªåŠ¨æ„å»ºâ€œçš„éœ€æ±‚ï¼Œå¯ç½‘ä¸Šè‡ªè¡Œæœç´¢è§£å†³æ–¹æ¡ˆï¼Œè¿™é‡Œå¯ä»¥æä¾›ä¸€ä¸ªæ–¹æ¡ˆå‚è€ƒï¼šwebhookã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Jenkins</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Jenkins</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>IEæµè§ˆå™¨éƒ¨åˆ†ç½‘ç«™ä¸­æ–‡æ— æ³•æ­£å¸¸æ˜¾ç¤ºé—®é¢˜</title>
    <link href="/20200722120000/"/>
    <url>/20200722120000/</url>
    
    <content type="html"><![CDATA[<h1 id="IEæµè§ˆå™¨éƒ¨åˆ†ç½‘ç«™ä¸­æ–‡æ— æ³•æ­£å¸¸æ˜¾ç¤ºé—®é¢˜"><a href="#IEæµè§ˆå™¨éƒ¨åˆ†ç½‘ç«™ä¸­æ–‡æ— æ³•æ­£å¸¸æ˜¾ç¤ºé—®é¢˜" class="headerlink" title="IEæµè§ˆå™¨éƒ¨åˆ†ç½‘ç«™ä¸­æ–‡æ— æ³•æ­£å¸¸æ˜¾ç¤ºé—®é¢˜"></a>IEæµè§ˆå™¨éƒ¨åˆ†ç½‘ç«™ä¸­æ–‡æ— æ³•æ­£å¸¸æ˜¾ç¤ºé—®é¢˜</h1><p>é—®é¢˜æè¿°ï¼šIEæµè§ˆå™¨éƒ¨åˆ†ç½‘ç«™ä¸­æ–‡æ— æ³•æ­£å¸¸æ˜¾ç¤ºï¼Œæ˜¾ç¤ºä¸ºè‹±æ–‡ã€‚</p><p>é—®é¢˜è¯´æ˜ï¼šç”±äº IE11 ä¸­å¾®è½¯å¼ƒç”¨äº† zh_CN è¯­è¨€ï¼Œè¿›è€Œé‡‡ç”¨ zh_hans_CNï¼Œ é€ æˆå‰å°è¯·æ±‚åå°æ•°æ®åï¼Œå‰å°é¡µé¢ä¸èƒ½æ­£å¸¸å›½é™…åŒ–é—®é¢˜ã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li><p>æ–¹æ¡ˆ1. ä¿®æ”¹windowsæ³¨å†Œè¡¨ä¿¡æ¯ã€‚</p><p>æ–°å»ºä¸€ä¸ª <code>xxx.reg</code> æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight moonscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs moonscript">Windows Registry Editor Version <span class="hljs-number">5.00</span><br><br><br>[HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\International]<br><span class="hljs-string">&quot;AcceptLanguage&quot;</span>=<span class="hljs-string">&quot;zh-CN;zh-Hans-CN,zh-Nans;en-US;en;&quot;</span><br></code></pre></td></tr></table></figure></li></ul><p>â€‹ä¿å­˜åæ‰§è¡Œæ³¨å†Œè¡¨æ–‡ä»¶å³å¯ã€‚</p><ul><li><p>æ–¹æ¡ˆ2. å¦‚æœæ˜¯ç½‘ç«™å¼€å‘äººå‘˜ï¼Œå¯ä»¥ä¿®æ”¹ç½‘ç«™çš„ç›¸å…³å›½é™…åŒ–é…ç½®æ¥è§£å†³è¯¥é—®é¢˜ã€‚</p><p>å¯å‚è€ƒæ–‡ç« ğŸ‘‰<a href="https://blog.csdn.net/juemodanqing/article/details/106226047">IE11 zh_HANS_CNå›½é™…åŒ–é—®é¢˜</a>ã€‚</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>é—®é¢˜è®°å½•</category>
      
      <category>IEæµè§ˆå™¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>IEæµè§ˆå™¨</tag>
      
      <tag>æ±‰åŒ–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>iOSçš„APPé™çº§</title>
    <link href="/20200526123000/"/>
    <url>/20200526123000/</url>
    
    <content type="html"><![CDATA[<blockquote><p>é™çº§æ•™ç¨‹å‚è€ƒğŸ‘‰<a href="https://zhuanlan.zhihu.com/p/101541667">åŸæ–‡åœ°å€</a></p><p><a href="https://tools.lancely.tech/apple/app-search?country=cn">åœ¨çº¿æŸ¥è¯¢appå†å²ç‰ˆæœ¬</a></p></blockquote><h1 id="1-å·¥å…·å‡†å¤‡"><a href="#1-å·¥å…·å‡†å¤‡" class="headerlink" title="1. å·¥å…·å‡†å¤‡"></a>1. å·¥å…·å‡†å¤‡</h1><ul><li><p>iTunesï¼Œéœ€è¦12.6.5ä»¥ä¸‹çš„ç‰ˆæœ¬ ï¼Œå› ä¸º12.6.5ä»¥ä¸Šçš„ç‰ˆæœ¬å‡å–æ¶ˆäº†Apple Storeã€‚</p></li><li><p>Fiddlerï¼Œè¯·æ±‚æ‹¦æˆªå·¥å…·ï¼Œä¹Ÿå¯ä½¿ç”¨å…¶ä»–è‡ªå·±ç†Ÿæ‚‰çš„å·¥å…·ï¼Œå¦‚HttpWatchã€BurpSuiteç­‰ã€‚</p></li></ul><h1 id="2-é…ç½®-Fiddler"><a href="#2-é…ç½®-Fiddler" class="headerlink" title="2. é…ç½® Fiddler"></a>2. é…ç½® Fiddler</h1><ol><li>æ‰“å¼€Fiddlerï¼ŒTools-Fiddler options-HTTPS-å…¨éƒ¨æ‰“å‹¾âœ”-å¯¼å‡ºè¯ä¹¦ï¼Œ è¯ä¹¦å¯¼å‡ºåˆ°æ¡Œé¢åï¼Œç›´æ¥åŒå‡»æ‰“å¼€å®‰è£…å³å¯ã€‚</li><li>æ‰“å¼€iTunesï¼Œè¿æ¥ä½ çš„iPhoneï¼Œç™»å½•è‹¹æœIDï¼ŒåŒæ—¶æœç´¢ä½ è¦é™çº§çš„åº”ç”¨ï¼Œè¿›å…¥åº”ç”¨è¯¦æƒ…é¡µé¢ã€‚ï¼ˆå…ˆä¸ç‚¹å‡»ä¸‹è½½ï¼‰</li><li>åœ¨ç‰ˆæœ¬æŸ¥è¯¢ç½‘ç«™æŸ¥è¯¢æ‰€éœ€è¦é™çº§çš„åº”ç”¨çš„ç‰ˆæœ¬å·ï¼Œæ¯ä¸ªåº”ç”¨ç‰ˆæœ¬éƒ½å¯¹åº”ç€ä¸åŒçš„ç‰ˆæœ¬å·ã€‚<a href="https://tools.lancely.tech/apple/app-search?country=cn">åœ¨çº¿æŸ¥è¯¢appå†å²ç‰ˆæœ¬</a></li></ol><h1 id="3-ä¸‹è½½å†å²ç‰ˆæœ¬"><a href="#3-ä¸‹è½½å†å²ç‰ˆæœ¬" class="headerlink" title="3. ä¸‹è½½å†å²ç‰ˆæœ¬"></a>3. ä¸‹è½½å†å²ç‰ˆæœ¬</h1><ol><li>æˆ‘ä»¬è¿›å…¥Fiddlerå·¥å…·ï¼Œç‚¹å‡»å¿«æ·é”®<strong>ã€ŒF11ã€</strong>ï¼Œå·¦ä¸‹è§’ä¼šå‡ºç°ä¸€ä¸ªçº¢è‰²çš„<strong>ã€ŒTã€</strong>ï¼ŒFiddlerä¾¿å¼€å§‹è¿›è¡Œæ‹¦æˆªã€‚</li><li>è¿”å›iTunesçš„åº”ç”¨è¯¦æƒ…é¡µé¢ï¼Œç‚¹å‡»<strong>ã€Œä¸‹è½½ã€</strong>æˆ–è€…<strong>ã€Œè·å–ã€</strong>æŒ‰é’®ã€‚</li><li>è¿”å›Fiddlerå·¥å…·ï¼Œå·¦ä¾§ç•Œé¢ä¼šå‡ºç°<strong>çº¢è‰²å¼€å¤´çš„æ‹¦æˆªé“¾æ¥</strong>ã€‚ ï¼ˆåº”ç”¨é“¾æ¥æ ¼å¼åŸºæœ¬ä¸ºï¼šâ€œå­—æ¯æ•°å­—-buyâ€å¼€å¤´ï¼Œæˆ‘è¿™é‡Œä¸¾ä¾‹çš„QQä¸ºp45-buyå¼€å¤´ã€‚ï¼‰</li><li>ç‚¹å‡»æ‹¦æˆªé“¾æ¥ä¹‹åï¼Œå†ç‚¹å‡»å³ä¾§ç•Œé¢çš„ã€Œ<strong>Inspectors</strong>ã€â€”ã€Œ<strong>TextView</strong>ã€é€‰é¡¹ï¼Œæœ€åå†ç‚¹å‡»ä¸‹æ–¹çš„ã€Œ<strong>Run to completion</strong>ã€ã€‚</li><li>è¿™æ—¶å·¦ä¾§å°±ä¼šå‡ºç°ä»¥<strong>p45-buyå¼€å¤´</strong>çš„é“¾æ¥ï¼ˆQQä¸ºä¾‹ï¼‰ï¼Œå†ç‚¹å‡»ä¸€ä¸‹è¯¥é“¾æ¥ï¼Œå‡ºç°è¯¥åº”ç”¨çš„æœ€æ–°ç‰ˆæœ¬å·ï¼Œæˆ‘ä»¬åªéœ€<strong>å°†æœ€æ–°çš„ç‰ˆæœ¬å·æ›´æ”¹ä¸ºé™çº§çš„ç‰ˆæœ¬å·</strong>å³å¯ã€‚ä¿®æ”¹å®Œæˆåï¼Œæˆ‘ä»¬å†æ¬¡ç‚¹å‡»å³ä¾§ä¸‹æ–¹çš„ã€Œ<strong>Run to completion</strong>ã€ï¼Œæ¥ç€ç›´æ¥å…³é—­Fiddlerå·¥å…·å³å¯ã€‚</li><li>è¿”å›iTunesï¼Œè¿™æ—¶å¯èƒ½ä¼šæç¤º<strong>â€œä¸‹è½½é”™è¯¯â€</strong>ç­‰æç¤ºï¼Œæˆ‘ä»¬ç›´æ¥å¿½è§†å®ƒï¼Œåœ¨æœç´¢æ å³ä¾§ç‚¹å‡»ä¸‹è½½é¡µé¢<strong>é‡æ–°ä¸‹è½½</strong>å³å¯ã€‚ï¼ˆå¦‚æœæç¤º â€œ ç™»é™†itunesæç¤ºæ— æ³•è¿æ¥Apple IDæœåŠ¡å™¨â€å°±ä¸ç®¡å®ƒï¼Œä¸‹è½½åˆ—è¡¨è¿›åº¦å¯èƒ½æ²¡æœ‰ï¼Œä½†å®é™…ä¸Šæ˜¯æœ‰åœ¨ä¸‹è½½ã€‚ï¼‰</li><li>ä¸‹è½½å®Œæˆåï¼Œå®‰è£…åŒ…ä¼šä¿å­˜åœ¨é»˜è®¤è·¯å¾„ä¸­ï¼ŒiTunesæ‰“å¼€<strong>ã€Œç¼–è¾‘ã€-ã€Œåå¥½è®¾ç½®ã€-ã€Œé«˜çº§ã€</strong>ï¼Œå³å¯çœ‹åˆ°åº”ç”¨ä¸‹è½½çš„è·¯å¾„ã€‚</li></ol>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>iOS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>iOS</tag>
      
      <tag>APPé™çº§</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>IEå¼¹çª—å¯ç‚¹å‡»ï¼ˆæ¨¡æ€æ¡†éæ¨¡æ€æ¡†ï¼‰</title>
    <link href="/20200513123000/"/>
    <url>/20200513123000/</url>
    
    <content type="html"><![CDATA[<h2 id="IEå¼¹çª—å¯-x2F-ä¸å¯ç‚¹å‡»"><a href="#IEå¼¹çª—å¯-x2F-ä¸å¯ç‚¹å‡»" class="headerlink" title="IEå¼¹çª—å¯&#x2F;ä¸å¯ç‚¹å‡»"></a>IEå¼¹çª—å¯&#x2F;ä¸å¯ç‚¹å‡»</h2><blockquote><p>ğŸ‘‰<a href="https://blog.csdn.net/iteye_4398/article/details/81689102">å‚è€ƒåŸæ–‡</a></p></blockquote><ul><li><p>æ–¹æ³•ä¸€ï¼š</p><p>è®¾ç½®å¼¹å‡ºçª—å£çš„ <code>&lt;body&gt;</code>ï¼š</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;body Î¿nblur=<span class="hljs-string">&quot;self.focus()&quot;</span>&gt;<br></code></pre></td></tr></table></figure></li><li><p>æ–¹æ³•äºŒï¼š</p><p>ç”¨showModalDialogæ–¹æ³•å»ºç«‹æ¨¡å¼å¯¹è¯æ¡†ï¼š</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;script&gt;<br>    function <span class="hljs-title function_">topwin</span><span class="hljs-params">()</span>&#123;<br>        window.showModalDialog(<span class="hljs-string">&quot;D:\window.html&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;dialogWidth:300px;dialogHeight:300px;scroll:no;status:no&quot;</span>)<br>    &#125;<br>&lt;/script&gt;<br>&lt;button onClick=<span class="hljs-string">&quot;topwin()&quot;</span>&gt;æ‰“å¼€æ¨¡æ€çª—å£&lt;/button&gt;<br></code></pre></td></tr></table></figure><p>æ­¤æ–¹æ³•çš„æ•ˆæœå’Œæ–¹æ³•ä¸€çš„æ•ˆæœç›¸åŒï¼Œå¼¹å‡ºçª—å£å‰ç«¯æ˜¾ç¤ºï¼Œä½†æ˜¯ä¸èƒ½åœ¨å…¶ä»–çª—å£åšä»»ä½•æ“ä½œäº†ï¼Œä¹Ÿæ˜¯ä¸¢äº†ç„¦ç‚¹ã€‚</p></li><li><p>æ–¹æ³•ä¸‰ï¼š</p><p>ç”¨showModelessDialogæ–¹æ³•å»ºç«‹æ— æ¨¡å¼å¯¹è¯æ¡†ï¼š</p><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jsp">&lt;script&gt;<br>    function <span class="hljs-title function_">topwin</span><span class="hljs-params">()</span>&#123;<br>        window.showModelessDialog(<span class="hljs-string">&quot;D:\window.html&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;dialogWidth:300px;dialogHeight:300px;scroll:no;status:no&quot;</span>)<br>    &#125;<br>&lt;/script&gt;<br>&lt;button onClick=<span class="hljs-string">&quot;topwin()&quot;</span>&gt;æ‰“å¼€éæ¨¡æ€çª—å£&lt;/button&gt;<br></code></pre></td></tr></table></figure></li></ul><h2 id="showModalDialog-è¾“å…¥å‚æ•°è¯´æ˜"><a href="#showModalDialog-è¾“å…¥å‚æ•°è¯´æ˜" class="headerlink" title="showModalDialog() è¾“å…¥å‚æ•°è¯´æ˜"></a>showModalDialog() è¾“å…¥å‚æ•°è¯´æ˜</h2><p>ğŸ‘‰<a href="https://www.cnblogs.com/tianxiaoxiao/p/7486174.html">å‚è€ƒæ–‡æ¡£</a></p><h2 id="éæ¨¡æ€çˆ¶å­çª—å£äº¤äº’"><a href="#éæ¨¡æ€çˆ¶å­çª—å£äº¤äº’" class="headerlink" title="éæ¨¡æ€çˆ¶å­çª—å£äº¤äº’"></a>éæ¨¡æ€çˆ¶å­çª—å£äº¤äº’</h2><p>æ¨¡æ€çª—å£å¯ä»¥é€šè¿‡å›è°ƒå‡½æ•°è¿›è¡Œäº¤äº’ï¼Œéæ¨¡æ€çª—å£å¯ä»¥å‚è€ƒï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 1.çˆ¶çª—å£æ‰“å¼€å…¥å‚ä¼ ä¸€ä¸ªwindowå¯¹è±¡</span><br><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">showModalDialog</span>(url,<span class="hljs-variable language_">window</span>,<span class="hljs-string">&quot;dialogWidth:300px;dialogHeight:300px;scroll:no;status:no&quot;</span>);<br><br><span class="hljs-comment">// 2.å­çª—å£æ¥æ”¶å‚æ•°å¹¶è°ƒç”¨ä¸»è°ƒçª—å£çš„å‡½æ•°</span><br><span class="hljs-keyword">var</span> parentWindow = <span class="hljs-variable language_">window</span>.<span class="hljs-property">dialogArguments</span>;<br>parentWindow.<span class="hljs-title function_">parentFn</span>(); <span class="hljs-comment">//parentFnæ˜¯ä¸»è°ƒçª—å£çš„å‡½æ•°</span><br></code></pre></td></tr></table></figure><h2 id="æ¨¡æ€çª—è°ƒè¯•é—®é¢˜"><a href="#æ¨¡æ€çª—è°ƒè¯•é—®é¢˜" class="headerlink" title="æ¨¡æ€çª—è°ƒè¯•é—®é¢˜"></a>æ¨¡æ€çª—è°ƒè¯•é—®é¢˜</h2><p>æ¨¡æ€çª—å£æ— æ³•é€šè¿‡F12å¼€å‘è€…å·¥å…·æŸ¥çœ‹é¡µé¢ä¿¡æ¯ï¼Œå¯ä»¥å°è¯•å°†å…¶ä¿®æ”¹ä¸ºæ–°é¡µé¢æ‰“å¼€çš„æ–¹å¼è¿›è¡Œè°ƒè¯•ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">showDialog</span>(<span class="hljs-string">&quot;/businesss/page.jsp&quot;</span>)<br></code></pre></td></tr></table></figure><p>ä¿®æ”¹ä¸ºopen()ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(<span class="hljs-variable constant_">WEB_ROOT</span>+<span class="hljs-string">&quot;/businesss/page.jsp&quot;</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>IEæµè§ˆå™¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>IEæµè§ˆå™¨</tag>
      
      <tag>å¼¹çª—</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Fiddleræ— æ³•æŠ“æœ¬åœ°æ•°æ®åŒ…</title>
    <link href="/20200219120000/"/>
    <url>/20200219120000/</url>
    
    <content type="html"><![CDATA[<ul><li><p>æ–¹æ³•ä¸€ï¼šåœ¨localhoståå¢åŠ .fiddler</p><p>æ¯”å¦‚è¯·æ±‚<code>http://localhost:8080</code>æ”¹ä¸º<code>http://localhost.fiddler:8080</code>å³å¯</p></li><li><p>æ–¹æ³•äºŒï¼šåœ¨localhostæˆ–127.0.0.1åå¢åŠ ä¸€ä¸ªç‚¹å³å¯</p><p>æ¯”å¦‚<code>http://localhost.:8080</code></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>é—®é¢˜è®°å½•</category>
      
      <category>Fiddler</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fiddler</tag>
      
      <tag>æŠ“åŒ…</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Oracleä¸­çš„ä¸ç­‰äºæ¡ä»¶çš„æ³¨æ„ç‚¹</title>
    <link href="/20191210120000/"/>
    <url>/20191210120000/</url>
    
    <content type="html"><![CDATA[<p>å‡è®¾ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t.<span class="hljs-operator">*</span>, t.rowid <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> t<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªSQLæŸ¥è¯¢å‡ºæ¥çš„ç»“æœæœ‰16æ¡ï¼Œå…¶ä¸­å­—æ®µ user_id å€¼ä¸ºç©ºçš„æ•°æ® 10 æ¡ï¼Œä¸ä¸ºç©ºçš„6æ¡ï¼Œ</p><p>é‚£ä¹ˆï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t.<span class="hljs-operator">*</span>, t.rowid <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> t <span class="hljs-keyword">WHERE</span> t.user_id <span class="hljs-operator">&lt;&gt;</span> <span class="hljs-string">&#x27;123&#x27;</span><br></code></pre></td></tr></table></figure><p>å¦‚æœæœŸæœ›æŸ¥è¯¢å‡ºuser_id &#x3D; â€˜123â€™ä»¥å¤–çš„æ•°æ®ï¼Œè¿™ä¸ªsqlæ‰§è¡Œä¹‹åï¼Œä¼šæ¯”æœŸæœ›çš„æ•°æ®å°‘10æ¡ï¼ˆå³ï¼š10æ¡ user_id å€¼ä¸ºç©ºçš„æ•°æ®è¢«è¿‡æ»¤æ‰ï¼‰</p><p>æ­£ç¡®å†™æ³•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> t.<span class="hljs-operator">*</span>, t.rowid <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span> t <span class="hljs-keyword">WHERE</span> t.user_id <span class="hljs-operator">&lt;&gt;</span> <span class="hljs-string">&#x27;123&#x27;</span> <span class="hljs-keyword">or</span> t.user_id <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span><br></code></pre></td></tr></table></figure><p>æ€»ç»“ï¼š</p><p><strong>nullåªèƒ½é€šè¿‡is nullæˆ–è€…is not nullæ¥åˆ¤æ–­ï¼Œå…¶å®ƒæ“ä½œç¬¦ä¸nullæ“ä½œéƒ½æ˜¯false</strong></p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Oracle</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Oracle</tag>
      
      <tag>SQLè¯­å¥</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>IEå¼¹å‡ºçª—å£æ˜¾ç¤ºåœ°å€è®¾ç½®</title>
    <link href="/20191121123000/"/>
    <url>/20191121123000/</url>
    
    <content type="html"><![CDATA[<p>åœ¨å¼€å‘ä¸­ä½¿ç”¨å¼¹å‡ºçª—å£æ—¶çœ‹ä¸åˆ°åœ°å€æ ï¼Œä¸çŸ¥é“URLå¯¹å¼€å‘å¾ˆä¸æ–¹ä¾¿ï¼Œè®¾ç½®åŠæ³•å¦‚ä¸‹ï¼š</p><p>å·¥å…·â€“&gt;Internet é€‰é¡¹â€“&gt;å®‰å…¨â€“&gt;è‡ªå®šä¹‰çº§åˆ«â€“&gt;å…è®¸ç½‘ç«™æ‰“å¼€æ²¡æœ‰åœ°å€æ æˆ–çŠ¶æ€æ çš„çª—å£â€“&gt;ç¦æ­¢</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>IEæµè§ˆå™¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>IEæµè§ˆå™¨</tag>
      
      <tag>å¼¹çª—</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>likeæ¨¡ç³ŠæŸ¥è¯¢ä¸‹åˆ’çº¿æ¡ä»¶ä¼šæŸ¥è¯¢å‡ºæ‰€æœ‰æ•°æ®</title>
    <link href="/20191113120000/"/>
    <url>/20191113120000/</url>
    
    <content type="html"><![CDATA[<p>åŸæ¥æ¡ä»¶SQLå¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">AND</span> user_name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-operator">||</span> ? <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;%&#x27;</span><br></code></pre></td></tr></table></figure><p>æ ¹æ® like æ¨¡ç³ŠæŸ¥è¯¢çš„åŒ¹é…è§„åˆ™ï¼Œ ä¸‹åˆ’çº¿ _ è¡¨ç¤ºåŒ¹é…ä»»ä¸€å­—ç¬¦ï¼Œæ‰€ä»¥ä¼šå‡ºç°æŸ¥è¯¢æ¡ä»¶ è¾“å…¥ä¸€ä¸ª _ å°±ä¼šæŸ¥è¯¢å‡ºæ‰€æœ‰çš„æ•°æ®ï¼Œä¸é¢„æœŸçš„ç»“æœä¸ä¸€è‡´ã€‚</p><p>ä¿®æ”¹æ–¹æ¡ˆ1ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">AND</span> user_name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-operator">||</span> ? <span class="hljs-operator">||</span> <span class="hljs-string">&#x27;%&#x27;</span> <span class="hljs-keyword">ESCAPE</span> <span class="hljs-string">&#x27;\&#x27;</span><br></code></pre></td></tr></table></figure><p>è¿™ä¹ˆå†™ä»£è¡¨å°† \ ä½œä¸ºè½¬ä¹‰å­—ç¬¦ï¼ˆä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ç‰¹æ®Šå­—ç¬¦ï¼‰ï¼ŒæŸ¥è¯¢æ¡ä»¶å…¥å‚æ—¶éœ€è¦å°† _ æ›¿æ¢ä¸º _ï¼Œè¿™æ ·å°±èƒ½å®ç°å°†ä¸‹åˆ’çº¿å½“ä½œæ™®é€šå­—ç¬¦æŸ¥è¯¢æ¡ä»¶ã€‚</p><p>ä½†æ˜¯è¿™ä¹ˆå†™éœ€è¦è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼Œå³ï¼š \ è¿™ä¸ªç‰¹æ®Šå­—ç¬¦å°±ä¸èƒ½ä½œä¸ºæŸ¥è¯¢æ¡ä»¶ã€‚</p><p>ä¿®æ”¹æ–¹æ¡ˆ2ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">--å‰åæ¨¡ç³ŠæŸ¥è¯¢</span><br><span class="hljs-keyword">AND</span> INSTR(user_name, ?) <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span><br><br><span class="hljs-comment">--ç›¸å½“äº NOT LIKE</span><br><span class="hljs-keyword">AND</span> INSTR(user_name, ?) <span class="hljs-operator">=</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>æ€»ç»“ï¼šåœ¨æ¶‰åŠæ¨¡ç³ŠæŸ¥è¯¢çš„åœ°æ–¹å°±éœ€è¦æ³¨æ„è¿™ç§æƒ…å†µï¼Œæ˜¯å¦éœ€è¦é™åˆ¶ç‰¹æ®Šå­—ç¬¦ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Oracle</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Oracle</tag>
      
      <tag>SQLè¯­å¥</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>OracleæŸ¥è¯¢å¼‚å¸¸ï¼šä¸å­˜åœ¨çš„LOBå€¼å¤„ç†æ–¹æ³•</title>
    <link href="/20191031120000/"/>
    <url>/20191031120000/</url>
    
    <content type="html"><![CDATA[<p>é—®é¢˜SQLï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">to_char(wmsys.WM_CONCAT(<span class="hljs-keyword">distinct</span> oname.org_name)) orgNameClob<br></code></pre></td></tr></table></figure><p>åœ¨PL&#x2F;SQLæ‰§è¡Œæ²¡æœ‰é—®é¢˜ï¼Œä½†åœ¨JAVAåç«¯æŠ¥é”™ã€‚</p><p>å¯ä¿®æ”¹ä¸ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-built_in">listagg</span>(oname.org_name,<span class="hljs-string">&#x27;,&#x27;</span>) <span class="hljs-keyword">within</span> <span class="hljs-keyword">group</span> (<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> (oname.org_name)) <span class="hljs-keyword">as</span> orgNameClob<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>é—®é¢˜è®°å½•</category>
      
      <category>Oracle</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Oracle</tag>
      
      <tag>SQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Oracleåˆ†åŒºä¼˜åŒ–åˆ†æ</title>
    <link href="/20190822120000/"/>
    <url>/20190822120000/</url>
    
    <content type="html"><![CDATA[<p><img src="/20190822120000/Image.png" alt="åˆ†åŒºddl"></p><p>ä¸Šå›¾ä¸­å¯¹äºè¯¥è¡¨åšäº†äºŒçº§åˆ†åŒºï¼šä¸€çº§ä¸º PROV_ORG_NOï¼ŒäºŒçº§ä¸º ACCEPT_TIMEï¼Œå½“ä¸€çº§åˆ†åŒºèµ·åˆ°ä½œç”¨æ—¶ï¼ŒäºŒçº§åˆ†åŒºæ‰ä¼šèµ·æ•ˆï¼Œå¦åˆ™æ‰§è¡Œè®¡åˆ’çœ‹åˆ°çš„æ˜¯ PARTITION LIST ALL </p><p><img src="/20190822120000/Image-1678685413173-6.png" alt="æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’"></p><p>å¯¹äºæœ‰åˆ†åŒºçš„è¡¨çš„æŸ¥è¯¢SQLï¼Œä¼˜åŒ–åˆ†ææ—¶å¯ä»¥çœ‹çœ‹æŸ¥è¯¢æ¡ä»¶æ˜¯å¦ä¼šèµ°åˆ†åŒºã€‚</p><p>ä¼˜åŒ–åï¼šPARTITION LIST SINGLE</p><p><img src="/20190822120000/Image-1678685451642-8.png" alt="æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’"></p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Oracle</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Oracle</tag>
      
      <tag>è¡¨åˆ†åŒº</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>jspæŠ¥é”™the import cannot be resolved</title>
    <link href="/20190702120000/"/>
    <url>/20190702120000/</url>
    
    <content type="html"><![CDATA[<p>jspæŠ¥é”™ <code>the import cannot be resolved</code> é—®é¢˜å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•è§£å†³ï¼š</p><ol><li><p>cleané¡¹ç›®ï¼Œé‡æ–°ç¼–è¯‘é¡¹ç›®ã€‚</p><p>ã€è§£å†³ã€‘ä¸€èˆ¬ä½¿ç”¨eclipse&#x2F;myeclipseçš„èœå• project -&gt; clean ..å¯ä»¥è§£å†³ã€‚åŒæ—¶æœ€å¥½é€‰ä¸­Build Automaticallyé€‰é¡¹ã€‚</p></li><li><p>è‹¥æ˜¯æ²¡æœ‰è§£å†³ï¼Œä¸è¦ç€æ€¥ï¼Œç»§ç»­æ¥ã€‚é‡æ–°å¯¼å…¥jaråŒ…ã€‚</p><p>ã€è§£å†³ã€‘å³é”®é¡¹ç›®-&gt;build path -&gt; Config build path -&gt; Libraries-&gt; removeåï¼Œé‡æ–°å¯¼å…¥ã€‚</p></li><li><p>è¯¥é¡¹ç›®æœ‰ä¾èµ–é¡¹ç›®éœ€è¦é‡æ–°å¯¼å…¥ä¾èµ–é¡¹ç›®ã€‚</p><p>ã€è§£å†³ã€‘å³é”®é¡¹ç›®-&gt;build path -&gt; Config build path -&gt; project -&gt; removeåï¼Œé‡æ–°å¯¼å…¥ã€‚</p></li><li><p>è‡ªåŠ¨ç¼–è¯‘çš„classæ–‡ä»¶å¤¹è·¯å¾„é—®é¢˜</p><p>ã€è§£å†³ã€‘å³é”®é¡¹ç›®-&gt;build path -&gt; Config build path -&gt; source-&gt; åœ¨å¯¹è¯æ¡†çš„æœ€ä¸‹ä¾§æœ‰ä¸ªDefault output file:é€‰é¡¹ï¼Œå¯ä»¥é€‰æ‹©é¡¹ç›®å†eclipse&#x2F;myeclipseä¸­ç¼–è¯‘åçš„classæ–‡ä»¶çš„è·¯å¾„ï¼Œä¸€èˆ¬webé¡¹ç›®çš„è·¯å¾„ä¸º{ProjectName}&#x2F;web(WebRoot)&#x2F;WEB-INF&#x2F;classesï¼Œéwebé¡¹ç›®ä¸€èˆ¬ä¸º{ProjectName}&#x2F;classesã€‚</p></li><li><p>é—®é¢˜è¿˜æ˜¯å­˜åœ¨çš„è¯ï¼Œå°±è¶…å‡ºè¿™ä¸ªé—®é¢˜çš„ç•Œé™äº†ï¼Œæ„æ€å°±æ˜¯è¯´å¯èƒ½å°±æ˜¯å…¶ä»–çš„é—®é¢˜å¼•èµ·çš„é”™è¯¯ã€‚</p><p>ã€è§£å†³ã€‘å…¶å®ä¹Ÿä¸ç®—æ˜¯è§£å†³ã€‚å…·ä½“æ˜¯ä»€ä¹ˆé—®é¢˜å¼•èµ·çš„å¯ä»¥æ‰“å¼€Problemså¯¹è¯æ¡†çª—å£æŸ¥çœ‹ã€‚</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>é—®é¢˜è®°å½•</category>
      
      <category>JSP</category>
      
    </categories>
    
    
    <tags>
      
      <tag>JSP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Javaä¸­Listéå†æ—¶æ“ä½œå…ƒç´ çš„æ³¨æ„ç‚¹</title>
    <link href="/20190621120000/"/>
    <url>/20190621120000/</url>
    
    <content type="html"><![CDATA[<p>JAVAä¸­å¾ªç¯éå†listæœ‰ä¸‰ç§æ–¹å¼forå¾ªç¯ã€for-eachå¾ªç¯ã€iteratoréå†ã€‚</p><ol><li><p>forå¾ªç¯éå†liståˆ é™¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; list.size(); i++)&#123;<br>    <span class="hljs-keyword">if</span>(list.get(i).equals(<span class="hljs-string">&quot;del&quot;</span>))&#123;<br>        list.remove(i);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼çš„é—®é¢˜åœ¨äºï¼Œåˆ é™¤æŸä¸ªå…ƒç´ åï¼Œlistçš„å¤§å°å‘ç”Ÿäº†å˜åŒ–ï¼Œè€Œä½ çš„ç´¢å¼•ä¹Ÿåœ¨å˜åŒ–ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´ä½ åœ¨éå†çš„æ—¶å€™æ¼æ‰æŸäº›å…ƒç´ ã€‚æ¯”å¦‚å½“ä½ åˆ é™¤ç¬¬1ä¸ªå…ƒç´ åï¼Œç»§ç»­æ ¹æ®ç´¢å¼•è®¿é—®ç¬¬2ä¸ªå…ƒç´ æ—¶ï¼Œå› ä¸ºåˆ é™¤çš„å…³ç³»åé¢çš„å…ƒç´ éƒ½å¾€å‰ç§»åŠ¨äº†ä¸€ä½ï¼Œæ‰€ä»¥å®é™…è®¿é—®çš„æ˜¯ç¬¬3ä¸ªå…ƒç´ ã€‚å› æ­¤ï¼Œè¿™ç§æ–¹å¼å¯ä»¥ç”¨åœ¨åˆ é™¤ç‰¹å®šçš„ä¸€ä¸ªå…ƒç´ æ—¶ä½¿ç”¨ï¼Œä½†ä¸é€‚åˆå¾ªç¯åˆ é™¤å¤šä¸ªå…ƒç´ æ—¶ä½¿ç”¨ã€‚</p></li><li><p>for-eachå¾ªç¯åˆ é™¤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">for</span>(String str : list)&#123;<br>    <span class="hljs-keyword">if</span>(str.equals(<span class="hljs-string">&quot;del&quot;</span>))&#123;<br>        list.remove(str);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼çš„é—®é¢˜åœ¨äºï¼Œåˆ é™¤å…ƒç´ åç»§ç»­å¾ªç¯ä¼šæŠ¥é”™è¯¯ä¿¡æ¯ConcurrentModificationExceptionï¼Œå› ä¸ºå…ƒç´ åœ¨ä½¿ç”¨çš„æ—¶å€™å‘ç”Ÿäº†å¹¶å‘çš„ä¿®æ”¹ï¼Œå¯¼è‡´å¼‚å¸¸æŠ›å‡ºã€‚ä½†æ˜¯åˆ é™¤å®Œæ¯•é©¬ä¸Šä½¿ç”¨breakè·³å‡ºï¼Œåˆ™ä¸ä¼šè§¦å‘æŠ¥é”™ã€‚</p></li><li><p>iteratoréå†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">Iterator&lt;String&gt; it = list.iterator(); <br><span class="hljs-keyword">while</span>(it.hasNext())&#123;<br>    <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> it.next();<br>    <span class="hljs-keyword">if</span>(str.equals(<span class="hljs-string">&quot;del&quot;</span>))&#123;<br>        it.remove();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼å¯ä»¥æ­£å¸¸çš„å¾ªç¯åŠåˆ é™¤ã€‚ä½†è¦æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨iteratorçš„removeæ–¹æ³•ï¼Œå¦‚æœç”¨listçš„removeæ–¹æ³•åŒæ ·ä¼šæŠ¥ä¸Šé¢æåˆ°çš„ConcurrentModificationExceptioné”™è¯¯ã€‚</p></li></ol>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹æ‰§è¡Œæ—¥å¿—</title>
    <link href="/20190612120000/"/>
    <url>/20190612120000/</url>
    
    <content type="html"><![CDATA[<p>SQLæŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹æ‰§è¡Œæ—¥å¿—ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> t.sql_id,<br>    t.sql_text,<br>    s.plan_hash_value,<br>    s.optimizer_cost,<br>    s.executions_total,<br>    s.elapsed_time_total,<br>    s.disk_reads_total,<br>    s.buffer_gets_total<br><span class="hljs-keyword">from</span> DBA_HIST_SQLSTAT s, DBA_HIST_SQLTEXT t<br><span class="hljs-keyword">where</span> s.sql_id<span class="hljs-operator">=</span>t.sql_id<br><span class="hljs-keyword">and</span> t.sql_text <span class="hljs-keyword">like</span><span class="hljs-string">&#x27;%å­˜å‚¨è¿‡ç¨‹åç§°%&#x27;</span>;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Oracle</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Oracle</tag>
      
      <tag>SQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SQLä¼˜åŒ–</title>
    <link href="/20190416120000/"/>
    <url>/20190416120000/</url>
    
    <content type="html"><![CDATA[<p>1ã€é¿å…åœ¨whereå­å¥ä¸­ä½¿ç”¨ is null æˆ– is not null å¯¹å­—æ®µè¿›è¡Œåˆ¤æ–­ã€‚</p><p>å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">where</span> name <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span><br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªæŸ¥è¯¢ä¸­ï¼Œå°±ç®—æˆ‘ä»¬ä¸º name å­—æ®µè®¾ç½®äº†ç´¢å¼•ï¼ŒæŸ¥è¯¢åˆ†æå™¨ä¹Ÿä¸ä¼šä½¿ç”¨ï¼Œå› æ­¤æŸ¥è¯¢æ•ˆç‡åº•ä¸‹ã€‚ä¸ºäº†é¿å…è¿™æ ·çš„æŸ¥è¯¢ï¼Œåœ¨æ•°æ®åº“è®¾è®¡çš„æ—¶å€™ï¼Œå°½é‡å°†å¯èƒ½ä¼šå‡ºç° null å€¼çš„å­—æ®µè®¾ç½®é»˜è®¤å€¼ï¼Œè¿™é‡Œå¦‚æœæˆ‘ä»¬å°† name å­—æ®µçš„é»˜è®¤å€¼è®¾ç½®ä¸º0ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è¿™æ ·æŸ¥è¯¢ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>2ã€é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨ !&#x3D; æˆ– &lt;&gt; æ“ä½œç¬¦ã€‚</p><p>å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> name <span class="hljs-keyword">from</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">where</span> id <span class="hljs-operator">&lt;&gt;</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>æ•°æ®åº“åœ¨æŸ¥è¯¢æ—¶ï¼Œå¯¹ !&#x3D; æˆ– &lt;&gt; æ“ä½œç¬¦ä¸ä¼šä½¿ç”¨ç´¢å¼•ï¼Œè€Œå¯¹äº &lt; ã€ &lt;&#x3D; ã€ &#x3D; ã€ &gt; ã€ &gt;&#x3D; ã€ BETWEEN ANDï¼Œæ•°æ®åº“æ‰ä¼šä½¿ç”¨ç´¢å¼•ã€‚å› æ­¤å¯¹äºä¸Šé¢çš„æŸ¥è¯¢ï¼Œæ­£ç¡®å†™æ³•åº”è¯¥æ˜¯ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> name <span class="hljs-keyword">from</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">where</span> id <span class="hljs-operator">&lt;</span> <span class="hljs-number">0</span><br><span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span><br><span class="hljs-keyword">select</span> name <span class="hljs-keyword">from</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">where</span> id <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬ä¸ºä»€ä¹ˆæ²¡æœ‰ä½¿ç”¨ or æ¥é“¾æ¥ where åçš„ä¸¤ä¸ªæ¡ä»¶å‘¢ï¼Ÿè¿™å°±æ˜¯æˆ‘ä»¬ä¸‹é¢è¦è¯´çš„ç¬¬3ä¸ªä¼˜åŒ–æŠ€å·§ã€‚</p><p>3ã€é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨ oræ¥é“¾æ¥æ¡ä»¶ã€‚</p><p>å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> tabel <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;UncleToo&#x27;</span> <span class="hljs-keyword">or</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;PHP&#x27;</span><br></code></pre></td></tr></table></figure><p>è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> tabel <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;UncleToo&#x27;</span><br><span class="hljs-keyword">union</span> <span class="hljs-keyword">all</span><br><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> tabel <span class="hljs-keyword">where</span> name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;PHP&#x27;</span><br></code></pre></td></tr></table></figure><p>4ã€å°‘ç”¨ in æˆ– not inã€‚</p><p>è™½ç„¶å¯¹äº in çš„æ¡ä»¶ä¼šä½¿ç”¨ç´¢å¼•ï¼Œä¸ä¼šå…¨è¡¨æ‰«æï¼Œä½†æ˜¯åœ¨æŸäº›ç‰¹å®šçš„æƒ…å†µï¼Œä½¿ç”¨å…¶ä»–æ–¹æ³•ä¹Ÿè®¸æ•ˆæœæ›´å¥½ã€‚å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> name <span class="hljs-keyword">from</span> tabel <span class="hljs-keyword">where</span> id <span class="hljs-keyword">in</span>(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure><p>åƒè¿™ç§è¿ç»­çš„æ•°å€¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ BETWEEN ANDï¼Œå¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> name <span class="hljs-keyword">from</span> tabel <span class="hljs-keyword">where</span> id <span class="hljs-keyword">between</span> <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><p>5ã€æ³¨æ„ like ä¸­é€šé…ç¬¦çš„ä½¿ç”¨ã€‚</p><p>ä¸‹é¢çš„è¯­å¥ä¼šå¯¼è‡´å…¨è¡¨æ‰«æï¼Œå°½é‡å°‘ç”¨ã€‚å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> tabel <span class="hljs-keyword">where</span> name <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%UncleToo%&#x27;</span><br></code></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> tabel <span class="hljs-keyword">where</span> name <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;%UncleToo&#x27;</span><br></code></pre></td></tr></table></figure><p>è€Œä¸‹é¢çš„è¯­å¥æ‰§è¡Œæ•ˆç‡è¦å¿«çš„å¤šï¼Œå› ä¸ºå®ƒä½¿ç”¨äº†ç´¢å¼•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> tabel <span class="hljs-keyword">where</span> name <span class="hljs-keyword">like</span> <span class="hljs-string">&#x27;UncleToo%&#x27;</span><br></code></pre></td></tr></table></figure><p>6ã€é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œè¡¨è¾¾å¼æ“ä½œã€‚</p><p>å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> name <span class="hljs-keyword">from</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">where</span> id<span class="hljs-operator">/</span><span class="hljs-number">2</span> <span class="hljs-operator">=</span> <span class="hljs-number">100</span><br></code></pre></td></tr></table></figure><p>æ­£ç¡®çš„å†™æ³•åº”è¯¥æ˜¯ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> name <span class="hljs-keyword">from</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> <span class="hljs-number">100</span><span class="hljs-operator">*</span><span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>7ã€é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œå‡½æ•°æ“ä½œã€‚</p><p>å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">where</span> <span class="hljs-built_in">substring</span>(name,<span class="hljs-number">1</span>,<span class="hljs-number">8</span>) <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;UncleToo&#x27;</span><br></code></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">where</span> datediff(<span class="hljs-keyword">day</span>,datefield,<span class="hljs-string">&#x27;2014-07-17&#x27;</span>) <span class="hljs-operator">&gt;=</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸¤æ¡è¯­å¥ä¸­éƒ½å¯¹å­—æ®µè¿›è¡Œäº†å‡½æ•°å¤„ç†ï¼Œè¿™æ ·å°±æ˜¯çš„æŸ¥è¯¢åˆ†æå™¨æ”¾å¼ƒäº†ç´¢å¼•çš„ä½¿ç”¨ã€‚æ­£ç¡®çš„å†™æ³•æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">where</span> name <span class="hljs-keyword">like</span><span class="hljs-string">&#x27;UncleToo%&#x27;</span><br></code></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">where</span> datefield <span class="hljs-operator">&lt;=</span> <span class="hljs-string">&#x27;2014-07-17&#x27;</span><br></code></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸è¦åœ¨ where å­å¥ä¸­çš„ &#x3D; å·¦è¾¹è¿›è¡Œå‡½æ•°ã€ç®—æœ¯è¿ç®—æˆ–å…¶ä»–è¡¨è¾¾å¼è¿ç®—ã€‚</p><p>8ã€åœ¨å­æŸ¥è¯¢ä¸­ï¼Œç”¨ exists ä»£æ›¿ in æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ã€‚</p><p>å¦‚ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> name <span class="hljs-keyword">from</span> a <span class="hljs-keyword">where</span> id <span class="hljs-keyword">in</span>(<span class="hljs-keyword">select</span> id <span class="hljs-keyword">from</span> b) <br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬å°†è¿™æ¡è¯­å¥æ¢æˆä¸‹é¢çš„å†™æ³•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> name <span class="hljs-keyword">from</span> a <span class="hljs-keyword">where</span> <span class="hljs-keyword">exists</span>(<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> <span class="hljs-keyword">from</span> b <span class="hljs-keyword">where</span> id <span class="hljs-operator">=</span> a.id)<br></code></pre></td></tr></table></figure><p>è¿™æ ·ï¼ŒæŸ¥è¯¢å‡ºæ¥çš„ç»“æœä¸€æ ·ï¼Œä½†æ˜¯ä¸‹é¢è¿™æ¡è¯­å¥æŸ¥è¯¢çš„é€Ÿåº¦è¦å¿«çš„å¤šã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Oracle</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Oracle</tag>
      
      <tag>SQL</tag>
      
      <tag>SQLä¼˜åŒ–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è·å–æŠ–éŸ³æ— æ°´å°è§†é¢‘ï¼ˆæ·å¾„ï¼‰</title>
    <link href="/20190326120000/"/>
    <url>/20190326120000/</url>
    
    <content type="html"><![CDATA[<p><img src="/20190326120000/IMG_1238.JPG" alt="æ·å¾„å†…å®¹"></p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>iOS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>iOS</tag>
      
      <tag>æŠ–éŸ³</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>windowsä¸­é€šè¿‡å‘½ä»¤è¡Œè§£å†³Tomcatç«¯å£è¢«å ç”¨é—®é¢˜</title>
    <link href="/20180907130000/"/>
    <url>/20180907130000/</url>
    
    <content type="html"><![CDATA[<p>1ã€æ‰¾åˆ°è¢«å ç”¨ç«¯å£çš„pid(æœ€å³è¾¹é‚£ä¸€åˆ—)</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sh">netstat -ano<br></code></pre></td></tr></table></figure><p>2ã€é€šè¿‡æœ¬åœ°åœ°å€çš„ç«¯å£å·å³å¯æŸ¥æ‰¾åˆ°è¿›ç¨‹çš„pid(8023ä¸ºæ‰¾åˆ°çš„pid)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">tasklist|findstr &quot;8023&quot;<br></code></pre></td></tr></table></figure><p>3ã€é€šè¿‡è¿›ç¨‹åkillæ‰è¿›ç¨‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">taskkill /f /t /im javaw.exe<br></code></pre></td></tr></table></figure><p>ï¼ˆé™„ï¼šå…¶å®ç›´æ¥æ‰§è¡Œç¬¬ä¸‰æ­¥å°±è¡Œï¼Œè¢«å ç”¨ä¸€èˆ¬å°±æ˜¯å› ä¸ºä¹‹å‰çš„javaè¿›ç¨‹æ²¡æœ‰å®Œå…¨å…³é—­ã€‚ï¼‰</p>]]></content>
    
    
    <categories>
      
      <category>é—®é¢˜è®°å½•</category>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Tomcatå†…å­˜æº¢å‡ºé—®é¢˜</title>
    <link href="/20180907120000/"/>
    <url>/20180907120000/</url>
    
    <content type="html"><![CDATA[<p>ã€é—®é¢˜æè¿°ã€‘</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">è¿è¡ŒTomcatå‡ºç°å¼‚å¸¸ï¼š<br>java<span class="hljs-selector-class">.lang</span><span class="hljs-selector-class">.OutOfMemoryError</span>: PermGen space<br></code></pre></td></tr></table></figure><p>ã€è§£å†³æ–¹æ¡ˆã€‘</p><p>åŒå‡»ä¸‹æ–¹Serversæ ‡ç­¾çš„Tomcatï¼Œé€‰æ‹© Open launch configurationï¼Œåœ¨æ‰“å¼€çš„çª—å£ä¸­é€‰æ‹©Argumentsæ ‡ç­¾ï¼Œåœ¨VM Argumentsçš„å†…å®¹ä¸­è¿½åŠ ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">-Xms512m -Xmx1024m -XX:<span class="hljs-attribute">MaxNewSize</span>=256m -XX:<span class="hljs-attribute">MaxPermSize</span>=512m<br></code></pre></td></tr></table></figure><p>å‚æ•°è¯´æ˜ï¼š</p><table><thead><tr><th align="center">å‚æ•°</th><th align="center">å‚æ•°è¯´æ˜</th></tr></thead><tbody><tr><td align="center">-Xms</td><td align="center">java Heapåˆå§‹å¤§å°ã€‚ é»˜è®¤æ˜¯ç‰©ç†å†…å­˜çš„1&#x2F;64ã€‚</td></tr><tr><td align="center">-Xmx</td><td align="center">java heapæœ€å¤§å€¼ã€‚å»ºè®®å‡è®¾ä¸ºç‰©ç†å†…å­˜çš„ä¸€åŠã€‚ä¸å¯è¶…è¿‡ç‰©ç†å†…å­˜ã€‚</td></tr><tr><td align="center">-XX:PermSize</td><td align="center">è®¾å®šå†…å­˜çš„æ°¸ä¹…ä¿å­˜åŒºåˆå§‹å¤§å°ï¼Œç¼ºçœå€¼ä¸º64Mã€‚</td></tr><tr><td align="center">-XX:MaxPermSize</td><td align="center">è®¾å®šå†…å­˜çš„æ°¸ä¹…ä¿å­˜åŒºæœ€å¤§ å¤§å°ï¼Œç¼ºçœå€¼ä¸º64Mã€‚</td></tr><tr><td align="center">-XX:SurvivorRatio&#x3D;2</td><td align="center">å¹¸å­˜è€…æ± çš„å¤§å°,é»˜è®¤æ˜¯2ï¼Œå¦‚æœåƒåœ¾å›æ”¶å˜æˆäº†ç“¶é¢ˆï¼Œå¯ä»¥å°è¯•å®šåˆ¶ç”Ÿæˆæ± è®¾ç½®ã€‚</td></tr><tr><td align="center">-XX:NewSize</td><td align="center">æ–°ç”Ÿæˆçš„æ± çš„åˆå§‹å¤§å°ã€‚ç¼ºçœå€¼ä¸º2Mã€‚</td></tr><tr><td align="center">-XX:MaxNewSize</td><td align="center">æ–°ç”Ÿæˆçš„æ± çš„æœ€å¤§å¤§å°ã€‚ç¼ºçœå€¼ä¸º32Mã€‚</td></tr></tbody></table>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Tomcat</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Tomcat</tag>
      
      <tag>JVM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>IDEAç¼–è¯‘Javaæ–‡ä»¶æŠ¥é”™</title>
    <link href="/20180906120000/"/>
    <url>/20180906120000/</url>
    
    <content type="html"><![CDATA[<p>ã€é—®é¢˜æè¿°ã€‘</p><figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs fsharp"><span class="hljs-literal">Error</span><span class="hljs-operator">:</span>(1,10) java<span class="hljs-operator">:</span>éœ€è¦<span class="hljs-keyword">class</span>,integerfaceæˆ–<span class="hljs-built_in">enum</span>.<br>ä»¥åŠ java<span class="hljs-operator">:</span>éæ³•å­—ç¬¦<span class="hljs-operator">:</span>\<span class="hljs-operator">...</span><br></code></pre></td></tr></table></figure><p>ã€é—®é¢˜åŸå› ã€‘</p><p>javaæ–‡ä»¶ç¼–ç æœ‰é—®é¢˜ã€‚ï¼ˆ.javaåªè¯†åˆ«ä¸å¸¦BOMçš„UTF-8ç¼–ç ï¼‰</p><p>ã€è§£å†³æ–¹æ¡ˆã€‘</p><p>ç”¨EmEditorã€Editplusã€ULtraEditæˆ–Notepad++ä¹‹ç±»çš„å·¥å…·å¦å­˜ä¸ºUTF-8ï¼ˆæ— BOMï¼‰ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>é—®é¢˜è®°å½•</category>
      
      <category>Java</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Java</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¿®æ”¹OracleXEé»˜è®¤ç«¯å£</title>
    <link href="/20180905120000/"/>
    <url>/20180905120000/</url>
    
    <content type="html"><![CDATA[<p>OracleXEé»˜è®¤ç«¯å£å·ä¸º8080ï¼Œä¸Tomcaté»˜è®¤ç«¯å£å·å†²çªï¼Œä¿®æ”¹OracleXEé»˜è®¤ç«¯å£ï¼š</p><p>æ­¥éª¤ä¸€ï¼šè¿è¡Œcmdï¼Œè¾“å…¥sqlplus &#x2F; as sysdba;   </p><p>æ­¥éª¤äºŒï¼šè¾“å…¥exec dbms_xdb.sethttpport(1521); ï¼ˆ1521ä¸ºæ›´æ”¹åçš„ç«¯å£ï¼‰</p>]]></content>
    
    
    <categories>
      
      <category>é—®é¢˜è®°å½•</category>
      
      <category>OracleXE</category>
      
    </categories>
    
    
    <tags>
      
      <tag>OracleXE</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Eclipseä¸­HttpServletç±»æ‰¾ä¸åˆ°</title>
    <link href="/20180904130000/"/>
    <url>/20180904130000/</url>
    
    <content type="html"><![CDATA[<p>Eclipseä¸­HttpServletç±»æ‰¾ä¸åˆ°ã€‚</p><p>ã€é—®é¢˜åŸå› ã€‘</p><p>æ²¡æœ‰å¯¼å…¥Servlet-api.jaråŒ…ã€‚</p><p>ã€è§£å†³æ–¹æ³•ã€‘</p><p>è¿™ä¸ªåŒ…åœ¨æ‰€å®‰è£…åœ¨çš„tomcatçš„libæ–‡ä»¶ä¸‹ï¼Œæ‰€ä»¥åªéœ€è¦å¯¼å…¥å³å¯ã€‚åœ¨éœ€è¦å¯¼å…¥çš„å·¥ç¨‹ä¸Šå³é”®è¿›å…¥propertiesï¼Œé€‰æ‹©Java Build Pathï¼ŒLibraries é€‰é¡¹å¡ä¸­ Add External JARSï¼Œé€‰æ‹©ä½ æ‰€å®‰è£… Tomcat ç›®å½•ä¸‹ lib æ–‡ä»¶å¤¹ä¸­çš„ Servlet-api.jar åŒ…å³å¯ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>é—®é¢˜è®°å½•</category>
      
      <category>Eclipse</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Eclipse</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PL/SQL è‡ªåŠ¨è¡¥å…¨è®¾ç½®</title>
    <link href="/20180904120000/"/>
    <url>/20180904120000/</url>
    
    <content type="html"><![CDATA[<p>1ã€åœ¨å®‰è£…ç›®å½•çš„ PlugIns æ–‡ä»¶ä¸‹åˆ›å»º <em><strong>AutoReplace.txt</strong></em> æ–‡ä»¶ï¼ˆæ–‡ä»¶åå¯è‡ªå®šä¹‰ï¼Œæœ€å¥½æ˜¯è‹±æ–‡åï¼‰ã€‚</p><p>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼ˆå¯è‡ªå®šä¹‰ï¼‰ï¼š</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-attr">sf</span> = <span class="hljs-string">SELECT * FROM</span><br><span class="hljs-attr">sc</span> = <span class="hljs-string">SELECT COUNT(*) FROM t</span><br><span class="hljs-attr">st</span> = <span class="hljs-string">SELECT t.*, t.ROWID FROM t</span><br><span class="hljs-attr">w</span> = <span class="hljs-string">WHERE</span><br><span class="hljs-attr">b</span> = <span class="hljs-string">BETWEEN AND</span><br><span class="hljs-attr">l</span> = <span class="hljs-string">LIKE &#x27;%%&#x27;</span><br><span class="hljs-attr">o</span> = <span class="hljs-string">ORDER BY</span><br><span class="hljs-attr">f</span> = <span class="hljs-string">FOR UPDATE</span><br><span class="hljs-attr">u</span> = <span class="hljs-string">UPDATE t SET t. WHERE t</span><br></code></pre></td></tr></table></figure><p>2ã€æ‰“å¼€PL&#x2F;SQLï¼Œè¿›è¡Œè®¾ç½®</p><p>PL&#x2F;SQL ç‰ˆæœ¬12ï¼šConfigure -&gt; Perferences -&gt; Editor -&gt; AutoReplacesï¼Œå‹¾é€‰ Enableï¼Œç„¶åé€‰æ‹©åˆšæ‰åˆ›å»ºçš„æ–‡ä»¶ï¼Œç¡®å®šåé‡å¯å³å¯ã€‚</p><p>PL&#x2F;SQL ç‰ˆæœ¬12ä»¥ä¸‹çš„ï¼šTools -&gt; Perferences -&gt; Editor -&gt; AutoReplacesï¼Œå‹¾é€‰ Enableï¼Œç„¶åé€‰æ‹©åˆšæ‰åˆ›å»ºçš„æ–‡ä»¶ï¼Œç¡®å®šåé‡å¯å³å¯ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>PLSQL</category>
      
    </categories>
    
    
    <tags>
      
      <tag>PLSQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Win7ç¯å¢ƒä¸‹çš„VPNè¿æ¥</title>
    <link href="/20180903120000/"/>
    <url>/20180903120000/</url>
    
    <content type="html"><![CDATA[<h1 id="Win7ç¯å¢ƒä¸‹çš„VPNè¿æ¥"><a href="#Win7ç¯å¢ƒä¸‹çš„VPNè¿æ¥" class="headerlink" title="Win7ç¯å¢ƒä¸‹çš„VPNè¿æ¥"></a>Win7ç¯å¢ƒä¸‹çš„VPNè¿æ¥</h1><p>1ã€â€ç½‘ç»œå’Œå…±äº«ä¸­å¿ƒâ€</p><p>2ã€â€è®¾ç½®æ–°çš„è¿æ¥â€</p><p>3ã€â€è¿æ¥åˆ°å·¥ä½œåŒºâ€</p><p>4ã€â€åˆ›å»ºæ–°çš„è¿æ¥â€</p><p>5ã€â€ä½¿ç”¨æˆ‘çš„Internetè¿æ¥(VPN)â€</p><p>6ã€è¾“å…¥ç›¸å…³ç½‘ç«™ä¸Šå–å¾—çš„æœåŠ¡å™¨IPåœ°å€(æˆ–ç½‘å€)ï¼Œä¸‹ä¸€æ­¥</p><p>7ã€è¾“å…¥åœ¨ç›¸å…³ç½‘ç«™ä¸Šæ³¨å†Œçš„å¸å·å’Œå¯†ç </p><p>æ›´æ”¹æœåŠ¡å™¨åœ°å€ï¼š</p><p>é€‰ä¸­vpnè¿æ¥ï¼Œå³é”®-å±æ€§-åœ¨å¸¸è§„é€‰é¡¹å¡ç›´æ¥ä¿®æ”¹å³å¯</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Win7</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Win7</tag>
      
      <tag>VPN</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Eclipseå¿«æ·é”®</title>
    <link href="/20180902120000/"/>
    <url>/20180902120000/</url>
    
    <content type="html"><![CDATA[<h1 id="Eclipseå¿«æ·é”®"><a href="#Eclipseå¿«æ·é”®" class="headerlink" title="Eclipseå¿«æ·é”®"></a>Eclipseå¿«æ·é”®</h1><figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs mathematica"><span class="hljs-variable">alt</span> <span class="hljs-operator">+</span> <span class="hljs-operator">/</span>  è¡¥å……ä»£ç <br><br>è¾“å…¥<span class="hljs-variable">syso</span>å<span class="hljs-variable">alt</span><span class="hljs-operator">+/</span>å¯ä»¥ç›´æ¥è¡¥å……å®Œæ•´<span class="hljs-variable">System</span><span class="hljs-operator">.</span><span class="hljs-variable">out</span><span class="hljs-operator">.</span><span class="hljs-variable">println</span><span class="hljs-punctuation">(</span><span class="hljs-punctuation">)</span><span class="hljs-operator">;</span><br><br>è¾“å…¥<span class="hljs-variable">main</span>å<span class="hljs-variable">alt</span><span class="hljs-operator">+/</span>å¯ä»¥ç›´æ¥è¡¥å……å®Œæ•´<span class="hljs-variable">public</span> <span class="hljs-variable">static</span> <span class="hljs-variable">void</span> <span class="hljs-variable">main</span><span class="hljs-punctuation">(</span><span class="hljs-built_in">String</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span> <span class="hljs-variable">args</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+/:</span> å¯¹ä¸€è¡Œæ³¨é‡Šæˆ–å–æ¶ˆæ³¨é‡Šã€‚å¯¹äºå¤šè¡Œä¹ŸåŒæ ·é€‚ç”¨ã€‚<br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-number">1</span> å¿«é€Ÿä¿®å¤<span class="hljs-punctuation">(</span>æœ€ç»å…¸çš„å¿«æ·é”®<span class="hljs-operator">,</span>å°±ä¸ç”¨å¤šè¯´äº†<span class="hljs-punctuation">)</span><br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-built_in">D</span><span class="hljs-operator">:</span> åˆ é™¤å½“å‰è¡Œ<br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">Alt</span><span class="hljs-operator">+</span>â†“ å¤åˆ¶å½“å‰è¡Œåˆ°ä¸‹ä¸€è¡Œ<span class="hljs-punctuation">(</span>å¤åˆ¶å¢åŠ <span class="hljs-punctuation">)</span><br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">Alt</span><span class="hljs-operator">+</span>â†‘ å¤åˆ¶å½“å‰è¡Œåˆ°ä¸Šä¸€è¡Œ<span class="hljs-punctuation">(</span>å¤åˆ¶å¢åŠ <span class="hljs-punctuation">)</span><br><br><span class="hljs-variable">Alt</span><span class="hljs-operator">+</span>â†“ å½“å‰è¡Œå’Œä¸‹é¢ä¸€è¡Œäº¤äº’ä½ç½®<span class="hljs-punctuation">(</span>ç‰¹åˆ«å®ç”¨<span class="hljs-operator">,</span>å¯ä»¥çœå»å…ˆå‰ªåˆ‡<span class="hljs-operator">,</span>å†ç²˜è´´äº†<span class="hljs-punctuation">)</span><br><br><span class="hljs-variable">Alt</span><span class="hljs-operator">+</span>â†‘ å½“å‰è¡Œå’Œä¸Šé¢ä¸€è¡Œäº¤äº’ä½ç½®<span class="hljs-punctuation">(</span>åŒä¸Š<span class="hljs-punctuation">)</span><br><br><span class="hljs-variable">Alt</span><span class="hljs-operator">+</span>â† å‰ä¸€ä¸ªç¼–è¾‘çš„é¡µé¢<br><br><span class="hljs-variable">Alt</span><span class="hljs-operator">+</span>â†’ ä¸‹ä¸€ä¸ªç¼–è¾‘çš„é¡µé¢<span class="hljs-punctuation">(</span>å½“ç„¶æ˜¯é’ˆå¯¹ä¸Šé¢é‚£æ¡æ¥è¯´äº†<span class="hljs-punctuation">)</span><br><br><span class="hljs-variable">Alt</span><span class="hljs-operator">+</span><span class="hljs-built_in">Enter</span> æ˜¾ç¤ºå½“å‰é€‰æ‹©èµ„æº<span class="hljs-punctuation">(</span>å·¥ç¨‹<span class="hljs-operator">,</span><span class="hljs-variable">or</span> æ–‡ä»¶ <span class="hljs-variable">or</span>æ–‡ä»¶<span class="hljs-punctuation">)</span>çš„å±æ€§<br><br><span class="hljs-variable">Shift</span><span class="hljs-operator">+</span><span class="hljs-built_in">Enter</span> åœ¨å½“å‰è¡Œçš„ä¸‹ä¸€è¡Œæ’å…¥ç©ºè¡Œ<span class="hljs-punctuation">(</span>è¿™æ—¶é¼ æ ‡å¯ä»¥åœ¨å½“å‰è¡Œçš„ä»»ä¸€ä½ç½®<span class="hljs-operator">,</span>ä¸ä¸€å®šæ˜¯æœ€å<span class="hljs-punctuation">)</span><br><br><span class="hljs-variable">Shift</span><span class="hljs-operator">+</span><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-built_in">Enter</span> åœ¨å½“å‰è¡Œæ’å…¥ç©ºè¡Œ<span class="hljs-punctuation">(</span>åŸç†åŒä¸Šæ¡<span class="hljs-punctuation">)</span><br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">Q</span> å®šä½åˆ°æœ€åç¼–è¾‘çš„åœ°æ–¹<br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">L</span> å®šä½åœ¨æŸè¡Œ <span class="hljs-punctuation">(</span>å¯¹äºç¨‹åºè¶…è¿‡<span class="hljs-number">100</span>çš„äººå°±æœ‰ç¦éŸ³äº†<span class="hljs-punctuation">)</span><br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">M</span> æœ€å¤§åŒ–å½“å‰çš„<span class="hljs-variable">Edit</span>æˆ–<span class="hljs-variable">View</span> <span class="hljs-punctuation">(</span>å†æŒ‰åˆ™åä¹‹<span class="hljs-punctuation">)</span><br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+/</span> æ³¨é‡Šå½“å‰è¡Œ<span class="hljs-operator">,</span>å†æŒ‰åˆ™å–æ¶ˆæ³¨é‡Š<br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-built_in">O</span> å¿«é€Ÿæ˜¾ç¤º <span class="hljs-variable">OutLine</span><br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">T</span> å¿«é€Ÿæ˜¾ç¤ºå½“å‰ç±»çš„ç»§æ‰¿ç»“æ„<br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">W</span> å…³é—­å½“å‰<span class="hljs-variable">Editer</span><br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-built_in">K</span> å‚ç…§é€‰ä¸­çš„<span class="hljs-built_in">Word</span>å¿«é€Ÿå®šä½åˆ°ä¸‹ä¸€ä¸ª<br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-built_in">E</span> å¿«é€Ÿæ˜¾ç¤ºå½“å‰<span class="hljs-variable">Editer</span>çš„ä¸‹æ‹‰åˆ—è¡¨<span class="hljs-punctuation">(</span>å¦‚æœå½“å‰é¡µé¢æ²¡æœ‰æ˜¾ç¤ºçš„ç”¨é»‘ä½“è¡¨ç¤º<span class="hljs-punctuation">)</span><br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+/</span><span class="hljs-punctuation">(</span>å°é”®ç›˜<span class="hljs-punctuation">)</span> æŠ˜å å½“å‰ç±»ä¸­çš„æ‰€æœ‰ä»£ç <br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span>Ã—<span class="hljs-punctuation">(</span>å°é”®ç›˜<span class="hljs-punctuation">)</span> å±•å¼€å½“å‰ç±»ä¸­çš„æ‰€æœ‰ä»£ç <br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-built_in">Space</span> ä»£ç åŠ©æ‰‹å®Œæˆä¸€äº›ä»£ç çš„æ’å…¥<span class="hljs-punctuation">(</span>ä½†ä¸€èˆ¬å’Œè¾“å…¥æ³•æœ‰å†²çª<span class="hljs-operator">,</span>å¯ä»¥ä¿®æ”¹è¾“å…¥æ³•çš„çƒ­é”®<span class="hljs-operator">,</span>ä¹Ÿå¯ä»¥æš‚ç”¨<span class="hljs-variable">Alt</span><span class="hljs-operator">+/</span>æ¥ä»£æ›¿<span class="hljs-punctuation">)</span><br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">Shift</span><span class="hljs-operator">+</span><span class="hljs-built_in">E</span> æ˜¾ç¤ºç®¡ç†å½“å‰æ‰“å¼€çš„æ‰€æœ‰çš„<span class="hljs-variable">View</span>çš„ç®¡ç†å™¨<span class="hljs-punctuation">(</span>å¯ä»¥é€‰æ‹©å…³é—­<span class="hljs-operator">,</span>æ¿€æ´»ç­‰æ“ä½œ<span class="hljs-punctuation">)</span><br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">J</span> æ­£å‘å¢é‡æŸ¥æ‰¾<span class="hljs-punctuation">(</span>æŒ‰ä¸‹<span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">J</span>å<span class="hljs-operator">,</span>ä½ æ‰€è¾“å…¥çš„æ¯ä¸ªå­—æ¯ç¼–è¾‘å™¨éƒ½æä¾›å¿«é€ŸåŒ¹é…å®šä½åˆ°æŸä¸ªå•è¯<span class="hljs-operator">,</span>å¦‚æœæ²¡æœ‰<span class="hljs-operator">,</span>åˆ™åœ¨<span class="hljs-variable">stutes</span> <span class="hljs-variable">line</span>ä¸­æ˜¾ç¤ºæ²¡æœ‰æ‰¾åˆ°äº†<span class="hljs-operator">,</span>æŸ¥ä¸€ä¸ªå•è¯æ—¶<span class="hljs-operator">,</span>ç‰¹åˆ«å®ç”¨<span class="hljs-operator">,</span>è¿™ä¸ªåŠŸèƒ½<span class="hljs-variable">Idea</span>ä¸¤å¹´å‰å°±æœ‰äº†<span class="hljs-punctuation">)</span><br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">Shift</span><span class="hljs-operator">+</span><span class="hljs-variable">J</span> åå‘å¢é‡æŸ¥æ‰¾<span class="hljs-punctuation">(</span>å’Œä¸Šæ¡ç›¸åŒ<span class="hljs-operator">,</span>åªä¸è¿‡æ˜¯ä»åå¾€å‰æŸ¥<span class="hljs-punctuation">)</span><br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">Shift</span><span class="hljs-operator">+</span><span class="hljs-variable">F4</span> å…³é—­æ‰€æœ‰æ‰“å¼€çš„<span class="hljs-variable">Editer</span><br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">Shift</span><span class="hljs-operator">+</span><span class="hljs-variable">X</span> æŠŠå½“å‰é€‰ä¸­çš„æ–‡æœ¬å…¨éƒ¨å˜ä¸ºå°å†™<br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">Shift</span><span class="hljs-operator">+</span><span class="hljs-variable">Y</span> æŠŠå½“å‰é€‰ä¸­çš„æ–‡æœ¬å…¨éƒ¨å˜ä¸ºå°å†™<br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">Shift</span><span class="hljs-operator">+</span><span class="hljs-variable">F</span> æ ¼å¼åŒ–å½“å‰ä»£ç ï¼ˆè‡ªåŠ¨æ•´ç†ä»£ç ï¼‰<br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">Shift</span><span class="hljs-operator">+</span><span class="hljs-variable">P</span> å®šä½åˆ°å¯¹åº”çš„åŒ¹é…ç¬¦<span class="hljs-punctuation">(</span>è­¬å¦‚<span class="hljs-punctuation">&#123;</span><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">(</span>ä»å‰é¢å®šä½åé¢æ—¶<span class="hljs-operator">,</span>å…‰æ ‡è¦åœ¨åŒ¹é…ç¬¦é‡Œé¢<span class="hljs-operator">,</span>åé¢åˆ°å‰é¢<span class="hljs-operator">,</span>åˆ™åä¹‹<span class="hljs-punctuation">)</span><br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span><span class="hljs-variable">Shift</span><span class="hljs-operator">+</span><span class="hljs-built_in">O</span> è¾“å…¥å·¥å…·åŒ…çš„å…³é”®è¯åå¿«æ·é”®å³å¯è·å¾—è¯¥å·¥å…·åŒ…<br><br><span class="hljs-variable">Ctrl</span><span class="hljs-operator">+</span>é¼ æ ‡ç‚¹å‡» æŸ¥çœ‹æºä»£ç <br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Eclipse</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Eclipse</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Struts2 å’Œ Spring MVC çš„åŒºåˆ«</title>
    <link href="/20180828120000/"/>
    <url>/20180828120000/</url>
    
    <content type="html"><![CDATA[<p>Struts2 å’Œ Spring MVC çš„åŒºåˆ«</p><p>ã€åŒºåˆ«1ã€‘</p><p>   Struts2 çš„æ ¸å¿ƒæ˜¯åŸºäºä¸€ä¸ª Filter å³ StrutsPreparedAndExcuteFilterã€‚</p><p>   Spring MVC çš„æ ¸å¿ƒæ˜¯åŸºäºä¸€ä¸ª Servlet å³ DispatcherServlet(å‰ç«¯æ§åˆ¶å™¨)ã€‚</p><p>ã€åŒºåˆ«2ã€‘</p><p>   Struts2 æ˜¯åŸºäºç±»å¼€å‘çš„ï¼Œä¼ é€’çš„å‚æ•°æ˜¯é€šè¿‡ç±»çš„å±æ€§ä¼ é€’(å±æ€§é©±åŠ¨å’Œæ¨¡å‹é©±åŠ¨),æ‰€ä»¥åªèƒ½è®¾è®¡æˆå¤šä¾‹ã€‚</p><p>   Spring MVC æ˜¯åŸºäºç±»ä¸­çš„æ–¹æ³•å¼€å‘çš„ï¼Œä½¿ç”¨ requestMapping å°† url å’Œæ–¹æ³•è¿›è¡Œæ˜ å°„ï¼Œæ ¹æ® url æ‰¾åˆ° controller ç±»çš„æ–¹æ³•ç”Ÿæˆä¸€ä¸ª handler å¤„ç†å™¨å¯¹è±¡(åªåŒ…æ‹¬ä¸€ä¸ªmethod)ã€‚ä¼ é€’å‚æ•°æ˜¯ä¼ åˆ°æ–¹æ³•çš„å½¢å‚ä¸Šé¢ï¼Œæ‰€ä»¥æ—¢å¯ä»¥æ˜¯å•ä¾‹æ¨¡å¼ä¹Ÿå¯ä»¥æ˜¯å¤šä¾‹æ¨¡å¼ã€‚</p><p>ã€åŒºåˆ«3ã€‘</p><p>   Struts2 é‡‡ç”¨çš„æ˜¯å€¼æ ˆå­˜å‚¨è¯·æ±‚ä»¥åŠå“åº”æ•°æ®ï¼ŒOGNLå­˜å–æ•°æ®ã€‚</p><p>   Spring MVC é‡‡ç”¨ request æ¥è§£æè¯·æ±‚å†…å®¹ï¼Œç„¶åç”±å…¶å†…éƒ¨çš„ getParameter ç»™æ–¹æ³•ä¸­å½¢å‚èµ‹å€¼ï¼Œå†æŠŠåå°å¤„ç†è¿‡çš„æ•°æ®é€šè¿‡ ModelAndView å¯¹è±¡å­˜å‚¨ï¼ŒModelå­˜å‚¨æ•°æ®ï¼ŒViewå­˜å‚¨è¿”å›çš„é¡µé¢ï¼Œå†æŠŠå¯¹è±¡é€šè¿‡ request ä¼ è¾“åˆ°é¡µé¢å»ã€‚</p><p>ã€é™„ã€‘</p><p>å…³äº intercepter çš„å®ç°æœºåˆ¶ï¼š</p><p>   strutsæœ‰ä»¥è‡ªå·±çš„interceptoræœºåˆ¶ï¼Œspring mvcç”¨çš„æ˜¯ç‹¬ç«‹çš„AOPæ–¹å¼ã€‚è¿™æ ·å¯¼è‡´strutsçš„é…ç½®æ–‡ä»¶é‡è¿˜æ˜¯æ¯”spring mvcå¤§ï¼Œè™½ç„¶strutsçš„é…ç½®èƒ½ç»§æ‰¿ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—è®ºä½¿ç”¨ä¸Šæ¥è®²ï¼Œspring mvcä½¿ç”¨æ›´åŠ ç®€æ´ï¼Œå¼€å‘æ•ˆç‡Spring MVCç¡®å®æ¯”struts2é«˜ã€‚spring mvcæ˜¯æ–¹æ³•çº§åˆ«çš„æ‹¦æˆªï¼Œä¸€ä¸ªæ–¹æ³•å¯¹åº”ä¸€ä¸ªrequestä¸Šä¸‹æ–‡ï¼Œè€Œæ–¹æ³•åŒæ—¶åˆè·Ÿä¸€ä¸ªurlå¯¹åº”ï¼Œæ‰€ä»¥è¯´ä»æ¶æ„æœ¬èº«ä¸Šspring3 mvcå°±å®¹æ˜“å®ç°restful urlã€‚struts2æ˜¯ç±»çº§åˆ«çš„æ‹¦æˆªï¼Œä¸€ä¸ªç±»å¯¹åº”ä¸€ä¸ªrequestä¸Šä¸‹æ–‡ï¼›å®ç°restful urlè¦è´¹åŠ²ï¼Œå› ä¸ºstruts2 actionçš„ä¸€ä¸ªæ–¹æ³•å¯ä»¥å¯¹åº”ä¸€ä¸ªurlï¼›è€Œå…¶ç±»å±æ€§å´è¢«æ‰€æœ‰æ–¹æ³•å…±äº«ï¼Œè¿™ä¹Ÿå°±æ— æ³•ç”¨æ³¨è§£æˆ–å…¶ä»–æ–¹å¼æ ‡è¯†å…¶æ‰€å±æ–¹æ³•äº†ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>å¾…åˆ†ç±»</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Struts2</tag>
      
      <tag>SpringMVC</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Mybatisä¸Oracleåˆ†é¡µ</title>
    <link href="/20180806120000/"/>
    <url>/20180806120000/</url>
    
    <content type="html"><![CDATA[<p>selectByPage(Integer offset, Integer limit );</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span><br>    (<span class="hljs-keyword">select</span> t.*,rownum rownu <span class="hljs-keyword">from</span> STUDENT t <span class="hljs-keyword">where</span> rownum &amp;lt;=<span class="hljs-meta">#&#123;param1&#125;*#&#123;param2&#125;) tt</span><br><span class="hljs-keyword">where</span> tt.rownum&gt;(<span class="hljs-meta">#&#123;param1&#125;-1)*#&#123;param2&#125;</span><br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼šè¿™é‡Œçš„*æ˜¯ä¹˜å·</p><p>åŸå¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span><br> (<span class="hljs-keyword">select</span> rownum rn, col1,col2,col3 <span class="hljs-keyword">from</span> (<br>  (<span class="hljs-keyword">select</span> rownum, col1, col2, col3 <span class="hljs-keyword">from</span> t_tablename <span class="hljs-keyword">where</span> rownum<span class="hljs-operator">&lt;=</span><span class="hljs-number">10</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> colname <span class="hljs-keyword">desc</span>) v1 <span class="hljs-comment">--1.æŸ¥è¯¢å‡ºå«æœ‰rownumçš„è¡¨æ•°æ®å¹¶ç»™åˆ«åv1,ç¬¬ä¸€ä¸ªrownumæ˜¯ä¸èƒ½ç”¨&gt;æˆ–&gt;=çš„</span><br> <span class="hljs-keyword">where</span> rn<span class="hljs-operator">&lt;=</span><span class="hljs-number">10</span>) v2) <span class="hljs-comment">--2.æŸ¥è¯¢v1çš„</span><br><span class="hljs-keyword">where</span> rn<span class="hljs-operator">&gt;=</span><span class="hljs-number">5</span>;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Mybatis</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Mybatis</tag>
      
      <tag>Oracle</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Excelæ‰¹é‡ç”Ÿæˆsql</title>
    <link href="/20180718130000/"/>
    <url>/20180718130000/</url>
    
    <content type="html"><![CDATA[<h1 id="Excelæ‰¹é‡ç”Ÿæˆsql"><a href="#Excelæ‰¹é‡ç”Ÿæˆsql" class="headerlink" title="Excelæ‰¹é‡ç”Ÿæˆsql"></a>Excelæ‰¹é‡ç”Ÿæˆsql</h1><p>å•å…ƒæ ¼è®¾ç½®å…¬å¼ï¼š</p><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs excel">=<span class="hljs-string">&quot;update tab_organization_info t set t.mchid = &#x27;&quot;</span>&amp;<span class="hljs-symbol">C:C</span>&amp;<span class="hljs-string">&quot;&#x27;, t.terminal_no = &#x27;&quot;</span>&amp;<span class="hljs-symbol">D:D</span>&amp;<span class="hljs-string">&quot;&#x27; where id = &quot;</span>&amp;<span class="hljs-symbol">A:A</span>&amp;<span class="hljs-string">&quot;;&quot;</span><br></code></pre></td></tr></table></figure><p>ï¼ˆæ³¨æ„å¼•ç”¨ï¼‰</p><p>ç„¶ååŒå‡»å•å…ƒæ ¼å³ä¸‹æ–¹çš„å¡«å……æŸ„å®ç°è‡ªåŠ¨å¡«å……ã€‚ï¼ˆæ³¨æ„ï¼šè‡ªåŠ¨å¡«å……éœ€è¦æ»¡è¶³å‰ä¸€åˆ—çš„å•å…ƒæ ¼ä¸ºéç©ºï¼Œå¦‚æœå‰ä¸€åˆ—çš„å•å…ƒæ ¼ä¸ºç©ºå€¼ï¼Œé‚£ä¹ˆè‡ªåŠ¨å¡«å……ä¼šç»ˆæ­¢ï¼Œéœ€è¦æ‰‹åŠ¨è·ƒè¿‡ï¼‰</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>å¾…åˆ†ç±»</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SQL</tag>
      
      <tag>Excel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBootå¯åŠ¨é¡¹ç›®æ—¶æŠ¥é”™é—®é¢˜</title>
    <link href="/20180710120000/"/>
    <url>/20180710120000/</url>
    
    <content type="html"><![CDATA[<p>SpringBootå¯åŠ¨é¡¹ç›®æ—¶æŠ¥é”™ï¼š</p><figure class="highlight smalltalk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs smalltalk"><span class="hljs-comment">&quot;XML fragments parsed from previous mappers already contains value for ...&quot;</span><br></code></pre></td></tr></table></figure><p>ã€è§£å†³æ–¹æ¡ˆ1ã€‘</p><p>ç¡®ä¿ Mapper.xml ä¸­æ²¡æœ‰é‡å¤çš„ id åï¼ŒMaven clean ä¸€ä¸‹é¡¹ç›®ï¼Œç„¶åé‡å¯ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>é—®é¢˜è®°å½•</category>
      
      <category>SpringBoot</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Springboot</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æŸ¥è¯¢è¡¨ä¸­å®Œå…¨é‡å¤çš„æ•°æ®</title>
    <link href="/20180710120000/"/>
    <url>/20180710120000/</url>
    
    <content type="html"><![CDATA[<p>æŸ¥è¯¢è¡¨ä¸­å®Œå…¨é‡å¤çš„æ•°æ®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">--æŸ¥è¯¢å®Œå…¨é‡å¤çš„æ•°æ®</span><br><br><span class="hljs-keyword">select</span> t.student_id_new, t.student_id_old <span class="hljs-keyword">from</span> STUDENT_REL t <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> t.student_id_new, t.student_id_old <span class="hljs-keyword">having</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>æŠŠ &gt; æ”¹æˆ &#x3D; å°±æ˜¯æŸ¥è¯¢éé‡å¤çš„æ•°æ®</p>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>Oracle</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SQL</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…³äºä¸Šçº¿åˆå§‹åŒ–è„šæœ¬ç®¡ç†æ–¹æ¡ˆ</title>
    <link href="/20180706120000/"/>
    <url>/20180706120000/</url>
    
    <content type="html"><![CDATA[<blockquote><p>ç»“åˆå·¥ä½œè¿‡çš„ä¸¤å®¶å…¬å¸çš„ä¸Šçº¿è„šæœ¬ç®¡ç†æ–¹æ¡ˆåšçš„ç®€å•æ€»ç»“ã€‚</p></blockquote><h1 id="å…³äºä¸Šçº¿åˆå§‹åŒ–è„šæœ¬ç®¡ç†æ–¹æ¡ˆ"><a href="#å…³äºä¸Šçº¿åˆå§‹åŒ–è„šæœ¬ç®¡ç†æ–¹æ¡ˆ" class="headerlink" title="å…³äºä¸Šçº¿åˆå§‹åŒ–è„šæœ¬ç®¡ç†æ–¹æ¡ˆ"></a>å…³äºä¸Šçº¿åˆå§‹åŒ–è„šæœ¬ç®¡ç†æ–¹æ¡ˆ</h1><p>å‚è€ƒç»“æ„ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs markdown">database<br><br>  | -bsï¼ˆç³»ç»Ÿåï¼‰<br><br><span class="hljs-code">     | -design</span><br><span class="hljs-code"></span><br><span class="hljs-code">       | -DDL</span><br><span class="hljs-code"></span><br><span class="hljs-code">         | -20180101</span><br><span class="hljs-code"></span><br><span class="hljs-code">           create_table_å·¥å•å·.sql</span><br><span class="hljs-code"></span><br><span class="hljs-code">           alter_table_å·¥å•å·.sql</span><br><span class="hljs-code"></span><br><span class="hljs-code">           create_sequence_å·¥å•å·.sql</span><br><span class="hljs-code"></span><br><span class="hljs-code">           pkg_åå­—ä¸å˜.pckï¼ˆå­˜å‚¨è¿‡ç¨‹åŒ…éå¢é‡ï¼Œç›´æ¥æ›¿æ¢ï¼‰</span><br><span class="hljs-code"></span><br><span class="hljs-code">         | -20180202</span><br><span class="hljs-code"></span><br><span class="hljs-code">       | -DML</span><br><span class="hljs-code"></span><br><span class="hljs-code">         | -20180101</span><br><span class="hljs-code"></span><br><span class="hljs-code">           dml_è¡¨å_å·¥å•å·.sql</span><br><span class="hljs-code"></span><br><span class="hljs-code">         | -20180202</span><br><span class="hljs-code"></span><br><span class="hljs-code">     | -develop</span><br><span class="hljs-code"></span><br><span class="hljs-code">      | -DDL</span><br><span class="hljs-code"></span><br><span class="hljs-code">      | -DML</span><br></code></pre></td></tr></table></figure><blockquote><p>database</p><blockquote><p>-bsï¼ˆç³»ç»Ÿåï¼‰</p><blockquote><p>-design</p><blockquote><p>-DDL</p><blockquote><p>-20180101</p><blockquote><p>create_table_å·¥å•å·.sql</p><p>alter_table_å·¥å•å·.sql</p><p>create_sequence_å·¥å•å·.sql</p><p>pkg_åå­—ä¸å˜.pckï¼ˆå­˜å‚¨è¿‡ç¨‹åŒ…éå¢é‡ï¼Œç›´æ¥æ›¿æ¢ï¼‰</p></blockquote></blockquote><p>-DML</p><blockquote><p>-20180101</p><blockquote><p>dml_è¡¨å_å·¥å•å·.sql</p></blockquote><p>-20180202</p></blockquote></blockquote><p>-develop</p><blockquote><p>-DDL</p><p>-DML</p></blockquote></blockquote></blockquote></blockquote><p>å»ºè®®ç»“æ„ï¼š</p><blockquote><p>database</p><blockquote><p>-ERPï¼ˆç³»ç»Ÿ1ï¼‰</p><blockquote><p>-æ‰€å±è¿­ä»£ï¼ˆç‰ˆæœ¬å·ï¼‰</p><blockquote><p>-DDL</p><blockquote><p>-20180101</p><blockquote><p>create_table_task_1234.sql</p></blockquote></blockquote><p>-DML</p><blockquote><p>-20180101</p><blockquote><p>insert_task_1234.sql</p><p>update_task_1234.sql</p><p>delete_task_1234.sql</p></blockquote><p>-20180202</p></blockquote></blockquote></blockquote><p>-TAï¼ˆç³»ç»Ÿ2ï¼‰</p><p>-HRMï¼ˆç³»ç»Ÿ3ï¼‰</p></blockquote></blockquote>]]></content>
    
    
    <categories>
      
      <category>æŠ€æœ¯åˆ†äº«</category>
      
      <category>å¾…åˆ†ç±»</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è„šæœ¬ç®¡ç†</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
